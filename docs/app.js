!function(){"use strict";var e="undefined"==typeof global?self:global;if("function"!=typeof e.require){var t={},r={},i={},n={}.hasOwnProperty,o=/^\.\.?(\/|$)/,a=function(e,t){for(var r,i=[],n=(o.test(t)?e+"/"+t:t).split("/"),a=0,s=n.length;a<s;a++)".."===(r=n[a])?i.pop():"."!==r&&""!==r&&i.push(r);return i.join("/")},s=function(e){return e.split("/").slice(0,-1).join("/")},l=function(t,i){var n,o={id:t,exports:{},hot:d&&d.createHot(t)};return r[t]=o,i(o.exports,(n=t,function(t){var r=a(s(n),t);return e.require(r,n)}),o),o.exports},u=function(e){var t=i[e];return t&&e!==t?u(t):e},c=function(e,i){null==i&&(i="/");var o=u(e);if(n.call(r,o))return r[o].exports;if(n.call(t,o))return l(o,t[o]);throw new Error("Cannot find module '"+e+"' from '"+i+"'")};c.alias=function(e,t){i[t]=e};var h=/\.[^.\/]+$/,f=/\/index(\.[^\/]+)?$/;c.register=c.define=function(e,o){if(e&&"object"==typeof e)for(var a in e)n.call(e,a)&&c.register(a,e[a]);else t[e]=o,delete r[e],function(e){if(h.test(e)){var t=e.replace(h,"");n.call(i,t)&&i[t].replace(h,"")!==t+"/index"||(i[t]=e)}if(f.test(e)){var r=e.replace(f,"");n.call(i,r)||(i[r]=e)}}(e)},c.list=function(){var e=[];for(var r in t)n.call(t,r)&&e.push(r);return e};var d=e._hmr&&new e._hmr(function(e,t){return u(a(s(e),t))},c,t,r);c._cache=r,c.hmr=d&&d.wrap,c.brunch=!0,e.require=c}}(),function(){"undefined"==typeof window||window;var e=function(e,t,r){var i={},n=function(t,r){try{return e(r+"/node_modules/"+t)}catch(e){if(-1===e.toString().indexOf("Cannot find module"))throw e;if(-1!==r.indexOf("node_modules")){var o=r.split("/"),a=o.lastIndexOf("node_modules"),s=o.slice(0,a).join("/");return n(t,s)}}return i};return function(o){if(o in t&&(o=t[o]),o){if("."!==o[0]&&r){var a=n(o,r);if(a!==i)return a}return e(o)}}};require.register("curvature/base/Bag.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Bag=void 0;var e=r("./Bindable"),i=r("./Mixin"),n=r("../mixin/EventTargetMixin"),o=e=>Number(e),a=Symbol("Mapped"),s=Symbol("Has"),l=Symbol("Add"),u=Symbol("Remove"),c=Symbol("Delete");class h extends(i.Mixin.with(n.EventTargetMixin)){constructor(t){super(),this.changeCallback=t,this.content=new Map,this.current=0,this.length=0,this.list=e.Bindable.makeBindable([]),this.meta=Symbol("meta"),this.type=void 0}has(e){return this[a]?this[a].has(e):this[s](e)}[s](e){return this.content.has(e)}add(e){return this[a]?this[a].add(e):this[l](e)}[l](t){if(void 0===t||!(t instanceof Object))throw new Error("Only objects may be added to Bags.");if(this.type&&!(t instanceof this.type))throw console.error(this.type,t),new Error(`Only objects of type ${this.type} may be added to this Bag.`);if(t=e.Bindable.make(t),!this.content.has(t)){var r=new CustomEvent("adding",{detail:{item:t}});if(this.dispatchEvent(r)){var i=o(this.current++);this.content.set(t,i),this.list[i]=t,this.changeCallback&&this.changeCallback(t,this.meta,h.ITEM_ADDED,i);var n=new CustomEvent("added",{detail:{item:t,id:i}});return this.dispatchEvent(n),this.length=this.size,i}}}remove(e){return this[a]?this[a].remove(e):this[u](e)}[u](t){if(void 0===t||!(t instanceof Object))throw new Error("Only objects may be removed from Bags.");if(this.type&&!(t instanceof this.type))throw console.error(this.type,t),new Error(`Only objects of type ${this.type} may be removed from this Bag.`);if(t=e.Bindable.make(t),!this.content.has(t))return this.changeCallback&&this.changeCallback(t,this.meta,0,void 0),!1;var r=new CustomEvent("removing",{detail:{item:t}});if(this.dispatchEvent(r)){var i=this.content.get(t);delete this.list[i],this.content.delete(t),this.changeCallback&&this.changeCallback(t,this.meta,h.ITEM_REMOVED,i);var n=new CustomEvent("removed",{detail:{item:t,id:i}});return this.dispatchEvent(n),this.length=this.size,t}}delete(e){if(this[a])return this[a].delete(e);this[c](e)}[c](e){this.remove(e)}map(e=(e=>e),t=(e=>e)){var r=new WeakMap,i=new h;return i[a]=this,this.addEventListener("added",n=>{var o=n.detail.item;if(t(o)&&!r.has(o)){var a=e(o);r.set(o,a),i[l](a)}}),this.addEventListener("removed",e=>{var t=e.detail.item;if(r.has(t)){var n=r.get(t);r.delete(t),i[u](n)}}),i}get size(){return this.content.size}items(){return Array.from(this.content.entries()).map(e=>e[0])}}t.Bag=h,Object.defineProperty(h,"ITEM_ADDED",{configurable:!1,enumerable:!1,writable:!0,value:1}),Object.defineProperty(h,"ITEM_REMOVED",{configurable:!1,enumerable:!1,writable:!0,value:-1})}()}),require.register("curvature/base/Bindable.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";function e(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Object.defineProperty(t,"__esModule",{value:!0}),t.Bindable=void 0;var r=Symbol("ref"),i=Symbol("original"),n=Symbol("deck"),o=Symbol("binding"),a=Symbol("subBinding"),s=Symbol("bindingAll"),l=Symbol("isBindable"),u=Symbol("wrapping"),c=Symbol("Names"),h=Symbol("executing"),f=Symbol("stack"),d=(Symbol("object"),Symbol("wrapped")),p=Symbol("unwrapped"),v=Symbol("getProto"),m=Symbol("onGet"),y=Symbol("onAllGet"),b=Symbol("bindChain"),g=Symbol("Descriptors"),w=Symbol("Before"),x=Symbol("After"),_=Symbol("NoGetters"),T=Symbol("Prevent"),E=Object.getPrototypeOf(Int8Array),S=Set.prototype[Symbol.iterator],P=Map.prototype[Symbol.iterator],j="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:void 0,O=e=>"function"==typeof j.Map&&e instanceof j.Map||"function"==typeof j.Set&&e instanceof j.Set||"function"==typeof j.Node&&e instanceof j.Node||"function"==typeof j.WeakMap&&e instanceof j.WeakMap||"function"==typeof j.Location&&e instanceof j.Location||"function"==typeof j.Storage&&e instanceof j.Storage||"function"==typeof j.WeakSet&&e instanceof j.WeakSet||"function"==typeof j.ArrayBuffer&&e instanceof j.ArrayBuffer||"function"==typeof j.Promise&&e instanceof j.Promise||"function"==typeof j.File&&e instanceof j.File||"function"==typeof j.Event&&e instanceof j.Event||"function"==typeof j.CustomEvent&&e instanceof j.CustomEvent||"function"==typeof j.Gamepad&&e instanceof j.Gamepad||"function"==typeof j.ResizeObserver&&e instanceof j.ResizeObserver||"function"==typeof j.MutationObserver&&e instanceof j.MutationObserver||"function"==typeof j.PerformanceObserver&&e instanceof j.PerformanceObserver||"function"==typeof j.IntersectionObserver&&e instanceof j.IntersectionObserver||"function"==typeof j.IDBCursor&&e instanceof j.IDBCursor||"function"==typeof j.IDBCursorWithValue&&e instanceof j.IDBCursorWithValue||"function"==typeof j.IDBDatabase&&e instanceof j.IDBDatabase||"function"==typeof j.IDBFactory&&e instanceof j.IDBFactory||"function"==typeof j.IDBIndex&&e instanceof j.IDBIndex||"function"==typeof j.IDBKeyRange&&e instanceof j.IDBKeyRange||"function"==typeof j.IDBObjectStore&&e instanceof j.IDBObjectStore||"function"==typeof j.IDBOpenDBRequest&&e instanceof j.IDBOpenDBRequest||"function"==typeof j.IDBRequest&&e instanceof j.IDBRequest||"function"==typeof j.IDBTransaction&&e instanceof j.IDBTransaction||"function"==typeof j.IDBVersionChangeEvent&&e instanceof j.IDBVersionChangeEvent||"function"==typeof j.FileSystemFileHandle&&e instanceof j.FileSystemFileHandle||"function"==typeof j.RTCPeerConnection&&e instanceof j.RTCPeerConnection||"function"==typeof j.ServiceWorkerRegistration&&e instanceof j.ServiceWorkerRegistration||"function"==typeof j.WebGLTexture&&e instanceof j.WebGLTexture;class C{static isBindable(e){return!!(e&&e[l]&&e[T])&&e[l]===C}static onDeck(e,t){return e[n].get(t)||!1}static ref(e){return e[r]||e||!1}static makeBindable(e){return this.make(e)}static shuck(e,t){t=t||new Map;var r=Object.create({});if(e instanceof E||e instanceof ArrayBuffer){var n=e.slice(0);return t.set(e,n),n}var o=Object.keys(e);for(var a in o){var s=o[a];if("___"!==s.substring(0,3)){var l=t.get(e[s]);if(l)r[s]=l;else if(e[s]!==e){if(e[s]&&"object"==typeof e[s]){var u=e[s];C.isBindable(e[s])&&(u=e[s][i]),r[s]=this.shuck(u,t)}else r[s]=e[s];t.set(e[s],r[s])}else t.set(e[s],r),r[s]=r}}return C.isBindable(e)&&(delete r.bindTo,delete r.isBound),r}static make(e){if(e[T])return e;if(!e||!["function","object"].includes(typeof e))return e;if(r in e)return e[r];if(e[l])return e;if(Object.isSealed(e)||Object.isFrozen(e)||!Object.isExtensible(e)||O(e))return e;Object.defineProperty(e,l,{configurable:!1,enumerable:!1,writable:!1,value:C}),Object.defineProperty(e,r,{configurable:!0,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(e,i,{configurable:!1,enumerable:!1,writable:!1,value:e}),Object.defineProperty(e,n,{configurable:!1,enumerable:!1,writable:!1,value:new Map}),Object.defineProperty(e,o,{configurable:!1,enumerable:!1,writable:!1,value:Object.create(null)}),Object.defineProperty(e,a,{configurable:!1,enumerable:!1,writable:!1,value:new Map}),Object.defineProperty(e,s,{configurable:!1,enumerable:!1,writable:!1,value:new Set}),Object.defineProperty(e,h,{enumerable:!1,writable:!0}),Object.defineProperty(e,u,{enumerable:!1,writable:!0}),Object.defineProperty(e,f,{configurable:!1,enumerable:!1,writable:!1,value:[]}),Object.defineProperty(e,w,{configurable:!1,enumerable:!1,writable:!1,value:new Set}),Object.defineProperty(e,x,{configurable:!1,enumerable:!1,writable:!1,value:new Set}),Object.defineProperty(e,d,{configurable:!1,enumerable:!1,writable:!1,value:Object.preventExtensions(new Map)}),Object.defineProperty(e,p,{configurable:!1,enumerable:!1,writable:!1,value:Object.preventExtensions(new Map)}),Object.defineProperty(e,g,{configurable:!1,enumerable:!1,writable:!1,value:Object.preventExtensions(new Map)});var t=(r,i=null,n={})=>{var l=!1;if(Array.isArray(r)){var u=r.map(e=>t(e,i,n));return()=>u.forEach(e=>e())}if(r instanceof Function&&(n=i||{},i=r,l=!0),n.delay>=0&&(i=this.wrapDelayCallback(i,n.delay)),n.throttle>=0&&(i=this.wrapThrottleCallback(i,n.throttle)),n.wait>=0&&(i=this.wrapWaitCallback(i,n.wait)),n.frame&&(i=this.wrapFrameCallback(i,n.frame)),n.idle&&(i=this.wrapIdleCallback(i)),l){if(e[s].add(i),!("now"in n)||n.now)for(var c in e)i(e[c],c,e,!1);return()=>{e[s].delete(i)}}if(e[o][r]||(e[o][r]=new Set),n.children){var h=i;i=((...t)=>{var r=t[0],i=e[a].get(h);if(i&&(e[a].delete(h),i()),"object"==typeof r){var o=C.make(r);C.isBindable(o)&&e[a].set(h,o.bindTo((...e)=>h(...t,...e),Object.assign({},n,{children:!1}))),h(...t)}else h(...t)})}e[o][r].add(i),"now"in n&&!n.now||i(e[r],r,e,!1);var f=()=>{var t=e[a].get(i);t&&(e[a].delete(i),t()),e[o][r]&&e[o][r].has(i)&&e[o][r].delete(i)};return n.removeWith&&n.removeWith instanceof View&&n.removeWith.onRemove(()=>f),f};Object.defineProperty(e,"bindTo",{configurable:!1,enumerable:!1,writable:!1,value:t});Object.defineProperty(e,b,{configurable:!1,enumerable:!1,writable:!1,value:(t,r)=>{var i=t.split("."),n=i.shift(),o=i.slice(0),a=[];return a.push(e.bindTo(n,(e,t,i,n)=>{var s=o.join(".");0!==o.length?(void 0===e&&(e=i[t]=this.make({})),a=a.concat(e[b](s,r))):r(e,t,i,n)})),()=>a.forEach(e=>e())}}),Object.defineProperty(e,"___before",{configurable:!1,enumerable:!1,writable:!1,value:t=>(e[w].add(t),()=>e[w].delete(t))}),Object.defineProperty(e,"___after",{configurable:!1,enumerable:!1,writable:!1,value:t=>(e[x].add(t),()=>e[x].delete(t))});for(var R in Object.defineProperty(e,"isBound",{configurable:!1,enumerable:!1,writable:!1,value:()=>{if(e[s].size)return!0;for(var t of Object.values(e[o]))if(t.size)return!0;return!1}}),e)e[R]&&"object"==typeof e[R]&&(e[R][r]||e[R]instanceof Promise||Object.isExtensible(e[R])&&!Object.isSealed(e[R])&&(O(e[R])||(e[R]=C.make(e[R]))));var k=e[g],A=e[d],B=e[f],M=Object.create(null);return M.set=((t,r,i)=>{if(i&&"object"==typeof i&&(i=C.make(i),t[r]===i))return!0;A.has(r)&&A.delete(r);var a=e[n],l=a.has(r),u=l&&a.get(r);if(l&&u===i)return!0;if(r.slice&&"___"===r.slice(-3))return!0;if(t[r]===i||"number"==typeof i&&isNaN(u)&&isNaN(i))return!0;for(var c of(a.set(r,i),e[s]))c(i,r,t,!1);if(r in e[o])for(var h of e[o][r])h(i,r,t,!1,t[r]);if(a.delete(r),j.File&&t instanceof j.File&&"lastModifiedDate"==r||Reflect.set(t,r,i),Array.isArray(t)&&e[o].length)for(var f in e[o].length)(0,e[o].length[f])(t.length,"length",t,!1,t.length);return!0}),M.construct=((t,r)=>{var n="constructor";for(var o of t[w])o(t,n,e[f],void 0,r);var a=C.make(new t[i](...r));for(var s of t[x])s(t,n,e[f],a,r);return a}),M.deleteProperty=((t,r)=>{var i=e[n];if(i.has(r))return!0;if(!(r in t))return!0;if(k.has(r)){var a=k.get(r);if(a&&!a.configurable)return!1;k.delete(r)}for(var l of(i.set(r,null),A.has(r)&&A.delete(r),e[s]))l(void 0,r,t,!0,t[r]);if(r in e[o])for(var u of e[o][r])u(void 0,r,t,!0,t[r]);return Reflect.deleteProperty(t,r),i.delete(r),!0}),e[_]||(M.getPrototypeOf=(t=>v in e?e[v]:Reflect.getPrototypeOf(t)),M.get=((t,n)=>{if(A.has(n))return A.get(n);if(n===r||n===i||"apply"===n||"isBound"===n||"bindTo"===n||"__proto__"===n||"constructor"===n)return e[n];var o;if(k.has(n)?o=k.get(n):(o=Object.getOwnPropertyDescriptor(e,n),k.set(n,o)),o&&!o.configurable&&!o.writable)return e[n];if(y in e)return e[y](n);if(m in e&&!(n in e))return e[m](n);if(o&&!o.configurable&&!o.writable)return A.set(n,e[n]),e[n];if("function"==typeof e[n]){if(c in e[n])return e[n];e[p].set(n,e[n]);var a=Object.getPrototypeOf(e)[n]===e[n],s=O(e)||"function"==typeof e[Symbol.iterator]&&"next"===n||"function"==typeof E&&e instanceof E||"function"==typeof EventTarget&&e instanceof EventTarget||"function"==typeof Date&&e instanceof Date||"function"==typeof P&&e.prototype===P||"function"==typeof S&&e.prototype===S?e:e[r],l=function(...t){for(var r of(e[h]=n,B.unshift(n),e[w]))r(e,n,B,e,t);var i;if(new.target)i=new(e[p].get(n))(...t);else{var o=e[p].get(n);i=a?o.apply(s||e,t):o(...t)}for(var l of e[x])l(e,n,B,e,t);return e[h]=null,B.shift(),i};l[y]=(t=>e[n][t]);var u=C.make(l);return A.set(n,u),u}return e[n]})),Object.defineProperty(e,r,{configurable:!1,enumerable:!1,writable:!1,value:new Proxy(e,M)}),e[r]}static clearBindings(e){var t=(e=>(...t)=>t.map(e))(e=>Object.keys(e).map(t=>delete e[t]));e[s].clear(),t(e[d],e[o],e[x],e[w])}static resolve(e,t,r=!1){for(var i,n=t.split("."),o=n[0];n.length;){if(r&&1===n.length)return[this.make(e),n.shift(),o];(i=n.shift())in e&&e[i]&&"object"==typeof e[i]||(e[i]=Object.create(null)),e=this.make(e[i])}return[this.make(e),i,o]}static wrapDelayCallback(e,t){return(...r)=>setTimeout(()=>e(...r),t)}static wrapThrottleCallback(e,t){return this.throttles.set(e,!1),(...r)=>{this.throttles.get(e,!0)||(e(...r),this.throttles.set(e,!0),setTimeout(()=>{this.throttles.set(e,!1)},t))}}static wrapWaitCallback(e,t){return(...r)=>{var i;(i=this.waiters.get(e))&&(this.waiters.delete(e),clearTimeout(i)),i=setTimeout(()=>e(...r),t),this.waiters.set(e,i)}}static wrapFrameCallback(e,t){return(...t)=>{requestAnimationFrame(()=>e(...t))}}static wrapIdleCallback(e){return(...t)=>{(window.requestIdleCallback||requestAnimationFrame)(()=>e(...t))}}}t.Bindable=C,e(C,"waiters",new WeakMap),e(C,"throttles",new WeakMap),Object.defineProperty(C,"Prevent",{configurable:!1,enumerable:!1,writable:!1,value:T}),Object.defineProperty(C,"OnGet",{configurable:!1,enumerable:!1,writable:!1,value:m}),Object.defineProperty(C,"NoGetters",{configurable:!1,enumerable:!1,writable:!1,value:_}),Object.defineProperty(C,"GetProto",{configurable:!1,enumerable:!1,writable:!1,value:v}),Object.defineProperty(C,"OnAllGet",{configurable:!1,enumerable:!1,writable:!1,value:y})}()}),require.register("curvature/base/Cache.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Cache=void 0;t.Cache=class{static store(e,t,r,i="standard"){var n=0;r&&(n=1e3*r+(new Date).getTime()),this.buckets||(this.buckets=new Map),this.buckets.has(i)||this.buckets.set(i,new Map);var o=new CustomEvent("cvCacheStore",{cancelable:!0,detail:{key:e,value:t,expiry:r,bucket:i}});document.dispatchEvent(o)&&this.buckets.get(i).set(e,{value:t,expiration:n})}static load(e,t=!1,r="standard"){var i=new CustomEvent("cvCacheLoad",{cancelable:!0,detail:{key:e,defaultvalue:t,bucket:r}});if(!document.dispatchEvent(i))return t;if(this.buckets&&this.buckets.has(r)&&this.buckets.get(r).has(e)){var n=this.buckets.get(r).get(e);if(0===n.expiration||n.expiration>(new Date).getTime())return this.buckets.get(r).get(e).value}return t}}}()}),require.register("curvature/base/Config.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Config=void 0;var e={},i=r,n="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:void 0;try{e=i("/Config").Config}catch(t){!0===n.devMode&&console.error(t),e={}}class o{static get(e){return this.configs[e]}static set(e,t){return this.configs[e]=t,this}static dump(){return this.configs}static init(...e){for(var t in e){var r=e[t];for(var i in"string"==typeof r&&(r=JSON.parse(r)),r){var n=r[i];return this.configs[i]=n}}return this}}t.Config=o,Object.defineProperty(o,"configs",{configurable:!1,enumerable:!1,writable:!1,value:e})}()}),require.register("curvature/base/Dom.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Dom=void 0;t.Dom=class{static mapTags(e,t,r,i,n){var o=[],a=!0;i&&(a=!1);var s=!1,{Node:l,Element:u,NodeFilter:c,document:h}=globalThis.window,f=h.createTreeWalker(e,c.SHOW_ELEMENT|c.SHOW_TEXT,{acceptNode:(e,r)=>{if(!a){if(e!==i)return c.FILTER_SKIP;a=!0}return n&&e===n&&(s=!0),s?c.FILTER_SKIP:t?e instanceof u&&e.matches(t)?c.FILTER_ACCEPT:c.FILTER_SKIP:c.FILTER_ACCEPT}},!1);for(0;f.nextNode();)o.push(r(f.currentNode,f));return o}static dispatchEvent(e,t){e.dispatchEvent(t),this.mapTags(e,!1,e=>{e.dispatchEvent(t)})}}}()}),require.register("curvature/base/Mixin.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Mixin=void 0;var e=r("./Bindable"),i=Symbol("constructor");Symbol("mixinList");class n{static from(e,...t){var r=class extends e{constructor(...i){var o=e.constructor?super(...i):null;for(var a of t)switch(a[n.Constructor]&&a[n.Constructor].apply(this),typeof a){case"function":n.mixClass(a,r);break;case"object":n.mixObject(a,this)}return o}};return r}static make(...e){var t=e.pop();return n.to(t,...e)}static to(e,...t){var r={};t.map(t=>{switch(typeof t){case"object":Object.assign(r,Object.getOwnPropertyDescriptors(t));break;case"function":Object.assign(r,Object.getOwnPropertyDescriptors(t.prototype))}delete r.constructor,Object.defineProperties(e.prototype,r)})}static with(...e){return this.from(class{constructor(){}},...e)}static mixObject(e,t){for(var r of Object.getOwnPropertyNames(e))"function"!=typeof e[r]?t[r]=e[r]:t[r]=e[r].bind(t);for(var i of Object.getOwnPropertySymbols(e))"function"!=typeof e[i]?t[i]=e[i]:t[i]=e[i].bind(t)}static mixClass(e,t){for(var r of Object.getOwnPropertyNames(e.prototype))if(!["name","prototype","length"].includes(r)){var i=Object.getOwnPropertyDescriptor(t,r);i&&!i.writable||("function"==typeof e[r]?t.prototype[r]=e.prototype[r].bind(t.prototype):t.prototype[r]=e.prototype[r])}for(var n of Object.getOwnPropertySymbols(e.prototype))"function"==typeof e[n]?t.prototype[n]=e.prototype[n].bind(t.prototype):t.prototype[n]=e.prototype[n];var o=function(){if(["name","prototype","length"].includes(a))return 0;var r=Object.getOwnPropertyDescriptor(t,a);if(r&&!r.writable)return 0;if("function"!=typeof e[a])return t[a]=e[a],0;var i=t[a]||!1,n=e[a].bind(t);t[a]=((...e)=>(i&&i(...e),n(...e)))};for(var a of Object.getOwnPropertyNames(e))o();var s=function(){if("function"!=typeof e[l])return t.prototype[l]=e[l],1;var r=t[l]||!1,i=e[l].bind(t);t[l]=((...e)=>(r&&r(...e),i(...e)))};for(var l of Object.getOwnPropertySymbols(e))s()}static mix(t){for(var r={},i={},n=e.Bindable.makeBindable(t),o=function(e){var t=Object.getOwnPropertyNames(e.prototype),o=Object.getOwnPropertyNames(e),a=/^(before|after)__(.+)/,s=function(t){var i=t.match(a);if(i){switch(i[1]){case"before":n.___before((r,n,o,a,s)=>{if(n===i[2])return e[t].bind(a)(...s)});break;case"after":n.___after((r,n,o,a,s)=>{if(n===i[2])return e[t].bind(a)(...s)})}return 0}return r[t]?0:"function"!=typeof e[t]?0:void(r[t]=e[t])};for(var l of o)s(l);var u=function(t){var r=t.match(a);if(r){switch(r[1]){case"before":n.___before((i,n,o,a,s)=>{if(n===r[2])return e.prototype[t].bind(a)(...s)});break;case"after":n.___after((i,n,o,a,s)=>{if(n===r[2])return e.prototype[t].bind(a)(...s)})}return 0}return i[t]?0:"function"!=typeof e.prototype[t]?0:void(i[t]=e.prototype[t])};for(var c of t)u(c)},a=this;a&&a.prototype;a=Object.getPrototypeOf(a))o(a);for(var s in r)t[s]=r[s].bind(t);var l=function(e){t.prototype[e]=function(...t){return i[e].apply(this,t)}};for(var u in i)l(u);return n}}t.Mixin=n,n.Constructor=i}()}),require.register("curvature/base/Router.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Router=void 0;var e,i=r("./View"),n=(r("./Cache"),r("./Config")),o=r("./Routes"),a=Symbol("NotFound"),s=Symbol("Internal"),l="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:void 0;l.CustomEvent=null!==(e=l.CustomEvent)&&void 0!==e?e:l.Event;class u{static wait(e,t="DOMContentLoaded",r=document){r.addEventListener(t,()=>{this.listen(e)})}static listen(e,t=!1){this.listener=e||this.listener,this.routes=t||e.routes,Object.assign(this.query,this.queryOver({}));var r=t=>{t.preventDefault(),t.state&&"routedId"in t.state?(t.state.routedId<=this.routeCount?(this.history.splice(t.state.routedId),this.routeCount=t.state.routedId):t.state.routedId>this.routeCount&&(this.history.push(t.state.prev),this.routeCount=t.state.routedId),this.state=t.state):null!==this.prevPath&&this.prevPath!==location.pathname&&this.history.push(this.prevPath),this.isOriginLimited(location)?this.match(this.nextPath,e):this.match(location.pathname,e)};window.addEventListener("cvUrlChanged",r),window.addEventListener("popstate",r);var i=!this.isOriginLimited(location)&&location.pathname+location.search;!this.isOriginLimited(location)&&location.hash&&(i+=location.hash);var n={routedId:this.routeCount,url:location.pathname,prev:this.prevPath};this.isOriginLimited(location)||history.replaceState(n,null,location.pathname),this.go(!1!==i?i:"/")}static go(e,t=!1){var r=n.Config.get("title");r&&(document.title=r);var i={routedId:this.routeCount,prev:this.prevPath,url:location.pathname};-1===t?this.match(e,this.listener,!0):this.isOriginLimited(location)?this.nextPath=e:2===t&&location.pathname!==e?history.replaceState(i,null,e):location.pathname!==e&&history.pushState(i,null,e),(!t||t<0)&&(!1===t&&(this.path=null),t||("#"===e.substring(0,1)?window.dispatchEvent(new HashChangeEvent("hashchange")):window.dispatchEvent(new CustomEvent("cvUrlChanged")))),this.prevPath=e}static processRoute(e,t,r){return"function"==typeof e[t]?e[t].prototype instanceof i.View?new e[t](r):e[t](r):e[t]}static handleError(e,t,r,i,n,o,a,u){"undefined"!=typeof document&&document.dispatchEvent(new CustomEvent("cvRouteError",{detail:{error:e,path:o,prev:a,view:n,routes:t,selected:r}}));var c=l.devMode?"Unexpected error: "+String(e):"Unexpected error.";t[s]&&(i[s]=e,c=this.processRoute(t,s,i)),this.update(n,o,c,t,r,i,u)}static match(e,t,r=!1){var i=null,n=!1;if(!0===r&&(n=r),r&&"object"==typeof r&&(n=r.forceRefresh,i=r.event),"undefined"==typeof document||this.path!==e||n){var s="http://example.com";"undefined"!=typeof document&&(s=this.isOriginLimited(location)?s:location.origin,this.queryString=location.search);var l=new URL(e,s);e=this.path=l.pathname,"undefined"==typeof document&&(this.queryString=l.search);var u=this.prevPath,c=t&&t.args?t.args.content:null,h=this.routes||t&&t.routes||o.Routes.dump(),f=new URLSearchParams(this.queryString);for(var d in i&&i.request&&(this.request=i.request),Object.keys(this.query))delete this.query[d];for(var[p,v]of f)this.query[p]=v;var m={},y=!1,b="";for(var g in"/"===e.substring(0,1)&&(e=e.substring(1)),e=e.split("/"),this.query)m[g]=this.query[g];e:for(var w in h){var x=w.split("/");if(!(x.length<e.length&&"*"!==x[x.length-1])){for(var _ in x)if("%"==x[_].substr(0,1)){var T=null,E=/^%(\w+)\??/.exec(x[_]);if(E&&E[1]&&(T=E[1]),!T)throw new Error(`${x[_]} is not a valid argument segment in route "${w}"`);if(e[_])m[T]=e[_];else{if("?"!=x[_].substr(x[_].length-1,1))continue e;m[T]=""}}else if("*"!==x[_]&&e[_]!==x[_])continue e;y=w,b=h[w],"*"===x[x.length-1]&&(m.pathparts=e.slice(x.length-1));break}}var S=new CustomEvent("cvRouteStart",{cancelable:!0,detail:{path:e,prev:u,root:t,selected:y,routes:h}});if("undefined"==typeof document||document.dispatchEvent(S)){if(!n&&t&&c&&"object"==typeof b&&c.constructor===b.constructor&&!(b instanceof Promise)&&c.update(m))return t.args.content=c,!0;y in h||(h[y]=h[a]);try{return!1===(b=this.processRoute(h,y,m))&&(b=this.processRoute(h,a,m)),"undefined"==typeof document?b instanceof Promise?b:Promise.resolve(b):b instanceof Promise?b.then(r=>this.update(t,e,r,h,y,m,n)).catch(r=>{this.handleError(r,h,y,m,t,e,u,n)}):this.update(t,e,b,h,y,m,n)}catch(r){this.handleError(r,h,y,m,t,e,u,n)}}}}static update(e,t,r,n,o,a,s){if(e){var l=this.prevPath,u=new CustomEvent("cvRoute",{cancelable:!0,detail:{result:r,path:t,prev:l,view:e,routes:n,selected:o}});!1!==r&&(e.args.content instanceof i.View&&(e.args.content.pause(!0),e.args.content.remove()),document.dispatchEvent(u)&&(e.args.content=r),r instanceof i.View&&(r.pause(!1),r.update(a,s)));var c=new CustomEvent("cvRouteEnd",{cancelable:!0,detail:{result:r,path:t,prev:l,view:e,routes:n,selected:o}});document.dispatchEvent(c)}}static isOriginLimited({origin:e}){return"null"===e||"file://"===e}static queryOver(e={}){var t=new URLSearchParams(location.search),r={},i={};for(var n of t)i[n[0]]=n[1];return delete(r=Object.assign(r,i,e)).api,r}static queryToString(e={},t=!1){var r=[],i=e;for(var n in t||(i=this.queryOver(e)),i)""!==i[n]&&r.push(n+"="+encodeURIComponent(i[n]));return r.join("&")}static setQuery(e,t,r){var i=this.queryOver();i[e]=t,void 0===t&&delete i[e];var n=this.queryToString(i,!0);this.go(location.pathname+(n?"?"+n:"?"),r)}}t.Router=u,Object.defineProperty(u,"query",{configurable:!1,enumerable:!1,writable:!1,value:{}}),Object.defineProperty(u,"history",{configurable:!1,enumerable:!1,writable:!1,value:[]}),Object.defineProperty(u,"routeCount",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(u,"prevPath",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(u,"queryString",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(u,"InternalError",{configurable:!1,enumerable:!1,writable:!1,value:s}),Object.defineProperty(u,"NotFoundError",{configurable:!1,enumerable:!1,writable:!1,value:a})}()}),require.register("curvature/base/Routes.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Routes=void 0;var e={},i=r,n=!1,o=()=>{if(!n){try{Object.assign(e,i("Routes").Routes||{})}catch(e){!0===globalThis.devMode&&console.warn(e)}n=!0}};class a{static get(e){return o(),this.routes[e]}static dump(){return o(),this.routes}}t.Routes=a,Object.defineProperty(a,"routes",{configurable:!1,enumerable:!1,writable:!1,value:e})}()}),require.register("curvature/base/RuleSet.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RuleSet=void 0;r("./Dom");var e=r("./Tag"),i=r("./View");class n{static add(e,t){return this.globalRules=this.globalRules||{},this.globalRules[e]=this.globalRules[e]||[],this.globalRules[e].push(t),this}static apply(e=document,t=null){for(var r in this.globalRules)for(var i in this.globalRules[r]){var n=this.globalRules[r][i],o=this.wrap(e,n,t),a=e.querySelectorAll(r);for(var s of a)o(s)}}add(e,t){return this.rules=this.rules||{},this.rules[e]=this.rules[e]||[],this.rules[e].push(t),this}apply(e=document,t=null){for(var r in n.apply(e,t),this.rules)for(var i in this.rules[r]){var o=this.rules[r][i],a=n.wrap(e,o,t),s=e.querySelectorAll(r);for(var l of s)a(l)}}purge(){if(this.rules)for(var[e,t]of Object.entries(this.rules))if(this.rules[e])for(var r in this.rules[e])delete this.rules[e][r]}static wait(e="DOMContentLoaded",t=document){var r=((e,t)=>()=>(t.removeEventListener(e,r),this.apply()))(e,t);t.addEventListener(e,r)}static wrap(t,r,n=null){var o=r;return(r instanceof i.View||r&&r.prototype&&r.prototype instanceof i.View)&&(o=(()=>r)),t=>{if(void 0===t.___cvApplied___&&Object.defineProperty(t,"___cvApplied___",{enumerable:!1,writable:!1,value:new WeakSet}),!t.___cvApplied___.has(r)){var a,s;n&&(a=s=n,n.viewList&&(s=n.viewList.parent));var l=new e.Tag(t,s,null,void 0,a),u=l.element.parentNode,c=l.element.nextSibling,h=o(l);if(!1!==h&&t.___cvApplied___.add(r),h instanceof HTMLElement&&(h=new e.Tag(h)),h instanceof e.Tag){if(!h.element.contains(l.element)){for(;l.element.firstChild;)h.element.appendChild(l.element.firstChild);l.remove()}c?u.insertBefore(h.element,c):u.appendChild(h.element)}h&&h.prototype&&h.prototype instanceof i.View&&(h=new h({},n)),h instanceof i.View&&(n&&(n.cleanup.push(()=>h.remove()),n.cleanup.push(n.args.bindTo((e,t,r)=>{r[t]=e,h.args[t]=e})),n.cleanup.push(h.args.bindTo((e,t,r,i)=>{r[t]=e,n.args[t]=e}))),l.clear(),h.render(l.element))}}}}t.RuleSet=n}()}),require.register("curvature/base/SetMap.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";function e(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Object.defineProperty(t,"__esModule",{value:!0}),t.SetMap=void 0;t.SetMap=class{constructor(){e(this,"_map",new Map)}has(e){return this._map.has(e)}get(e){return this._map.get(e)}getOne(e){var t=this.get(e);for(var r of t)return r}add(e,t){var r=this._map.get(e);return r||this._map.set(e,r=new Set),r.add(t)}remove(e,t){var r=this._map.get(e);if(r){var i=r.delete(t);return r.size||this._map.delete(e),i}}values(){return new Set(...[...this._map.values()].map(e=>[...e.values()]))}}}()}),require.register("curvature/base/Tag.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tag=void 0;var e=r("./Bindable"),i=Symbol("CurrentStyle"),n=Symbol("CurrentAttrs"),o=function(e){if(this.node)for(var t in e){var r=String(e[t]);this[i].has(t)&&this[i].get(t)===e[t]||Number.isNaN(e[t])||("-"===t[0]?this.node.style.setProperty(t,r):this.node.style[t]=r,void 0!==e[t]?this[i].set(t,e[t]):this[i].delete(t))}},a=function(e){return"function"==typeof this[e]?this[e]:this.node&&"function"==typeof this.node[e]?this[e]=((...t)=>this.node[e](...t)):"style"===e?this.proxy.style:this.node&&e in this.node?this.node[e]:this[e]};t.Tag=class{constructor(t,r,s,l,u){if("string"==typeof t){var c=document.createRange().createContextualFragment(t);t=c.firstChild}this.element=e.Bindable.makeBindable(t),this.node=this.element,this.parent=r,this.direct=u,this.ref=s,this.index=l,this.cleanup=[],this[e.Bindable.OnAllGet]=a.bind(this),this[i]=new Map,this[n]=new Map;var h=e.Bindable.make(o.bind(this));return Object.defineProperty(this,"style",{value:h}),this.proxy=e.Bindable.make(this),this.proxy.style.bindTo((e,t,r,n)=>{this[i].has(t)&&this[i].get(t)===e||(this.node.style[t]=e,n||void 0===e?this[i].delete(t):this[i].set(t,e))}),this.proxy.bindTo((e,r)=>{if("index"!==r)return r in t&&t[r]!==e&&(t[r]=e),!1}),this.proxy}attr(e){for(var t in e)this[n].has(t)&&void 0===e[t]?(this.node.removeAttribute(t),this[n].delete(t)):this[n].has(t)&&this[n].get(t)===e[t]||(null===e[t]?(this.node.setAttribute(t,""),this[n].set(t,"")):(this.node.setAttribute(t,e[t]),this[n].set(t,e[t])));return this}remove(){var t;for(this.node&&this.node.remove(),e.Bindable.clearBindings(this);t=this.cleanup.shift();)t();if(this.clear(),this.node){var r=new Event("cvDomDetached");this.node.dispatchEvent(r),this.node=this.element=this.ref=this.parent=void 0}}clear(){if(this.node)for(var e=new Event("cvDomDetached");this.node.firstChild;)this.node.firstChild.dispatchEvent(e),this.node.removeChild(this.node.firstChild)}pause(e=!0){}listen(e,t,r){var i=this.node;i.addEventListener(e,t,r);var n=()=>{i.removeEventListener(e,t,r)},o=()=>{n(),n=(()=>console.warn("Already removed!"))};return this.parent.onRemove(()=>o()),o}}}()}),require.register("curvature/base/Uuid.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";function e(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Object.defineProperty(t,"__esModule",{value:!0}),t.Uuid=void 0;var r=("object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:void 0).crypto;class i{constructor(t=null,n=4){if(e(this,"uuid",null),e(this,"version",4),t){if("string"!=typeof t&&!(t instanceof i)||!t.match(/[0-9A-Fa-f]{8}(-[0-9A-Fa-f]{4}){3}-[0-9A-Fa-f]{12}/))throw new Error(`Invalid input for Uuid: "${t}"`);this.version=n,this.uuid=t}else if(r&&"function"==typeof r.randomUUID)this.uuid=r.randomUUID();else{var o=r&&"function"==typeof r.randomUUID?()=>r.getRandomValues(new Uint8Array(1))[0]:()=>Math.trunc(256*Math.random());this.uuid=([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^o()&15>>e/4).toString(16))}Object.freeze(this)}[Symbol.toPrimitive](){return this.toString()}toString(){return this.uuid}toJson(){return{version:this.version,uuid:this.uuid}}}t.Uuid=i}()}),require.register("curvature/base/View.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.View=void 0;var e=r("./Bindable"),i=r("./ViewList"),n=r("./Router"),o=r("./Uuid"),a=r("./Dom"),s=r("./Tag"),l=r("./Bag"),u=r("./RuleSet"),c=r("./Mixin"),h=r("../mixin/EventTargetMixin"),f=Symbol("dontParse"),d=Symbol("expandBind"),p=Symbol("uuid");class v extends(c.Mixin.with(h.EventTargetMixin)){get _id(){return this[p]}static from(e,t={},r=null){var i=new this(t,r);return i.template=e,i}constructor(t={},r=null){super(t,r),this[h.EventTargetMixin.Parent]=r,Object.defineProperty(this,"args",{value:e.Bindable.make(t)}),Object.defineProperty(this,p,{value:this.constructor.uuid()}),Object.defineProperty(this,"nodesAttached",{value:new l.Bag((e,t,r)=>{})}),Object.defineProperty(this,"nodesDetached",{value:new l.Bag((e,t,r)=>{})}),Object.defineProperty(this,"_onRemove",{value:new l.Bag((e,t,r)=>{})}),Object.defineProperty(this,"cleanup",{value:[]}),Object.defineProperty(this,"parent",{value:r,writable:!0}),Object.defineProperty(this,"views",{value:new Map}),Object.defineProperty(this,"viewLists",{value:new Map}),Object.defineProperty(this,"withViews",{value:new Map}),Object.defineProperty(this,"tags",{value:e.Bindable.make({})}),Object.defineProperty(this,"nodes",{value:e.Bindable.make([])}),Object.defineProperty(this,"timeouts",{value:new Map}),Object.defineProperty(this,"intervals",{value:new Map}),Object.defineProperty(this,"frames",{value:[]}),Object.defineProperty(this,"ruleSet",{value:new u.RuleSet}),Object.defineProperty(this,"preRuleSet",{value:new u.RuleSet}),Object.defineProperty(this,"subBindings",{value:{}}),Object.defineProperty(this,"templates",{value:{}}),Object.defineProperty(this,"postMapping",{value:new Set}),Object.defineProperty(this,"eventCleanup",{value:[]}),Object.defineProperty(this,"unpauseCallbacks",{value:new Map}),Object.defineProperty(this,"interpolateRegex",{value:/(\[\[((?:\$+)?[\w\.\|-]+)\]\])/g}),Object.defineProperty(this,"rendered",{value:new Promise((e,t)=>Object.defineProperty(this,"renderComplete",{value:e}))}),this.onRemove(()=>{this[h.EventTargetMixin.Parent]&&(this[h.EventTargetMixin.Parent]=null)}),this.controller=this,this.template="",this.firstNode=null,this.lastNode=null,this.viewList=null,this.mainView=null,this.preserve=!1,this.removed=!1,this.loaded=Promise.resolve(this)}static isView(){return v}onFrame(e){var t=!1,r=()=>{t=!0},i=r=>{this.removed||t||(this.paused||e(Date.now()),requestAnimationFrame(i))};return requestAnimationFrame(()=>i(Date.now())),this.frames.push(r),r}onNextFrame(e){return requestAnimationFrame(()=>e(Date.now()))}onIdle(e){return requestIdleCallback(()=>e(Date.now()))}onTimeout(e,t){var r={timeout:null,callback:null,time:e,fired:!1,created:(new Date).getTime(),paused:!1},i=()=>{t(),r.fired=!0,this.timeouts.delete(r.timeout)},n=setTimeout(i,e);return r.callback=i,r.timeout=n,this.timeouts.set(r.timeout,r),n}clearTimeout(e){if(this.timeouts.has(e)){var t=this.timeouts.get(e);clearTimeout(t.timeout),this.timeouts.delete(t.timeout)}}onInterval(e,t){var r=setInterval(t,e);return this.intervals.set(r,{timeout:r,callback:t,time:e,paused:!1}),r}clearInterval(e){if(this.intervals.has(e)){var t=this.intervals.get(e);clearTimeout(t.timeout),this.intervals.delete(t.timeout)}}pause(e){if(void 0===e&&(this.paused=!this.paused),this.paused=e,this.paused){for(var[t,r]of this.timeouts)r.fired?this.timeouts.delete(r.timeout):(clearTimeout(r.timeout),r.paused=!0,r.time=Math.max(0,r.time-(Date.now()-r.created)));for(var[i,n]of this.intervals)clearInterval(n.timeout),n.paused=!0}else{for(var[o,a]of this.timeouts)a.paused&&(a.fired?this.timeouts.delete(a.timeout):(a.timeout=setTimeout(a.callback,a.time),a.paused=!1));for(var[s,l]of this.intervals)l.paused&&(l.timeout=setInterval(l.callback,l.time),l.paused=!1);for(var[,u]of this.unpauseCallbacks)u();this.unpauseCallbacks.clear()}for(var[c,h]of this.viewLists)h.pause(!!e);for(var f in this.tags)if(Array.isArray(this.tags[f]))for(var d in this.tags[f])this.tags[f][d].pause(!!e);else this.tags[f].pause(!!e)}render(e=null,t=null,r=null){var{document:i}=globalThis.window;if(e instanceof v&&(e=e.firstNode.parentNode),t instanceof v&&(t=t.firstNode),this.firstNode)return this.reRender(e,t,r);this.dispatchEvent(new CustomEvent("render"));var n,o="object"==typeof this.template&&"function"==typeof this.template.cloneNode,a=o||v.templates.has(this.template);if(n=a?o?this.template.cloneNode(!0):v.templates.get(this.template).cloneNode(!0):i.createRange().createContextualFragment(this.template),a||o||v.templates.set(this.template,n.cloneNode(!0)),this.mainView||this.preRuleSet.apply(n,this),this.mapTags(n),this.mainView||this.ruleSet.apply(n,this),!0===globalThis.devMode?(this.firstNode=i.createComment(`Template ${this._id} Start`),this.lastNode=i.createComment(`Template ${this._id} End`)):(this.firstNode=i.createTextNode(""),this.lastNode=i.createTextNode("")),this.nodes.push(this.firstNode,...Array.from(n.childNodes),this.lastNode),this.postRender(e),this.dispatchEvent(new CustomEvent("rendered")),this.dispatchAttach()){if(e){t?(e.insertBefore(this.firstNode,t),e.insertBefore(this.lastNode,t)):(e.insertBefore(this.firstNode,null),e.insertBefore(this.lastNode,null)),e.insertBefore(n,this.lastNode);var s=e.getRootNode();if(s.isConnected)this.attached(s,e),this.dispatchAttached(s,e,r);else if(r){var l=t=>{var i=e.getRootNode();this.attached(i,e),this.dispatchAttached(i,e,r),r.removeEventListener("attached",l)};r.addEventListener("attached",l)}}return this.renderComplete(this.nodes),this.nodes}}dispatchAttach(){var{CustomEvent:e}=globalThis.window;return this.dispatchEvent(new e("attach",{cancelable:!0,target:this}))}dispatchAttached(e,t,r){var{CustomEvent:i}=globalThis.window;for(var n of(this.dispatchEvent(new i("attached",{detail:{view:r||this,node:t,root:e,mainView:this}})),this.dispatchDomAttached(r),this.nodesAttached.items()))n(e,t)}dispatchDomAttached(e){var{Node:t,CustomEvent:r}=globalThis.window;this.nodes.filter(e=>e.nodeType!==t.COMMENT_NODE).forEach(t=>{t.matches&&(t.dispatchEvent(new r("cvDomAttached",{target:t,detail:{view:e||this,mainView:this}})),a.Dom.mapTags(t,!1,(t,i)=>{t.matches&&t.dispatchEvent(new r("cvDomAttached",{target:t,detail:{view:e||this,mainView:this}}))}))})}reRender(e,t,r){var{CustomEvent:i}=globalThis.window;if(this.dispatchEvent(new i("reRender"),{cancelable:!0,target:this,view:r})){var n=new DocumentFragment;if(this.firstNode.isConnected){var o=this.nodesDetached.items();for(var a in o)o[a]()}if(n.append(...this.nodes),e){t?(e.insertBefore(this.firstNode,t),e.insertBefore(this.lastNode,t)):(e.insertBefore(this.firstNode,null),e.insertBefore(this.lastNode,null)),e.insertBefore(n,this.lastNode),this.dispatchEvent(new i("reRendered"),{cancelable:!0,target:this,view:r});var s=e.getRootNode();s.isConnected&&(this.attached(s,e),this.dispatchAttached(s,e))}return this.nodes}}mapTags(e){a.Dom.mapTags(e,!1,(e,t)=>{e[f]||(e=e.matches?(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=this.mapInterpolatableTag(e)).matches("[cv-template]")&&this.mapTemplateTag(e)||e).matches("[cv-slot]")&&this.mapSlotTag(e)||e).matches("[cv-prerender]")&&this.mapPrendererTag(e)||e).matches("[cv-link]")&&this.mapLinkTag(e)||e).matches("[cv-attr]")&&this.mapAttrTag(e)||e).matches("[cv-expand]")&&this.mapExpandableTag(e)||e).matches("[cv-ref]")&&this.mapRefTag(e)||e).matches("[cv-on]")&&this.mapOnTag(e)||e).matches("[cv-each]")&&this.mapEachTag(e)||e).matches("[cv-bind]")&&this.mapBindTag(e)||e).matches("[cv-with]")&&this.mapWithTag(e)||e).matches("[cv-if]")&&this.mapIfTag(e)||e).matches("[cv-view]")&&this.mapViewTag(e)||e:this.mapInterpolatableTag(e))!==t.currentNode&&(t.currentNode=e)}),this.postMapping.forEach(e=>e())}mapExpandableTag(t){var r=t[d];r&&(r(),t[d]=!1);var[i,n]=e.Bindable.resolve(this.args,t.getAttribute("cv-expand"),!0);return t.removeAttribute("cv-expand"),i[n]||(i[n]={}),i[n]=e.Bindable.make(i[n]),this.onRemove(t[d]=i[n].bindTo((e,r,i,n,o)=>{n||void 0===e?t.removeAttribute(r,e):null!==e?t.setAttribute(r,e):t.setAttribute(r,"")})),t}mapAttrTag(e){var t=this.compileAttrTag(e)(this);return e.replaceWith(t),t}compileAttrTag(t){var r=t.getAttribute("cv-attr").split(/[,;]/).map(e=>e.split(":"));return t.removeAttribute("cv-attr"),i=>{var n=t.cloneNode(!0),o=function(){var t=r[a][1]||r[a][0],[o,s]=e.Bindable.resolve(i.args,t,!0),l=r[a][0];i.onRemove(o.bindTo(s,(e,t,r,i)=>{i||void 0===e?n.removeAttribute(l,e):null!==e?n.setAttribute(l,e):n.setAttribute(l,"")}))};for(var a in r)o();return n}}mapInterpolatableTag(t){var r=this,i=this.interpolateRegex,{Node:n,document:o}=globalThis.window;if(t.nodeType===n.TEXT_NODE){var a=t.nodeValue;if(!this.interpolatable(a))return t;for(var l,u,c=0,d=function(){var i=l[2],u=!1,d=!1,p=i.split("|"),m=!1;if(p.length>1&&(m=r.stringTransformer(p.slice(1)),i=p[0]),"$$"===i.substr(0,2)&&(u=!0,d=!0,i=i.substr(2)),"$"===i.substr(0,1)&&(u=!0,i=i.substr(1)),"000"===i.substr(0,3))return expand=!0,i=i.substr(3),0;var y=a.substring(c,l.index);c=l.index+l[1].length;var b,g=o.createTextNode(y);g[f]=!0,t.parentNode.insertBefore(g,t),(b=u?o.createElement("div"):o.createTextNode(""))[f]=!0;var w=r.args,x=i;if(i.match(/\./)&&([w,x]=e.Bindable.resolve(r.args,i,!0)),t.parentNode.insertBefore(b,t),"object"!=typeof w)return 1;var _=(w=e.Bindable.make(w)).bindTo(x,(e,i,o)=>{if(o[i]!==e&&(o[i]instanceof v||o[i]instanceof n||o[i]instanceof s.Tag)&&(o[i].preserve||o[i].remove()),d&&!(e instanceof v)){var a=null!==e&&void 0!==e?e:"";(e=new v(r.args,r)).template=a}if(m&&(e=m(e)),e instanceof v){b.nodeValue="",e[h.EventTargetMixin.Parent]=r,e.render(t.parentNode,b,r);var l=()=>{e.preserve||e.remove()};r.onRemove(l),e.onRemove(()=>r._onRemove.remove(l))}else e instanceof n?(b.nodeValue="",t.parentNode.insertBefore(e,b),r.onRemove(()=>e.remove())):e instanceof s.Tag?(b.nodeValue="",e.node?(t.parentNode.insertBefore(e.node,b),r.onRemove(()=>e.remove())):e.remove()):(e instanceof Object&&e.__toString instanceof Function&&(e=e.__toString()),u?b.innerHTML=e:b.nodeValue=e);b[f]=!0});r.onRemove(_)};(l=i.exec(a))&&(0===(u=d())||1!==u););var p=a.substring(c),m=o.createTextNode(p);m[f]=!0,t.parentNode.insertBefore(m,t),t.nodeValue=""}else if(t.nodeType===n.ELEMENT_NODE)for(var y=function(){if(!r.interpolatable(t.attributes[b].value))return 1;for(var n,o=0,a=t.attributes[b].value,s=t.attributes[b],l={},u=[];n=i.exec(a);)u.push(a.substring(o,n.index)),l[n[2]]||(l[n[2]]=[]),l[n[2]].push(u.length),u.push(n[1]),o=n.index+n[1].length;u.push(a.substring(o));var c=function(){var i=r.args,n=h,o=h.split("|"),a=!1,c=h;o.length>1&&(a=r.stringTransformer(o.slice(1)),n=o[0]),n.match(/\./)&&([i,n]=e.Bindable.resolve(r.args,n,!0));l[c];r.onRemove(i.bindTo(n,(e,i,o,h)=>{for(var f in a&&(e=a(e)),l)for(var d in l[c])u[l[c][d]]=o[f],i===n&&(u[l[c][d]]=e);r.paused?r.unpauseCallbacks.set(s,()=>t.setAttribute(s.name,u.join(""))):t.setAttribute(s.name,u.join(""))}))};for(var h in l)c()},b=0;b<t.attributes.length;b++)y();return t}mapRefTag(e){var t=e.getAttribute("cv-ref"),[r,i=null,n=null]=t.split(":"),o=s.Tag;i&&(o=this.stringToClass(i)),e.removeAttribute("cv-ref"),Object.defineProperty(e,"___tag___",{enumerable:!1,writable:!0}),this.onRemove(()=>{e.___tag___=null,e.remove()});var a=this;this.viewList&&(a=this.viewList.parent);var l=new o(e,this,r,void 0,this);for(e.___tag___=l,this.tags[r]=l;a;){var u=this.args[n];if(void 0!==u?(a.tags[r]||(a.tags[r]=[]),a.tags[r][u]=l):a.tags[r]=l,!a.parent)break;a=a.parent}return e}mapBindTag(t){var r=t.getAttribute("cv-bind"),i=this.args,n=r,o=null;r.match(/\./)&&([i,n,o]=e.Bindable.resolve(this.args,r,!0)),i!==this.args&&(this.subBindings[r]=this.subBindings[r]||[],this.onRemove(this.args.bindTo(o,()=>{for(;this.subBindings.length;)this.subBindings.shift()()})));var l=!1;"$"===n.substr(0,1)&&(n=n.substr(1),l=!0);var u=!1,c=i.bindTo(n,(e,r,i,n,o)=>{if((o instanceof v||o instanceof Node||o instanceof s.Tag)&&o!==e&&o.remove(),["INPUT","SELECT","TEXTAREA"].includes(t.tagName)){var c=t.getAttribute("type");if(c&&"checkbox"===c.toLowerCase())t.checked=!!e;else if(c&&"radio"===c.toLowerCase())t.checked=e==t.value;else if("file"!==c)if("SELECT"===t.tagName){var d=()=>{for(var r=0;r<t.options.length;r++){t.options[r].value==e&&(t.selectedIndex=r)}};d(),this.nodesAttached.add(d)}else t.value=null==e?"":e;u&&t.dispatchEvent(new CustomEvent("cvAutoChanged",{bubbles:!0})),u=!0}else if(e instanceof v){for(var p of t.childNodes)p.remove();e[h.EventTargetMixin.Parent]=this,e.render(t,null,this)}else if(e instanceof Node)t.insert(e);else if(e instanceof s.Tag)t.append(e.node);else if(l){if(t.innerHTML!==e){if(e=String(e),t.innerHTML===e.substring(0,t.innerHTML.length))t.innerHTML+=e.substring(t.innerHTML.length);else{for(var m of t.childNodes)m.remove();t.innerHTML=e}a.Dom.mapTags(t,!1,e=>e[f]=!0)}}else if(t.textContent!==e){for(var y of t.childNodes)y.remove();t.textContent=e}});i!==this.args&&this.subBindings[r].push(c),this.onRemove(c);var d=t.getAttribute("type"),p=t.getAttribute("multiple"),m=r=>{if(r.target===t)if(d&&"checkbox"===d.toLowerCase())t.checked?i[n]=r.target.getAttribute("value"):i[n]=!1;else if(r.target.matches("[contenteditable=true]"))i[n]=r.target.innerHTML;else if("file"===d&&p){var o=Array.from(r.target.files),a=i[n]||e.Bindable.onDeck(i,n);if(a&&o.length){var s=function(e){if(o[e]!==a[e])return o[e].toJSON=(()=>({name:file[e].name,size:file[e].size,type:file[e].type,date:file[e].lastModified})),a[e]=o[e],1};for(var l in o)if(s(l))break}else i[n]=o}else if("file"===d&&!p&&r.target.files.length){var u=r.target.files.item(0);u.toJSON=(()=>({name:u.name,size:u.size,type:u.type,date:u.lastModified})),i[n]=u}else i[n]=r.target.value};return"file"===d||"radio"===d?t.addEventListener("change",m):(t.addEventListener("input",m),t.addEventListener("change",m),t.addEventListener("value-changed",m)),this.onRemove(()=>{"file"===d||"radio"===d?t.removeEventListener("change",m):(t.removeEventListener("input",m),t.removeEventListener("change",m),t.removeEventListener("value-changed",m))}),t.removeAttribute("cv-bind"),t}mapOnTag(e){return String(e.getAttribute("cv-on")).split(";").map(e=>e.split(":")).forEach(t=>{var r=(t=t.map(e=>e.trim())).length,i=String(t.shift()).trim(),n=String(t.shift()||i).trim(),o=String(t.shift()||"").trim(),a=[],s=/(\w+)(?:\(([$\w\s-'",]+)\))?/.exec(n);s&&(n=s[1].replace(/(^[\s\n]+|[\s\n]+$)/,""),s[2]&&(a=s[2].split(",").map(e=>e.trim()))),a.length||a.push("$event"),i&&1!==r||(i=n);var l=t=>{for(var r,i=this,o=function(){var e=i.controller;return"function"==typeof e[n]?(r=((...t)=>{e[n](...t)}),0):"function"==typeof i[n]?(r=((...e)=>{i[n](...e)}),0):i.parent?void(i=i.parent):0};i&&0!==o(););var s=a.map(r=>{var n;return Number(r)==r?r:"event"===r||"$event"===r?t:"$view"===r?i:"$controller"===r?controller:"$tag"===r?e:"$parent"===r?this.parent:"$subview"===r?this:r in this.args?this.args[r]:(n=/^['"]([\w-]+?)["']$/.exec(r))?n[1]:void 0});if("function"!=typeof r)throw new Error(`${n} is not defined on View object.`+"\nTag:\n"+`${e.outerHTML}`);r(...s)},u={};switch(o.includes("p")?u.passive=!0:o.includes("P")&&(u.passive=!1),o.includes("c")?u.capture=!0:o.includes("C")&&(u.capture=!1),o.includes("o")?u.once=!0:o.includes("O")&&(u.once=!1),i){case"_init":l();break;case"_attach":this.nodesAttached.add(l);break;case"_detach":this.nodesDetached.add(l);break;default:e.addEventListener(i,l,u),this.onRemove(()=>{e.removeEventListener(i,l,u)})}return[i,n,a]}),e.removeAttribute("cv-on"),e}mapLinkTag(e){var t=e.getAttribute("cv-link");e.setAttribute("href",t);var r=r=>{r.preventDefault(),"http"!==t.substring(0,4)&&"//"!==t.substring(0,2)?n.Router.go(e.getAttribute("href")):globalThis.open(e.getAttribute("href",t))};return e.addEventListener("click",r),this.onRemove(((e,t)=>()=>{e.removeEventListener("click",t),e=void 0,t=void 0})(e,r)),e.removeAttribute("cv-link"),e}mapPrendererTag(e){var t=e.getAttribute("cv-prerender"),r=globalThis.prerenderer||navigator.userAgent.match(/prerender/i);return e.removeAttribute("cv-prerender"),r&&(globalThis.prerenderer=globalThis.prerenderer||!0),("never"===t&&r||"only"===t&&!r)&&this.postMapping.add(()=>e.parentNode.removeChild(e)),e}mapWithTag(t){var r=this,i=t.getAttribute("cv-with"),n=t.getAttribute("cv-carry"),o=t.getAttribute("cv-view");t.removeAttribute("cv-with"),t.removeAttribute("cv-carry"),t.removeAttribute("cv-view");var a=o?this.stringToClass(o):v,s=new DocumentFragment;[...t.childNodes].forEach(e=>s.appendChild(e));var l=[];n&&(l=n.split(",").map(e=>e.trim()));var u=this.args.bindTo(i,(i,n,o,u)=>{for(this.withViews.has(t)&&this.withViews.delete(t);t.firstChild;)t.removeChild(t.firstChild);var c=new a({},this);this.onRemove((e=>()=>{e.remove()})(c)),c.template=s;var h=function(){var e=r.args.bindTo(l[f],(e,t)=>{c.args[t]=e});c.onRemove(e),r.onRemove(()=>{e(),c.remove()})};for(var f in l)h();var d=function(){if("object"!=typeof i)return 1;var t=(i=e.Bindable.make(i)).bindTo(p,(e,t,r,i)=>{i?t in c.args&&delete c.args[t]:c.args[t]=e});c.args.bindTo(p,(e,t,r,n)=>{n?t in i&&delete i[t]:i[t]=e});r.onRemove(()=>{t(),i.isBound()||e.Bindable.clearBindings(i),c.remove()}),c.onRemove(()=>{t(),i.isBound()||e.Bindable.clearBindings(i)})};for(var p in i)d();c.render(t,null,this),this.withViews.set(t,c)});return this.onRemove(()=>{this.withViews.delete(t),u()}),t}mapViewTag(e){var t=e.getAttribute("cv-view");e.removeAttribute("cv-view");var r=new DocumentFragment;[...e.childNodes].forEach(e=>r.appendChild(e));var i=t.split(":"),n=i.shift(),o=new(i.length?this.stringToClass(i[0]):v)(this.args,this);return this.views.set(e,o),this.views.set(n,o),this.onRemove(()=>{o.remove(),this.views.delete(e),this.views.delete(n)}),o.template=r,o.render(e,null,this),e}mapEachTag(t){var r=t.getAttribute("cv-each"),n=t.getAttribute("cv-view");t.removeAttribute("cv-each"),t.removeAttribute("cv-view");var o=n?this.stringToClass(n):v,a=new DocumentFragment;[...t.childNodes].forEach(e=>a.appendChild(e));var[s,u,c]=r.split(":"),h=this.args,f=s;s.match(/\./)&&([h,f]=e.Bindable.resolve(this.args,s,!0));var d=h.bindTo(f,(e,r,n,s,h)=>{e instanceof l.Bag&&(e=e.list),this.viewLists.has(t)&&this.viewLists.get(t).remove();var f=new i.ViewList(a,u,e,this,c,o),d=()=>f.remove();this.onRemove(d),f.onRemove(()=>this._onRemove.remove(d));var p=this.args.bindTo((e,t,r,i)=>{"_id"!==t&&(i?t in f.subArgs&&delete f.subArgs[t]:f.subArgs[t]=e)}),v=f.args.bindTo((e,t,r,i,n)=>{"_id"!==t&&"value"!==t&&"___"!==String(t).substring(0,3)&&(i?delete this.args[t]:t in this.args&&(this.args[t]=e))});for(f.onRemove(p),f.onRemove(v),this.onRemove(p),this.onRemove(v);t.firstChild;)t.removeChild(t.firstChild);this.viewLists.set(t,f),f.render(t,null,this),"SELECT"===t.tagName&&f.reRender()});return this.onRemove(d),t}mapIfTag(t){var r=t,i=r.getAttribute("cv-view"),n=r.getAttribute("cv-if"),o=r.getAttribute("cv-is"),s=!1,u=!1;r.removeAttribute("cv-view"),r.removeAttribute("cv-if"),r.removeAttribute("cv-is");var c=i?this.stringToClass(i):v;"!"===n.substr(0,1)&&(n=n.substr(1),s=!0),"?"===n.substr(0,1)&&(n=n.substr(1),u=!0);var h=new DocumentFragment;[...r.childNodes].forEach(e=>h.appendChild(e));var f=this,d=new DocumentFragment,p=new c(this.args,f);p.tags.bindTo((e,t)=>this.tags[t]=e,{removeWith:this}),p.template=h;var m=f.args,y=n;n.match(/\./)&&([m,y]=e.Bindable.resolve(f.args,n,!0)),p.render(d,null,this);var b=m.bindTo(y,(e,r)=>{var i=e;u&&(e=null!==e&&void 0!==e),e instanceof l.Bag&&(e=e.list),Array.isArray(e)&&(e=!!e.length),null!==o&&(e=i==o),s&&(e=!e),e?(t.appendChild(d),[...d.childNodes].forEach(e=>a.Dom.mapTags(e,!1,(e,t)=>{e.matches&&e.dispatchEvent(new CustomEvent("cvDomAttached",{target:e,detail:{view:p||this,mainView:this}}))}))):(p.nodes.forEach(e=>d.appendChild(e)),a.Dom.mapTags(d,!1,(e,t)=>{e.matches&&new CustomEvent("cvDomDetached",{target:e,detail:{view:p||this,mainView:this}})}))},{children:Array.isArray(m[y])});f.onRemove(b);return f.onRemove(()=>{b(),f._onRemove.remove(b)}),this.onRemove(()=>{p.remove(),f!==this&&f.remove()}),t}mapTemplateTag(e){var t=e.getAttribute("cv-template");e.removeAttribute("cv-template");var r=e.innerHTML;return v.templates.has(r)||v.templates.set(r,document.createRange().createContextualFragment(e.innerHTML)),this.templates[t]=v.templates.get(r),this.postMapping.add(()=>e.remove()),e}mapSlotTag(e){var t=e.getAttribute("cv-slot"),r=this.templates[t];if(!r){for(var i=this;i&&!(r=i.templates[t]);)i=i.parent;if(!r)return void console.error(`Template ${t} not found.`)}for(e.removeAttribute("cv-slot");e.firstChild;)e.firstChild.remove();return"string"==typeof r&&(v.templates.has(r)||v.templates.set(r,document.createRange().createContextualFragment(r)),r=v.templates.get(r)),e.appendChild(r.cloneNode(!0)),e}postRender(e){}attached(e){}interpolatable(e){return!!String(e).match(this.interpolateRegex)}static uuid(){return new o.Uuid}remove(e=!1){if(this.dispatchEvent(new CustomEvent("remove",{detail:{view:this},cancelable:!0}))){var t=()=>{for(var e in this.tags)Array.isArray(this.tags[e])?(this.tags[e]&&this.tags[e].forEach(e=>e.remove()),this.tags[e].splice(0)):(this.tags[e]&&this.tags[e].remove(),this.tags[e]=void 0);for(var t in this.nodes)this.nodes[t]&&this.nodes[t].dispatchEvent(new Event("cvDomDetached")),this.nodes[t]&&this.nodes[t].remove(),this.nodes[t]=void 0;this.nodes.splice(0),this.firstNode=this.lastNode=void 0};e?t():requestAnimationFrame(t);var r=this._onRemove.items();for(var i of r)i(),this._onRemove.remove(i);for(var n of this.cleanup)n&&n();for(var[o,a]of(this.cleanup.length=0,this.viewLists))a.remove();for(var[s,l]of(this.viewLists.clear(),this.timeouts))clearTimeout(l.timeout),this.timeouts.delete(l.timeout);for(var u of this.intervals)clearInterval(u);for(var c of(this.intervals.length=0,this.frames))c();this.frames.length=0,this.preRuleSet.purge(),this.ruleSet.purge(),this.removed=!0,this.dispatchEvent(new CustomEvent("removed",{detail:{view:this},cancelable:!0}))}}findTag(e){for(var t in this.nodes){var r;if(this.nodes[t].querySelector){if(this.nodes[t].matches(e))return new s.Tag(this.nodes[t],this,void 0,void 0,this);if(r=this.nodes[t].querySelector(e))return new s.Tag(r,this,void 0,void 0,this)}}}findTags(e){var t=this.nodes.filter(t=>t.matches&&t.matches(e)),r=this.nodes.filter(e=>e.querySelectorAll).map(t=>[...t.querySelectorAll(e)]).flat().map(e=>new s.Tag(e,this,void 0,void 0,this))||[];return t.concat(r)}onRemove(e){e instanceof Event||this._onRemove.add(e)}update(){}beforeUpdate(e){}afterUpdate(e){}stringTransformer(e){return t=>{for(var r in e){for(var i=this,n=e[r];i&&!i[n];)i=i.parent;if(!i)return;t=i[e[r]](t)}return t}}stringToClass(e){if(v.refClasses.has(e))return v.refClasses.get(e);var t=e.split("/"),i=t[t.length-1],n=r(e);return v.refClasses.set(e,n[i]),n[i]}preventParsing(e){e[f]=!0}toString(){return this.nodes.map(e=>e.outerHTML).join(" ")}listen(e,t,r,i){if("string"==typeof e&&(i=r,r=t,t=e,e=this),e instanceof v)return this.listen(e.nodes,t,r,i);if(Array.isArray(e))return e.map(e=>this.listen(e,t,r,i));if(e instanceof s.Tag)return this.listen(e.element,t,r,i);e.addEventListener(t,r,i);var n=()=>e.removeEventListener(t,r,i),o=()=>{n(),n=(()=>{})};return this.onRemove(()=>o()),o}detach(){for(var e in this.nodes)this.nodes[e].remove();return this.nodes}}t.View=v,Object.defineProperty(v,"templates",{value:new Map}),Object.defineProperty(v,"refClasses",{value:new Map})}()}),require.register("curvature/base/ViewList.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ViewList=void 0;var e=r("./Bindable"),i=r("./SetMap"),n=r("./Bag");t.ViewList=class{constructor(t,r,i,o,a=null,s=null){this.removed=!1,this.args=e.Bindable.makeBindable(Object.create(null)),this.args.value=e.Bindable.makeBindable(i||Object.create(null)),this.subArgs=e.Bindable.makeBindable(Object.create(null)),this.views=[],this.cleanup=[],this.viewClass=s,this._onRemove=new n.Bag,this.template=t,this.subProperty=r,this.keyProperty=a,this.tag=null,this.downDebind=[],this.upDebind=[],this.paused=!1,this.parent=o,this.viewCount=0,this.rendered=new Promise((e,t)=>{Object.defineProperty(this,"renderComplete",{configurable:!1,writable:!0,value:e})}),this.willReRender=!1,this.args.___before((e,t,r,i,n)=>{"bindTo"!=t&&(this.paused=!0)}),this.args.___after((e,t,r,i,n)=>{"bindTo"!=t&&(this.paused=r.length>1,this.reRender())});var l=this.args.value.bindTo((e,t,r,i)=>{if(!this.paused){var n=t;if("symbol"!=typeof t)if(isNaN(t)&&(n="_"+t),i)for(var o in this.views[n]&&this.views[n].remove(!0),delete this.views[n],this.views)this.views[o]&&(isNaN(o)?this.views[o].args[this.keyProperty]=o.substr(1):this.views[o].args[this.keyProperty]=o);else this.views[n]?this.views[n]&&this.views[n].args&&(this.views[n].args[this.keyProperty]=t,this.views[n].args[this.subProperty]=e):this.viewCount?!1===this.willReRender&&(this.willReRender=requestAnimationFrame(()=>{this.willReRender=!1,this.reRender()})):this.reRender()}},{wait:0});this._onRemove.add(l),Object.preventExtensions(this)}render(e){var t=this,r=[],i=function(i){i.viewList=t,i.render(e,null,t.parent),r.push(i.rendered.then(()=>i))};for(var n of this.views)i(n);this.tag=e,Promise.all(r).then(e=>this.renderComplete(e)),this.parent.dispatchEvent(new CustomEvent("listRendered",{detail:{detail:{key:this.subProperty,value:this.args.value}}}))}reRender(){var e=this;if(!this.paused&&this.tag){var t=[],r=new i.SetMap;for(var n in this.views){var o=this.views[n];if(void 0!==o){var a=o.args[this.subProperty];r.add(a,o),t[n]=o}else t[n]=o}var s=[],l=new Set;this.downDebind.length&&this.downDebind.forEach(e=>e&&e()),this.upDebind.length&&this.upDebind.forEach(e=>e&&e()),this.upDebind.length=0,this.downDebind.length=0;var u=1/0,c=1/0,h=function(){var t=!1,i=f;if(isNaN(i)?i="_"+f:String(i).length&&(i=Number(i)),void 0!==e.args.value[f]&&r.has(e.args.value[f])){var n=r.getOne(e.args.value[f]);n&&(n.args[e.keyProperty]=f,s[i]=n,l.add(n),t=!0,isNaN(i)||(u=Math.min(u,i),i>0&&(c=Math.min(c,i))),r.remove(e.args.value[f],n))}if(!t){var o=Object.create(null),a=s[i]=new e.viewClass(o,e.parent);isNaN(i)||(u=Math.min(u,i),i>0&&(c=Math.min(c,i))),s[i].template=e.template,s[i].viewList=e,s[i].args[e.keyProperty]=f,s[i].args[e.subProperty]=e.args.value[f],e.upDebind[i]=o.bindTo(e.subProperty,(t,r,i,n)=>{var a=o[e.keyProperty];n?delete e.args.value[a]:e.args.value[a]=t}),e.downDebind[i]=e.subArgs.bindTo((e,t,r,i)=>{i?delete o[t]:o[t]=e});var h=()=>{e.upDebind.filter(e=>e).forEach(e=>e()),e.upDebind.length=0},d=()=>{e.downDebind.filter(e=>e).forEach(e=>e()),e.downDebind.length=0};a.onRemove(()=>{e._onRemove.remove(h),e._onRemove.remove(d),e.upDebind[i]&&e.upDebind[i](),e.downDebind[i]&&e.downDebind[i](),delete e.upDebind[i],delete e.downDebind[i]}),e._onRemove.add(h),e._onRemove.add(d),o[e.subProperty]=e.args.value[f]}};for(var f in this.args.value)h();for(var d in t)t[d]&&!l.has(t[d])&&t[d].remove(!0);if(Array.isArray(this.args.value)){var p=0===u&&void 0!==s[1]&&s.length>1||c===1/0?u:c,v=(e=0)=>{for(var t=s.length-e-1;t>p&&void 0===s[t];)t--;return t<p?Promise.resolve():s[t]===this.views[t]?s[t]&&!s[t].firstNode?(s[t].render(this.tag,s[t+1],this.parent),s[t].rendered.then(()=>v(Number(e)+1))):0===e||e%500?v(Number(e)+1):new Promise(t=>requestAnimationFrame(()=>t(v(Number(e)+1)))):(s[t].render(this.tag,s[t+1],this.parent),this.views.splice(t,0,s[t]),s[t].rendered.then(()=>v(e+1)))};this.rendered=v()}else{var m=[],y=Object.assign(Object.create(null),s),b=e=>parseInt(e)===e-0,g=Object.keys(s).sort((e,t)=>b(e)&&b(t)?Math.sign(e-t):b(e)||b(t)?!b(e)&&b(t)?-1:b(e)&&!b(t)?1:void 0:0),w=function(t){if(delete y[t],s[t].firstNode&&s[t]===e.views[t])return 1;s[t].render(e.tag,null,e.parent),m.push(s[t].rendered.then(()=>s[t]))};for(var x of g)w(x);for(var _ in y)delete this.args.views[_],y.remove(!0);this.rendered=Promise.all(m)}for(var T in s)isNaN(T)?s[T].args[this.keyProperty]=T.substr(1):s[T].args[this.keyProperty]=T;return this.views=Array.isArray(this.args.value)?[...s]:s,this.viewCount=s.length,l.clear(),this.willReRender=!1,this.rendered.then(()=>{this.parent.dispatchEvent(new CustomEvent("listRendered",{detail:{detail:{key:this.subProperty,value:this.args.value,tag:this.tag}}})),this.tag.dispatchEvent(new CustomEvent("listRendered",{detail:{detail:{key:this.subProperty,value:this.args.value,tag:this.tag}}}))}),this.rendered}}pause(e=!0){for(var t in this.views)this.views[t].pause(e)}onRemove(e){this._onRemove.add(e)}remove(){for(var t in this.views)this.views[t]&&this.views[t].remove(!0);var r=this._onRemove.items();for(var i in r)this._onRemove.remove(r[i]),r[i]();for(;this.cleanup.length;)this.cleanup.pop()();for(this.views=[];this.tag&&this.tag.firstChild;)this.tag.removeChild(this.tag.firstChild);this.subArgs&&e.Bindable.clearBindings(this.subArgs),e.Bindable.clearBindings(this.args),this.removed=!0}}}()}),require.register("curvature/input/Keyboard.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Keyboard=void 0;var e=r("../base/Bindable");t.Keyboard=class{static get(){return this.instance=this.instance||e.Bindable.make(new this)}constructor(){this.maxDecay=120,this.comboTime=500,this.listening=!1,this.focusElement=document.body,this[e.Bindable.NoGetters]=!0,Object.defineProperty(this,"combo",{value:e.Bindable.make([])}),Object.defineProperty(this,"whichs",{value:e.Bindable.make({})}),Object.defineProperty(this,"codes",{value:e.Bindable.make({})}),Object.defineProperty(this,"keys",{value:e.Bindable.make({})}),Object.defineProperty(this,"pressedWhich",{value:e.Bindable.make({})}),Object.defineProperty(this,"pressedCode",{value:e.Bindable.make({})}),Object.defineProperty(this,"pressedKey",{value:e.Bindable.make({})}),Object.defineProperty(this,"releasedWhich",{value:e.Bindable.make({})}),Object.defineProperty(this,"releasedCode",{value:e.Bindable.make({})}),Object.defineProperty(this,"releasedKey",{value:e.Bindable.make({})}),Object.defineProperty(this,"keyRefs",{value:e.Bindable.make({})}),document.addEventListener("keyup",e=>{this.listening&&(this.keys[e.key]>0||!this.focusElement||document.activeElement===this.focusElement||this.focusElement.contains(document.activeElement)&&!document.activeElement.matches("input,textarea"))&&(e.preventDefault(),this.releasedWhich[e.which]=Date.now(),this.releasedCode[e.code]=Date.now(),this.releasedKey[e.key]=Date.now(),this.whichs[e.which]=-1,this.codes[e.code]=-1,this.keys[e.key]=-1)}),document.addEventListener("keydown",e=>{this.listening&&(!this.focusElement||document.activeElement===this.focusElement||this.focusElement.contains(document.activeElement)&&!document.activeElement.matches("input,textarea"))&&(e.preventDefault(),e.repeat||(this.combo.push(e.code),clearTimeout(this.comboTimer),this.comboTimer=setTimeout(()=>this.combo.splice(0),this.comboTime),this.pressedWhich[e.which]=Date.now(),this.pressedCode[e.code]=Date.now(),this.pressedKey[e.key]=Date.now(),this.keys[e.key]>0||(this.whichs[e.which]=1,this.codes[e.code]=1,this.keys[e.key]=1)))});var t=e=>{for(var t in this.keys)this.keys[t]<0||(this.releasedKey[t]=Date.now(),this.keys[t]=-1);for(var r in this.codes)this.codes[r]<0||(this.releasedCode[r]=Date.now(),this.codes[r]=-1);for(var i in this.whichs)this.whichs[i]<0||(this.releasedWhich[i]=Date.now(),this.whichs[i]=-1)};window.addEventListener("blur",t),window.addEventListener("visibilitychange",()=>{"visible"!==document.visibilityState&&t()})}getKeyRef(t){return this.keyRefs[t]=this.keyRefs[t]||e.Bindable.make({})}getKeyTime(e){var t=this.releasedKey[e],r=this.pressedKey[e];return r?!t||t<r?Date.now()-r:-1*(Date.now()-t):0}getCodeTime(e){var t=this.releasedCode[e],r=this.pressedCode[e];return r?!t||t<r?Date.now()-r:-1*(Date.now()-t):0}getWhichTime(e){var t=this.releasedWhich[e],r=this.pressedWhich[e];return r?!t||t<r?Date.now()-r:-1*(Date.now()-t):0}getKey(e){return this.keys[e]?this.keys[e]:0}getKeyCode(e){return this.codes[e]?this.codes[e]:0}reset(){for(var e in this.keys)delete this.keys[e];for(var e in this.codes)delete this.codes[e];for(var e in this.whichs)delete this.whichs[e]}update(){for(var e in this.keys)this.keys[e]>0?this.keys[e]++:this.keys[e]>-this.maxDecay?this.keys[e]--:delete this.keys[e];for(var e in this.codes){var t=this.releasedCode[e],r=this.pressedCode[e],i=this.getKeyRef(e);if(this.codes[e]>0){if(i.frames=this.codes[e]++,i.time=r?Date.now()-r:0,i.down=!0,!t||t<r)return;return-1*(Date.now()-t)}this.codes[e]>-this.maxDecay?(i.frames=this.codes[e]--,i.time=t-Date.now(),i.down=!1):(i.frames=0,i.time=0,i.down=!1,delete this.codes[e])}for(var e in this.whichs)this.whichs[e]>0?this.whichs[e]++:this.whichs[e]>-this.maxDecay?this.whichs[e]--:delete this.whichs[e]}}}()}),require.register("curvature/mixin/EventTargetMixin.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventTargetMixin=void 0;var e=r("../base/Mixin"),i=Symbol("EventTargetParent"),n=Symbol("CallHandler"),o=Symbol("Capture"),a=Symbol("Bubble"),s=(Symbol("Target"),Symbol("HandlersBubble")),l=Symbol("HandlersCapture"),u=t.EventTargetMixin={[e.Mixin.Constructor](){this[l]=new Map,this[s]=new Map},dispatchEvent(...e){var t=e[0];"string"==typeof t&&(t=new CustomEvent(t),e[0]=t),t.cvPath=t.cvPath||[],t.cvTarget=t.cvCurrentTarget=this;var r=this[o](...e);if(t.cancelable&&(!1===r||t.cancelBubble))return r;var u=[];if(this[l].has(t.type)){var c=this[l].get(t.type),h=[...c];h.forEach(e=>e.push(c)),u.push(...h)}if(this[s].has(t.type)){var f=this[s].get(t.type),d=[...f];d.forEach(e=>e.push(f)),u.push(...d)}for(var[p,v,m]of(u.push([()=>this[n](...e),{},null]),u))if(v.once&&m.delete(p),r=p(t),t.cancelable&&!1===r)break;return t.cancelable&&(t.cancelBubble||!1===r)||this[a](...e),this[i]||Object.freeze(t.cvPath),t.returnValue},addEventListener(e,t,r={}){!0===r&&(r={useCapture:!0});var i=s;r.useCapture&&(i=l),this[i].has(e)||this[i].set(e,new Map),this[i].get(e).set(t,r),r.signal&&r.signal.addEventListener("abort",i=>this.removeEventListener(e,t,r),{once:!0})},removeEventListener(e,t,r={}){!0===r&&(r={useCapture:!0});var i=s;r.useCapture&&(i=l),this[i].has(e)&&this[i].get(e).delete(t)},[o](...e){var t=e[0];if(t.cvPath.push(this),this[i]){var r=this[i][o](...e);if((!t.cancelable||!1!==r&&!t.cancelBubble)&&this[i][l].has(t.type)){t.cvCurrentTarget=this[i];var{type:n}=t,a=this[i][l].get(n);for(var[s,u]of a)if(u.once&&a.delete(s),r=s(t),t.cancelable&&(!1===r||t.cancelBubble))break;return r}}},[a](...e){var t=e[0];if(t.bubbles&&this[i]&&!t.cancelBubble){if(!this[i][s].has(t.type))return this[i][a](...e);var r;t.cvCurrentTarget=this[i];var{type:o}=t,l=this[i][s].get(t.type);for(var[u,c]of l)if(c.once&&l.delete(u),r=u(t),t.cancelable&&!1===r)return r;return r=this[i][n](...e),t.cancelable&&(!1===r||t.cancelBubble)?r:this[i][a](...e)}},[n](...e){var t=e[0];if(!t.defaultPrevented){var r=`on${t.type[0].toUpperCase()+t.type.slice(1)}`;return"function"==typeof this[r]?this[r](t):void 0}}};Object.defineProperty(u,"Parent",{value:i})}()}),require.register("Config.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,o(i.key),i)}}function o(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Config=void 0,(e.Config=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)})).title="wgl2d"}),require.register("gl2d/Gl2d.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return o(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=Array(t);r<t;r++)i[r]=e[r];return i}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,c(i.key),i)}}function l(e,t,r){return t&&s(e.prototype,t),r&&s(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function u(e,t,r){return(t=c(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function c(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Gl2d=void 0;var h=function(){return l(function e(t){var r=t.gl,i=t.vertexShader,o=t.fragmentShader,s=t.uniforms,l=t.attributes;a(this,e),u(this,"context",null),u(this,"program",null),u(this,"attributes",{}),u(this,"buffers",{}),u(this,"uniforms",{}),this.context=r,this.program=r.createProgram(),r.attachShader(this.program,i),r.attachShader(this.program,o),r.linkProgram(this.program),r.detachShader(this.program,i),r.detachShader(this.program,o),r.deleteShader(i),r.deleteShader(o),r.getProgramParameter(this.program,r.LINK_STATUS)||(console.error(r.getProgramInfoLog(this.program)),r.deleteProgram(this.program));var c,h=n(s);try{for(h.s();!(c=h.n()).done;){var f=c.value,d=r.getUniformLocation(this.program,f);null!==d?this.uniforms[f]=d:console.warn("Uniform ".concat(f," not found."))}}catch(e){h.e(e)}finally{h.f()}var p,v=n(l);try{for(v.s();!(p=v.n()).done;){var m=p.value,y=r.getAttribLocation(this.program,m);if(null!==y){var b=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,b),r.enableVertexAttribArray(y),r.vertexAttribPointer(y,2,r.FLOAT,!1,0,0),this.attributes[m]=y,this.buffers[m]=b}else console.warn("Attribute ".concat(m," not found."))}}catch(e){v.e(e)}finally{v.f()}},[{key:"use",value:function(){this.context.useProgram(this.program)}},{key:"uniformF",value:function(e){for(var t=this.context,r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];t["uniform".concat(i.length,"f")].apply(t,[this.uniforms[e]].concat(i))}},{key:"uniformI",value:function(e){for(var t=this.context,r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];t["uniform".concat(i.length,"i")].apply(t,[this.uniforms[e]].concat(i))}}])}();e.Gl2d=function(){return l(function e(t){a(this,e),this.element=t||document.createElement("canvas"),this.context=this.element.getContext("webgl"),this.screenScale=1,this.zoomLevel=2},[{key:"createShader",value:function(e){var r=null;switch(e.substring(e.lastIndexOf(".")+1).toUpperCase()){case"VERT":r=this.context.VERTEX_SHADER;break;case"FRAG":r=this.context.FRAGMENT_SHADER}var i=this.context.createShader(r),n=t(e);if(this.context.shaderSource(i,n),this.context.compileShader(i),this.context.getShaderParameter(i,this.context.COMPILE_STATUS))return i;console.error(this.context.getShaderInfoLog(i)),this.context.deleteShader(i)}},{key:"createProgram",value:function(e){var t=e.vertexShader,r=e.fragmentShader,i=e.uniforms,n=e.attributes,o=this.context;return new h({gl:o,vertexShader:t,fragmentShader:r,uniforms:i,attributes:n})}},{key:"createTexture",value:function(e,t){var r=this.context,i=r.createTexture();return r.bindTexture(r.TEXTURE_2D,i),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e,t,0,r.RGBA,r.UNSIGNED_BYTE,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),i}},{key:"createFramebuffer",value:function(e){var t=this.context,r=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),r}},{key:"enableBlending",value:function(){var e=this.context;e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.enable(e.BLEND)}}])}()}),require.register("home/View.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.View=void 0;var n=t("curvature/base/View"),o=t("curvature/input/Keyboard"),a=t("curvature/base/Bag"),s=t("Config"),l=t("../world/TileMap"),u=t("../sprite/SpriteSheet"),c=t("../sprite/SpriteBoard"),h=t("../ui/Controller"),f=t("../ui/MapEditor"),d=t("../model/Entity"),p=t("../sprite/Camera"),v=t("../model/Controller"),m=t("../sprite/Sprite"),y=t("../world/World"),b=t("../math/Quadtree"),g=(t("../math/Rectangle"),t("../math/SMTree"));function w(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,x(i.key),i)}}function x(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}function _(e,t,r){return t=T(t),function(e,t){if(t&&("object"==i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,r||[],T(e).constructor):t.apply(e,r))}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function E(e,t){return(E=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var S={};S.onScreenJoyPad=new h.Controller,S.keyboard=o.Keyboard.get();var P=new b.Quadtree(0,0,100,100,.25);P.insert({x:10,y:10}),P.insert({x:20,y:20}),P.insert({x:20,y:25}),P.insert({x:25,y:25});new g.SMTree,e.View=function(e){function r(e){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),window.smProfiling=!0,(i=_(this,r,[e])).template=t("./view.tmp"),i.routes=[],i.entities=new a.Bag,i.keyboard=S.keyboard,i.speed=24,i.maxSpeed=i.speed,i.args.controller=S.onScreenJoyPad,i.args.fps=0,i.args.sps=0,i.args.camX=0,i.args.camY=0,i.args.frameLock=60,i.args.simulationLock=60,i.args.showEditor=!1,i.keyboard.listening=!0,i.keyboard.keys.bindTo("Escape",function(e,t,r,n){-1===e&&i.spriteBoard.unselect()}),i.keyboard.keys.bindTo("Home",function(e,t,r,n){e>0&&i.args.frameLock++}),i.keyboard.keys.bindTo("End",function(e,t,r,n){e>0&&(i.args.frameLock--,i.args.frameLock<0&&(i.args.frameLock=0))}),i.keyboard.keys.bindTo("PageUp",function(e,t,r,n){e>0&&i.args.simulationLock++}),i.keyboard.keys.bindTo("PageDown",function(e,t,r,n){e>0&&(i.args.simulationLock--,i.args.simulationLock<0&&(i.args.simulationLock=0))}),i.spriteSheet=new u.SpriteSheet,i.world=new y.World({src:"./world.json"}),i.map=new l.TileMap({spriteSheet:i.spriteSheet,src:"./map.json"}),i.args.mapEditor=new f.MapEditor({spriteSheet:i.spriteSheet,world:i.world,map:i.map}),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&E(e,t)}(r,n.View),i=r,(o=[{key:"onRendered",value:function(){var e=this,t=new c.SpriteBoard({element:this.tags.canvas.element,world:this.world,map:this.map});this.spriteBoard=t;var r=new d.Entity({sprite:new m.Sprite({x:48,y:64,src:void 0,spriteBoard:t,spriteSheet:this.spriteSheet,width:32,height:48}),controller:new v.Controller({keyboard:this.keyboard,onScreenJoyPad:this.args.controller}),camera:p.Camera});this.entities.add(r),this.spriteBoard.sprites.add(r.sprite),this.spriteBoard.following=r,this.keyboard.keys.bindTo("=",function(t,r,i,n){t>0&&e.zoom(1)}),this.keyboard.keys.bindTo("+",function(t,r,i,n){t>0&&e.zoom(1)}),this.keyboard.keys.bindTo("-",function(t,r,i,n){t>0&&e.zoom(-1)}),this.args.mapEditor.args.bindTo("selectedGraphic",function(t){if(t&&null!=e.spriteBoard.selected.globalX){e.args.showEditor=!1;var r=e.spriteBoard.selected.startGlobalX,i=e.spriteBoard.selected.globalX;if(i<r){var n=[r,i];i=n[0],r=n[1]}for(;r<=i;r++){var o=e.spriteBoard.selected.startGlobalY,a=e.spriteBoard.selected.globalY;if(a<o){var s=[o,a];a=s[0],o=s[1]}for(;o<=a;o++)e.map.setTile(r,o,t)}e.map.setTile(e.spriteBoard.selected.globalX,e.spriteBoard.selected.globalY,t),e.spriteBoard.resize(),e.spriteBoard.unselect()}}),this.args.showEditor=!1,window.addEventListener("resize",function(){return e.resize()});var i=0,n=0,o=[],a=function(t){if(document.hidden)window.requestAnimationFrame(a);else{!function(t){var r=(t/=1e3)-n;if(0!=e.args.simulationLock){if(!(r<1/(e.args.simulationLock+e.args.simulationLock/60*10)))for(n=t,e.keyboard.update(),Object.values(e.entities.items()).map(function(e){e.simulate()}),e.args._sps=1/r,o.push(e.args._sps);o.length>5;)o.shift()}else o=[0]}(performance.now()),window.requestAnimationFrame(a),e.spriteBoard.draw();var r=t-i;i=t,e.args.fps=(1e3/r).toFixed(3),e.args.camX=Number(p.Camera.x).toFixed(3),e.args.camY=Number(p.Camera.y).toFixed(3),e.spriteBoard.following&&(e.args.posX=Number(e.spriteBoard.following.sprite.x).toFixed(3),e.args.posY=Number(e.spriteBoard.following.sprite.y).toFixed(3))}};this.spriteBoard.gl2d.zoomLevel=document.body.clientHeight/1024*4,this.resize(),a(performance.now()),setInterval(function(){document.title="".concat(s.Config.title," ").concat(e.args.fps," FPS")},227/3),setInterval(function(){var t=o.reduce(function(e,t){return e+t},0)/o.length;e.args.sps=t.toFixed(3).padStart(5," ")},115.5)}},{key:"resize",value:function(e,t){this.args.width=this.tags.canvas.element.width=e||document.body.clientWidth,this.args.height=this.tags.canvas.element.height=t||document.body.clientHeight,this.args.rwidth=Math.trunc((e||document.body.clientWidth)/this.spriteBoard.gl2d.zoomLevel),this.args.rheight=Math.trunc((t||document.body.clientHeight)/this.spriteBoard.gl2d.zoomLevel);var r=this.spriteBoard.gl2d.screenScale;this.spriteBoard.gl2d.screenScale=document.body.clientHeight/1024,this.spriteBoard.gl2d.zoomLevel*=this.spriteBoard.gl2d.screenScale/r,this.spriteBoard.resize()}},{key:"scroll",value:function(e){var t=e.deltaY>0?-1:e.deltaY<0?1:0;this.zoom(t)}},{key:"zoom",value:function(e){var t=32*this.spriteBoard.gl2d.screenScale,r=.2*this.spriteBoard.gl2d.screenScale,i=(e*(.05*this.spriteBoard.gl2d.zoomLevel)+this.spriteBoard.gl2d.zoomLevel).toFixed(2);i<r?i=r:i>t&&(i=t),Math.abs(i-1)<.05&&(i=1),this.spriteBoard.gl2d.zoomLevel!==i&&(this.spriteBoard.gl2d.zoomLevel=i,this.resize())}}])&&w(i.prototype,o),h&&w(i,h),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,h}()}),require.register("home/view.tmp.html",function(e,t,r){r.exports='<canvas\n\tcv-ref = "canvas:curvature/base/Tag"\n\tcv-on  = "wheel:scroll(event);"\n></canvas>\n<div class = "hud fps">\n [[sps]] simulations/s / [[simulationLock]]\n [[fps]] frames/s      / [[frameLock]]\n\n Res [[rwidth]] x [[rheight]]\n     [[width]] x [[height]]\n\n Cam [[camX]] x [[camY]]\n Pos [[posX]] x [[posY]]\n\n δ Sim:   Pg Up / Dn\n δ Frame: Home / End\n δ Scale: + / -\n\n</div>\n<div class = "reticle"></div>\n\n[[controller]]\n\n<div cv-if = "showEditor">\n\t[[mapEditor]]\n\t--\n\t[[mmm]]\n</span>\n'}),require.register("initialize.js",function(e,t,r){"use strict";var i=t("curvature/base/Router"),n=t("home/View");void 0!==Proxy&&document.addEventListener("DOMContentLoaded",function(){var e=new n.View;i.Router.listen(e),e.render(document.body)})}),require.register("inject/Container.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.Container=void 0;var n=t("./Injectable");function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,a(i.key),i)}}function a(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}function s(e,t,r){return t=l(t),function(e,t){if(t&&("object"==i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,r||[],l(e).constructor):t.apply(e,r))}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}e.Container=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),s(this,t,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(t,n.Injectable),r=t,(i=[{key:"inject",value:function(e){return new this.constructor(Object.assign({},this,e))}}])&&o(r.prototype,i),a&&o(r,a),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,i,a}()}),require.register("inject/Injectable.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t,r){return t=o(t),function(e,t){if(t&&("object"==i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,r||[],o(e).constructor):t.apply(e,r))}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,c(i.key),i)}}function u(e,t,r){return t&&l(e.prototype,t),r&&l(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function c(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Injectable=void 0;var h={},f={};e.Injectable=function(){function e(){s(this,e);var t=this.constructor.injections(),r=this.constructor.context();for(var i in h[r]||(h[r]={}),f[r]||(f[r]={}),t){var n=t[i];!h[r][i]&&n.prototype&&(/[A-Z]/.test(String(i)[0])&&(h[r][i]=n))}for(var o in t){var a=void 0,l=h[r][o]||t[o];/[A-Z]/.test(String(o)[0])?(l.prototype?f[r][o]||(f[r][o]=new l):f[r][o]=l,a=f[r][o]):a=l.prototype?new l:l,Object.defineProperty(this,o,{enumerable:!1,writable:!1,value:a})}}return u(e,null,[{key:"injections",value:function(){return{}}},{key:"context",value:function(){return"."}},{key:"inject",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".";if(!(this.prototype instanceof e||this===e))throw new Error("Cannot access injectable subclass!\n\nAre you trying to instantiate like this?\n\n\tnew X.inject({...});\n\nIf so please try:\n\n\tnew (X.inject({...}));\n\nPlease note the parenthesis.\n");var i=this.injections();return function(e){function o(){return s(this,o),n(this,o,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}(o,e),u(o,null,[{key:"injections",value:function(){return Object.assign({},i,t)}},{key:"context",value:function(){return r}}])}(this)}}])}()}),require.register("inject/Single.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,o(i.key),i)}}function o(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.single=e.Single=void 0;var a=e.Single=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name="sss."+Math.random()});e.single=new a}),require.register("math/Quadtree.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.Quadtree=void 0;var n=t("./Rectangle");function o(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||a(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){if(e){if("string"==typeof e)return s(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=Array(t);r<t;r++)i[r]=e[r];return i}function l(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,u(i.key),i)}}function u(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}function c(e,t,r){return t=h(t),function(e,t){if(t&&("object"==i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,r||[],h(e).constructor):t.apply(e,r))}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}e.Quadtree=function(e){function t(e,r,i,n,o){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=c(this,t,[e,r,i,n])).split=!1,a.items=new Set,a.minSize=o,a.ulCell=null,a.urCell=null,a.blCell=null,a.brCell=null,a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&f(e,t)}(t,n.Rectangle),r=t,(i=[{key:"insert",value:function(e){if(this.contains(e.x,e.y)){var r=this.x2-this.x1,i=this.y2-this.y1;if(this.items.size&&r>this.minSize&&i>this.minSize){if(!this.split){var n=.5*r,o=.5*i;this.ulCell=new t(this.x1,this.y1,this.x1+n,this.y1+o,this.minSize),this.blCell=new t(this.x1,this.y1+o,this.x1+n,this.y2,this.minSize),this.urCell=new t(this.x1+n,this.y1,this.x2,this.y1+o,this.minSize),this.brCell=new t(this.x1+n,this.y1+o,this.x2,this.y2,this.minSize),this.split=!0}var s,l=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=a(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw o}}}}(this.items);try{for(l.s();!(s=l.n()).done;){var u=s.value;this.ulCell.insert(u),this.urCell.insert(u),this.blCell.insert(u),this.brCell.insert(u),this.items.delete(u)}}catch(e){l.e(e)}finally{l.f()}this.ulCell.insert(e),this.urCell.insert(e),this.blCell.insert(e),this.brCell.insert(e)}else this.items.add(e)}}},{key:"findLeaf",value:function(e,t){var r,i,n;return this.contains(e,t)?this.split?null!==(r=null!==(i=null!==(n=this.ulCell.findLeaf(e,t))&&void 0!==n?n:this.urCell.findLeaf(e,t))&&void 0!==i?i:this.blCell.findLeaf(e,t))&&void 0!==r?r:this.brCell.findLeaf(e,t):this:null}},{key:"has",value:function(e){return this.split?this.ulCell.has(e)||this.urCell.has(e)||this.blCell.has(e)||this.brCell.has(e):this.items.has(e)}},{key:"select",value:function(e,t,r,i){var n=t+i;return e+r<this.x1||e>this.x2?new Set:n<this.y1||t>this.y2?new Set:this.split?new Set([].concat(o(this.ulCell.select(e,t,r,i)),o(this.urCell.select(e,t,r,i)),o(this.blCell.select(e,t,r,i)),o(this.brCell.select(e,t,r,i)))):this.items}},{key:"dump",value:function(){return this.split?new Set([].concat(o(this.ulCell.dump()),o(this.urCell.dump()),o(this.blCell.dump()),o(this.brCell.dump()))):this.items}}])&&l(r.prototype,i),s&&l(r,s),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,i,s}()}),require.register("math/Rectangle.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=Array(t);r<t;r++)i[r]=e[r];return i}function a(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,s(i.key),i)}}function s(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Rectangle=void 0;e.Rectangle=function(){return e=function e(t,r,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x1=t,this.y1=r,this.x2=i,this.y2=n},(t=[{key:"contains",value:function(e,t){return!(e<=this.x1||e>=this.x2)&&!(t<=this.y1||t>=this.y2)}},{key:"isOverlapping",value:function(e){return!(this.x1>=e.x2||this.x2<=e.x1)&&!(this.y1>=e.y2||this.y2<=e.y1)}},{key:"isFlushWith",value:function(e){return!(this.x1>e.x2||e.x1>this.x2)&&(!(this.y1>e.y2||e.y1>this.y2)&&(this.x1===e.x2||e.x1===this.x2||(this.y1===e.y2||e.y1===this.y2||void 0)))}},{key:"intersection",value:function(e){if(this.isOverlapping(e))return new this.constructor(Math.max(this.x1,e.x1),Math.max(this.y1,e.y1),Math.min(this.x2,e.x2),Math.min(this.y2,e.y2))}},{key:"isInside",value:function(e){return this.x1>=e.x1&&this.y1>=e.y1&&this.x2<=e.x2&&this.y2<=e.y2}},{key:"isOutside",value:function(e){return e.isInside(this)}},{key:"toTriangles",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;return 2===e?[this.x1,this.y1,this.x2,this.y1,this.x1,this.y2,this.x1,this.y2,this.x2,this.y1,this.x2,this.y2]:3===e?[this.x1,this.y1,1,this.x2,this.y1,1,this.x1,this.y2,1,this.x1,this.y2,1,this.x2,this.y1,1,this.x2,this.y2,1]:4===e?[this.x1,this.y1,0,1,this.x2,this.y1,0,1,this.x1,this.y2,0,1,this.x1,this.y2,0,1,this.x2,this.y1,0,1,this.x2,this.y2,0,1]:[this.x1,this.y1].concat(n(e>2?Array(-2+e).fill(0):[]),[this.x2,this.y1],n(e>2?Array(-2+e).fill(0):[]),[this.x1,this.y2],n(e>2?Array(-2+e).fill(0):[]),[this.x1,this.y2],n(e>2?Array(-2+e).fill(0):[]),[this.x2,this.y1],n(e>2?Array(-2+e).fill(0):[]),[this.x2,this.y2],n(e>2?Array(-2+e).fill(0):[]))}}])&&a(e.prototype,t),r&&a(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}()}),require.register("math/SMTree.js",function(e,t,r){"use strict";function i(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||a(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e){"@babel/helpers - typeof";return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=a(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw o}}}}function a(e,t){if(e){if("string"==typeof e)return s(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=Array(t);r<t;r++)i[r]=e[r];return i}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,h(i.key),i)}}function c(e,t,r){return t&&u(e.prototype,t),r&&u(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function h(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.SMTree=void 0;var f=function(){function e(t,r,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;l(this,e),this.start=t,this.end=r,this.depth=n,this.size=0,this.rectangles=new Set,this.subTree=n<1?new p(1+n):null,this.prev=i}return c(e,[{key:"split",value:function(t){if(t<this.start||t>this.end)throw new RangeError("Splitting segment out of bounds!");if(t===this.start)return[this];if(t===this.end)return[this];var r,i=new e(this.start,t,this.prev,this.depth),n=new e(t,this.end,i,this.depth),a=o(this.rectangles);try{for(a.s();!(r=a.n()).done;){var s=r.value,l=0===this.depth?s.x1:s.y1;(0===this.depth?s.x2:s.y2)<t?i.add(s):l>t?n.add(s):(i.add(s),n.add(s))}}catch(e){a.e(e)}finally{a.f()}return[i,n]}},{key:"add",value:function(e){Object.freeze(e),this.subTree&&this.subTree.add(e),this.rectangles.add(e),this.size=this.rectangles.size}},{key:"delete",value:function(e){return this.subTree&&this.subTree.delete(e),this.rectangles.delete(e),this.size=this.rectangles.size,!this.rectangles.size&&this.start>-1/0}}])}(),d=function(e){return"x1"in e&&"y1"in e&&"x2"in e&&"y2"in e},p=e.SMTree=function(){return c(function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;l(this,e),this.depth=t,this.segments=[new f(-1/0,1/0,null,this.depth)]},[{key:"add",value:function(e){if(!d(e))throw new Error("Object supplied is not a Rectangle. Must have properties: x1, y1, x2, y1.");var t=0===this.depth?e.x1:e.y1,r=0===this.depth?e.x2:e.y2,i=this.findSegment(t);this.splitSegment(i,t);var n=this.findSegment(r);if(this.splitSegment(n,r),i!==n)for(var o=1+i;o<=n;o++)this.segments[o].add(e);else this.segments[i].add(e)}},{key:"delete",value:function(e){if(!d(e))throw new Error("Object supplied is not a Rectangle. Must have properties: x1, y1, x2, y1.");for(var t=0===this.depth?e.x1:e.y1,r=0===this.depth?e.x2:e.y2,i=this.findSegment(t),n=this.findSegment(r),o=[],a=i;a<=n;a++)this.segments[a].delete(e)&&o.push(a);for(var s=-1+o.length;s>=0;s--){var l=o[s];if(!this.segments[-1+l])throw new Error("Cannot delete segment without predecessor.");this.segments[-1+l].end=this.segments[l].end,this.segments[1+l].prev=this.segments[-1+l],this.segments.splice(l,1)}2===this.segments.length&&0==this.segments[0].size&&0===this.segments[1].size&&(this.segments[0].end=this.segments[1].end,this.segments.length=1)}},{key:"query",value:function(e,t,r,i){for(var n=new Set,a=this.findSegment(e),s=this.findSegment(r),l=a;l<=s;l++){var u=this.segments[l];if(u.subTree)for(var c=u.subTree.findSegment(t),h=u.subTree.findSegment(i),f=c;f<=h;f++){var d,p=o(u.subTree.segments[f].rectangles);try{for(p.s();!(d=p.n()).done;){var v=d.value;n.add(v)}}catch(e){p.e(e)}finally{p.f()}}}return n}},{key:"splitSegment",value:function(e,t){var r;if(!(t<=this.segments[e].start||t>=this.segments[e].end)){var n=this.segments[e].split(t);(r=this.segments).splice.apply(r,[e,1].concat(i(n)))}}},{key:"findSegment",value:function(e){var t=0,r=-1+this.segments.length;do{var i=Math.floor(.5*(t+r)),n=this.segments[i];if(n.start<e&&n.end>=e)return i;n.start<e&&(t=1+i),n.end>e&&(r=-1+i)}while(t<=r);return-1}}])}()}),require.register("math/Split.js",function(e,t,r){"use strict";var i;function n(e){"@babel/helpers - typeof";return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return a(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=Array(t);r<t;r++)i[r]=e[r];return i}function s(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,u(i.key),i)}}function l(e,t,r){return(t=u(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Split=void 0;var c=e.Split=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},r=[{key:"intToBytes",value:function(e){return this.value[0]=e,o(this.bytes)}}],(t=null)&&s(e.prototype,t),r&&s(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}();i=c,l(c,"bytes",new Uint8ClampedArray(4)),l(c,"words",new Uint16Array(i.bytes.buffer)),l(c,"value",new Uint32Array(i.bytes.buffer))}),require.register("model/Controller.js",function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Controller=void 0;var i=t("curvature/base/Bindable");function n(e){"@babel/helpers - typeof";return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,s(i.key),i)}}function a(e,t,r){return(t=s(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}e.Controller=function(){return e=function e(t){var r=this,n=t.keyboard,o=t.onScreenJoyPad;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a(this,"triggers",i.Bindable.makeBindable({})),a(this,"axis",i.Bindable.makeBindable({})),n.keys.bindTo(function(e,t,i,n){e>0?r.keyPress(t,e,i[t]):-1!==e||r.keyRelease(t,e,i[t])}),o.args.bindTo("x",function(e){r.axis[0]=e/50}),o.args.bindTo("y",function(e){r.axis[1]=e/50})},(t=[{key:"keyPress",value:function(e,t,r){if(/^[0-9]$/.test(e))this.triggers[e]=!0;else switch(e){case"ArrowRight":this.axis[0]=1;break;case"ArrowDown":this.axis[1]=1;break;case"ArrowLeft":this.axis[0]=-1;break;case"ArrowUp":this.axis[1]=-1}}},{key:"keyRelease",value:function(e,t,r){if(/^[0-9]$/.test(e))this.triggers[e]=!1;else switch(e){case"ArrowRight":this.axis[0]>0&&(this.axis[0]=0),this.axis[0]=0;case"ArrowLeft":this.axis[0]<0&&(this.axis[0]=0);break;case"ArrowDown":this.axis[1]>0&&(this.axis[1]=0);case"ArrowUp":this.axis[1]<0&&(this.axis[1]=0)}}}])&&o(e.prototype,t),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}()}),require.register("model/Entity.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,o(i.key),i)}}function o(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Entity=void 0;var a=[1,0,0],s=[0,1,1];e.Entity=function(){return e=function e(t){var r=t.sprite,i=t.controller,n=t.x,o=t.y;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.direction="south",this.state="standing",this.sprite=r,this.controller=i,this.x=n,this.y=o,this.sprite.spriteBoard.renderMode=0},(t=[{key:"create",value:function(){}},{key:"simulate",value:function(){Math.trunc(performance.now()/1e3)%15==0&&(this.sprite.region=null),Math.trunc(performance.now()/1e3)%15==5&&(this.sprite.region=s),Math.trunc(performance.now()/1e3)%15==10&&(this.sprite.region=a);var e=this.controller.axis[0]||0,t=this.controller.axis[1]||0;for(var r in this.controller.triggers){if(this.controller.triggers[r])if(this.sprite.spriteBoard.renderMode=r,"9"===r)this.sprite.spriteBoard.world.getMapsForPoint(this.sprite.x,this.sprite.y).forEach(function(e){return console.log(e.src)})}e=Math.min(1,Math.max(e,-1)),t=Math.min(1,Math.max(t,-1)),this.sprite.x+=e>0?Math.ceil(4*e):Math.floor(4*e),this.sprite.y+=t>0?Math.ceil(4*t):Math.floor(4*t);var i,n=!1;Math.abs(e)>Math.abs(t)&&(n=!0),n?(this.direction="west",e>0&&(this.direction="east"),this.state="walking"):t?(this.direction="north",t>0&&(this.direction="south"),this.state="walking"):this.state="standing",(i=this.sprite[this.state][this.direction])&&this.sprite.setFrames(i)}},{key:"destroy",value:function(){}}])&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}()}),require.register("overlay/overlay.frag",function(e,t,r){r.exports="precision mediump float;\n\nuniform vec4 u_color;\nvarying vec2 v_texCoord;\n\nvoid main() {\n  // gl_FragColor = texture2D(u_image, v_texCoord);\n  gl_FragColor = vec4(1.0, 1.0, 0.0, 0.25);\n}\n"}),require.register("overlay/overlay.vert",function(e,t,r){r.exports="attribute vec2 a_position;\nattribute vec2 a_texCoord;\n\nuniform vec2 u_resolution;\nvarying vec2 v_texCoord;\n\nvoid main()\n{\n  vec2 zeroToOne = a_position / u_resolution;\n  vec2 zeroToTwo = zeroToOne * 2.0;\n  vec2 clipSpace = zeroToTwo - 1.0;\n\n  gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n  v_texCoord  = a_texCoord;\n}\n"}),require.register("sprite/Camera.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,a(i.key),i)}}function o(e,t,r){return(t=a(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Camera=void 0;var s=e.Camera=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)});o(s,"x",0),o(s,"y",0),o(s,"width",0),o(s,"height",0)}),require.register("sprite/MapRenderer.js",function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MapRenderer=void 0;var i=t("curvature/base/Bindable"),n=t("./SpriteSheet");t("../math/Split");function o(e){"@babel/helpers - typeof";return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return s(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){l=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(l)throw o}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=Array(t);r<t;r++)i[r]=e[r];return i}function l(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,u(i.key),i)}}function u(e){var t=function(e,t){if("object"!=o(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=o(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==o(t)?t:t+""}e.MapRenderer=function(){return e=function e(t){var r=this,o=t.spriteBoard,a=t.map;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this[i.Bindable.Prevent]=!0,this.spriteBoard=o,this.spriteSheet=new n.SpriteSheet,this.loaded=!1,this.map=a,this.width=0,this.height=0,this.tileWidth=0,this.tileHeight=0,this.xOffset=0,this.yOffset=0;var s=this.spriteBoard.gl2d.context;this.tileMapping=this.spriteBoard.gl2d.createTexture(1,1),this.tileTexture=this.spriteBoard.gl2d.createTexture(1,1);var l=function(){return parseInt(255*Math.random())};new Uint8Array([l(),l(),l(),255]);a.ready.then(function(){r.loaded=!0,r.tileWidth=a.tileWidth,r.tileHeight=a.tileHeight,s.bindTexture(s.TEXTURE_2D,r.tileTexture),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,a.tileSetWidth,a.tileSetHeight,0,s.RGBA,s.UNSIGNED_BYTE,a.pixels),s.bindTexture(s.TEXTURE_2D,null)})},(t=[{key:"negSafeMod",value:function(e,t){return e>=0?e%t:(t+e%t)%t}},{key:"draw",value:function(){if(this.loaded){var e=this.spriteBoard.gl2d.context,t=this.spriteBoard.following.sprite.x,r=this.spriteBoard.following.sprite.y,i=this.spriteBoard.gl2d.zoomLevel,n=.5*this.tileWidth,o=.5*this.tileHeight,s=Math.floor(this.width/this.tileWidth),l=Math.floor(this.height/this.tileHeight),u=64*Math.floor(Math.floor(.5*this.width/64)+0),c=64*Math.floor(Math.floor(.5*this.height/64)+0),h=(t+n)/this.tileWidth+-this.negSafeMod(t+n,64)/this.tileWidth+-this.map.xWorld/this.tileWidth+-u/this.tileWidth,f=(r+o)/this.tileHeight+-this.negSafeMod(r+o,64)/this.tileHeight+-this.map.yWorld/this.tileHeight+-c/this.tileHeight;if(!(h+s<0||f+l<0)){var d=i*(.5*(this.width+this.xOffset)-this.negSafeMod(t+n,64)-u),p=i*(.5*(this.height+this.yOffset)-this.negSafeMod(r+o,64)-c);this.spriteBoard.drawProgram.uniformF("u_size",this.width,this.height),this.spriteBoard.drawProgram.uniformF("u_tileSize",this.tileWidth,this.tileHeight),this.spriteBoard.drawProgram.uniformF("u_mapTextureSize",this.map.tileSetWidth,this.map.tileSetHeight),this.spriteBoard.drawProgram.uniformI("u_renderTiles",1),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,this.tileTexture),this.spriteBoard.drawProgram.uniformI("u_tiles",2),e.activeTexture(e.TEXTURE3),e.bindTexture(e.TEXTURE_2D,this.tileMapping),this.spriteBoard.drawProgram.uniformI("u_tileMapping",3);var v,m=a(this.map.getSlice(h,f,s,l,performance.now()/1e3));try{for(m.s();!(v=m.n()).done;){var y=v.value;e.texImage2D(e.TEXTURE_2D,0,e.RGBA,s,l,0,e.RGBA,e.UNSIGNED_BYTE,y),this.setRectangle(d+.5*this.tileWidth*i,p+this.tileHeight*i,this.width*i,this.height*i),e.bindFramebuffer(e.FRAMEBUFFER,this.spriteBoard.drawBuffer),e.drawArrays(e.TRIANGLES,0,6)}}catch(e){m.e(e)}finally{m.f()}this.spriteBoard.drawProgram.uniformI("u_renderTiles",0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE3),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,null)}}}},{key:"resize",value:function(e,t){this.width=e+0,this.height=t+0,this.width=128*Math.ceil(e/128)+128,this.height=128*Math.ceil(t/128)+128,this.xOffset=e-this.width,this.yOffset=t-this.height}},{key:"simulate",value:function(){}},{key:"setRectangle",value:function(e,t,r,i){var n=this.spriteBoard.gl2d.context;n.bindBuffer(n.ARRAY_BUFFER,this.spriteBoard.drawProgram.buffers.a_texCoord),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),n.STATIC_DRAW);var o=e,a=e+r,s=t,l=t+i;n.bindBuffer(n.ARRAY_BUFFER,this.spriteBoard.drawProgram.buffers.a_position),n.bufferData(n.ARRAY_BUFFER,new Float32Array([o,l,a,l,o,s,o,s,a,l,a,s]),n.STATIC_DRAW)}}])&&l(e.prototype,t),r&&l(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}()}),require.register("sprite/Parallax.js",function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Parallax=void 0;var i=t("curvature/base/Bindable");t("./Camera");function n(e){"@babel/helpers - typeof";return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return a(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw o}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=Array(t);r<t;r++)i[r]=e[r];return i}function s(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,h(i.key),i)}}function l(e,t,r){return t&&s(e.prototype,t),r&&s(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t,r){return(t=h(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function h(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}var f=l(function e(){u(this,e),c(this,"texture",null),c(this,"width",0),c(this,"height",0),c(this,"offset",0),c(this,"parallax",0)});e.Parallax=function(){return l(function e(t){var r=this,n=t.spriteBoard,o=t.map;u(this,e),this[i.Bindable.Prevent]=!0,this.spriteBoard=n;this.spriteBoard.gl2d.context;this.map=o,this.texture=null,this.height=0,this.slices=["parallax/mountains-0.png","parallax/sky-0-recolor.png","parallax/sky-1-recolor.png","parallax/sky-1b-recolor.png","parallax/sky-2-recolor.png"],this.parallaxLayers=[],this.textures=[],o.ready.then(function(){return r.assemble(o)}).then(function(){r.loaded=!0}),this.loaded=!1,this.x=0,this.y=0},[{key:"assemble",value:function(){var e=this,t=this.spriteBoard.gl2d.context,r=this.map.imageLayers.map(function(r,i){return e.constructor.loadImage(r.image).then(function(n){var o,a,s=e.textures[i]=t.createTexture(),l=e.parallaxLayers[i]=new f,u=n.height+r.offsety;e.height<u&&(e.height=u),l.texture=s,l.width=n.width,l.height=n.height,l.offset=null!==(o=r.offsety)&&void 0!==o?o:0,l.parallax=null!==(a=r.parallaxx)&&void 0!==a?a:1,t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST)})});return Promise.all(r)}},{key:"draw",value:function(){if(this.loaded){var e=this.spriteBoard.gl2d.context,t=this.spriteBoard.gl2d.zoomLevel;this.x=this.spriteBoard.following.sprite.x+-this.spriteBoard.width/t*.5,this.y=this.spriteBoard.following.sprite.y,this.spriteBoard.drawProgram.uniformI("u_renderParallax",1),this.spriteBoard.drawProgram.uniformF("u_scroll",this.x,this.y),e.activeTexture(e.TEXTURE0);var r,i=o(this.parallaxLayers);try{for(i.s();!(r=i.n()).done;){var n=r.value;e.bindTexture(e.TEXTURE_2D,n.texture),this.spriteBoard.drawProgram.uniformF("u_size",n.width,n.width),this.spriteBoard.drawProgram.uniformF("u_parallax",n.parallax,0),this.setRectangle(0,this.spriteBoard.height+(-this.height+n.offset)*t,n.width*t,n.height*t,n.width),e.bindFramebuffer(e.FRAMEBUFFER,this.spriteBoard.drawBuffer),e.drawArrays(e.TRIANGLES,0,6)}}catch(e){i.e(e)}finally{i.f()}this.spriteBoard.drawProgram.uniformI("u_renderParallax",0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindTexture(e.TEXTURE_2D,null)}}},{key:"setRectangle",value:function(e,t,r,i){var n=this.spriteBoard.gl2d.context,o=this.spriteBoard.width/r;n.bindBuffer(n.ARRAY_BUFFER,this.spriteBoard.drawProgram.buffers.a_texCoord),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,0,o,0,0,1,0,1,o,0,o,1]),n.STATIC_DRAW);var a=e-0,s=e+this.spriteBoard.width,l=t,u=t+i;n.bindBuffer(n.ARRAY_BUFFER,this.spriteBoard.drawProgram.buffers.a_position),n.bufferData(n.ARRAY_BUFFER,new Float32Array([a,u,s,u,a,l,a,l,s,u,s,l]),n.STATIC_DRAW)}}],[{key:"loadImage",value:function(e){return this.imagePromises||(this.imagePromises={}),this.imagePromises[e]?this.imagePromises[e]:(this.imagePromises[e]=new Promise(function(t,r){var i=new Image;i.src=e,i.addEventListener("load",function(e){t(i)})}),this.imagePromises[e])}}])}()}),require.register("sprite/Sprite.js",function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Sprite=void 0;var i=t("curvature/base/Bindable"),n=t("./Camera");t("../math/Split");function o(e){"@babel/helpers - typeof";return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=l(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function s(e){return function(e){if(Array.isArray(e))return u(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||l(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){if(e){if("string"==typeof e)return u(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=Array(t);r<t;r++)i[r]=e[r];return i}function c(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,h(i.key),i)}}function h(e){var t=function(e,t){if("object"!=o(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=o(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==o(t)?t:t+""}e.Sprite=function(){function e(t){var r=this,n=t.src,o=t.spriteBoard,a=t.spriteSheet,s=(t.width,t.height,t.x),l=t.y,u=t.z;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this[i.Bindable.Prevent]=!0,this.x=s||0,this.y=l||0,this.z=u||0,this.width=32,this.height=32,this.scale=1,this.frames=[],this.frameDelay=4,this.currentDelay=this.frameDelay,this.currentFrame=0,this.currentFrames="",this.speed=0,this.maxSpeed=8,this.moving=!1,this.RIGHT=0,this.DOWN=1,this.LEFT=2,this.UP=3,this.EAST=this.RIGHT,this.SOUTH=this.DOWN,this.WEST=this.LEFT,this.NORTH=this.UP,this.region=[0,0,0,1],this.standing={north:["player_standing_north.png"],south:["player_standing_south.png"],west:["player_standing_west.png"],east:["player_standing_east.png"]},this.walking={north:["player_walking_north.png","player_walking_north.png","player_standing_north.png","player_walking_north2.png","player_walking_north2.png","player_standing_north.png"],south:["player_walking_south.png","player_walking_south.png","player_standing_south.png","player_walking_south2.png","player_walking_south2.png","player_standing_south.png"],west:["player_walking_west.png","player_walking_west.png","player_standing_west.png","player_standing_west.png","player_walking_west2.png","player_walking_west2.png","player_standing_west.png","player_standing_west.png"],east:["player_walking_east.png","player_walking_east.png","player_standing_east.png","player_standing_east.png","player_walking_east2.png","player_walking_east2.png","player_standing_east.png","player_standing_east.png"]},this.spriteBoard=o;var c=this.spriteBoard.gl2d.context;this.texture=c.createTexture(),c.bindTexture(c.TEXTURE_2D,this.texture);var h=function(){return parseInt(255*Math.random())},f=new Uint8Array([h(),h(),h(),255]);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,1,1,0,c.RGBA,c.UNSIGNED_BYTE,f),this.spriteSheet=a,this.spriteSheet.ready.then(function(t){var i=r.spriteSheet.getFrame(n);i&&e.loadTexture(r.spriteBoard.gl2d,i).then(function(e){r.texture=e.texture,r.width=e.image.width*r.scale,r.height=e.image.height*r.scale})})}return t=e,r=[{key:"draw",value:function(){var e;this.frameDelay=this.maxSpeed-Math.abs(this.speed),this.frameDelay>this.maxSpeed&&(this.frameDelay=this.maxSpeed),this.currentDelay<=0?(this.currentDelay=this.frameDelay,this.currentFrame++):this.currentDelay--,this.currentFrame>=this.frames.length&&(this.currentFrame=this.currentFrame-this.frames.length);var t=this.frames[this.currentFrame];t&&(this.texture=t.texture,this.width=t.width*this.scale,this.height=t.height*this.scale);var r=this.spriteBoard.gl2d.context;r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,this.texture),this.spriteBoard.drawProgram.uniformF("u_region",0,0,0,0);var i=this.spriteBoard.gl2d.zoomLevel;this.setRectangle(this.x*i-n.Camera.x+this.spriteBoard.width/2,this.y*i-n.Camera.y+this.spriteBoard.height/2+-this.height*i,this.width*i,this.height*i),r.bindFramebuffer(r.FRAMEBUFFER,this.spriteBoard.drawBuffer),r.drawArrays(r.TRIANGLES,0,6),(e=this.spriteBoard.drawProgram).uniformF.apply(e,["u_region"].concat(s(Object.assign(this.region||[0,0,0],{3:1})))),r.bindFramebuffer(r.FRAMEBUFFER,this.spriteBoard.effectBuffer),r.drawArrays(r.TRIANGLES,0,6),this.spriteBoard.drawProgram.uniformF("u_region",0,0,0,0),r.bindFramebuffer(r.FRAMEBUFFER,null),r.bindTexture(r.TEXTURE_2D,null)}},{key:"setFrames",value:function(t){var r=this,i=t.join(" ");if(this.currentFrames!==i){this.currentFrames=i;this.spriteSheet.ready.then(function(i){var n=i.getFrames(t).map(function(t){return function(t){return e.loadTexture(r.spriteBoard.gl2d,t)}(t).then(function(e){return{texture:e.texture,width:e.image.width,height:e.image.height}})});Promise.all(n).then(function(e){return r.frames=e})})}}},{key:"setRectangle",value:function(e,t,r,i){arguments.length>4&&void 0!==arguments[4]&&arguments[4];var n=this.spriteBoard.gl2d.context,o=this.spriteBoard.gl2d.zoomLevel;n.bindBuffer(n.ARRAY_BUFFER,this.spriteBoard.drawProgram.buffers.a_texCoord),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),n.STATIC_DRAW);var a=t+32*o,s=e+r,l=t+i+32*o,u=new Float32Array([e,a,s,a,e,l,e,l,s,a,s,l]),c=e+.5*r,h=t+.5*i,f=this.matrixTransform(u,this.matrixComposite(this.matrixTranslate(c,h),this.matrixTranslate(-c,-h)));n.bindBuffer(n.ARRAY_BUFFER,this.spriteBoard.drawProgram.buffers.a_position),n.bufferData(n.ARRAY_BUFFER,f,n.STATIC_DRAW)}},{key:"matrixIdentity",value:function(){return[[1,0,0],[0,1,0],[0,0,1]]}},{key:"matrixTranslate",value:function(e,t){return[[1,0,e],[0,1,t],[0,0,1]]}},{key:"matrixScale",value:function(e,t){return[[e,0,0],[0,t,0],[0,0,1]]}},{key:"matrixRotate",value:function(e){var t=Math.sin(e),r=Math.cos(e);return[[r,-t,0],[t,r,0],[0,0,1]]}},{key:"matrixShearX",value:function(e){return[[1,e,0],[0,1,0],[0,0,1]]}},{key:"matrixShearY",value:function(e){return[[1,0,0],[e,1,0],[0,0,1]]}},{key:"matrixMultiply",value:function(e,t){if(e.length!==t.length)throw new Error("Invalid matrices");if(e[0].length!==t.length)throw new Error("Incompatible matrices");for(var r=Array(e.length).fill().map(function(){return Array(t[0].length).fill(0)}),i=0;i<e.length;i++)for(var n=0;n<t[0].length;n++)for(var o=0;o<e[0].length;o++)r[i][n]+=e[i][o]*t[o][n];return r}},{key:"matrixComposite",value:function(){for(var e=this.matrixIdentity(),t=0;t<arguments.length;t++)e=this.matrixMultiply(e,t<0||arguments.length<=t?void 0:arguments[t]);return e}},{key:"matrixTransform",value:function(e,t){for(var r=[],i=0;i<e.length;i+=2){var n,o=[e[i],e[i+1],1],s=a(t);try{for(s.s();!(n=s.n()).done;){var l=n.value;r.push(o[0]*l[0]+o[1]*l[1]+o[2]*l[2])}}catch(e){s.e(e)}finally{s.f()}}return new Float32Array(r.filter(function(e,t){return(1+t)%3}))}}],o=[{key:"loadTexture",value:function(t,r){var i=t.context;return this.promises||(this.promises={}),this.promises[r]?this.promises[r]:(this.promises[r]=e.loadImage(r).then(function(e){var t=i.createTexture();return i.bindTexture(i.TEXTURE_2D,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e),i.bindTexture(i.TEXTURE_2D,null),{image:e,texture:t}}),this.promises[r])}},{key:"loadImage",value:function(e){return new Promise(function(t,r){var i=new Image;i.src=e,i.addEventListener("load",function(e){t(i)})})}}],r&&c(t.prototype,r),o&&c(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r,o}()}),require.register("sprite/SpriteBoard.js",function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SpriteBoard=void 0;var i=t("curvature/base/Bag"),n=t("curvature/base/Bindable"),o=t("../gl2d/Gl2d"),a=t("./Camera"),s=t("./Sprite"),l=t("./SpriteSheet"),u=t("./MapRenderer"),c=t("./Parallax"),h=t("../math/Split");function f(e){"@babel/helpers - typeof";return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,p(i.key),i)}}function p(e){var t=function(e,t){if("object"!=f(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=f(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==f(t)?t:t+""}e.SpriteBoard=function(){return e=function e(t){var r=this,f=t.element,d=t.world,p=t.map;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this[n.Bindable.Prevent]=!0,console.log(h.Split.intToBytes(65280)),this.map=p,this.maps=[],this.mapRenderers=[],this.world=d,this.sprites=new i.Bag,this.mouse={x:null,y:null,clickX:null,clickY:null},this.width=f.width,this.height=f.height,a.Camera.width=f.width,a.Camera.height=f.height,this.gl2d=new o.Gl2d(f),this.gl2d.enableBlending();this.renderMode=0,this.drawProgram=this.gl2d.createProgram({vertexShader:this.gl2d.createShader("sprite/texture.vert"),fragmentShader:this.gl2d.createShader("sprite/texture.frag"),attributes:["a_position","a_texCoord"],uniforms:["u_image","u_effect","u_tiles","u_tileMapping","u_size","u_scale","u_scroll","u_stretch","u_tileSize","u_resolution","u_mapTextureSize","u_region","u_parallax","u_time","u_renderTiles","u_renderParallax","u_renderMode"]}),this.drawProgram.use(),this.colorLocation=this.drawProgram.uniforms.u_color,this.tilePosLocation=this.drawProgram.uniforms.u_tileNo,this.regionLocation=this.drawProgram.uniforms.u_region,this.drawLayer=this.gl2d.createTexture(1e3,1e3),this.effectLayer=this.gl2d.createTexture(1e3,1e3),this.drawBuffer=this.gl2d.createFramebuffer(this.drawLayer),this.effectBuffer=this.gl2d.createFramebuffer(this.effectLayer),document.addEventListener("mousemove",function(e){r.mouse.x=e.clientX,r.mouse.y=e.clientY}),d.ready.then(function(e){r.mapRenderers=e.map(function(e){var t=new u.MapRenderer({spriteBoard:r,map:e});return t.resize(a.Camera.width,a.Camera.height),t})}),this.parallax=new c.Parallax({spriteBoard:this,map:p});var v=new l.SpriteSheet;for(var m in Array(2).fill()){var y=new s.Sprite({src:"barrel.png",spriteBoard:this,spriteSheet:v});y.x=32+64*m%1280-16,y.y=32*Math.trunc(32*m/1280)+32,this.sprites.add(y)}this.following=null},(t=[{key:"draw",value:function(){this.following&&(a.Camera.x=(16+this.following.sprite.x)*this.gl2d.zoomLevel||0,a.Camera.y=(16+this.following.sprite.y)*this.gl2d.zoomLevel||0);var e=this.gl2d.context;if(this.drawProgram.uniformF("u_size",a.Camera.width,a.Camera.height),this.drawProgram.uniformF("u_resolution",e.canvas.width,e.canvas.height),this.drawProgram.uniformI("u_renderMode",this.renderMode),this.drawProgram.uniformF("u_time",performance.now()),this.drawProgram.uniformF("u_region",0,0,0,0),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clearColor(0,0,0,1),e.bindFramebuffer(e.FRAMEBUFFER,this.effectBuffer),e.clear(e.COLOR_BUFFER_BIT),e.bindFramebuffer(e.FRAMEBUFFER,this.drawBuffer),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.bindFramebuffer(e.FRAMEBUFFER,null),this.map.backgroundColor){var t=this.map.backgroundColor.substr(1),r=parseInt(t.substr(-6,2),16)/255,i=parseInt(t.substr(-4,2),16)/255,n=parseInt(t.substr(-2,2),16)/255,o=8===t.length?parseInt(t.substr(-8,2),16)/255:1;e.clearColor(r,n,i,o)}else e.clearColor(0,0,0,1);e.clear(e.COLOR_BUFFER_BIT),window.smProfiling&&console.time("draw-parallax"),this.parallax&&this.parallax.draw(),window.smProfiling&&console.timeEnd("draw-parallax"),this.drawProgram.uniformF("u_size",a.Camera.width,a.Camera.height),window.smProfiling&&console.time("draw-tiles"),this.mapRenderers.forEach(function(e){return e.draw()}),window.smProfiling&&console.timeEnd("draw-tiles"),window.smProfiling&&console.time("draw-sprites");var s=this.sprites.items();s.sort(function(e,t){return void 0===e.y?-1:void 0===t.y?1:e.y-t.y}),s.forEach(function(e){return e.draw()}),window.smProfiling&&console.timeEnd("draw-sprites"),window.smProfiling&&(window.smProfiling=!1),this.setRectangle(0,this.gl2d.element.height,this.gl2d.element.width,-this.gl2d.element.height),e.bindFramebuffer(e.FRAMEBUFFER,null),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.drawLayer),this.drawProgram.uniformI("u_image",0),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,this.effectLayer),this.drawProgram.uniformI("u_effect",1),e.drawArrays(e.TRIANGLES,0,6),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE4),e.bindTexture(e.TEXTURE_2D,null)}},{key:"resize",value:function(e,t){var r=this.gl2d.context;e=e||this.gl2d.element.width,t=t||this.gl2d.element.height,this.width=e,this.height=t,a.Camera.x*=this.gl2d.zoomLevel,a.Camera.y*=this.gl2d.zoomLevel,a.Camera.width=e/this.gl2d.zoomLevel,a.Camera.height=t/this.gl2d.zoomLevel,this.mapRenderers.forEach(function(e){return e.resize(a.Camera.width,a.Camera.height)}),r.bindTexture(r.TEXTURE_2D,this.drawLayer),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,this.width,this.height,0,r.RGBA,r.UNSIGNED_BYTE,null),r.bindTexture(r.TEXTURE_2D,this.effectLayer),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,this.width,this.height,0,r.RGBA,r.UNSIGNED_BYTE,null),r.bindTexture(r.TEXTURE_2D,null)}},{key:"setRectangle",value:function(e,t,r,i){var n=this.gl2d.context;n.bindBuffer(n.ARRAY_BUFFER,this.drawProgram.buffers.a_position);var o=e,a=e+r,s=t,l=t+i;n.bufferData(n.ARRAY_BUFFER,new Float32Array([o,s,a,s,o,l,o,l,a,s,a,l]),n.STREAM_DRAW)}}])&&d(e.prototype,t),r&&d(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}()}),require.register("sprite/SpriteSheet.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,o(i.key),i)}}function o(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.SpriteSheet=void 0;e.SpriteSheet=function(){return e=function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.imageUrl="/spritesheet.png",this.boxesUrl="/spritesheet.json",this.vertices={},this.frames={},this.width=0,this.height=0;var r=fetch(this.boxesUrl).then(function(e){return e.json()}).then(function(e){return t.boxes=e}),i=new Promise(function(e){t.image=new Image,t.image.src=t.imageUrl,t.image.onload=function(){e()}});this.ready=Promise.all([r,i]).then(function(){return t.processImage()}).then(function(){return t})},r=[{key:"loadTexture",value:function(e,t){var r=e.context;if(this.texturePromises||(this.texturePromises={}),this.texturePromises[t])return this.texturePromises[t];var i=r.createTexture();return this.texturePromises[t]=this.loadImage(t).then(function(e){return r.bindTexture(r.TEXTURE_2D,i),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),{image:e,texture:i}})}},{key:"loadImage",value:function(e){return this.imagePromises||(this.imagePromises={}),this.imagePromises[e]?this.imagePromises[e]:(this.imagePromises[e]=new Promise(function(t,r){var i=new Image;i.src=e,i.addEventListener("load",function(e){t(i)})}),this.imagePromises[e])}}],(t=[{key:"processImage",value:function(){var e=this;if(this.boxes&&this.boxes.frames){var t=document.createElement("canvas");t.width=this.image.width,t.height=this.image.height;var r=t.getContext("2d",{willReadFrequently:!0});r.drawImage(this.image,0,0);var i=[],n=function(t){var n=document.createElement("canvas");n.width=e.boxes.frames[t].frame.w,n.height=e.boxes.frames[t].frame.h;var o=n.getContext("2d");e.boxes.frames[t].frame&&o.putImageData(r.getImageData(e.boxes.frames[t].frame.x,e.boxes.frames[t].frame.y,e.boxes.frames[t].frame.w,e.boxes.frames[t].frame.h),0,0),e.boxes.frames[t].text&&(o.fillStyle=e.boxes.frames[t].color||"white",o.font=e.boxes.frames[t].font||"".concat(e.boxes.frames[t].frame.h,"px sans-serif"),o.textAlign="center",o.fillText(e.boxes.frames[t].text,e.boxes.frames[t].frame.w/2,e.boxes.frames[t].frame.h,e.boxes.frames[t].frame.w),o.textAlign=null,o.font=null),i.push(new Promise(function(r){n.toBlob(function(i){e.frames[e.boxes.frames[t].filename]=URL.createObjectURL(i),r(e.frames[e.boxes.frames[t].filename])})}))};for(var o in this.boxes.frames)n(o);return Promise.all(i)}}},{key:"getVertices",value:function(e){return this.vertices[e]}},{key:"getFrame",value:function(e){return this.frames[e]}},{key:"getFrames",value:function(e){var t=this;return Array.isArray(e)?e.map(function(e){return t.getFrame(e)}):this.getFramesByPrefix(e)}},{key:"getFramesByPrefix",value:function(e){var t=[];for(var r in this.frames)r.substring(0,e.length)===e&&t.push(this.frames[r]);return t}}])&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}()}),require.register("sprite/TextureBank.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,o(i.key),i)}}function o(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.TextureBank=void 0;e.TextureBank=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)})}),require.register("sprite/Tileset.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(){n=function(){return t};var e,t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},s="function"==typeof Symbol?Symbol:{},l=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function h(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{h({},"")}catch(e){h=function(e,t,r){return e[t]=r}}function f(e,t,r,i){var n=t&&t.prototype instanceof g?t:g,o=Object.create(n.prototype),s=new A(i||[]);return a(o,"_invoke",{value:O(e,r,s)}),o}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=f;var p="suspendedStart",v="suspendedYield",m="executing",y="completed",b={};function g(){}function w(){}function x(){}var _={};h(_,l,function(){return this});var T=Object.getPrototypeOf,E=T&&T(T(B([])));E&&E!==r&&o.call(E,l)&&(_=E);var S=x.prototype=g.prototype=Object.create(_);function P(e){["next","throw","return"].forEach(function(t){h(e,t,function(e){return this._invoke(t,e)})})}function j(e,t){function r(n,a,s,l){var u=d(e[n],e,a);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==i(h)&&o.call(h,"__await")?t.resolve(h.__await).then(function(e){r("next",e,s,l)},function(e){r("throw",e,s,l)}):t.resolve(h).then(function(e){c.value=e,s(c)},function(e){return r("throw",e,s,l)})}l(u.arg)}var n;a(this,"_invoke",{value:function(e,i){function o(){return new t(function(t,n){r(e,i,t,n)})}return n=n?n.then(o,o):o()}})}function O(t,r,i){var n=p;return function(o,a){if(n===m)throw Error("Generator is already running");if(n===y){if("throw"===o)throw a;return{value:e,done:!0}}for(i.method=o,i.arg=a;;){var s=i.delegate;if(s){var l=C(s,i);if(l){if(l===b)continue;return l}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(n===p)throw n=y,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);n=m;var u=d(t,r,i);if("normal"===u.type){if(n=i.done?y:v,u.arg===b)continue;return{value:u.arg,done:i.done}}"throw"===u.type&&(n=y,i.method="throw",i.arg=u.arg)}}}function C(t,r){var i=r.method,n=t.iterator[i];if(n===e)return r.delegate=null,"throw"===i&&t.iterator.return&&(r.method="return",r.arg=e,C(t,r),"throw"===r.method)||"return"!==i&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+i+"' method")),b;var o=d(n,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,b;var a=o.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,b):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,b)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function B(t){if(t||""===t){var r=t[l];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,a=function r(){for(;++n<t.length;)if(o.call(t,n))return r.value=t[n],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(i(t)+" is not iterable")}return w.prototype=x,a(S,"constructor",{value:x,configurable:!0}),a(x,"constructor",{value:w,configurable:!0}),w.displayName=h(x,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,h(e,c,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},P(j.prototype),h(j.prototype,u,function(){return this}),t.AsyncIterator=j,t.async=function(e,r,i,n,o){void 0===o&&(o=Promise);var a=new j(f(e,r,i,n),o);return t.isGeneratorFunction(r)?a:a.next().then(function(e){return e.done?e.value:a.next()})},P(S),h(S,c,"Generator"),h(S,l,function(){return this}),h(S,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),r=[];for(var i in t)r.push(i);return r.reverse(),function e(){for(;r.length;){var i=r.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},t.values=B,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(k),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(i,n){return s.type="throw",s.arg=t,r.next=i,n&&(r.method="next",r.arg=e),!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var l=o.call(a,"catchLoc"),u=o.call(a,"finallyLoc");if(l&&u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var n=i;break}}n&&("break"===e||"continue"===e)&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null);var a=n?n.completion:{};return a.type=e,a.arg=t,n?(this.method="next",this.next=n.finallyLoc,b):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),b},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),b}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var i=r.completion;if("throw"===i.type){var n=i.arg;k(r)}return n}}throw Error("illegal catch attempt")},delegateYield:function(t,r,i){return this.delegate={iterator:B(t),resultName:r,nextLoc:i},"next"===this.method&&(this.arg=e),b}},t}function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return a(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw o}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=Array(t);r<t;r++)i[r]=e[r];return i}function s(e,t,r,i,n,o,a){try{var s=e[o](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(i,n)}function l(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,u(i.key),i)}}function u(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Tileset=void 0;e.Tileset=function(){return e=function e(t){var r=t.source,i=t.firstgid,n=t.columns,o=t.image,a=t.imageheight,s=t.imagewidth,l=t.margin,u=t.name,c=t.spacing,h=t.tilecount,f=t.tileheight,d=t.tilewidth,p=t.tiles;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.firstGid=i,this.ready=this.getReady({source:r,columns:n,image:o,imageheight:a,imagewidth:s,margin:l,name:u,spacing:c,tilecount:h,tileheight:f,tilewidth:d,tiles:p})},(t=[{key:"getReady",value:function(){var e,t=(e=n().mark(function e(t){var r,i,a,s,l,u,c,h,f,d,p,v,m,y,b,g=this;return n().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.source,i=t.columns,a=t.image,s=t.imageheight,l=t.imagewidth,u=t.margin,c=t.name,h=t.spacing,f=t.tilecount,d=t.tileheight,p=t.tilewidth,v=t.tiles,!r){e.next=20;break}return e.next=4,fetch(r);case 4:return e.next=6,e.sent.json();case 6:m=e.sent,i=m.columns,a=m.image,s=m.imageheight,l=m.imagewidth,u=m.margin,c=m.name,h=m.spacing,f=m.tilecount,d=m.tileheight,p=m.tilewidth,v=m.tiles,y=o(v);try{for(y.s();!(b=y.n()).done;)b.value.id+=this.firstGid}catch(e){y.e(e)}finally{y.f()}case 20:return this.image=new Image,this.image.src=a,this.columns=i,this.imageWidth=l,this.imageHeight=s,this.margin=u,this.name=c,this.spacing=h,this.tileCount=f,this.tileHeight=d,this.tileWidth=p,this.tiles=null!==v&&void 0!==v?v:[],console.log(this),e.abrupt("return",new Promise(function(e){return g.image.onload=function(){return e()}}));case 34:case"end":return e.stop()}},e,this)}),function(){var t=this,r=arguments;return new Promise(function(i,n){var o=e.apply(t,r);function a(e){s(o,i,n,a,l,"next",e)}function l(e){s(o,i,n,a,l,"throw",e)}a(void 0)})});return function(e){return t.apply(this,arguments)}}()}])&&l(e.prototype,t),r&&l(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}()}),require.register("sprite/texture.frag",function(e,t,r){r.exports="// texture.frag\n#define M_PI 3.1415926535897932384626433832795\n#define M_TAU M_PI / 2.0\nprecision mediump float;\n\nvarying vec2 v_texCoord;\nvarying vec2 v_position;\n\nuniform sampler2D u_image;\nuniform sampler2D u_effect;\nuniform sampler2D u_tiles;\nuniform sampler2D u_tileMapping;\n\nuniform vec2 u_size;\nuniform vec2 u_tileSize;\nuniform vec2 u_resolution;\nuniform vec2 u_mapTextureSize;\n\nuniform vec4 u_color;\nuniform vec4 u_region;\nuniform vec2 u_parallax;\nuniform vec2 u_scroll;\nuniform vec2 u_stretch;\n\nuniform float u_time;\nuniform float u_scale;\n\nuniform int u_renderTiles;\nuniform int u_renderParallax;\nuniform int u_renderMode;\n\nfloat masked = 0.0;\nfloat sorted = 1.0;\nfloat displace = 1.0;\nfloat blur = 1.0;\n\nvec2 rippleX(vec2 texCoord, float a, float b, float c) {\n  vec2 rippled = vec2(\n    v_texCoord.x + sin(v_texCoord.y * (a * u_size.y) + b) * c / u_size.x,\n    v_texCoord.y\n  );\n\n  if (rippled.x < 0.0) {\n    rippled.x = abs(rippled.x);\n  }\n  else if (rippled.x > u_size.x) {\n    rippled.x = u_size.x - (rippled.x - u_size.x);\n  }\n\n  return rippled;\n}\n\nvec2 rippleY(vec2 texCoord, float a, float b, float c) {\n  vec2 rippled = vec2(v_texCoord.x, v_texCoord.y + sin(v_texCoord.x * (a * u_size.x) + b) * c / u_size.y);\n\n  if (rippled.y < 0.0) {\n    rippled.x = abs(rippled.x);\n  }\n  else if (rippled.y > u_size.y) {\n    rippled.y = u_size.y - (rippled.y - u_size.y);\n  }\n\n  return rippled;\n}\n\nvec4 motionBlur(sampler2D image, float angle, float magnitude, vec2 textCoord) {\n  vec4 originalColor = texture2D(image, textCoord);\n  vec4 dispColor = originalColor;\n\n  const float max = 10.0;\n  float weight = 0.85;\n\n  for (float i = 0.0; i < max; i += 1.0) {\n    if(i > abs(magnitude) || originalColor.a < 1.0) {\n      break;\n    }\n    vec4 dispColorDown = texture2D(image, textCoord + vec2(\n      cos(angle) * i * sign(magnitude) / u_size.x,\n      sin(angle) * i * sign(magnitude) / u_size.y\n    ));\n    dispColor = dispColor * (1.0 - weight) + dispColorDown * weight;\n    weight *= 0.8;\n  }\n\n  return dispColor;\n}\n\nvec4 linearBlur(sampler2D image, float angle, float magnitude, vec2 textCoord) {\n  vec4 originalColor = texture2D(image, textCoord);\n  vec4 dispColor = texture2D(image, textCoord);\n\n  const float max = 10.0;\n  float weight = 0.65;\n\n  for (float i = 0.0; i < max; i += 0.25) {\n    if(i > abs(magnitude)) {\n      break;\n    }\n    vec4 dispColorUp = texture2D(image, textCoord + vec2(\n      cos(angle) * -i * sign(magnitude) / u_size.x,\n      sin(angle) * -i * sign(magnitude) / u_size.y\n    ));\n    vec4 dispColorDown = texture2D(image, textCoord + vec2(\n      cos(angle) * i * sign(magnitude) / u_size.x,\n      sin(angle) * i * sign(magnitude) / u_size.y\n    ));\n    dispColor = dispColor * (1.0 - weight) + dispColorDown * weight * 0.5 + dispColorUp * weight * 0.5;\n    weight *= 0.70;\n  }\n\n  return dispColor;\n}\n\nvoid main() {\n  vec4 originalColor = texture2D(u_image, v_texCoord);\n  vec4 effectColor = texture2D(u_effect,  v_texCoord);\n\n  // This only applies when drawing the parallax background\n  if (u_renderParallax == 1) {\n\n    float texelSize = 1.0 / u_size.x;\n\n    vec2 parallaxCoord = v_texCoord * vec2(1.0, -1.0) + vec2(0.0, 1.0)\n      + vec2(u_scroll.x * texelSize * u_parallax.x, 0.0);\n      // + vec2(u_time / 10000.0, 0.0);\n      // + vec2(, 0.0);\n      ;\n\n    gl_FragColor = texture2D(u_image,  parallaxCoord);\n\n    return;\n  }\n\n  // This only applies when drawing tiles.\n  if (u_renderTiles == 1) {\n    float xTiles = floor(u_size.x / u_tileSize.x);\n    float yTiles = floor(u_size.y / u_tileSize.y);\n\n    float xT = (v_texCoord.x * u_size.x) / u_tileSize.x;\n    float yT = (v_texCoord.y * u_size.y) / u_tileSize.y;\n\n    float inv_xTiles = 1.0 / xTiles;\n    float inv_yTiles = 1.0 / yTiles;\n\n    float xTile = floor(xT) * inv_xTiles;\n    float yTile = floor(yT) * inv_yTiles;\n\n    float xOff = (xT * inv_xTiles - xTile) * xTiles;\n    float yOff = (yT * inv_yTiles - yTile) * yTiles * -1.0 + 1.0;\n\n    float xWrap = u_mapTextureSize.x / u_tileSize.x;\n    float yWrap = u_mapTextureSize.y / u_tileSize.y;\n\n    // Mode 1 draws tiles' x/y values as red & green\n    if (u_renderMode == 1) {\n      gl_FragColor = vec4(xTile, yTile, 0, 1.0);\n      return;\n    }\n\n    // Mode 2 is the same as mode 1 but adds combines\n    // internal tile x/y to the blue channel\n    if (u_renderMode == 2) {\n      gl_FragColor = vec4(xTile, yTile, (xOff + yOff) * 0.5, 1.0);\n      return;\n    }\n\n    vec4 tile = texture2D(u_tileMapping, v_texCoord * vec2(1.0, -1.0) + vec2(0.0, 1.0));\n\n    float lo = tile.r * 256.0;\n    float hi = tile.g * 256.0 * 256.0;\n\n    float tileNumber = lo + hi;\n\n    if (tileNumber == 0.0) {\n      gl_FragColor.a = 0.0;\n      return;\n    }\n\n    // Mode 3 uses the tile number for the red/green channels\n    if (u_renderMode == 3) {\n      gl_FragColor = tile;\n      gl_FragColor.b = 0.5;\n      gl_FragColor.a = 1.0;\n      return;\n    }\n\n    // Mode 4 normalizes the tile number to all channels\n    if (u_renderMode == 4) {\n      gl_FragColor = vec4(\n        mod(tileNumber, 256.0) / 256.0\n        , mod(tileNumber, 256.0) / 256.0\n        , mod(tileNumber, 256.0) / 256.0\n        , 1.0\n      );\n      return;\n    }\n\n    float tileSetX = floor(mod((-1.0 + tileNumber), xWrap));\n    float tileSetY = floor((-1.0 + tileNumber) / xWrap);\n\n    vec4 tileColor = texture2D(u_tiles, vec2(\n      xOff / xWrap + tileSetX * (u_tileSize.y / u_mapTextureSize.y)\n      , yOff / yWrap + tileSetY * (u_tileSize.y / u_mapTextureSize.y)\n    ));\n\n    gl_FragColor = tileColor;\n\n    return;\n  }\n\n  // This if/else block only applies\n  // when we're drawing the effectBuffer\n  if (u_region.r > 0.0 || u_region.g > 0.0 || u_region.b > 0.0) {\n    if (masked < 1.0 || originalColor.a > 0.0) {\n      gl_FragColor = u_region;\n    }\n    return;\n  }\n  else if (u_region.a > 0.0) {\n    if (sorted > 0.0) {\n      gl_FragColor = vec4(0, 0, 0, originalColor.a > 0.0 ? 1.0 : 0.0);\n    }\n    else {\n      gl_FragColor = vec4(0, 0, 0, 0.0);\n    }\n    return;\n  };\n\n  // Mode 5 draws the effect buffer to the screen\n  if (u_renderMode == 5) {\n    gl_FragColor = effectColor;\n    return;\n  }\n\n  vec3 ripple = vec3(M_PI/8.0, u_time / 200.0, 1.0);\n\n  // This if/else block only applies\n  // when we're drawing the drawBuffer\n  if (effectColor == vec4(0, 1, 1, 1)) { // Water region\n    vec2 texCoord = v_texCoord;\n    vec4 v_blurredColor = originalColor;\n    if (displace > 0.0) {\n      texCoord = rippleX(v_texCoord, ripple.x, ripple.y, ripple.z);\n      v_blurredColor = texture2D(u_image, texCoord);\n    }\n    if (blur > 0.0) {\n      v_blurredColor = linearBlur(u_image, 0.0, 1.0, texCoord);\n    }\n    gl_FragColor = v_blurredColor * 0.65 + effectColor * 0.35;\n  }\n  else if (effectColor == vec4(1, 0, 0, 1)) { // Fire region\n    vec2 v_displacement = rippleY(v_texCoord, ripple.x * 3.0, ripple.y * 1.5, ripple.z * 0.333);\n    vec4 v_blurredColor = originalColor;\n    if (displace > 0.0) {\n      v_blurredColor = texture2D(u_image, v_displacement);\n    }\n    if (blur > 0.0) {\n      v_blurredColor = motionBlur(u_image, -M_TAU, 1.0, v_displacement);\n    }\n    gl_FragColor = v_blurredColor * 0.75 + effectColor * 0.25;\n  }\n  else { // Null region\n    gl_FragColor = originalColor;\n  }\n}\n"}),require.register("sprite/texture.vert",function(e,t,r){r.exports="// texture.vert\nprecision mediump float;\n\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\n\nuniform vec2 u_resolution;\n\nvarying vec2 v_texCoord;\nvarying vec2 v_position;\n\nvoid main()\n{\n  vec2 zeroToOne = a_position / u_resolution;\n  vec2 zeroToTwo = zeroToOne * 2.0;\n  vec2 clipSpace = zeroToTwo - 1.0;\n\n  gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n  v_texCoord  = a_texCoord;\n  v_position  = a_position;\n}\n"}),require.register("ui/Controller.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.Controller=void 0;var n=t("curvature/base/View");function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,a(i.key),i)}}function a(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}function s(e,t,r){return t=l(t),function(e,t){if(t&&("object"==i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,r||[],l(e).constructor):t.apply(e,r))}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}e.Controller=function(e){function r(e){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(i=s(this,r,[e])).template=t("./controller.tmp"),i.dragStart=!1,i.args.dragging=!1,i.args.x=0,i.args.y=0,window.addEventListener("mousemove",function(e){i.moveStick(e)}),window.addEventListener("mouseup",function(e){i.dropStick(e)}),window.addEventListener("touchmove",function(e){i.moveStick(e)}),window.addEventListener("touchend",function(e){i.dropStick(e)}),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(r,n.View),i=r,(a=[{key:"dragStick",value:function(e){var t=e;e.preventDefault(),e.touches&&e.touches[0]&&(t=e.touches[0]),this.args.dragging=!0,this.dragStart={x:t.clientX,y:t.clientY}}},{key:"moveStick",value:function(e){if(this.args.dragging){var t=e;e.touches&&e.touches[0]&&(t=e.touches[0]),this.args.xx=t.clientX-this.dragStart.x,this.args.yy=t.clientY-this.dragStart.y;this.args.xx<-50?this.args.x=-50:this.args.xx>50?this.args.x=50:this.args.x=this.args.xx,this.args.yy<-50?this.args.y=-50:this.args.yy>50?this.args.y=50:this.args.y=this.args.yy}}},{key:"dropStick",value:function(e){this.args.dragging=!1,this.args.x=0,this.args.y=0}}])&&o(i.prototype,a),l&&o(i,l),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,a,l}()}),require.register("ui/MapEditor.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.MapEditor=void 0;var n=t("curvature/base/View");function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,a(i.key),i)}}function a(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}function s(e,t,r){return t=l(t),function(e,t){if(t&&("object"==i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,r||[],l(e).constructor):t.apply(e,r))}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}e.MapEditor=function(e){function r(e){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(i=s(this,r,[e])).template=t("./mapEditor.tmp"),e.spriteSheet.ready.then(function(e){i.args.tiles=e.frames}),i.args.bindTo("selectedGraphic",function(e){i.args.selectedGraphic=null},{wait:0}),i.args.multiSelect=!1,i.args.selection={},i.args.selectedImage=null,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(r,n.View),i=r,(a=[{key:"selectGraphic",value:function(e){console.log(e),this.args.selectedGraphic=e}},{key:"select",value:function(e){Object.assign(this.args.selection,e),e.globalX!==e.startGlobalX||e.globalY!==e.startGlobalY?this.args.multiSelect=!0:this.args.multiSelect=!1,this.args.multiSelect||(this.args.selectedImages=this.args.map.getTile(e.globalX,e.globalY))}}])&&o(i.prototype,a),l&&o(i,l),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,a,l}()}),require.register("ui/controller.tmp.html",function(e,t,r){r.exports='<div class = "controller">\n\t<div class = "joystick" cv-on = "\n\t\ttouchstart:dragStick(event);\n\t\tmousedown:dragStick(event);\n\t">\n\t\t<div class = "pad" style = "position: relative; transform:translate([[x]]px,[[y]]px);"></div>\n\t</div>\n\n\t<div class = "button">A</div>\n\t<div class = "button">B</div>\n\t<div class = "button">C</div>\n</div>'}),require.register("ui/mapEditor.tmp.html",function(e,t,r){r.exports='<div class = "tab-page mapEditor">\n\t<div class = "tabs">\n\t\t<div>Tile</div>\n\t\t<div>Layer</div>\n\t\t<div>Object</div>\n\t\t<div>Trigger</div>\n\t\t<div>Map</div>\n\t</div>\n\n\t<div class = "tile">\n\t\t<div class = "selected">\n\t\t\t<div cv-if = "!multiSelect">\n\t\t\t\t<p style = "font-size: large">\n\t\t\t\t\t([[selection.globalX]], [[selection.globalY]])\n\t\t\t\t</p>\n\t\t\t\t<p cv-each = "selectedImages:selectedImage:sI">\n\t\t\t\t\t<button>-</button>\n\t\t\t\t\t<img class = "current" cv-attr = "src:selectedImage">\n\t\t\t\t</p>\n\t\t\t\t<button>+</button>\n\t\t\t</div>\n\t\t\t<div cv-if = "multiSelect">\n\t\t\t\t<p style = "font-size: large">\n\t\t\t\t\t([[selection.startGlobalX]], [[selection.startGlobalY]]) - ([[selection.globalX]], [[selection.globalY]])\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class = "tiles" cv-each = "tiles:tile:t">\n\t\t\t<img cv-attr = "src:tile,title:t" cv-on = "click:selectGraphic(t);">\n\t\t</div>\n\t</div>\n\t\x3c!-- <div class = "tile">OBJECT MODE</div>\n\t<div class = "tile">TRIGGER MODE</div>\n\t<div class = "tile">MAP MODE</div> --\x3e\n</div>'}),require.register("world/Actor.js",function(e,t,r){"use strict"}),require.register("world/Floor.js",function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Floor=void 0;var i=t("../sprite/Sprite");function n(e){"@babel/helpers - typeof";return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,a(i.key),i)}}function a(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}e.Floor=function(){return e=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.gl2d=t,this.sprites=[],this.resize(9,9)},(t=[{key:"resize",value:function(e,t){this.width=e,this.height=t;for(var r=0;r<e;r++)for(var n=0;n<t;n++){var o=new i.Sprite(this.gl2d,"/floorTile.png");o.x=32*r,o.y=32*n,this.sprites.push(o)}}},{key:"draw",value:function(){this.sprites.map(function(e){return e.draw()})}}])&&o(e.prototype,t),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}()}),require.register("world/TileMap.js",function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TileMap=void 0;var i=t("curvature/base/Bindable"),n=t("../sprite/Tileset");function o(e){"@babel/helpers - typeof";return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(){a=function(){return t};var e,t={},r=Object.prototype,i=r.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},s="function"==typeof Symbol?Symbol:{},l=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function h(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{h({},"")}catch(e){h=function(e,t,r){return e[t]=r}}function f(e,t,r,i){var o=t&&t.prototype instanceof g?t:g,a=Object.create(o.prototype),s=new A(i||[]);return n(a,"_invoke",{value:O(e,r,s)}),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=f;var p="suspendedStart",v="suspendedYield",m="executing",y="completed",b={};function g(){}function w(){}function x(){}var _={};h(_,l,function(){return this});var T=Object.getPrototypeOf,E=T&&T(T(B([])));E&&E!==r&&i.call(E,l)&&(_=E);var S=x.prototype=g.prototype=Object.create(_);function P(e){["next","throw","return"].forEach(function(t){h(e,t,function(e){return this._invoke(t,e)})})}function j(e,t){function r(n,a,s,l){var u=d(e[n],e,a);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==o(h)&&i.call(h,"__await")?t.resolve(h.__await).then(function(e){r("next",e,s,l)},function(e){r("throw",e,s,l)}):t.resolve(h).then(function(e){c.value=e,s(c)},function(e){return r("throw",e,s,l)})}l(u.arg)}var a;n(this,"_invoke",{value:function(e,i){function n(){return new t(function(t,n){r(e,i,t,n)})}return a=a?a.then(n,n):n()}})}function O(t,r,i){var n=p;return function(o,a){if(n===m)throw Error("Generator is already running");if(n===y){if("throw"===o)throw a;return{value:e,done:!0}}for(i.method=o,i.arg=a;;){var s=i.delegate;if(s){var l=C(s,i);if(l){if(l===b)continue;return l}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(n===p)throw n=y,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);n=m;var u=d(t,r,i);if("normal"===u.type){if(n=i.done?y:v,u.arg===b)continue;return{value:u.arg,done:i.done}}"throw"===u.type&&(n=y,i.method="throw",i.arg=u.arg)}}}function C(t,r){var i=r.method,n=t.iterator[i];if(n===e)return r.delegate=null,"throw"===i&&t.iterator.return&&(r.method="return",r.arg=e,C(t,r),"throw"===r.method)||"return"!==i&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+i+"' method")),b;var o=d(n,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,b;var a=o.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,b):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,b)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function B(t){if(t||""===t){var r=t[l];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,a=function r(){for(;++n<t.length;)if(i.call(t,n))return r.value=t[n],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(o(t)+" is not iterable")}return w.prototype=x,n(S,"constructor",{value:x,configurable:!0}),n(x,"constructor",{value:w,configurable:!0}),w.displayName=h(x,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,h(e,c,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},P(j.prototype),h(j.prototype,u,function(){return this}),t.AsyncIterator=j,t.async=function(e,r,i,n,o){void 0===o&&(o=Promise);var a=new j(f(e,r,i,n),o);return t.isGeneratorFunction(r)?a:a.next().then(function(e){return e.done?e.value:a.next()})},P(S),h(S,c,"Generator"),h(S,l,function(){return this}),h(S,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),r=[];for(var i in t)r.push(i);return r.reverse(),function e(){for(;r.length;){var i=r.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},t.values=B,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(k),!t)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(i,n){return s.type="throw",s.arg=t,r.next=i,n&&(r.method="next",r.arg=e),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var l=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(l&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,b):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),b},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),b}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var i=r.completion;if("throw"===i.type){var n=i.arg;k(r)}return n}}throw Error("illegal catch attempt")},delegateYield:function(t,r,i){return this.delegate={iterator:B(t),resultName:r,nextLoc:i},"next"===this.method&&(this.arg=e),b}},t}function s(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return l(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=Array(t);r<t;r++)i[r]=e[r];return i}function u(e,t,r,i,n,o,a){try{var s=e[o](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(i,n)}function c(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,h(i.key),i)}}function h(e){var t=function(e,t){if("object"!=o(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=o(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==o(t)?t:t+""}e.TileMap=function(){return e=function e(t){var r=t.src;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this[i.Bindable.Prevent]=!0,this.image=document.createElement("img"),this.src=r,this.pixels=[],this.tileCount=0,this.backgroundColor=null,this.properties={},this.canvases=new Map,this.contexts=new Map,this.tileLayers=[],this.imageLayers=[],this.objectLayers=[],this.xWorld=0,this.yWorld=0,this.width=0,this.height=0,this.tileWidth=0,this.tileHeight=0,this.tileSetWidth=0,this.tileSetHeight=0,this.ready=this.getReady(r),this.animations=new Map},(t=[{key:"getReady",value:function(){var e,t=(e=a().mark(function e(t){var r,i,o,l,u;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:return e.next=4,e.sent.json();case 4:if(r=e.sent,this.tileLayers=r.layers.filter(function(e){return"tilelayer"===e.type}),this.imageLayers=r.layers.filter(function(e){return"imagelayer"===e.type}),this.objectLayers=r.layers.filter(function(e){return"objectlayer"===e.type}),this.backgroundColor=r.backgroundcolor,r.properties){i=s(r.properties);try{for(i.s();!(o=i.n()).done;)l=o.value,this.properties[l.name]=l.value}catch(e){i.e(e)}finally{i.f()}}return this.properties.backgroundColor&&(this.backgroundColor=this.properties.backgroundColor),u=r.tilesets.map(function(e){return new n.Tileset(e)}),this.width=r.width,this.height=r.height,this.tileWidth=r.tilewidth,this.tileHeight=r.tileheight,e.next=18,Promise.all(u.map(function(e){return e.ready}));case 18:return this.assemble(u),e.abrupt("return",this);case 20:case"end":return e.stop()}},e,this)}),function(){var t=this,r=arguments;return new Promise(function(i,n){var o=e.apply(t,r);function a(e){u(o,i,n,a,s,"next",e)}function s(e){u(o,i,n,a,s,"throw",e)}a(void 0)})});return function(e){return t.apply(this,arguments)}}()},{key:"assemble",value:function(e){var t=this;e.sort(function(e,t){return e.firstGid-t.firstGid});var r=this.tileCount=e.reduce(function(e,t){return e.tileCount+t.tileCount},{tileCount:0}),i=Math.ceil(Math.sqrt(r)),n=document.createElement("canvas");this.tileSetWidth=n.width=i*this.tileWidth,this.tileSetHeight=n.height=Math.ceil(r/i)*this.tileHeight;var o,a=n.getContext("2d"),l=0,u=0,c=s(e);try{for(c.s();!(o=c.n()).done;){var h=o.value,f=0,d=0,p=h.image,v=document.createElement("canvas");v.width=p.width,v.height=p.height;var m=v.getContext("2d",{willReadFrequently:!0});m.drawImage(p,0,0);for(var y=0;y<h.tileCount;y++){var b=m.getImageData(f,d,this.tileWidth,this.tileHeight);a.putImageData(b,l,u),f+=this.tileWidth,l+=this.tileWidth,f>=h.imageWidth&&(f=0,d+=this.tileHeight),l>=n.width&&(l=0,u+=this.tileHeight)}}}catch(e){c.e(e)}finally{c.f()}this.pixels=a.getImageData(0,0,n.width,n.height).data,n.toBlob(function(e){var r=URL.createObjectURL(e);t.image.onload=function(){return URL.revokeObjectURL(r)},t.image.src=r});var g,w=s(e);try{for(w.s();!(g=w.n()).done;){var x,_=s(g.value.tiles);try{for(_.s();!(x=_.n()).done;){var T=x.value;T.animation&&this.animations.set(T.id,T.animation)}}catch(e){_.e(e)}finally{_.f()}}}catch(e){w.e(e)}finally{w.f()}var E,S=s(this.tileLayers);try{for(S.s();!(E=S.n()).done;){var P=E.value,j=document.createElement("canvas"),O=j.getContext("2d",{willReadFrequently:!0});this.canvases.set(P,j),this.contexts.set(P,O);var C=new Uint32Array(P.data.map(function(e){return 0+e})),R=new Uint8ClampedArray(C.buffer);for(var k in C){var A=C[k];this.animations.has(A)&&console.log({i:k,tile:A},this.animations.get(A))}for(var B=3;B<R.length;B+=4)R[B]=255;j.width=this.width,j.height=this.height,O.putImageData(new ImageData(R,this.width,this.height),0,0)}}catch(e){S.e(e)}finally{S.f()}}},{key:"getSlice",value:function(e,t,r,i){arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.contexts.values().map(function(n){return n.getImageData(e,t,r,i).data})}}])&&c(e.prototype,t),r&&c(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}()}),require.register("world/World.js",function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.World=void 0;var i=t("curvature/base/Bindable"),n=(t("../sprite/Tileset"),t("./TileMap")),o=t("../math/Rectangle"),a=t("../math/SMTree");function s(e){"@babel/helpers - typeof";return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return u(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=Array(t);r<t;r++)i[r]=e[r];return i}function c(){c=function(){return t};var e,t={},r=Object.prototype,i=r.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",l=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function h(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{h({},"")}catch(e){h=function(e,t,r){return e[t]=r}}function f(e,t,r,i){var o=t&&t.prototype instanceof g?t:g,a=Object.create(o.prototype),s=new A(i||[]);return n(a,"_invoke",{value:O(e,r,s)}),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=f;var p="suspendedStart",v="suspendedYield",m="executing",y="completed",b={};function g(){}function w(){}function x(){}var _={};h(_,a,function(){return this});var T=Object.getPrototypeOf,E=T&&T(T(B([])));E&&E!==r&&i.call(E,a)&&(_=E);var S=x.prototype=g.prototype=Object.create(_);function P(e){["next","throw","return"].forEach(function(t){h(e,t,function(e){return this._invoke(t,e)})})}function j(e,t){function r(n,o,a,l){var u=d(e[n],e,o);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==s(h)&&i.call(h,"__await")?t.resolve(h.__await).then(function(e){r("next",e,a,l)},function(e){r("throw",e,a,l)}):t.resolve(h).then(function(e){c.value=e,a(c)},function(e){return r("throw",e,a,l)})}l(u.arg)}var o;n(this,"_invoke",{value:function(e,i){function n(){return new t(function(t,n){r(e,i,t,n)})}return o=o?o.then(n,n):n()}})}function O(t,r,i){var n=p;return function(o,a){if(n===m)throw Error("Generator is already running");if(n===y){if("throw"===o)throw a;return{value:e,done:!0}}for(i.method=o,i.arg=a;;){var s=i.delegate;if(s){var l=C(s,i);if(l){if(l===b)continue;return l}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(n===p)throw n=y,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);n=m;var u=d(t,r,i);if("normal"===u.type){if(n=i.done?y:v,u.arg===b)continue;return{value:u.arg,done:i.done}}"throw"===u.type&&(n=y,i.method="throw",i.arg=u.arg)}}}function C(t,r){var i=r.method,n=t.iterator[i];if(n===e)return r.delegate=null,"throw"===i&&t.iterator.return&&(r.method="return",r.arg=e,C(t,r),"throw"===r.method)||"return"!==i&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+i+"' method")),b;var o=d(n,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,b;var a=o.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,b):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,b)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function B(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function r(){for(;++n<t.length;)if(i.call(t,n))return r.value=t[n],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(s(t)+" is not iterable")}return w.prototype=x,n(S,"constructor",{value:x,configurable:!0}),n(x,"constructor",{value:w,configurable:!0}),w.displayName=h(x,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,h(e,u,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},P(j.prototype),h(j.prototype,l,function(){return this}),t.AsyncIterator=j,t.async=function(e,r,i,n,o){void 0===o&&(o=Promise);var a=new j(f(e,r,i,n),o);return t.isGeneratorFunction(r)?a:a.next().then(function(e){return e.done?e.value:a.next()})},P(S),h(S,u,"Generator"),h(S,a,function(){return this}),h(S,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),r=[];for(var i in t)r.push(i);return r.reverse(),function e(){for(;r.length;){var i=r.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},t.values=B,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(k),!t)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(i,n){return s.type="throw",s.arg=t,r.next=i,n&&(r.method="next",r.arg=e),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var l=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(l&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,b):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),b},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),b}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var i=r.completion;if("throw"===i.type){var n=i.arg;k(r)}return n}}throw Error("illegal catch attempt")},delegateYield:function(t,r,i){return this.delegate={iterator:B(t),resultName:r,nextLoc:i},"next"===this.method&&(this.arg=e),b}},t}function h(e,t,r,i,n,o,a){try{var s=e[o](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(i,n)}function f(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,d(i.key),i)}}function d(e){var t=function(e,t){if("object"!=s(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=s(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==s(t)?t:t+""}e.World=function(){return e=function e(t){var r=t.src;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this[i.Bindable.Prevent]=!0,this.ready=this.getReady(r),this.maps=[],this.mTree=new a.SMTree,this.rectMap=new Map},(t=[{key:"getReady",value:function(){var e,t=(e=c().mark(function e(t){var r,i=this;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:return e.next=4,e.sent.json();case 4:return r=e.sent,e.next=7,Promise.all(r.maps.map(function(e,t){var r=new n.TileMap({src:e.fileName});r.xWorld=e.x,r.yWorld=e.y,i.maps[t]=r;var a=new o.Rectangle(e.x,e.y,e.x+e.width,e.y+e.height);return i.rectMap.set(a,r),i.mTree.add(a),r.ready}));case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e)}),function(){var t=this,r=arguments;return new Promise(function(i,n){var o=e.apply(t,r);function a(e){h(o,i,n,a,s,"next",e)}function s(e){h(o,i,n,a,s,"throw",e)}a(void 0)})});return function(e){return t.apply(this,arguments)}}()},{key:"getMapsForPoint",value:function(e,t){var r,i=this.mTree.query(e,t,e,t),n=new Set,o=l(i);try{for(o.s();!(r=o.n()).done;){var a=r.value,s=this.rectMap.get(a);n.add(s)}}catch(e){o.e(e)}finally{o.f()}return n}}])&&f(e.prototype,t),r&&f(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}()}),require.register("___globals___",function(e,t,r){})}(),require("___globals___");
