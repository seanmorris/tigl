!function(){"use strict";var e="undefined"==typeof global?self:global;if("function"!=typeof e.require){var t={},i={},r={},n={}.hasOwnProperty,o=/^\.\.?(\/|$)/,s=function(e,t){for(var i,r=[],n=(o.test(t)?e+"/"+t:t).split("/"),s=0,a=n.length;s<a;s++)".."===(i=n[s])?r.pop():"."!==i&&""!==i&&r.push(i);return r.join("/")},a=function(e){return e.split("/").slice(0,-1).join("/")},l=function(t,r){var n,o={id:t,exports:{},hot:d&&d.createHot(t)};return i[t]=o,r(o.exports,(n=t,function(t){var i=s(a(n),t);return e.require(i,n)}),o),o.exports},u=function(e){var t=r[e];return t&&e!==t?u(t):e},c=function(e,r){null==r&&(r="/");var o=u(e);if(n.call(i,o))return i[o].exports;if(n.call(t,o))return l(o,t[o]);throw new Error("Cannot find module '"+e+"' from '"+r+"'")};c.alias=function(e,t){r[t]=e};var h=/\.[^.\/]+$/,f=/\/index(\.[^\/]+)?$/;c.register=c.define=function(e,o){if(e&&"object"==typeof e)for(var s in e)n.call(e,s)&&c.register(s,e[s]);else t[e]=o,delete i[e],function(e){if(h.test(e)){var t=e.replace(h,"");n.call(r,t)&&r[t].replace(h,"")!==t+"/index"||(r[t]=e)}if(f.test(e)){var i=e.replace(f,"");n.call(r,i)||(r[i]=e)}}(e)},c.list=function(){var e=[];for(var i in t)n.call(t,i)&&e.push(i);return e};var d=e._hmr&&new e._hmr(function(e,t){return u(s(a(e),t))},c,t,i);c._cache=i,c.hmr=d&&d.wrap,c.brunch=!0,e.require=c}}(),function(){"undefined"==typeof window||window;var e=function(e,t,i){var r={},n=function(t,i){try{return e(i+"/node_modules/"+t)}catch(e){if(-1===e.toString().indexOf("Cannot find module"))throw e;if(-1!==i.indexOf("node_modules")){var o=i.split("/"),s=o.lastIndexOf("node_modules"),a=o.slice(0,s).join("/");return n(t,a)}}return r};return function(o){if(o in t&&(o=t[o]),o){if("."!==o[0]&&i){var s=n(o,i);if(s!==r)return s}return e(o)}}};require.register("curvature/base/Bag.js",function(t,i,r){i=e(i,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Bag=void 0;var e=i("./Bindable"),r=i("./Mixin"),n=i("../mixin/EventTargetMixin"),o=e=>Number(e),s=Symbol("Mapped"),a=Symbol("Has"),l=Symbol("Add"),u=Symbol("Remove"),c=Symbol("Delete");class h extends(r.Mixin.with(n.EventTargetMixin)){constructor(t){super(),this.changeCallback=t,this.content=new Map,this.current=0,this.length=0,this.list=e.Bindable.makeBindable([]),this.meta=Symbol("meta"),this.type=void 0}has(e){return this[s]?this[s].has(e):this[a](e)}[a](e){return this.content.has(e)}add(e){return this[s]?this[s].add(e):this[l](e)}[l](t){if(void 0===t||!(t instanceof Object))throw new Error("Only objects may be added to Bags.");if(this.type&&!(t instanceof this.type))throw console.error(this.type,t),new Error(`Only objects of type ${this.type} may be added to this Bag.`);if(t=e.Bindable.make(t),!this.content.has(t)){var i=new CustomEvent("adding",{detail:{item:t}});if(this.dispatchEvent(i)){var r=o(this.current++);this.content.set(t,r),this.list[r]=t,this.changeCallback&&this.changeCallback(t,this.meta,h.ITEM_ADDED,r);var n=new CustomEvent("added",{detail:{item:t,id:r}});return this.dispatchEvent(n),this.length=this.size,r}}}remove(e){return this[s]?this[s].remove(e):this[u](e)}[u](t){if(void 0===t||!(t instanceof Object))throw new Error("Only objects may be removed from Bags.");if(this.type&&!(t instanceof this.type))throw console.error(this.type,t),new Error(`Only objects of type ${this.type} may be removed from this Bag.`);if(t=e.Bindable.make(t),!this.content.has(t))return this.changeCallback&&this.changeCallback(t,this.meta,0,void 0),!1;var i=new CustomEvent("removing",{detail:{item:t}});if(this.dispatchEvent(i)){var r=this.content.get(t);delete this.list[r],this.content.delete(t),this.changeCallback&&this.changeCallback(t,this.meta,h.ITEM_REMOVED,r);var n=new CustomEvent("removed",{detail:{item:t,id:r}});return this.dispatchEvent(n),this.length=this.size,t}}delete(e){if(this[s])return this[s].delete(e);this[c](e)}[c](e){this.remove(e)}map(e=(e=>e),t=(e=>e)){var i=new WeakMap,r=new h;return r[s]=this,this.addEventListener("added",n=>{var o=n.detail.item;if(t(o)&&!i.has(o)){var s=e(o);i.set(o,s),r[l](s)}}),this.addEventListener("removed",e=>{var t=e.detail.item;if(i.has(t)){var n=i.get(t);i.delete(t),r[u](n)}}),r}get size(){return this.content.size}items(){return Array.from(this.content.entries()).map(e=>e[0])}}t.Bag=h,Object.defineProperty(h,"ITEM_ADDED",{configurable:!1,enumerable:!1,writable:!0,value:1}),Object.defineProperty(h,"ITEM_REMOVED",{configurable:!1,enumerable:!1,writable:!0,value:-1})}()}),require.register("curvature/base/Bindable.js",function(t,i,r){i=e(i,{},"curvature"),function(){"use strict";function e(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Object.defineProperty(t,"__esModule",{value:!0}),t.Bindable=void 0;var i=Symbol("ref"),r=Symbol("original"),n=Symbol("deck"),o=Symbol("binding"),s=Symbol("subBinding"),a=Symbol("bindingAll"),l=Symbol("isBindable"),u=Symbol("wrapping"),c=Symbol("Names"),h=Symbol("executing"),f=Symbol("stack"),d=(Symbol("object"),Symbol("wrapped")),p=Symbol("unwrapped"),v=Symbol("getProto"),m=Symbol("onGet"),y=Symbol("onAllGet"),b=Symbol("bindChain"),g=Symbol("Descriptors"),w=Symbol("Before"),x=Symbol("After"),T=Symbol("NoGetters"),_=Symbol("Prevent"),P=Object.getPrototypeOf(Int8Array),E=Set.prototype[Symbol.iterator],S=Map.prototype[Symbol.iterator],j="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:void 0,O=e=>"function"==typeof j.Map&&e instanceof j.Map||"function"==typeof j.Set&&e instanceof j.Set||"function"==typeof j.Node&&e instanceof j.Node||"function"==typeof j.WeakMap&&e instanceof j.WeakMap||"function"==typeof j.Location&&e instanceof j.Location||"function"==typeof j.Storage&&e instanceof j.Storage||"function"==typeof j.WeakSet&&e instanceof j.WeakSet||"function"==typeof j.ArrayBuffer&&e instanceof j.ArrayBuffer||"function"==typeof j.Promise&&e instanceof j.Promise||"function"==typeof j.File&&e instanceof j.File||"function"==typeof j.Event&&e instanceof j.Event||"function"==typeof j.CustomEvent&&e instanceof j.CustomEvent||"function"==typeof j.Gamepad&&e instanceof j.Gamepad||"function"==typeof j.ResizeObserver&&e instanceof j.ResizeObserver||"function"==typeof j.MutationObserver&&e instanceof j.MutationObserver||"function"==typeof j.PerformanceObserver&&e instanceof j.PerformanceObserver||"function"==typeof j.IntersectionObserver&&e instanceof j.IntersectionObserver||"function"==typeof j.IDBCursor&&e instanceof j.IDBCursor||"function"==typeof j.IDBCursorWithValue&&e instanceof j.IDBCursorWithValue||"function"==typeof j.IDBDatabase&&e instanceof j.IDBDatabase||"function"==typeof j.IDBFactory&&e instanceof j.IDBFactory||"function"==typeof j.IDBIndex&&e instanceof j.IDBIndex||"function"==typeof j.IDBKeyRange&&e instanceof j.IDBKeyRange||"function"==typeof j.IDBObjectStore&&e instanceof j.IDBObjectStore||"function"==typeof j.IDBOpenDBRequest&&e instanceof j.IDBOpenDBRequest||"function"==typeof j.IDBRequest&&e instanceof j.IDBRequest||"function"==typeof j.IDBTransaction&&e instanceof j.IDBTransaction||"function"==typeof j.IDBVersionChangeEvent&&e instanceof j.IDBVersionChangeEvent||"function"==typeof j.FileSystemFileHandle&&e instanceof j.FileSystemFileHandle||"function"==typeof j.RTCPeerConnection&&e instanceof j.RTCPeerConnection||"function"==typeof j.ServiceWorkerRegistration&&e instanceof j.ServiceWorkerRegistration||"function"==typeof j.WebGLTexture&&e instanceof j.WebGLTexture;class C{static isBindable(e){return!!(e&&e[l]&&e[_])&&e[l]===C}static onDeck(e,t){return e[n].get(t)||!1}static ref(e){return e[i]||e||!1}static makeBindable(e){return this.make(e)}static shuck(e,t){t=t||new Map;var i=Object.create({});if(e instanceof P||e instanceof ArrayBuffer){var n=e.slice(0);return t.set(e,n),n}var o=Object.keys(e);for(var s in o){var a=o[s];if("___"!==a.substring(0,3)){var l=t.get(e[a]);if(l)i[a]=l;else if(e[a]!==e){if(e[a]&&"object"==typeof e[a]){var u=e[a];C.isBindable(e[a])&&(u=e[a][r]),i[a]=this.shuck(u,t)}else i[a]=e[a];t.set(e[a],i[a])}else t.set(e[a],i),i[a]=i}}return C.isBindable(e)&&(delete i.bindTo,delete i.isBound),i}static make(e){if(e[_])return e;if(!e||!["function","object"].includes(typeof e))return e;if(i in e)return e[i];if(e[l])return e;if(Object.isSealed(e)||Object.isFrozen(e)||!Object.isExtensible(e)||O(e))return e;Object.defineProperty(e,l,{configurable:!1,enumerable:!1,writable:!1,value:C}),Object.defineProperty(e,i,{configurable:!0,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(e,r,{configurable:!1,enumerable:!1,writable:!1,value:e}),Object.defineProperty(e,n,{configurable:!1,enumerable:!1,writable:!1,value:new Map}),Object.defineProperty(e,o,{configurable:!1,enumerable:!1,writable:!1,value:Object.create(null)}),Object.defineProperty(e,s,{configurable:!1,enumerable:!1,writable:!1,value:new Map}),Object.defineProperty(e,a,{configurable:!1,enumerable:!1,writable:!1,value:new Set}),Object.defineProperty(e,h,{enumerable:!1,writable:!0}),Object.defineProperty(e,u,{enumerable:!1,writable:!0}),Object.defineProperty(e,f,{configurable:!1,enumerable:!1,writable:!1,value:[]}),Object.defineProperty(e,w,{configurable:!1,enumerable:!1,writable:!1,value:new Set}),Object.defineProperty(e,x,{configurable:!1,enumerable:!1,writable:!1,value:new Set}),Object.defineProperty(e,d,{configurable:!1,enumerable:!1,writable:!1,value:Object.preventExtensions(new Map)}),Object.defineProperty(e,p,{configurable:!1,enumerable:!1,writable:!1,value:Object.preventExtensions(new Map)}),Object.defineProperty(e,g,{configurable:!1,enumerable:!1,writable:!1,value:Object.preventExtensions(new Map)});var t=(i,r=null,n={})=>{var l=!1;if(Array.isArray(i)){var u=i.map(e=>t(e,r,n));return()=>u.forEach(e=>e())}if(i instanceof Function&&(n=r||{},r=i,l=!0),n.delay>=0&&(r=this.wrapDelayCallback(r,n.delay)),n.throttle>=0&&(r=this.wrapThrottleCallback(r,n.throttle)),n.wait>=0&&(r=this.wrapWaitCallback(r,n.wait)),n.frame&&(r=this.wrapFrameCallback(r,n.frame)),n.idle&&(r=this.wrapIdleCallback(r)),l){if(e[a].add(r),!("now"in n)||n.now)for(var c in e)r(e[c],c,e,!1);return()=>{e[a].delete(r)}}if(e[o][i]||(e[o][i]=new Set),n.children){var h=r;r=((...t)=>{var i=t[0],r=e[s].get(h);if(r&&(e[s].delete(h),r()),"object"==typeof i){var o=C.make(i);C.isBindable(o)&&e[s].set(h,o.bindTo((...e)=>h(...t,...e),Object.assign({},n,{children:!1}))),h(...t)}else h(...t)})}e[o][i].add(r),"now"in n&&!n.now||r(e[i],i,e,!1);var f=()=>{var t=e[s].get(r);t&&(e[s].delete(r),t()),e[o][i]&&e[o][i].has(r)&&e[o][i].delete(r)};return n.removeWith&&n.removeWith instanceof View&&n.removeWith.onRemove(()=>f),f};Object.defineProperty(e,"bindTo",{configurable:!1,enumerable:!1,writable:!1,value:t});Object.defineProperty(e,b,{configurable:!1,enumerable:!1,writable:!1,value:(t,i)=>{var r=t.split("."),n=r.shift(),o=r.slice(0),s=[];return s.push(e.bindTo(n,(e,t,r,n)=>{var a=o.join(".");0!==o.length?(void 0===e&&(e=r[t]=this.make({})),s=s.concat(e[b](a,i))):i(e,t,r,n)})),()=>s.forEach(e=>e())}}),Object.defineProperty(e,"___before",{configurable:!1,enumerable:!1,writable:!1,value:t=>(e[w].add(t),()=>e[w].delete(t))}),Object.defineProperty(e,"___after",{configurable:!1,enumerable:!1,writable:!1,value:t=>(e[x].add(t),()=>e[x].delete(t))});for(var R in Object.defineProperty(e,"isBound",{configurable:!1,enumerable:!1,writable:!1,value:()=>{if(e[a].size)return!0;for(var t of Object.values(e[o]))if(t.size)return!0;return!1}}),e)e[R]&&"object"==typeof e[R]&&(e[R][i]||e[R]instanceof Promise||Object.isExtensible(e[R])&&!Object.isSealed(e[R])&&(O(e[R])||(e[R]=C.make(e[R]))));var k=e[g],M=e[d],B=e[f],A=Object.create(null);return A.set=((t,i,r)=>{if(r&&"object"==typeof r&&(r=C.make(r),t[i]===r))return!0;M.has(i)&&M.delete(i);var s=e[n],l=s.has(i),u=l&&s.get(i);if(l&&u===r)return!0;if(i.slice&&"___"===i.slice(-3))return!0;if(t[i]===r||"number"==typeof r&&isNaN(u)&&isNaN(r))return!0;for(var c of(s.set(i,r),e[a]))c(r,i,t,!1);if(i in e[o])for(var h of e[o][i])h(r,i,t,!1,t[i]);if(s.delete(i),j.File&&t instanceof j.File&&"lastModifiedDate"==i||Reflect.set(t,i,r),Array.isArray(t)&&e[o].length)for(var f in e[o].length)(0,e[o].length[f])(t.length,"length",t,!1,t.length);return!0}),A.construct=((t,i)=>{var n="constructor";for(var o of t[w])o(t,n,e[f],void 0,i);var s=C.make(new t[r](...i));for(var a of t[x])a(t,n,e[f],s,i);return s}),A.deleteProperty=((t,i)=>{var r=e[n];if(r.has(i))return!0;if(!(i in t))return!0;if(k.has(i)){var s=k.get(i);if(s&&!s.configurable)return!1;k.delete(i)}for(var l of(r.set(i,null),M.has(i)&&M.delete(i),e[a]))l(void 0,i,t,!0,t[i]);if(i in e[o])for(var u of e[o][i])u(void 0,i,t,!0,t[i]);return Reflect.deleteProperty(t,i),r.delete(i),!0}),e[T]||(A.getPrototypeOf=(t=>v in e?e[v]:Reflect.getPrototypeOf(t)),A.get=((t,n)=>{if(M.has(n))return M.get(n);if(n===i||n===r||"apply"===n||"isBound"===n||"bindTo"===n||"__proto__"===n||"constructor"===n)return e[n];var o;if(k.has(n)?o=k.get(n):(o=Object.getOwnPropertyDescriptor(e,n),k.set(n,o)),o&&!o.configurable&&!o.writable)return e[n];if(y in e)return e[y](n);if(m in e&&!(n in e))return e[m](n);if(o&&!o.configurable&&!o.writable)return M.set(n,e[n]),e[n];if("function"==typeof e[n]){if(c in e[n])return e[n];e[p].set(n,e[n]);var s=Object.getPrototypeOf(e)[n]===e[n],a=O(e)||"function"==typeof e[Symbol.iterator]&&"next"===n||"function"==typeof P&&e instanceof P||"function"==typeof EventTarget&&e instanceof EventTarget||"function"==typeof Date&&e instanceof Date||"function"==typeof S&&e.prototype===S||"function"==typeof E&&e.prototype===E?e:e[i],l=function(...t){for(var i of(e[h]=n,B.unshift(n),e[w]))i(e,n,B,e,t);var r;if(new.target)r=new(e[p].get(n))(...t);else{var o=e[p].get(n);r=s?o.apply(a||e,t):o(...t)}for(var l of e[x])l(e,n,B,e,t);return e[h]=null,B.shift(),r};l[y]=(t=>e[n][t]);var u=C.make(l);return M.set(n,u),u}return e[n]})),Object.defineProperty(e,i,{configurable:!1,enumerable:!1,writable:!1,value:new Proxy(e,A)}),e[i]}static clearBindings(e){var t=(e=>(...t)=>t.map(e))(e=>Object.keys(e).map(t=>delete e[t]));e[a].clear(),t(e[d],e[o],e[x],e[w])}static resolve(e,t,i=!1){for(var r,n=t.split("."),o=n[0];n.length;){if(i&&1===n.length)return[this.make(e),n.shift(),o];(r=n.shift())in e&&e[r]&&"object"==typeof e[r]||(e[r]=Object.create(null)),e=this.make(e[r])}return[this.make(e),r,o]}static wrapDelayCallback(e,t){return(...i)=>setTimeout(()=>e(...i),t)}static wrapThrottleCallback(e,t){return this.throttles.set(e,!1),(...i)=>{this.throttles.get(e,!0)||(e(...i),this.throttles.set(e,!0),setTimeout(()=>{this.throttles.set(e,!1)},t))}}static wrapWaitCallback(e,t){return(...i)=>{var r;(r=this.waiters.get(e))&&(this.waiters.delete(e),clearTimeout(r)),r=setTimeout(()=>e(...i),t),this.waiters.set(e,r)}}static wrapFrameCallback(e,t){return(...t)=>{requestAnimationFrame(()=>e(...t))}}static wrapIdleCallback(e){return(...t)=>{(window.requestIdleCallback||requestAnimationFrame)(()=>e(...t))}}}t.Bindable=C,e(C,"waiters",new WeakMap),e(C,"throttles",new WeakMap),Object.defineProperty(C,"Prevent",{configurable:!1,enumerable:!1,writable:!1,value:_}),Object.defineProperty(C,"OnGet",{configurable:!1,enumerable:!1,writable:!1,value:m}),Object.defineProperty(C,"NoGetters",{configurable:!1,enumerable:!1,writable:!1,value:T}),Object.defineProperty(C,"GetProto",{configurable:!1,enumerable:!1,writable:!1,value:v}),Object.defineProperty(C,"OnAllGet",{configurable:!1,enumerable:!1,writable:!1,value:y})}()}),require.register("curvature/base/Cache.js",function(t,i,r){i=e(i,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Cache=void 0;t.Cache=class{static store(e,t,i,r="standard"){var n=0;i&&(n=1e3*i+(new Date).getTime()),this.buckets||(this.buckets=new Map),this.buckets.has(r)||this.buckets.set(r,new Map);var o=new CustomEvent("cvCacheStore",{cancelable:!0,detail:{key:e,value:t,expiry:i,bucket:r}});document.dispatchEvent(o)&&this.buckets.get(r).set(e,{value:t,expiration:n})}static load(e,t=!1,i="standard"){var r=new CustomEvent("cvCacheLoad",{cancelable:!0,detail:{key:e,defaultvalue:t,bucket:i}});if(!document.dispatchEvent(r))return t;if(this.buckets&&this.buckets.has(i)&&this.buckets.get(i).has(e)){var n=this.buckets.get(i).get(e);if(0===n.expiration||n.expiration>(new Date).getTime())return this.buckets.get(i).get(e).value}return t}}}()}),require.register("curvature/base/Config.js",function(t,i,r){i=e(i,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Config=void 0;var e={},r=i,n="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:void 0;try{e=r("/Config").Config}catch(t){!0===n.devMode&&console.error(t),e={}}class o{static get(e){return this.configs[e]}static set(e,t){return this.configs[e]=t,this}static dump(){return this.configs}static init(...e){for(var t in e){var i=e[t];for(var r in"string"==typeof i&&(i=JSON.parse(i)),i){var n=i[r];return this.configs[r]=n}}return this}}t.Config=o,Object.defineProperty(o,"configs",{configurable:!1,enumerable:!1,writable:!1,value:e})}()}),require.register("curvature/base/Dom.js",function(t,i,r){i=e(i,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Dom=void 0;t.Dom=class{static mapTags(e,t,i,r,n){var o=[],s=!0;r&&(s=!1);var a=!1,{Node:l,Element:u,NodeFilter:c,document:h}=globalThis.window,f=h.createTreeWalker(e,c.SHOW_ELEMENT|c.SHOW_TEXT,{acceptNode:(e,i)=>{if(!s){if(e!==r)return c.FILTER_SKIP;s=!0}return n&&e===n&&(a=!0),a?c.FILTER_SKIP:t?e instanceof u&&e.matches(t)?c.FILTER_ACCEPT:c.FILTER_SKIP:c.FILTER_ACCEPT}},!1);for(0;f.nextNode();)o.push(i(f.currentNode,f));return o}static dispatchEvent(e,t){e.dispatchEvent(t),this.mapTags(e,!1,e=>{e.dispatchEvent(t)})}}}()}),require.register("curvature/base/Mixin.js",function(t,i,r){i=e(i,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Mixin=void 0;var e=i("./Bindable"),r=Symbol("constructor");Symbol("mixinList");class n{static from(e,...t){var i=class extends e{constructor(...r){var o=e.constructor?super(...r):null;for(var s of t)switch(s[n.Constructor]&&s[n.Constructor].apply(this),typeof s){case"function":n.mixClass(s,i);break;case"object":n.mixObject(s,this)}return o}};return i}static make(...e){var t=e.pop();return n.to(t,...e)}static to(e,...t){var i={};t.map(t=>{switch(typeof t){case"object":Object.assign(i,Object.getOwnPropertyDescriptors(t));break;case"function":Object.assign(i,Object.getOwnPropertyDescriptors(t.prototype))}delete i.constructor,Object.defineProperties(e.prototype,i)})}static with(...e){return this.from(class{constructor(){}},...e)}static mixObject(e,t){for(var i of Object.getOwnPropertyNames(e))"function"!=typeof e[i]?t[i]=e[i]:t[i]=e[i].bind(t);for(var r of Object.getOwnPropertySymbols(e))"function"!=typeof e[r]?t[r]=e[r]:t[r]=e[r].bind(t)}static mixClass(e,t){for(var i of Object.getOwnPropertyNames(e.prototype))if(!["name","prototype","length"].includes(i)){var r=Object.getOwnPropertyDescriptor(t,i);r&&!r.writable||("function"==typeof e[i]?t.prototype[i]=e.prototype[i].bind(t.prototype):t.prototype[i]=e.prototype[i])}for(var n of Object.getOwnPropertySymbols(e.prototype))"function"==typeof e[n]?t.prototype[n]=e.prototype[n].bind(t.prototype):t.prototype[n]=e.prototype[n];var o=function(){if(["name","prototype","length"].includes(s))return 0;var i=Object.getOwnPropertyDescriptor(t,s);if(i&&!i.writable)return 0;if("function"!=typeof e[s])return t[s]=e[s],0;var r=t[s]||!1,n=e[s].bind(t);t[s]=((...e)=>(r&&r(...e),n(...e)))};for(var s of Object.getOwnPropertyNames(e))o();var a=function(){if("function"!=typeof e[l])return t.prototype[l]=e[l],1;var i=t[l]||!1,r=e[l].bind(t);t[l]=((...e)=>(i&&i(...e),r(...e)))};for(var l of Object.getOwnPropertySymbols(e))a()}static mix(t){for(var i={},r={},n=e.Bindable.makeBindable(t),o=function(e){var t=Object.getOwnPropertyNames(e.prototype),o=Object.getOwnPropertyNames(e),s=/^(before|after)__(.+)/,a=function(t){var r=t.match(s);if(r){switch(r[1]){case"before":n.___before((i,n,o,s,a)=>{if(n===r[2])return e[t].bind(s)(...a)});break;case"after":n.___after((i,n,o,s,a)=>{if(n===r[2])return e[t].bind(s)(...a)})}return 0}return i[t]?0:"function"!=typeof e[t]?0:void(i[t]=e[t])};for(var l of o)a(l);var u=function(t){var i=t.match(s);if(i){switch(i[1]){case"before":n.___before((r,n,o,s,a)=>{if(n===i[2])return e.prototype[t].bind(s)(...a)});break;case"after":n.___after((r,n,o,s,a)=>{if(n===i[2])return e.prototype[t].bind(s)(...a)})}return 0}return r[t]?0:"function"!=typeof e.prototype[t]?0:void(r[t]=e.prototype[t])};for(var c of t)u(c)},s=this;s&&s.prototype;s=Object.getPrototypeOf(s))o(s);for(var a in i)t[a]=i[a].bind(t);var l=function(e){t.prototype[e]=function(...t){return r[e].apply(this,t)}};for(var u in r)l(u);return n}}t.Mixin=n,n.Constructor=r}()}),require.register("curvature/base/Router.js",function(t,i,r){i=e(i,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Router=void 0;var e,r=i("./View"),n=(i("./Cache"),i("./Config")),o=i("./Routes"),s=Symbol("NotFound"),a=Symbol("Internal"),l="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:void 0;l.CustomEvent=null!==(e=l.CustomEvent)&&void 0!==e?e:l.Event;class u{static wait(e,t="DOMContentLoaded",i=document){i.addEventListener(t,()=>{this.listen(e)})}static listen(e,t=!1){this.listener=e||this.listener,this.routes=t||e.routes,Object.assign(this.query,this.queryOver({}));var i=t=>{t.preventDefault(),t.state&&"routedId"in t.state?(t.state.routedId<=this.routeCount?(this.history.splice(t.state.routedId),this.routeCount=t.state.routedId):t.state.routedId>this.routeCount&&(this.history.push(t.state.prev),this.routeCount=t.state.routedId),this.state=t.state):null!==this.prevPath&&this.prevPath!==location.pathname&&this.history.push(this.prevPath),this.isOriginLimited(location)?this.match(this.nextPath,e):this.match(location.pathname,e)};window.addEventListener("cvUrlChanged",i),window.addEventListener("popstate",i);var r=!this.isOriginLimited(location)&&location.pathname+location.search;!this.isOriginLimited(location)&&location.hash&&(r+=location.hash);var n={routedId:this.routeCount,url:location.pathname,prev:this.prevPath};this.isOriginLimited(location)||history.replaceState(n,null,location.pathname),this.go(!1!==r?r:"/")}static go(e,t=!1){var i=n.Config.get("title");i&&(document.title=i);var r={routedId:this.routeCount,prev:this.prevPath,url:location.pathname};-1===t?this.match(e,this.listener,!0):this.isOriginLimited(location)?this.nextPath=e:2===t&&location.pathname!==e?history.replaceState(r,null,e):location.pathname!==e&&history.pushState(r,null,e),(!t||t<0)&&(!1===t&&(this.path=null),t||("#"===e.substring(0,1)?window.dispatchEvent(new HashChangeEvent("hashchange")):window.dispatchEvent(new CustomEvent("cvUrlChanged")))),this.prevPath=e}static processRoute(e,t,i){return"function"==typeof e[t]?e[t].prototype instanceof r.View?new e[t](i):e[t](i):e[t]}static handleError(e,t,i,r,n,o,s,u){"undefined"!=typeof document&&document.dispatchEvent(new CustomEvent("cvRouteError",{detail:{error:e,path:o,prev:s,view:n,routes:t,selected:i}}));var c=l.devMode?"Unexpected error: "+String(e):"Unexpected error.";t[a]&&(r[a]=e,c=this.processRoute(t,a,r)),this.update(n,o,c,t,i,r,u)}static match(e,t,i=!1){var r=null,n=!1;if(!0===i&&(n=i),i&&"object"==typeof i&&(n=i.forceRefresh,r=i.event),"undefined"==typeof document||this.path!==e||n){var a="http://example.com";"undefined"!=typeof document&&(a=this.isOriginLimited(location)?a:location.origin,this.queryString=location.search);var l=new URL(e,a);e=this.path=l.pathname,"undefined"==typeof document&&(this.queryString=l.search);var u=this.prevPath,c=t&&t.args?t.args.content:null,h=this.routes||t&&t.routes||o.Routes.dump(),f=new URLSearchParams(this.queryString);for(var d in r&&r.request&&(this.request=r.request),Object.keys(this.query))delete this.query[d];for(var[p,v]of f)this.query[p]=v;var m={},y=!1,b="";for(var g in"/"===e.substring(0,1)&&(e=e.substring(1)),e=e.split("/"),this.query)m[g]=this.query[g];e:for(var w in h){var x=w.split("/");if(!(x.length<e.length&&"*"!==x[x.length-1])){for(var T in x)if("%"==x[T].substr(0,1)){var _=null,P=/^%(\w+)\??/.exec(x[T]);if(P&&P[1]&&(_=P[1]),!_)throw new Error(`${x[T]} is not a valid argument segment in route "${w}"`);if(e[T])m[_]=e[T];else{if("?"!=x[T].substr(x[T].length-1,1))continue e;m[_]=""}}else if("*"!==x[T]&&e[T]!==x[T])continue e;y=w,b=h[w],"*"===x[x.length-1]&&(m.pathparts=e.slice(x.length-1));break}}var E=new CustomEvent("cvRouteStart",{cancelable:!0,detail:{path:e,prev:u,root:t,selected:y,routes:h}});if("undefined"==typeof document||document.dispatchEvent(E)){if(!n&&t&&c&&"object"==typeof b&&c.constructor===b.constructor&&!(b instanceof Promise)&&c.update(m))return t.args.content=c,!0;y in h||(h[y]=h[s]);try{return!1===(b=this.processRoute(h,y,m))&&(b=this.processRoute(h,s,m)),"undefined"==typeof document?b instanceof Promise?b:Promise.resolve(b):b instanceof Promise?b.then(i=>this.update(t,e,i,h,y,m,n)).catch(i=>{this.handleError(i,h,y,m,t,e,u,n)}):this.update(t,e,b,h,y,m,n)}catch(i){this.handleError(i,h,y,m,t,e,u,n)}}}}static update(e,t,i,n,o,s,a){if(e){var l=this.prevPath,u=new CustomEvent("cvRoute",{cancelable:!0,detail:{result:i,path:t,prev:l,view:e,routes:n,selected:o}});!1!==i&&(e.args.content instanceof r.View&&(e.args.content.pause(!0),e.args.content.remove()),document.dispatchEvent(u)&&(e.args.content=i),i instanceof r.View&&(i.pause(!1),i.update(s,a)));var c=new CustomEvent("cvRouteEnd",{cancelable:!0,detail:{result:i,path:t,prev:l,view:e,routes:n,selected:o}});document.dispatchEvent(c)}}static isOriginLimited({origin:e}){return"null"===e||"file://"===e}static queryOver(e={}){var t=new URLSearchParams(location.search),i={},r={};for(var n of t)r[n[0]]=n[1];return delete(i=Object.assign(i,r,e)).api,i}static queryToString(e={},t=!1){var i=[],r=e;for(var n in t||(r=this.queryOver(e)),r)""!==r[n]&&i.push(n+"="+encodeURIComponent(r[n]));return i.join("&")}static setQuery(e,t,i){var r=this.queryOver();r[e]=t,void 0===t&&delete r[e];var n=this.queryToString(r,!0);this.go(location.pathname+(n?"?"+n:"?"),i)}}t.Router=u,Object.defineProperty(u,"query",{configurable:!1,enumerable:!1,writable:!1,value:{}}),Object.defineProperty(u,"history",{configurable:!1,enumerable:!1,writable:!1,value:[]}),Object.defineProperty(u,"routeCount",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(u,"prevPath",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(u,"queryString",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(u,"InternalError",{configurable:!1,enumerable:!1,writable:!1,value:a}),Object.defineProperty(u,"NotFoundError",{configurable:!1,enumerable:!1,writable:!1,value:s})}()}),require.register("curvature/base/Routes.js",function(t,i,r){i=e(i,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Routes=void 0;var e={},r=i,n=!1,o=()=>{if(!n){try{Object.assign(e,r("Routes").Routes||{})}catch(e){!0===globalThis.devMode&&console.warn(e)}n=!0}};class s{static get(e){return o(),this.routes[e]}static dump(){return o(),this.routes}}t.Routes=s,Object.defineProperty(s,"routes",{configurable:!1,enumerable:!1,writable:!1,value:e})}()}),require.register("curvature/base/RuleSet.js",function(t,i,r){i=e(i,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RuleSet=void 0;i("./Dom");var e=i("./Tag"),r=i("./View");class n{static add(e,t){return this.globalRules=this.globalRules||{},this.globalRules[e]=this.globalRules[e]||[],this.globalRules[e].push(t),this}static apply(e=document,t=null){for(var i in this.globalRules)for(var r in this.globalRules[i]){var n=this.globalRules[i][r],o=this.wrap(e,n,t),s=e.querySelectorAll(i);for(var a of s)o(a)}}add(e,t){return this.rules=this.rules||{},this.rules[e]=this.rules[e]||[],this.rules[e].push(t),this}apply(e=document,t=null){for(var i in n.apply(e,t),this.rules)for(var r in this.rules[i]){var o=this.rules[i][r],s=n.wrap(e,o,t),a=e.querySelectorAll(i);for(var l of a)s(l)}}purge(){if(this.rules)for(var[e,t]of Object.entries(this.rules))if(this.rules[e])for(var i in this.rules[e])delete this.rules[e][i]}static wait(e="DOMContentLoaded",t=document){var i=((e,t)=>()=>(t.removeEventListener(e,i),this.apply()))(e,t);t.addEventListener(e,i)}static wrap(t,i,n=null){var o=i;return(i instanceof r.View||i&&i.prototype&&i.prototype instanceof r.View)&&(o=(()=>i)),t=>{if(void 0===t.___cvApplied___&&Object.defineProperty(t,"___cvApplied___",{enumerable:!1,writable:!1,value:new WeakSet}),!t.___cvApplied___.has(i)){var s,a;n&&(s=a=n,n.viewList&&(a=n.viewList.parent));var l=new e.Tag(t,a,null,void 0,s),u=l.element.parentNode,c=l.element.nextSibling,h=o(l);if(!1!==h&&t.___cvApplied___.add(i),h instanceof HTMLElement&&(h=new e.Tag(h)),h instanceof e.Tag){if(!h.element.contains(l.element)){for(;l.element.firstChild;)h.element.appendChild(l.element.firstChild);l.remove()}c?u.insertBefore(h.element,c):u.appendChild(h.element)}h&&h.prototype&&h.prototype instanceof r.View&&(h=new h({},n)),h instanceof r.View&&(n&&(n.cleanup.push(()=>h.remove()),n.cleanup.push(n.args.bindTo((e,t,i)=>{i[t]=e,h.args[t]=e})),n.cleanup.push(h.args.bindTo((e,t,i,r)=>{i[t]=e,n.args[t]=e}))),l.clear(),h.render(l.element))}}}}t.RuleSet=n}()}),require.register("curvature/base/SetMap.js",function(t,i,r){i=e(i,{},"curvature"),function(){"use strict";function e(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Object.defineProperty(t,"__esModule",{value:!0}),t.SetMap=void 0;t.SetMap=class{constructor(){e(this,"_map",new Map)}has(e){return this._map.has(e)}get(e){return this._map.get(e)}getOne(e){var t=this.get(e);for(var i of t)return i}add(e,t){var i=this._map.get(e);return i||this._map.set(e,i=new Set),i.add(t)}remove(e,t){var i=this._map.get(e);if(i){var r=i.delete(t);return i.size||this._map.delete(e),r}}values(){return new Set(...[...this._map.values()].map(e=>[...e.values()]))}}}()}),require.register("curvature/base/Tag.js",function(t,i,r){i=e(i,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tag=void 0;var e=i("./Bindable"),r=Symbol("CurrentStyle"),n=Symbol("CurrentAttrs"),o=function(e){if(this.node)for(var t in e){var i=String(e[t]);this[r].has(t)&&this[r].get(t)===e[t]||Number.isNaN(e[t])||("-"===t[0]?this.node.style.setProperty(t,i):this.node.style[t]=i,void 0!==e[t]?this[r].set(t,e[t]):this[r].delete(t))}},s=function(e){return"function"==typeof this[e]?this[e]:this.node&&"function"==typeof this.node[e]?this[e]=((...t)=>this.node[e](...t)):"style"===e?this.proxy.style:this.node&&e in this.node?this.node[e]:this[e]};t.Tag=class{constructor(t,i,a,l,u){if("string"==typeof t){var c=document.createRange().createContextualFragment(t);t=c.firstChild}this.element=e.Bindable.makeBindable(t),this.node=this.element,this.parent=i,this.direct=u,this.ref=a,this.index=l,this.cleanup=[],this[e.Bindable.OnAllGet]=s.bind(this),this[r]=new Map,this[n]=new Map;var h=e.Bindable.make(o.bind(this));return Object.defineProperty(this,"style",{value:h}),this.proxy=e.Bindable.make(this),this.proxy.style.bindTo((e,t,i,n)=>{this[r].has(t)&&this[r].get(t)===e||(this.node.style[t]=e,n||void 0===e?this[r].delete(t):this[r].set(t,e))}),this.proxy.bindTo((e,i)=>{if("index"!==i)return i in t&&t[i]!==e&&(t[i]=e),!1}),this.proxy}attr(e){for(var t in e)this[n].has(t)&&void 0===e[t]?(this.node.removeAttribute(t),this[n].delete(t)):this[n].has(t)&&this[n].get(t)===e[t]||(null===e[t]?(this.node.setAttribute(t,""),this[n].set(t,"")):(this.node.setAttribute(t,e[t]),this[n].set(t,e[t])));return this}remove(){var t;for(this.node&&this.node.remove(),e.Bindable.clearBindings(this);t=this.cleanup.shift();)t();if(this.clear(),this.node){var i=new Event("cvDomDetached");this.node.dispatchEvent(i),this.node=this.element=this.ref=this.parent=void 0}}clear(){if(this.node)for(var e=new Event("cvDomDetached");this.node.firstChild;)this.node.firstChild.dispatchEvent(e),this.node.removeChild(this.node.firstChild)}pause(e=!0){}listen(e,t,i){var r=this.node;r.addEventListener(e,t,i);var n=()=>{r.removeEventListener(e,t,i)},o=()=>{n(),n=(()=>console.warn("Already removed!"))};return this.parent.onRemove(()=>o()),o}}}()}),require.register("curvature/base/Uuid.js",function(t,i,r){i=e(i,{},"curvature"),function(){"use strict";function e(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Object.defineProperty(t,"__esModule",{value:!0}),t.Uuid=void 0;var i=("object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:void 0).crypto;class r{constructor(t=null,n=4){if(e(this,"uuid",null),e(this,"version",4),t){if("string"!=typeof t&&!(t instanceof r)||!t.match(/[0-9A-Fa-f]{8}(-[0-9A-Fa-f]{4}){3}-[0-9A-Fa-f]{12}/))throw new Error(`Invalid input for Uuid: "${t}"`);this.version=n,this.uuid=t}else if(i&&"function"==typeof i.randomUUID)this.uuid=i.randomUUID();else{var o=i&&"function"==typeof i.randomUUID?()=>i.getRandomValues(new Uint8Array(1))[0]:()=>Math.trunc(256*Math.random());this.uuid=([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^o()&15>>e/4).toString(16))}Object.freeze(this)}[Symbol.toPrimitive](){return this.toString()}toString(){return this.uuid}toJson(){return{version:this.version,uuid:this.uuid}}}t.Uuid=r}()}),require.register("curvature/base/View.js",function(t,i,r){i=e(i,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.View=void 0;var e=i("./Bindable"),r=i("./ViewList"),n=i("./Router"),o=i("./Uuid"),s=i("./Dom"),a=i("./Tag"),l=i("./Bag"),u=i("./RuleSet"),c=i("./Mixin"),h=i("../mixin/EventTargetMixin"),f=Symbol("dontParse"),d=Symbol("expandBind"),p=Symbol("uuid");class v extends(c.Mixin.with(h.EventTargetMixin)){get _id(){return this[p]}static from(e,t={},i=null){var r=new this(t,i);return r.template=e,r}constructor(t={},i=null){super(t,i),this[h.EventTargetMixin.Parent]=i,Object.defineProperty(this,"args",{value:e.Bindable.make(t)}),Object.defineProperty(this,p,{value:this.constructor.uuid()}),Object.defineProperty(this,"nodesAttached",{value:new l.Bag((e,t,i)=>{})}),Object.defineProperty(this,"nodesDetached",{value:new l.Bag((e,t,i)=>{})}),Object.defineProperty(this,"_onRemove",{value:new l.Bag((e,t,i)=>{})}),Object.defineProperty(this,"cleanup",{value:[]}),Object.defineProperty(this,"parent",{value:i,writable:!0}),Object.defineProperty(this,"views",{value:new Map}),Object.defineProperty(this,"viewLists",{value:new Map}),Object.defineProperty(this,"withViews",{value:new Map}),Object.defineProperty(this,"tags",{value:e.Bindable.make({})}),Object.defineProperty(this,"nodes",{value:e.Bindable.make([])}),Object.defineProperty(this,"timeouts",{value:new Map}),Object.defineProperty(this,"intervals",{value:new Map}),Object.defineProperty(this,"frames",{value:[]}),Object.defineProperty(this,"ruleSet",{value:new u.RuleSet}),Object.defineProperty(this,"preRuleSet",{value:new u.RuleSet}),Object.defineProperty(this,"subBindings",{value:{}}),Object.defineProperty(this,"templates",{value:{}}),Object.defineProperty(this,"postMapping",{value:new Set}),Object.defineProperty(this,"eventCleanup",{value:[]}),Object.defineProperty(this,"unpauseCallbacks",{value:new Map}),Object.defineProperty(this,"interpolateRegex",{value:/(\[\[((?:\$+)?[\w\.\|-]+)\]\])/g}),Object.defineProperty(this,"rendered",{value:new Promise((e,t)=>Object.defineProperty(this,"renderComplete",{value:e}))}),this.onRemove(()=>{this[h.EventTargetMixin.Parent]&&(this[h.EventTargetMixin.Parent]=null)}),this.controller=this,this.template="",this.firstNode=null,this.lastNode=null,this.viewList=null,this.mainView=null,this.preserve=!1,this.removed=!1,this.loaded=Promise.resolve(this)}static isView(){return v}onFrame(e){var t=!1,i=()=>{t=!0},r=i=>{this.removed||t||(this.paused||e(Date.now()),requestAnimationFrame(r))};return requestAnimationFrame(()=>r(Date.now())),this.frames.push(i),i}onNextFrame(e){return requestAnimationFrame(()=>e(Date.now()))}onIdle(e){return requestIdleCallback(()=>e(Date.now()))}onTimeout(e,t){var i={timeout:null,callback:null,time:e,fired:!1,created:(new Date).getTime(),paused:!1},r=()=>{t(),i.fired=!0,this.timeouts.delete(i.timeout)},n=setTimeout(r,e);return i.callback=r,i.timeout=n,this.timeouts.set(i.timeout,i),n}clearTimeout(e){if(this.timeouts.has(e)){var t=this.timeouts.get(e);clearTimeout(t.timeout),this.timeouts.delete(t.timeout)}}onInterval(e,t){var i=setInterval(t,e);return this.intervals.set(i,{timeout:i,callback:t,time:e,paused:!1}),i}clearInterval(e){if(this.intervals.has(e)){var t=this.intervals.get(e);clearTimeout(t.timeout),this.intervals.delete(t.timeout)}}pause(e){if(void 0===e&&(this.paused=!this.paused),this.paused=e,this.paused){for(var[t,i]of this.timeouts)i.fired?this.timeouts.delete(i.timeout):(clearTimeout(i.timeout),i.paused=!0,i.time=Math.max(0,i.time-(Date.now()-i.created)));for(var[r,n]of this.intervals)clearInterval(n.timeout),n.paused=!0}else{for(var[o,s]of this.timeouts)s.paused&&(s.fired?this.timeouts.delete(s.timeout):(s.timeout=setTimeout(s.callback,s.time),s.paused=!1));for(var[a,l]of this.intervals)l.paused&&(l.timeout=setInterval(l.callback,l.time),l.paused=!1);for(var[,u]of this.unpauseCallbacks)u();this.unpauseCallbacks.clear()}for(var[c,h]of this.viewLists)h.pause(!!e);for(var f in this.tags)if(Array.isArray(this.tags[f]))for(var d in this.tags[f])this.tags[f][d].pause(!!e);else this.tags[f].pause(!!e)}render(e=null,t=null,i=null){var{document:r}=globalThis.window;if(e instanceof v&&(e=e.firstNode.parentNode),t instanceof v&&(t=t.firstNode),this.firstNode)return this.reRender(e,t,i);this.dispatchEvent(new CustomEvent("render"));var n,o="object"==typeof this.template&&"function"==typeof this.template.cloneNode,s=o||v.templates.has(this.template);if(n=s?o?this.template.cloneNode(!0):v.templates.get(this.template).cloneNode(!0):r.createRange().createContextualFragment(this.template),s||o||v.templates.set(this.template,n.cloneNode(!0)),this.mainView||this.preRuleSet.apply(n,this),this.mapTags(n),this.mainView||this.ruleSet.apply(n,this),!0===globalThis.devMode?(this.firstNode=r.createComment(`Template ${this._id} Start`),this.lastNode=r.createComment(`Template ${this._id} End`)):(this.firstNode=r.createTextNode(""),this.lastNode=r.createTextNode("")),this.nodes.push(this.firstNode,...Array.from(n.childNodes),this.lastNode),this.postRender(e),this.dispatchEvent(new CustomEvent("rendered")),this.dispatchAttach()){if(e){t?(e.insertBefore(this.firstNode,t),e.insertBefore(this.lastNode,t)):(e.insertBefore(this.firstNode,null),e.insertBefore(this.lastNode,null)),e.insertBefore(n,this.lastNode);var a=e.getRootNode();if(a.isConnected)this.attached(a,e),this.dispatchAttached(a,e,i);else if(i){var l=t=>{var r=e.getRootNode();this.attached(r,e),this.dispatchAttached(r,e,i),i.removeEventListener("attached",l)};i.addEventListener("attached",l)}}return this.renderComplete(this.nodes),this.nodes}}dispatchAttach(){var{CustomEvent:e}=globalThis.window;return this.dispatchEvent(new e("attach",{cancelable:!0,target:this}))}dispatchAttached(e,t,i){var{CustomEvent:r}=globalThis.window;for(var n of(this.dispatchEvent(new r("attached",{detail:{view:i||this,node:t,root:e,mainView:this}})),this.dispatchDomAttached(i),this.nodesAttached.items()))n(e,t)}dispatchDomAttached(e){var{Node:t,CustomEvent:i}=globalThis.window;this.nodes.filter(e=>e.nodeType!==t.COMMENT_NODE).forEach(t=>{t.matches&&(t.dispatchEvent(new i("cvDomAttached",{target:t,detail:{view:e||this,mainView:this}})),s.Dom.mapTags(t,!1,(t,r)=>{t.matches&&t.dispatchEvent(new i("cvDomAttached",{target:t,detail:{view:e||this,mainView:this}}))}))})}reRender(e,t,i){var{CustomEvent:r}=globalThis.window;if(this.dispatchEvent(new r("reRender"),{cancelable:!0,target:this,view:i})){var n=new DocumentFragment;if(this.firstNode.isConnected){var o=this.nodesDetached.items();for(var s in o)o[s]()}if(n.append(...this.nodes),e){t?(e.insertBefore(this.firstNode,t),e.insertBefore(this.lastNode,t)):(e.insertBefore(this.firstNode,null),e.insertBefore(this.lastNode,null)),e.insertBefore(n,this.lastNode),this.dispatchEvent(new r("reRendered"),{cancelable:!0,target:this,view:i});var a=e.getRootNode();a.isConnected&&(this.attached(a,e),this.dispatchAttached(a,e))}return this.nodes}}mapTags(e){s.Dom.mapTags(e,!1,(e,t)=>{e[f]||(e=e.matches?(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=this.mapInterpolatableTag(e)).matches("[cv-template]")&&this.mapTemplateTag(e)||e).matches("[cv-slot]")&&this.mapSlotTag(e)||e).matches("[cv-prerender]")&&this.mapPrendererTag(e)||e).matches("[cv-link]")&&this.mapLinkTag(e)||e).matches("[cv-attr]")&&this.mapAttrTag(e)||e).matches("[cv-expand]")&&this.mapExpandableTag(e)||e).matches("[cv-ref]")&&this.mapRefTag(e)||e).matches("[cv-on]")&&this.mapOnTag(e)||e).matches("[cv-each]")&&this.mapEachTag(e)||e).matches("[cv-bind]")&&this.mapBindTag(e)||e).matches("[cv-with]")&&this.mapWithTag(e)||e).matches("[cv-if]")&&this.mapIfTag(e)||e).matches("[cv-view]")&&this.mapViewTag(e)||e:this.mapInterpolatableTag(e))!==t.currentNode&&(t.currentNode=e)}),this.postMapping.forEach(e=>e())}mapExpandableTag(t){var i=t[d];i&&(i(),t[d]=!1);var[r,n]=e.Bindable.resolve(this.args,t.getAttribute("cv-expand"),!0);return t.removeAttribute("cv-expand"),r[n]||(r[n]={}),r[n]=e.Bindable.make(r[n]),this.onRemove(t[d]=r[n].bindTo((e,i,r,n,o)=>{n||void 0===e?t.removeAttribute(i,e):null!==e?t.setAttribute(i,e):t.setAttribute(i,"")})),t}mapAttrTag(e){var t=this.compileAttrTag(e)(this);return e.replaceWith(t),t}compileAttrTag(t){var i=t.getAttribute("cv-attr").split(/[,;]/).map(e=>e.split(":"));return t.removeAttribute("cv-attr"),r=>{var n=t.cloneNode(!0),o=function(){var t=i[s][1]||i[s][0],[o,a]=e.Bindable.resolve(r.args,t,!0),l=i[s][0];r.onRemove(o.bindTo(a,(e,t,i,r)=>{r||void 0===e?n.removeAttribute(l,e):null!==e?n.setAttribute(l,e):n.setAttribute(l,"")}))};for(var s in i)o();return n}}mapInterpolatableTag(t){var i=this,r=this.interpolateRegex,{Node:n,document:o}=globalThis.window;if(t.nodeType===n.TEXT_NODE){var s=t.nodeValue;if(!this.interpolatable(s))return t;for(var l,u,c=0,d=function(){var r=l[2],u=!1,d=!1,p=r.split("|"),m=!1;if(p.length>1&&(m=i.stringTransformer(p.slice(1)),r=p[0]),"$$"===r.substr(0,2)&&(u=!0,d=!0,r=r.substr(2)),"$"===r.substr(0,1)&&(u=!0,r=r.substr(1)),"000"===r.substr(0,3))return expand=!0,r=r.substr(3),0;var y=s.substring(c,l.index);c=l.index+l[1].length;var b,g=o.createTextNode(y);g[f]=!0,t.parentNode.insertBefore(g,t),(b=u?o.createElement("div"):o.createTextNode(""))[f]=!0;var w=i.args,x=r;if(r.match(/\./)&&([w,x]=e.Bindable.resolve(i.args,r,!0)),t.parentNode.insertBefore(b,t),"object"!=typeof w)return 1;var T=(w=e.Bindable.make(w)).bindTo(x,(e,r,o)=>{if(o[r]!==e&&(o[r]instanceof v||o[r]instanceof n||o[r]instanceof a.Tag)&&(o[r].preserve||o[r].remove()),d&&!(e instanceof v)){var s=null!==e&&void 0!==e?e:"";(e=new v(i.args,i)).template=s}if(m&&(e=m(e)),e instanceof v){b.nodeValue="",e[h.EventTargetMixin.Parent]=i,e.render(t.parentNode,b,i);var l=()=>{e.preserve||e.remove()};i.onRemove(l),e.onRemove(()=>i._onRemove.remove(l))}else e instanceof n?(b.nodeValue="",t.parentNode.insertBefore(e,b),i.onRemove(()=>e.remove())):e instanceof a.Tag?(b.nodeValue="",e.node?(t.parentNode.insertBefore(e.node,b),i.onRemove(()=>e.remove())):e.remove()):(e instanceof Object&&e.__toString instanceof Function&&(e=e.__toString()),u?b.innerHTML=e:b.nodeValue=e);b[f]=!0});i.onRemove(T)};(l=r.exec(s))&&(0===(u=d())||1!==u););var p=s.substring(c),m=o.createTextNode(p);m[f]=!0,t.parentNode.insertBefore(m,t),t.nodeValue=""}else if(t.nodeType===n.ELEMENT_NODE)for(var y=function(){if(!i.interpolatable(t.attributes[b].value))return 1;for(var n,o=0,s=t.attributes[b].value,a=t.attributes[b],l={},u=[];n=r.exec(s);)u.push(s.substring(o,n.index)),l[n[2]]||(l[n[2]]=[]),l[n[2]].push(u.length),u.push(n[1]),o=n.index+n[1].length;u.push(s.substring(o));var c=function(){var r=i.args,n=h,o=h.split("|"),s=!1,c=h;o.length>1&&(s=i.stringTransformer(o.slice(1)),n=o[0]),n.match(/\./)&&([r,n]=e.Bindable.resolve(i.args,n,!0));l[c];i.onRemove(r.bindTo(n,(e,r,o,h)=>{for(var f in s&&(e=s(e)),l)for(var d in l[c])u[l[c][d]]=o[f],r===n&&(u[l[c][d]]=e);i.paused?i.unpauseCallbacks.set(a,()=>t.setAttribute(a.name,u.join(""))):t.setAttribute(a.name,u.join(""))}))};for(var h in l)c()},b=0;b<t.attributes.length;b++)y();return t}mapRefTag(e){var t=e.getAttribute("cv-ref"),[i,r=null,n=null]=t.split(":"),o=a.Tag;r&&(o=this.stringToClass(r)),e.removeAttribute("cv-ref"),Object.defineProperty(e,"___tag___",{enumerable:!1,writable:!0}),this.onRemove(()=>{e.___tag___=null,e.remove()});var s=this;this.viewList&&(s=this.viewList.parent);var l=new o(e,this,i,void 0,this);for(e.___tag___=l,this.tags[i]=l;s;){var u=this.args[n];if(void 0!==u?(s.tags[i]||(s.tags[i]=[]),s.tags[i][u]=l):s.tags[i]=l,!s.parent)break;s=s.parent}return e}mapBindTag(t){var i=t.getAttribute("cv-bind"),r=this.args,n=i,o=null;i.match(/\./)&&([r,n,o]=e.Bindable.resolve(this.args,i,!0)),r!==this.args&&(this.subBindings[i]=this.subBindings[i]||[],this.onRemove(this.args.bindTo(o,()=>{for(;this.subBindings.length;)this.subBindings.shift()()})));var l=!1;"$"===n.substr(0,1)&&(n=n.substr(1),l=!0);var u=!1,c=r.bindTo(n,(e,i,r,n,o)=>{if((o instanceof v||o instanceof Node||o instanceof a.Tag)&&o!==e&&o.remove(),["INPUT","SELECT","TEXTAREA"].includes(t.tagName)){var c=t.getAttribute("type");if(c&&"checkbox"===c.toLowerCase())t.checked=!!e;else if(c&&"radio"===c.toLowerCase())t.checked=e==t.value;else if("file"!==c)if("SELECT"===t.tagName){var d=()=>{for(var i=0;i<t.options.length;i++){t.options[i].value==e&&(t.selectedIndex=i)}};d(),this.nodesAttached.add(d)}else t.value=null==e?"":e;u&&t.dispatchEvent(new CustomEvent("cvAutoChanged",{bubbles:!0})),u=!0}else if(e instanceof v){for(var p of t.childNodes)p.remove();e[h.EventTargetMixin.Parent]=this,e.render(t,null,this)}else if(e instanceof Node)t.insert(e);else if(e instanceof a.Tag)t.append(e.node);else if(l){if(t.innerHTML!==e){if(e=String(e),t.innerHTML===e.substring(0,t.innerHTML.length))t.innerHTML+=e.substring(t.innerHTML.length);else{for(var m of t.childNodes)m.remove();t.innerHTML=e}s.Dom.mapTags(t,!1,e=>e[f]=!0)}}else if(t.textContent!==e){for(var y of t.childNodes)y.remove();t.textContent=e}});r!==this.args&&this.subBindings[i].push(c),this.onRemove(c);var d=t.getAttribute("type"),p=t.getAttribute("multiple"),m=i=>{if(i.target===t)if(d&&"checkbox"===d.toLowerCase())t.checked?r[n]=i.target.getAttribute("value"):r[n]=!1;else if(i.target.matches("[contenteditable=true]"))r[n]=i.target.innerHTML;else if("file"===d&&p){var o=Array.from(i.target.files),s=r[n]||e.Bindable.onDeck(r,n);if(s&&o.length){var a=function(e){if(o[e]!==s[e])return o[e].toJSON=(()=>({name:file[e].name,size:file[e].size,type:file[e].type,date:file[e].lastModified})),s[e]=o[e],1};for(var l in o)if(a(l))break}else r[n]=o}else if("file"===d&&!p&&i.target.files.length){var u=i.target.files.item(0);u.toJSON=(()=>({name:u.name,size:u.size,type:u.type,date:u.lastModified})),r[n]=u}else r[n]=i.target.value};return"file"===d||"radio"===d?t.addEventListener("change",m):(t.addEventListener("input",m),t.addEventListener("change",m),t.addEventListener("value-changed",m)),this.onRemove(()=>{"file"===d||"radio"===d?t.removeEventListener("change",m):(t.removeEventListener("input",m),t.removeEventListener("change",m),t.removeEventListener("value-changed",m))}),t.removeAttribute("cv-bind"),t}mapOnTag(e){return String(e.getAttribute("cv-on")).split(";").map(e=>e.split(":")).forEach(t=>{var i=(t=t.map(e=>e.trim())).length,r=String(t.shift()).trim(),n=String(t.shift()||r).trim(),o=String(t.shift()||"").trim(),s=[],a=/(\w+)(?:\(([$\w\s-'",]+)\))?/.exec(n);a&&(n=a[1].replace(/(^[\s\n]+|[\s\n]+$)/,""),a[2]&&(s=a[2].split(",").map(e=>e.trim()))),s.length||s.push("$event"),r&&1!==i||(r=n);var l=t=>{for(var i,r=this,o=function(){var e=r.controller;return"function"==typeof e[n]?(i=((...t)=>{e[n](...t)}),0):"function"==typeof r[n]?(i=((...e)=>{r[n](...e)}),0):r.parent?void(r=r.parent):0};r&&0!==o(););var a=s.map(i=>{var n;return Number(i)==i?i:"event"===i||"$event"===i?t:"$view"===i?r:"$controller"===i?controller:"$tag"===i?e:"$parent"===i?this.parent:"$subview"===i?this:i in this.args?this.args[i]:(n=/^['"]([\w-]+?)["']$/.exec(i))?n[1]:void 0});if("function"!=typeof i)throw new Error(`${n} is not defined on View object.`+"\nTag:\n"+`${e.outerHTML}`);i(...a)},u={};switch(o.includes("p")?u.passive=!0:o.includes("P")&&(u.passive=!1),o.includes("c")?u.capture=!0:o.includes("C")&&(u.capture=!1),o.includes("o")?u.once=!0:o.includes("O")&&(u.once=!1),r){case"_init":l();break;case"_attach":this.nodesAttached.add(l);break;case"_detach":this.nodesDetached.add(l);break;default:e.addEventListener(r,l,u),this.onRemove(()=>{e.removeEventListener(r,l,u)})}return[r,n,s]}),e.removeAttribute("cv-on"),e}mapLinkTag(e){var t=e.getAttribute("cv-link");e.setAttribute("href",t);var i=i=>{i.preventDefault(),"http"!==t.substring(0,4)&&"//"!==t.substring(0,2)?n.Router.go(e.getAttribute("href")):globalThis.open(e.getAttribute("href",t))};return e.addEventListener("click",i),this.onRemove(((e,t)=>()=>{e.removeEventListener("click",t),e=void 0,t=void 0})(e,i)),e.removeAttribute("cv-link"),e}mapPrendererTag(e){var t=e.getAttribute("cv-prerender"),i=globalThis.prerenderer||navigator.userAgent.match(/prerender/i);return e.removeAttribute("cv-prerender"),i&&(globalThis.prerenderer=globalThis.prerenderer||!0),("never"===t&&i||"only"===t&&!i)&&this.postMapping.add(()=>e.parentNode.removeChild(e)),e}mapWithTag(t){var i=this,r=t.getAttribute("cv-with"),n=t.getAttribute("cv-carry"),o=t.getAttribute("cv-view");t.removeAttribute("cv-with"),t.removeAttribute("cv-carry"),t.removeAttribute("cv-view");var s=o?this.stringToClass(o):v,a=new DocumentFragment;[...t.childNodes].forEach(e=>a.appendChild(e));var l=[];n&&(l=n.split(",").map(e=>e.trim()));var u=this.args.bindTo(r,(r,n,o,u)=>{for(this.withViews.has(t)&&this.withViews.delete(t);t.firstChild;)t.removeChild(t.firstChild);var c=new s({},this);this.onRemove((e=>()=>{e.remove()})(c)),c.template=a;var h=function(){var e=i.args.bindTo(l[f],(e,t)=>{c.args[t]=e});c.onRemove(e),i.onRemove(()=>{e(),c.remove()})};for(var f in l)h();var d=function(){if("object"!=typeof r)return 1;var t=(r=e.Bindable.make(r)).bindTo(p,(e,t,i,r)=>{r?t in c.args&&delete c.args[t]:c.args[t]=e});c.args.bindTo(p,(e,t,i,n)=>{n?t in r&&delete r[t]:r[t]=e});i.onRemove(()=>{t(),r.isBound()||e.Bindable.clearBindings(r),c.remove()}),c.onRemove(()=>{t(),r.isBound()||e.Bindable.clearBindings(r)})};for(var p in r)d();c.render(t,null,this),this.withViews.set(t,c)});return this.onRemove(()=>{this.withViews.delete(t),u()}),t}mapViewTag(e){var t=e.getAttribute("cv-view");e.removeAttribute("cv-view");var i=new DocumentFragment;[...e.childNodes].forEach(e=>i.appendChild(e));var r=t.split(":"),n=r.shift(),o=new(r.length?this.stringToClass(r[0]):v)(this.args,this);return this.views.set(e,o),this.views.set(n,o),this.onRemove(()=>{o.remove(),this.views.delete(e),this.views.delete(n)}),o.template=i,o.render(e,null,this),e}mapEachTag(t){var i=t.getAttribute("cv-each"),n=t.getAttribute("cv-view");t.removeAttribute("cv-each"),t.removeAttribute("cv-view");var o=n?this.stringToClass(n):v,s=new DocumentFragment;[...t.childNodes].forEach(e=>s.appendChild(e));var[a,u,c]=i.split(":"),h=this.args,f=a;a.match(/\./)&&([h,f]=e.Bindable.resolve(this.args,a,!0));var d=h.bindTo(f,(e,i,n,a,h)=>{e instanceof l.Bag&&(e=e.list),this.viewLists.has(t)&&this.viewLists.get(t).remove();var f=new r.ViewList(s,u,e,this,c,o),d=()=>f.remove();this.onRemove(d),f.onRemove(()=>this._onRemove.remove(d));var p=this.args.bindTo((e,t,i,r)=>{"_id"!==t&&(r?t in f.subArgs&&delete f.subArgs[t]:f.subArgs[t]=e)}),v=f.args.bindTo((e,t,i,r,n)=>{"_id"!==t&&"value"!==t&&"___"!==String(t).substring(0,3)&&(r?delete this.args[t]:t in this.args&&(this.args[t]=e))});for(f.onRemove(p),f.onRemove(v),this.onRemove(p),this.onRemove(v);t.firstChild;)t.removeChild(t.firstChild);this.viewLists.set(t,f),f.render(t,null,this),"SELECT"===t.tagName&&f.reRender()});return this.onRemove(d),t}mapIfTag(t){var i=t,r=i.getAttribute("cv-view"),n=i.getAttribute("cv-if"),o=i.getAttribute("cv-is"),a=!1,u=!1;i.removeAttribute("cv-view"),i.removeAttribute("cv-if"),i.removeAttribute("cv-is");var c=r?this.stringToClass(r):v;"!"===n.substr(0,1)&&(n=n.substr(1),a=!0),"?"===n.substr(0,1)&&(n=n.substr(1),u=!0);var h=new DocumentFragment;[...i.childNodes].forEach(e=>h.appendChild(e));var f=this,d=new DocumentFragment,p=new c(this.args,f);p.tags.bindTo((e,t)=>this.tags[t]=e,{removeWith:this}),p.template=h;var m=f.args,y=n;n.match(/\./)&&([m,y]=e.Bindable.resolve(f.args,n,!0)),p.render(d,null,this);var b=m.bindTo(y,(e,i)=>{var r=e;u&&(e=null!==e&&void 0!==e),e instanceof l.Bag&&(e=e.list),Array.isArray(e)&&(e=!!e.length),null!==o&&(e=r==o),a&&(e=!e),e?(t.appendChild(d),[...d.childNodes].forEach(e=>s.Dom.mapTags(e,!1,(e,t)=>{e.matches&&e.dispatchEvent(new CustomEvent("cvDomAttached",{target:e,detail:{view:p||this,mainView:this}}))}))):(p.nodes.forEach(e=>d.appendChild(e)),s.Dom.mapTags(d,!1,(e,t)=>{e.matches&&new CustomEvent("cvDomDetached",{target:e,detail:{view:p||this,mainView:this}})}))},{children:Array.isArray(m[y])});f.onRemove(b);return f.onRemove(()=>{b(),f._onRemove.remove(b)}),this.onRemove(()=>{p.remove(),f!==this&&f.remove()}),t}mapTemplateTag(e){var t=e.getAttribute("cv-template");e.removeAttribute("cv-template");var i=e.innerHTML;return v.templates.has(i)||v.templates.set(i,document.createRange().createContextualFragment(e.innerHTML)),this.templates[t]=v.templates.get(i),this.postMapping.add(()=>e.remove()),e}mapSlotTag(e){var t=e.getAttribute("cv-slot"),i=this.templates[t];if(!i){for(var r=this;r&&!(i=r.templates[t]);)r=r.parent;if(!i)return void console.error(`Template ${t} not found.`)}for(e.removeAttribute("cv-slot");e.firstChild;)e.firstChild.remove();return"string"==typeof i&&(v.templates.has(i)||v.templates.set(i,document.createRange().createContextualFragment(i)),i=v.templates.get(i)),e.appendChild(i.cloneNode(!0)),e}postRender(e){}attached(e){}interpolatable(e){return!!String(e).match(this.interpolateRegex)}static uuid(){return new o.Uuid}remove(e=!1){if(this.dispatchEvent(new CustomEvent("remove",{detail:{view:this},cancelable:!0}))){var t=()=>{for(var e in this.tags)Array.isArray(this.tags[e])?(this.tags[e]&&this.tags[e].forEach(e=>e.remove()),this.tags[e].splice(0)):(this.tags[e]&&this.tags[e].remove(),this.tags[e]=void 0);for(var t in this.nodes)this.nodes[t]&&this.nodes[t].dispatchEvent(new Event("cvDomDetached")),this.nodes[t]&&this.nodes[t].remove(),this.nodes[t]=void 0;this.nodes.splice(0),this.firstNode=this.lastNode=void 0};e?t():requestAnimationFrame(t);var i=this._onRemove.items();for(var r of i)r(),this._onRemove.remove(r);for(var n of this.cleanup)n&&n();for(var[o,s]of(this.cleanup.length=0,this.viewLists))s.remove();for(var[a,l]of(this.viewLists.clear(),this.timeouts))clearTimeout(l.timeout),this.timeouts.delete(l.timeout);for(var u of this.intervals)clearInterval(u);for(var c of(this.intervals.length=0,this.frames))c();this.frames.length=0,this.preRuleSet.purge(),this.ruleSet.purge(),this.removed=!0,this.dispatchEvent(new CustomEvent("removed",{detail:{view:this},cancelable:!0}))}}findTag(e){for(var t in this.nodes){var i;if(this.nodes[t].querySelector){if(this.nodes[t].matches(e))return new a.Tag(this.nodes[t],this,void 0,void 0,this);if(i=this.nodes[t].querySelector(e))return new a.Tag(i,this,void 0,void 0,this)}}}findTags(e){var t=this.nodes.filter(t=>t.matches&&t.matches(e)),i=this.nodes.filter(e=>e.querySelectorAll).map(t=>[...t.querySelectorAll(e)]).flat().map(e=>new a.Tag(e,this,void 0,void 0,this))||[];return t.concat(i)}onRemove(e){e instanceof Event||this._onRemove.add(e)}update(){}beforeUpdate(e){}afterUpdate(e){}stringTransformer(e){return t=>{for(var i in e){for(var r=this,n=e[i];r&&!r[n];)r=r.parent;if(!r)return;t=r[e[i]](t)}return t}}stringToClass(e){if(v.refClasses.has(e))return v.refClasses.get(e);var t=e.split("/"),r=t[t.length-1],n=i(e);return v.refClasses.set(e,n[r]),n[r]}preventParsing(e){e[f]=!0}toString(){return this.nodes.map(e=>e.outerHTML).join(" ")}listen(e,t,i,r){if("string"==typeof e&&(r=i,i=t,t=e,e=this),e instanceof v)return this.listen(e.nodes,t,i,r);if(Array.isArray(e))return e.map(e=>this.listen(e,t,i,r));if(e instanceof a.Tag)return this.listen(e.element,t,i,r);e.addEventListener(t,i,r);var n=()=>e.removeEventListener(t,i,r),o=()=>{n(),n=(()=>{})};return this.onRemove(()=>o()),o}detach(){for(var e in this.nodes)this.nodes[e].remove();return this.nodes}}t.View=v,Object.defineProperty(v,"templates",{value:new Map}),Object.defineProperty(v,"refClasses",{value:new Map})}()}),require.register("curvature/base/ViewList.js",function(t,i,r){i=e(i,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ViewList=void 0;var e=i("./Bindable"),r=i("./SetMap"),n=i("./Bag");t.ViewList=class{constructor(t,i,r,o,s=null,a=null){this.removed=!1,this.args=e.Bindable.makeBindable(Object.create(null)),this.args.value=e.Bindable.makeBindable(r||Object.create(null)),this.subArgs=e.Bindable.makeBindable(Object.create(null)),this.views=[],this.cleanup=[],this.viewClass=a,this._onRemove=new n.Bag,this.template=t,this.subProperty=i,this.keyProperty=s,this.tag=null,this.downDebind=[],this.upDebind=[],this.paused=!1,this.parent=o,this.viewCount=0,this.rendered=new Promise((e,t)=>{Object.defineProperty(this,"renderComplete",{configurable:!1,writable:!0,value:e})}),this.willReRender=!1,this.args.___before((e,t,i,r,n)=>{"bindTo"!=t&&(this.paused=!0)}),this.args.___after((e,t,i,r,n)=>{"bindTo"!=t&&(this.paused=i.length>1,this.reRender())});var l=this.args.value.bindTo((e,t,i,r)=>{if(!this.paused){var n=t;if("symbol"!=typeof t)if(isNaN(t)&&(n="_"+t),r)for(var o in this.views[n]&&this.views[n].remove(!0),delete this.views[n],this.views)this.views[o]&&(isNaN(o)?this.views[o].args[this.keyProperty]=o.substr(1):this.views[o].args[this.keyProperty]=o);else this.views[n]?this.views[n]&&this.views[n].args&&(this.views[n].args[this.keyProperty]=t,this.views[n].args[this.subProperty]=e):this.viewCount?!1===this.willReRender&&(this.willReRender=requestAnimationFrame(()=>{this.willReRender=!1,this.reRender()})):this.reRender()}},{wait:0});this._onRemove.add(l),Object.preventExtensions(this)}render(e){var t=this,i=[],r=function(r){r.viewList=t,r.render(e,null,t.parent),i.push(r.rendered.then(()=>r))};for(var n of this.views)r(n);this.tag=e,Promise.all(i).then(e=>this.renderComplete(e)),this.parent.dispatchEvent(new CustomEvent("listRendered",{detail:{detail:{key:this.subProperty,value:this.args.value}}}))}reRender(){var e=this;if(!this.paused&&this.tag){var t=[],i=new r.SetMap;for(var n in this.views){var o=this.views[n];if(void 0!==o){var s=o.args[this.subProperty];i.add(s,o),t[n]=o}else t[n]=o}var a=[],l=new Set;this.downDebind.length&&this.downDebind.forEach(e=>e&&e()),this.upDebind.length&&this.upDebind.forEach(e=>e&&e()),this.upDebind.length=0,this.downDebind.length=0;var u=1/0,c=1/0,h=function(){var t=!1,r=f;if(isNaN(r)?r="_"+f:String(r).length&&(r=Number(r)),void 0!==e.args.value[f]&&i.has(e.args.value[f])){var n=i.getOne(e.args.value[f]);n&&(n.args[e.keyProperty]=f,a[r]=n,l.add(n),t=!0,isNaN(r)||(u=Math.min(u,r),r>0&&(c=Math.min(c,r))),i.remove(e.args.value[f],n))}if(!t){var o=Object.create(null),s=a[r]=new e.viewClass(o,e.parent);isNaN(r)||(u=Math.min(u,r),r>0&&(c=Math.min(c,r))),a[r].template=e.template,a[r].viewList=e,a[r].args[e.keyProperty]=f,a[r].args[e.subProperty]=e.args.value[f],e.upDebind[r]=o.bindTo(e.subProperty,(t,i,r,n)=>{var s=o[e.keyProperty];n?delete e.args.value[s]:e.args.value[s]=t}),e.downDebind[r]=e.subArgs.bindTo((e,t,i,r)=>{r?delete o[t]:o[t]=e});var h=()=>{e.upDebind.filter(e=>e).forEach(e=>e()),e.upDebind.length=0},d=()=>{e.downDebind.filter(e=>e).forEach(e=>e()),e.downDebind.length=0};s.onRemove(()=>{e._onRemove.remove(h),e._onRemove.remove(d),e.upDebind[r]&&e.upDebind[r](),e.downDebind[r]&&e.downDebind[r](),delete e.upDebind[r],delete e.downDebind[r]}),e._onRemove.add(h),e._onRemove.add(d),o[e.subProperty]=e.args.value[f]}};for(var f in this.args.value)h();for(var d in t)t[d]&&!l.has(t[d])&&t[d].remove(!0);if(Array.isArray(this.args.value)){var p=0===u&&void 0!==a[1]&&a.length>1||c===1/0?u:c,v=(e=0)=>{for(var t=a.length-e-1;t>p&&void 0===a[t];)t--;return t<p?Promise.resolve():a[t]===this.views[t]?a[t]&&!a[t].firstNode?(a[t].render(this.tag,a[t+1],this.parent),a[t].rendered.then(()=>v(Number(e)+1))):0===e||e%500?v(Number(e)+1):new Promise(t=>requestAnimationFrame(()=>t(v(Number(e)+1)))):(a[t].render(this.tag,a[t+1],this.parent),this.views.splice(t,0,a[t]),a[t].rendered.then(()=>v(e+1)))};this.rendered=v()}else{var m=[],y=Object.assign(Object.create(null),a),b=e=>parseInt(e)===e-0,g=Object.keys(a).sort((e,t)=>b(e)&&b(t)?Math.sign(e-t):b(e)||b(t)?!b(e)&&b(t)?-1:b(e)&&!b(t)?1:void 0:0),w=function(t){if(delete y[t],a[t].firstNode&&a[t]===e.views[t])return 1;a[t].render(e.tag,null,e.parent),m.push(a[t].rendered.then(()=>a[t]))};for(var x of g)w(x);for(var T in y)delete this.args.views[T],y.remove(!0);this.rendered=Promise.all(m)}for(var _ in a)isNaN(_)?a[_].args[this.keyProperty]=_.substr(1):a[_].args[this.keyProperty]=_;return this.views=Array.isArray(this.args.value)?[...a]:a,this.viewCount=a.length,l.clear(),this.willReRender=!1,this.rendered.then(()=>{this.parent.dispatchEvent(new CustomEvent("listRendered",{detail:{detail:{key:this.subProperty,value:this.args.value,tag:this.tag}}})),this.tag.dispatchEvent(new CustomEvent("listRendered",{detail:{detail:{key:this.subProperty,value:this.args.value,tag:this.tag}}}))}),this.rendered}}pause(e=!0){for(var t in this.views)this.views[t].pause(e)}onRemove(e){this._onRemove.add(e)}remove(){for(var t in this.views)this.views[t]&&this.views[t].remove(!0);var i=this._onRemove.items();for(var r in i)this._onRemove.remove(i[r]),i[r]();for(;this.cleanup.length;)this.cleanup.pop()();for(this.views=[];this.tag&&this.tag.firstChild;)this.tag.removeChild(this.tag.firstChild);this.subArgs&&e.Bindable.clearBindings(this.subArgs),e.Bindable.clearBindings(this.args),this.removed=!0}}}()}),require.register("curvature/input/Keyboard.js",function(t,i,r){i=e(i,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Keyboard=void 0;var e=i("../base/Bindable");t.Keyboard=class{static get(){return this.instance=this.instance||e.Bindable.make(new this)}constructor(){this.maxDecay=120,this.comboTime=500,this.listening=!1,this.focusElement=document.body,this[e.Bindable.NoGetters]=!0,Object.defineProperty(this,"combo",{value:e.Bindable.make([])}),Object.defineProperty(this,"whichs",{value:e.Bindable.make({})}),Object.defineProperty(this,"codes",{value:e.Bindable.make({})}),Object.defineProperty(this,"keys",{value:e.Bindable.make({})}),Object.defineProperty(this,"pressedWhich",{value:e.Bindable.make({})}),Object.defineProperty(this,"pressedCode",{value:e.Bindable.make({})}),Object.defineProperty(this,"pressedKey",{value:e.Bindable.make({})}),Object.defineProperty(this,"releasedWhich",{value:e.Bindable.make({})}),Object.defineProperty(this,"releasedCode",{value:e.Bindable.make({})}),Object.defineProperty(this,"releasedKey",{value:e.Bindable.make({})}),Object.defineProperty(this,"keyRefs",{value:e.Bindable.make({})}),document.addEventListener("keyup",e=>{this.listening&&(this.keys[e.key]>0||!this.focusElement||document.activeElement===this.focusElement||this.focusElement.contains(document.activeElement)&&!document.activeElement.matches("input,textarea"))&&(e.preventDefault(),this.releasedWhich[e.which]=Date.now(),this.releasedCode[e.code]=Date.now(),this.releasedKey[e.key]=Date.now(),this.whichs[e.which]=-1,this.codes[e.code]=-1,this.keys[e.key]=-1)}),document.addEventListener("keydown",e=>{this.listening&&(!this.focusElement||document.activeElement===this.focusElement||this.focusElement.contains(document.activeElement)&&!document.activeElement.matches("input,textarea"))&&(e.preventDefault(),e.repeat||(this.combo.push(e.code),clearTimeout(this.comboTimer),this.comboTimer=setTimeout(()=>this.combo.splice(0),this.comboTime),this.pressedWhich[e.which]=Date.now(),this.pressedCode[e.code]=Date.now(),this.pressedKey[e.key]=Date.now(),this.keys[e.key]>0||(this.whichs[e.which]=1,this.codes[e.code]=1,this.keys[e.key]=1)))});var t=e=>{for(var t in this.keys)this.keys[t]<0||(this.releasedKey[t]=Date.now(),this.keys[t]=-1);for(var i in this.codes)this.codes[i]<0||(this.releasedCode[i]=Date.now(),this.codes[i]=-1);for(var r in this.whichs)this.whichs[r]<0||(this.releasedWhich[r]=Date.now(),this.whichs[r]=-1)};window.addEventListener("blur",t),window.addEventListener("visibilitychange",()=>{"visible"!==document.visibilityState&&t()})}getKeyRef(t){return this.keyRefs[t]=this.keyRefs[t]||e.Bindable.make({})}getKeyTime(e){var t=this.releasedKey[e],i=this.pressedKey[e];return i?!t||t<i?Date.now()-i:-1*(Date.now()-t):0}getCodeTime(e){var t=this.releasedCode[e],i=this.pressedCode[e];return i?!t||t<i?Date.now()-i:-1*(Date.now()-t):0}getWhichTime(e){var t=this.releasedWhich[e],i=this.pressedWhich[e];return i?!t||t<i?Date.now()-i:-1*(Date.now()-t):0}getKey(e){return this.keys[e]?this.keys[e]:0}getKeyCode(e){return this.codes[e]?this.codes[e]:0}reset(){for(var e in this.keys)delete this.keys[e];for(var e in this.codes)delete this.codes[e];for(var e in this.whichs)delete this.whichs[e]}update(){for(var e in this.keys)this.keys[e]>0?this.keys[e]++:this.keys[e]>-this.maxDecay?this.keys[e]--:delete this.keys[e];for(var e in this.codes){var t=this.releasedCode[e],i=this.pressedCode[e],r=this.getKeyRef(e);if(this.codes[e]>0){if(r.frames=this.codes[e]++,r.time=i?Date.now()-i:0,r.down=!0,!t||t<i)return;return-1*(Date.now()-t)}this.codes[e]>-this.maxDecay?(r.frames=this.codes[e]--,r.time=t-Date.now(),r.down=!1):(r.frames=0,r.time=0,r.down=!1,delete this.codes[e])}for(var e in this.whichs)this.whichs[e]>0?this.whichs[e]++:this.whichs[e]>-this.maxDecay?this.whichs[e]--:delete this.whichs[e]}}}()}),require.register("curvature/mixin/EventTargetMixin.js",function(t,i,r){i=e(i,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventTargetMixin=void 0;var e=i("../base/Mixin"),r=Symbol("EventTargetParent"),n=Symbol("CallHandler"),o=Symbol("Capture"),s=Symbol("Bubble"),a=(Symbol("Target"),Symbol("HandlersBubble")),l=Symbol("HandlersCapture"),u=t.EventTargetMixin={[e.Mixin.Constructor](){this[l]=new Map,this[a]=new Map},dispatchEvent(...e){var t=e[0];"string"==typeof t&&(t=new CustomEvent(t),e[0]=t),t.cvPath=t.cvPath||[],t.cvTarget=t.cvCurrentTarget=this;var i=this[o](...e);if(t.cancelable&&(!1===i||t.cancelBubble))return i;var u=[];if(this[l].has(t.type)){var c=this[l].get(t.type),h=[...c];h.forEach(e=>e.push(c)),u.push(...h)}if(this[a].has(t.type)){var f=this[a].get(t.type),d=[...f];d.forEach(e=>e.push(f)),u.push(...d)}for(var[p,v,m]of(u.push([()=>this[n](...e),{},null]),u))if(v.once&&m.delete(p),i=p(t),t.cancelable&&!1===i)break;return t.cancelable&&(t.cancelBubble||!1===i)||this[s](...e),this[r]||Object.freeze(t.cvPath),t.returnValue},addEventListener(e,t,i={}){!0===i&&(i={useCapture:!0});var r=a;i.useCapture&&(r=l),this[r].has(e)||this[r].set(e,new Map),this[r].get(e).set(t,i),i.signal&&i.signal.addEventListener("abort",r=>this.removeEventListener(e,t,i),{once:!0})},removeEventListener(e,t,i={}){!0===i&&(i={useCapture:!0});var r=a;i.useCapture&&(r=l),this[r].has(e)&&this[r].get(e).delete(t)},[o](...e){var t=e[0];if(t.cvPath.push(this),this[r]){var i=this[r][o](...e);if((!t.cancelable||!1!==i&&!t.cancelBubble)&&this[r][l].has(t.type)){t.cvCurrentTarget=this[r];var{type:n}=t,s=this[r][l].get(n);for(var[a,u]of s)if(u.once&&s.delete(a),i=a(t),t.cancelable&&(!1===i||t.cancelBubble))break;return i}}},[s](...e){var t=e[0];if(t.bubbles&&this[r]&&!t.cancelBubble){if(!this[r][a].has(t.type))return this[r][s](...e);var i;t.cvCurrentTarget=this[r];var{type:o}=t,l=this[r][a].get(t.type);for(var[u,c]of l)if(c.once&&l.delete(u),i=u(t),t.cancelable&&!1===i)return i;return i=this[r][n](...e),t.cancelable&&(!1===i||t.cancelBubble)?i:this[r][s](...e)}},[n](...e){var t=e[0];if(!t.defaultPrevented){var i=`on${t.type[0].toUpperCase()+t.type.slice(1)}`;return"function"==typeof this[i]?this[i](t):void 0}}};Object.defineProperty(u,"Parent",{value:r})}()}),require.register("Config.js",function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,n(r.key),r)}}function n(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Config=void 0,(e.Config=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)})).title="tigl"}),require.register("gl2d/Gl2d.js",function(e,t,i){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,a(r.key),r)}}function o(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,t,i){return(t=a(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function a(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Gl2d=void 0;let l=function(){return o(function e(t){let i=t.gl,n=t.vertexShader,o=t.fragmentShader,a=t.uniforms,l=t.attributes;r(this,e),s(this,"context",null),s(this,"program",null),s(this,"attributes",{}),s(this,"buffers",{}),s(this,"uniforms",{}),this.context=i,this.program=i.createProgram(),i.attachShader(this.program,n),i.attachShader(this.program,o),i.linkProgram(this.program),i.detachShader(this.program,n),i.detachShader(this.program,o),i.deleteShader(n),i.deleteShader(o),i.getProgramParameter(this.program,i.LINK_STATUS)||(console.error(i.getProgramInfoLog(this.program)),i.deleteProgram(this.program));for(const e of a){const t=i.getUniformLocation(this.program,e);null!==t?this.uniforms[e]=t:console.warn(`Uniform ${e} not found.`)}for(const e of l){const t=i.getAttribLocation(this.program,e);if(null===t){console.warn(`Attribute ${e} not found.`);continue}const r=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,r),i.enableVertexAttribArray(t),i.vertexAttribPointer(t,2,i.FLOAT,!1,0,0),this.attributes[e]=t,this.buffers[e]=r}},[{key:"use",value:function(){this.context.useProgram(this.program)}},{key:"uniformF",value:function(e){const t=this.context;for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];t[`uniform${r.length}f`](this.uniforms[e],...r)}},{key:"uniformI",value:function(e){const t=this.context;for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];t[`uniform${r.length}i`](this.uniforms[e],...r)}}])}();e.Gl2d=function(){return o(function e(t){r(this,e),this.element=t||document.createElement("canvas"),this.context=this.element.getContext("webgl")},[{key:"createShader",value:function(e){let i=null;switch(e.substring(e.lastIndexOf(".")+1).toUpperCase()){case"VERT":i=this.context.VERTEX_SHADER;break;case"FRAG":i=this.context.FRAGMENT_SHADER}const r=this.context.createShader(i),n=t(e);if(this.context.shaderSource(r,n),this.context.compileShader(r),this.context.getShaderParameter(r,this.context.COMPILE_STATUS))return r;console.error(this.context.getShaderInfoLog(r)),this.context.deleteShader(r)}},{key:"createProgram",value:function(e){let t=e.vertexShader,i=e.fragmentShader,r=e.uniforms,n=e.attributes;const o=this.context;return new l({gl:o,vertexShader:t,fragmentShader:i,uniforms:r,attributes:n})}},{key:"createTexture",value:function(e,t){const i=this.context,r=i.createTexture();return i.bindTexture(i.TEXTURE_2D,r),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,t,0,i.RGBA,i.UNSIGNED_BYTE,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),r}},{key:"createFramebuffer",value:function(e){const t=this.context,i=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),i}},{key:"enableBlending",value:function(){const e=this.context;e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.enable(e.BLEND)}}])}()}),require.register("home/View.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.View=void 0;var r=t("curvature/base/View"),n=t("../sprite/Camera"),o=t("../ui/OnScreenJoyPad"),s=t("curvature/input/Keyboard"),a=t("../session/Session");t("Config");function l(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,u(r.key),r)}}function u(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function c(e,t,i){return t=h(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,i||[],h(e).constructor):t.apply(e,i))}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}const d={};d.onScreenJoyPad=new o.OnScreenJoyPad,d.keyboard=s.Keyboard.get();e.View=function(e){function i(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),window.smProfiling=!0,(r=c(this,i,[e])).template=t("./view.tmp"),r.routes=[],r.keyboard=d.keyboard,r.speed=24,r.maxSpeed=r.speed,r.args.joypad=d.onScreenJoyPad,r.args.fps=0,r.args.sps=0,r.args.camX=0,r.args.camY=0,r.args.showEditor=!1,r.keyboard.listening=!0,r.keyboard.keys.bindTo("Home",(e,t,i,n)=>{!r.session||e<0||e%5==0&&(r.session.frameLock++,r.args.frameLock=r.session.frameLock)}),r.keyboard.keys.bindTo("End",(e,t,i,n)=>{!r.session||e<0||e%5==0&&(r.session.frameLock--,r.session.frameLock<0&&(r.session.frameLock=0),r.args.frameLock=r.session.frameLock)}),r.keyboard.keys.bindTo("PageUp",(e,t,i,n)=>{!r.session||e<0||(e%5==0&&r.session.simulationLock++,r.args.simulationLock=r.session.simulationLock)}),r.keyboard.keys.bindTo("PageDown",(e,t,i,n)=>{!r.session||e<0||(e%5==0&&(r.session.simulationLock--,r.session.simulationLock<0&&(r.session.simulationLock=0)),r.args.simulationLock=r.session.simulationLock)}),r.keyboard.keys.bindTo("=",(e,t,i,n)=>{e>0&&r.zoom(1)}),r.keyboard.keys.bindTo("+",(e,t,i,n)=>{e>0&&r.zoom(1)}),r.keyboard.keys.bindTo("-",(e,t,i,n)=>{e>0&&r.zoom(-1)}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&f(e,t)}(i,r.View),o=i,(s=[{key:"onRendered",value:function(){this.session=new a.Session({onScreenJoyPad:this.args.joypad,keyboard:this.keyboard,element:this.tags.canvas.element,world:"/world.json"}),this.args.frameLock=this.session.frameLock,this.args.simulationLock=this.session.simulationLock,window.addEventListener("resize",()=>this.resize());let e=0,t=0;const i=e=>{document.hidden||this.session.simulate(e)&&(this.args.sps=(1e3/(e-t)).toFixed(3),t=e)},r=t=>{document.hidden?window.requestAnimationFrame(r):(window.requestAnimationFrame(r),this.session.draw(t)&&(this.args.fps=(1e3/(t-e)).toFixed(3),this.args.camX=Number(n.Camera.x).toFixed(3),this.args.camY=Number(n.Camera.y).toFixed(3),e=t,this.session.spriteBoard.following&&(this.args.posX=Number(this.session.spriteBoard.following.sprite.x).toFixed(3),this.args.posY=Number(this.session.spriteBoard.following.sprite.y).toFixed(3))))};this.session.spriteBoard.zoomLevel=document.body.clientHeight/1280*4,this.resize(),setInterval(()=>i(performance.now()),0),r(performance.now())}},{key:"resize",value:function(e,t){const i=this.session.spriteBoard.screenScale;this.session.spriteBoard.screenScale=document.body.clientHeight/1280,this.session.spriteBoard.zoomLevel*=this.session.spriteBoard.screenScale/i,this.args.width=this.tags.canvas.element.width=e||document.body.clientWidth,this.args.height=this.tags.canvas.element.height=t||document.body.clientHeight,this.args.rwidth=Math.trunc((e||document.body.clientWidth)/this.session.spriteBoard.zoomLevel),this.args.rheight=Math.trunc((t||document.body.clientHeight)/this.session.spriteBoard.zoomLevel),this.session.spriteBoard.resize()}},{key:"scroll",value:function(e){let t=e.deltaY>0?-1:e.deltaY<0?1:0;this.zoom(t)}},{key:"zoom",value:function(e){this.session&&this.session.spriteBoard.zoom(e)}}])&&l(o.prototype,s),u&&l(o,u),Object.defineProperty(o,"prototype",{writable:!1}),o;var o,s,u}()}),require.register("home/view.tmp.html",function(e,t,i){i.exports='<canvas\n\tcv-ref = "canvas:curvature/base/Tag"\n\tcv-on  = "wheel:scroll(event);"\n></canvas>\n\n<div class = "hud fps">[[sps]] simulations/s / [[simulationLock]]\n[[fps]] frames/s      / [[frameLock]]\n\nRes [[rwidth]] x [[rheight]]\n    [[width]] x [[height]]\n\nCam [[camX]] x [[camY]]\nPos [[posX]] x [[posY]]\n\n Sim:   Pg Up / Dn\n Frame: Home / End\n Scale: + / -\n</div>\n<div class = "reticle"></div>\n\n[[joypad]]\n'}),require.register("initialize.js",function(e,t,i){"use strict";var r=t("curvature/base/Router");const n=new(t("home/View").View);r.Router.listen(n,{"*":function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];console.log(t)}}),document.addEventListener("DOMContentLoaded",()=>n.render(document.body))}),require.register("inject/Container.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Container=void 0;var r=t("./Injectable");function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,o(r.key),r)}}function o(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function s(e,t,i){return t=a(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,i||[],a(e).constructor):t.apply(e,i))}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}e.Container=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),s(this,t,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t)}(t,r.Injectable),i=t,(o=[{key:"inject",value:function(e){return new this.constructor(Object.assign({},this,e))}}])&&n(i.prototype,o),a&&n(i,a),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,a}()}),require.register("inject/Injectable.js",function(e,t,i){"use strict";function r(e,t,i){return t=n(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,i||[],n(e).constructor):t.apply(e,i))}function n(e){return(n=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){return(o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,u(r.key),r)}}function l(e,t,i){return t&&a(e.prototype,t),i&&a(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function u(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Injectable=void 0;let c={},h={};e.Injectable=function(){function e(){s(this,e);let t=this.constructor.injections(),i=this.constructor.context();c[i]||(c[i]={}),h[i]||(h[i]={});for(let e in t){let r=t[e];!c[i][e]&&r.prototype&&(/[A-Z]/.test(String(e)[0])&&(c[i][e]=r))}for(let e in t){let r=void 0,n=c[i][e]||t[e];/[A-Z]/.test(String(e)[0])?(n.prototype?h[i][e]||(h[i][e]=new n):h[i][e]=n,r=h[i][e]):r=n.prototype?new n:n,Object.defineProperty(this,e,{enumerable:!1,writable:!1,value:r})}}return l(e,null,[{key:"injections",value:function(){return{}}},{key:"context",value:function(){return"."}},{key:"inject",value:function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".";if(!(this.prototype instanceof e||this===e))throw new Error("Cannot access injectable subclass!\n\nAre you trying to instantiate like this?\n\n\tnew X.inject({...});\n\nIf so please try:\n\n\tnew (X.inject({...}));\n\nPlease note the parenthesis.\n");let n=this.injections();return function(e){function a(){return s(this,a),r(this,a,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&o(e,t)}(a,e),l(a,null,[{key:"injections",value:function(){return Object.assign({},n,t)}},{key:"context",value:function(){return i}}])}(this)}}])}()}),require.register("inject/Single.js",function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,n(r.key),r)}}function n(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.single=e.Single=void 0;let o=e.Single=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name="sss."+Math.random()});e.single=new o}),require.register("input/Axis.js",function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,o(r.key),r)}}function n(e,t,i){return(t=o(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function o(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Axis=void 0;e.Axis=function(){return e=function e(t){let i=t.deadZone,r=void 0===i?0:i,o=t.proportional,s=void 0===o||o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n(this,"magnitude",0),n(this,"delta",0),r&&(this.proportional=s,this.deadZone=r)},(t=[{key:"tilt",value:function(e){e=this.deadZone&&Math.abs(e)>=this.deadZone?(Math.abs(e)-this.deadZone)/(1-this.deadZone)*Math.sign(e):0,this.delta=Number(e-this.magnitude).toFixed(3)-0,this.magnitude=Number(e).toFixed(3)-0}},{key:"zero",value:function(){this.magnitude=this.delta=0}}])&&r(e.prototype,t),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}()}),require.register("input/Button.js",function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,o(r.key),r)}}function n(e,t,i){return(t=o(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function o(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Button=void 0;e.Button=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n(this,"active",!1),n(this,"pressure",0),n(this,"delta",0),n(this,"time",0)},(t=[{key:"update",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.pressure?this.time++:!this.pressure&&this.time>0?this.time=-1:!this.pressure&&this.time<0&&this.time--,this.time<-1&&-1===this.delta&&(this.delta=0)}},{key:"press",value:function(e){this.delta=Number(e-this.pressure).toFixed(3)-0,this.pressure=Number(e).toFixed(3)-0,this.active=!0,this.time=this.time>0?this.time:0}},{key:"release",value:function(){this.delta=Number(-this.pressure).toFixed(3)-0,this.pressure=0,this.active=!1}},{key:"zero",value:function(){this.pressure=this.delta=0,this.active=!1}}])&&r(e.prototype,t),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}()}),require.register("input/Controller.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Controller=void 0;var r=t("./Axis"),n=t("./Button");function o(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,s(r.key),r)}}function s(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}const a={Space:0,Enter:0,NumpadEnter:0,ControlLeft:1,ControlRight:1,ShiftLeft:2,ShiftRight:2,KeyZ:3,KeyQ:4,KeyE:5,Digit1:6,Digit3:7,KeyBackspace:8,KeyW:12,KeyA:14,KeyS:13,KeyD:15,KeyH:112,KeyJ:113,KeyK:114,KeyL:115,KeyP:1020,KeyO:1209,Pause:1020,Tab:11,ArrowUp:12,ArrowDown:13,ArrowLeft:14,ArrowRight:15,KeyMeta:16,Numpad4:112,Numpad2:113,Numpad8:114,Numpad6:115,Backquote:1010,NumpadAdd:1011,NumpadSubtract:1012,NumpadMultiply:1013,NumpadDivide:1014,PageUp:1022,PageDown:1023,Home:1024,End:1025,Escape:[1020,1050],KeyB:1201};[...Array(12)].map((e,t)=>a[`F${t}`]=2e3+t);const l={12:-1,13:1,14:-0,15:0,112:-2,113:3,114:-3,115:2},u={"-6":14,"+6":15,"-7":12,"+7":13},c={0:1200,1:1201,9:1020,4:1022,5:1023};e.Controller=function(){return e=function e(t){t.keys;let i=t.deadZone,r=void 0===i?0:i;t.gamepad,t.keyboard;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.deadZone=r,Object.defineProperties(this,{buttons:{value:{}},pressure:{value:{}},axes:{value:{}},keys:{value:{}}})},(t=[{key:"update",value:function(){let e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).gamepad;for(const e in this.buttons){this.buttons[e].update()}if(e&&this.willRumble){if("object"!=typeof this.willRumble&&(this.willRumble={duration:1e3,strongMagnitude:1,weakMagnitude:1}),e.id&&String(e.id).match(/playstation.{0,5}3/i)){this.willRumble.duration<100&&this.willRumble.strongMagnitude<.75&&(this.willRumble.duration=0,this.willRumble.weakMagnitude=0,this.willRumble.strongMagnitude=0),setTimeout(()=>{this.willRumble||e.vibrationActuator.playEffect("dual-rumble",{duration:0,weakMagnitude:0,strongMagnitude:0})},this.willRumble.duration+-1)}e.vibrationActuator&&e.vibrationActuator.playEffect&&e.vibrationActuator.playEffect("dual-rumble",this.willRumble),this.willRumble=!1}}},{key:"rumble",value:function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.willRumble=e}},{key:"readInput",value:function(e){let t=e.keyboard,i=e.gamepads,o=void 0===i?[]:i;const s={},h={},f={},d=new Set;for(let e=0;e<o.length;e++){const t=o[e];if(t)for(const e in t.buttons){const i=t.buttons[e];i.pressed&&(this.press(e,i.value),h[e]=!0,d.add(t))}}if(t){for(const e in[...Array(10)])h[e]||t.getKeyCode(e)>0&&(this.press(e,1),h[e]=!0,d.add(t));for(let e in a){if(h[e])continue;let i=a[e];Array.isArray(i)||(i=a[e]=[i]);for(const r of i)t.getKeyCode(e)>0&&(this.press(r,1),h[r]=!0)}}for(const e of o)if(e)for(const t in e.buttons){if(f[t])continue;if(h[t])continue;const i=e.buttons[t];this.buttons[t]&&!i.pressed&&this.buttons[t].active&&(this.release(t),f[t]=!0)}if(t){for(const e in[...Array(10)])f[e]||h[e]||t.getKeyCode(e)<0&&(this.release(e),f[e]=!0);for(let e in a){let i=a[e];Array.isArray(i)||(i=a[e]=[i]);for(const r of i)f[r]||h[r]||t.getKeyCode(e)<0&&(this.release(r),f[e]=!0)}}for(let e=0;e<o.length;e++){const t=o[e];if(t)for(const e in t.axes){const i=t.axes[e];Math.abs(i)<this.deadZone?s[e]||this.tilt(e,0):(s[e]=!0,this.tilt(e,i))}}for(let e in l){this.buttons[e]||(this.buttons[e]=new n.Button);const t=l[e],i=Math.sign(1/t),r=Math.abs(t);s[r]||(this.buttons[e].active?(s[r]=!0,this.tilt(r,i)):s[r]||this.tilt(r,0))}for(let e in u){const t=u[e];if(f[t])continue;if(h[t])continue;const i=[e.slice(0,1),e.slice(1)],n=(i[0],i[1]);this.axes[n]||(this.axes[n]=new r.Axis({deadZone:this.deadZone}));const o=this.axes[n];if(o.magnitude&&Math.sign(e)!==Math.sign(o.magnitude))continue;const s=Math.abs(o.magnitude);s?(this.press(t,s),h[t]=!0):(this.release(t,s),f[t]=!0)}for(const e in c){const t=c[e];f[t]||(h[t]||(this.buttons[t]||(this.buttons[t]=new n.Button),this.buttons[e]||(this.buttons[e]=new n.Button),this.buttons[e].active?(this.press(t,this.buttons[e].pressure),h[t]=!0):h[t]||(this.release(t,this.buttons[e].pressure),f[t]=!0)))}return d}},{key:"tilt",value:function(e,t){this.axes[e]||(this.axes[e]=new r.Axis({deadZone:this.deadZone})),this.axes[e].tilt(t)}},{key:"press",value:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.buttons[e]||(this.buttons[e]=new n.Button),this.buttons[e].press(t)}},{key:"release",value:function(e){this.buttons[e]||(this.buttons[e]=new n.Button),this.buttons[e].release()}},{key:"serialize",value:function(){const e={};for(const t in this.buttons)e[t]=this.buttons[t].pressure;const t={};for(const e in this.axes)t[e]=this.axes[e].magnitude;return{axes:t,buttons:e}}},{key:"replay",value:function(e){if(e.buttons)for(const t in e.buttons)e.buttons[t]>0?this.press(t,e.buttons[t]):this.release(t);if(e.axes)for(const t in e.axes)e.axes[t].magnitude!==e.axes[t]&&this.tilt(t,e.axes[t])}},{key:"zero",value:function(){for(const e in this.axes)this.axes[e].zero();for(const e in this.buttons)this.buttons[e].zero()}},{key:"buttonIsMapped",value:function(e){return e in c}},{key:"keyIsMapped",value:function(e){return e in a}}])&&o(e.prototype,t),i&&o(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}()}),require.register("math/Geometry.js",function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,n(r.key),r)}}function n(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Geometry=void 0;e.Geometry=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},i=[{key:"lineIntersectsLine",value:function(e,t,i,r,n,o,s,a){const l=i-e,u=r-t,c=s-n,h=a-o,f=l*h-u*c;if(0===f)return!1;const d=n-e,p=o-t,v=(d*u-p*l)/f;if(v<0||v>1)return!1;const m=(d*h-p*c)/f;return!(m<0||m>1)&&[e+m*l,t+m*u]}}],(t=null)&&r(e.prototype,t),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}()}),require.register("math/Matrix.js",function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,n(r.key),r)}}function n(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Matrix=void 0;e.Matrix=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},i=[{key:"identity",value:function(){return[[1,0,0],[0,1,0],[0,0,1]]}},{key:"translate",value:function(e,t){return[[1,0,e],[0,1,t],[0,0,1]]}},{key:"scale",value:function(e,t){return[[e,0,0],[0,t,0],[0,0,1]]}},{key:"rotate",value:function(e){const t=Math.sin(e),i=Math.cos(e);return[[i,-t,0],[t,i,0],[0,0,1]]}},{key:"shearX",value:function(e){return[[1,e,0],[0,1,0],[0,0,1]]}},{key:"shearY",value:function(e){return[[1,0,0],[e,1,0],[0,0,1]]}},{key:"multiply",value:function(e,t){if(e.length!==t.length)throw new Error("Invalid matrices");if(e[0].length!==t.length)throw new Error("Incompatible matrices");const i=Array(e.length).fill().map(()=>Array(t[0].length).fill(0));for(let r=0;r<e.length;r++)for(let n=0;n<t[0].length;n++)for(let o=0;o<e[0].length;o++)i[r][n]+=e[r][o]*t[o][n];return i}},{key:"composite",value:function(){let e=this.identity();for(let t=0;t<arguments.length;t++)e=this.multiply(e,t<0||arguments.length<=t?void 0:arguments[t]);return e}},{key:"transform",value:function(e,t){const i=[];for(let r=0;r<e.length;r+=2){const n=[e[r],e[r+1],1];for(const e of t)i.push(n[0]*e[0]+n[1]*e[1]+n[2]*e[2])}return new Float32Array(i.filter((e,t)=>(1+t)%3))}}],(t=null)&&r(e.prototype,t),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}()}),require.register("math/Quadtree.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Quadtree=void 0;var r=t("curvature/base/Bindable"),n=t("./Rectangle");function o(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,s(r.key),r)}}function s(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function a(e,t,i){return t=l(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,i||[],l(e).constructor):t.apply(e,i))}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}e.Quadtree=function(e){function t(e,i,n,o){var s;let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(s=a(this,t,[e,i,n,o]))[r.Bindable.Prevent]=!0,s.items=new Set,s.split=!1,s.minSize=l||10,s.backMap=u?u.backMap:new Map,s.parent=u,s.ulCell=null,s.urCell=null,s.blCell=null,s.brCell=null,s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(t,n.Rectangle),i=t,(s=[{key:"add",value:function(e){if(!this.contains(e.x,e.y))return!1;const i=this.x2-this.x1,r=this.y2-this.y1;if(this.split)return this.ulCell.add(e)||this.urCell.add(e)||this.blCell.add(e)||this.brCell.add(e);if(this.items.size&&i>this.minSize&&r>this.minSize){this.split=!0;const n=.5*i,o=.5*r;this.ulCell=new t(this.x1,this.y1,this.x1+n,this.y1+o,this.minSize,this),this.blCell=new t(this.x1,this.y1+o,this.x1+n,this.y2,this.minSize,this),this.urCell=new t(this.x1+n,this.y1,this.x2,this.y1+o,this.minSize,this),this.brCell=new t(this.x1+n,this.y1+o,this.x2,this.y2,this.minSize,this);for(const e of this.items)this.items.delete(e),this.ulCell.add(e)||this.urCell.add(e)||this.blCell.add(e)||this.brCell.add(e);return this.ulCell.add(e)||this.urCell.add(e)||this.blCell.add(e)||this.brCell.add(e)}return this.backMap.set(e,this),this.items.add(e),!0}},{key:"move",value:function(e){if(!this.backMap.has(e))return this.add(e);const t=this.backMap.get(e);let i=t;for(;i&&!i.contains(e.x,e.y);)i=i.parent;return i?(i!==t&&(t.delete(e),i.add(e)),!0):(t.delete(e),!1)}},{key:"delete",value:function(e){if(!this.backMap.has(e))return console.warn("Entity not in Quadtree."),!1;const t=this.backMap.get(e);return t.items.delete(e),t.parent&&t.parent.prune(),this.backMap.delete(e),!0}},{key:"isPrunable",value:function(){return this.split?this.ulCell.isPrunable()&&this.urCell.isPrunable()&&this.blCell.isPrunable()&&this.brCell.isPrunable():0===this.items.size}},{key:"prune",value:function(){return!!this.isPrunable()&&(this.split=!1,this.ulCell=null,this.urCell=null,this.blCell=null,this.brCell=null,!0)}},{key:"findLeaf",value:function(e,t){var i,r,n;return this.contains(e,t)?this.split?null!==(i=null!==(r=null!==(n=this.ulCell.findLeaf(e,t))&&void 0!==n?n:this.urCell.findLeaf(e,t))&&void 0!==r?r:this.blCell.findLeaf(e,t))&&void 0!==i?i:this.brCell.findLeaf(e,t):this:null}},{key:"has",value:function(e){return this.split?this.ulCell.has(e)||this.urCell.has(e)||this.blCell.has(e)||this.brCell.has(e):this.items.has(e)}},{key:"select",value:function(e,t,i,r){const n=t+r;return e+i<this.x1||e>this.x2?new Set:n<this.y1||t>this.y2?new Set:this.split?new Set([...this.ulCell.select(e,t,i,r),...this.urCell.select(e,t,i,r),...this.blCell.select(e,t,i,r),...this.brCell.select(e,t,i,r)]):this.items}},{key:"dump",value:function(){return this.split?new Set([...this.ulCell.dump(),...this.urCell.dump(),...this.blCell.dump(),...this.brCell.dump()]):this.items}}])&&o(i.prototype,s),l&&o(i,l),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,s,l}()}),require.register("math/QuickTree.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.QuickTree=void 0;var r=t("./Quadtree"),n=t("./Rectangle");function o(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,s(r.key),r)}}function s(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function a(e,t,i){return t=c(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,i||[],c(e).constructor):t.apply(e,i))}function l(e,t,i,r){var n=u(c(1&r?e.prototype:e),t,i);return 2&r&&"function"==typeof n?function(e){return n.apply(i,e)}:n}function u(){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,i){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=c(e)););return e}(e,t);if(r){var n=Object.getOwnPropertyDescriptor(r,t);return n.get?n.get.call(arguments.length<3?e:i):n.value}}).apply(null,arguments)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}const f=new WeakMap;e.QuickTree=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a(this,t,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(t,r.Quadtree),i=t,u=[{key:"deleteFromAllTrees",value:function(e){f.has(e)&&f.get(e).forEach(t=>t.delete(e))}}],(s=[{key:"add",value:function(e){l(t,"add",this,3)([e])?(f.has(e)||f.set(e,new Set),f.get(e).add(this)):this.parent||console.warn("Failed to add object to QuickTree.")}},{key:"delete",value:function(e){l(t,"delete",this,3)([e])&&f.has(e)&&f.get(e).delete(this)}},{key:"select",value:function(e,i,r,o){const s=new n.Rectangle(e,i,e+r,i+o),a=l(t,"select",this,3)([e,i,r,o]);for(const e of a)s.contains(e.x,e.y)||a.delete(e);return a}}])&&o(i.prototype,s),u&&o(i,u),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,s,u}()}),require.register("math/Ray.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Ray=void 0;var r=t("./Geometry");function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,s(r.key),r)}}function o(e,t,i){return(t=s(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function s(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}let a=e.Ray=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},i=[{key:"cast",value:function(e,t,i,r,n){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:320,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:this.DEFAULT_FLAGS;const a=t+Math.cos(n)*o,l=i+Math.sin(n)*o;return{terrain:this.castTerrain(e,t,i,r,n,o,s),entities:this.castEntity(e,t,i,a,l,s)}}},{key:"castEntity",value:function(e,t,i,n,o){arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.DEFAULT_FLAGS;const s=.5*(t+n),a=.5*(i+o),l=Math.max(320,Math.abs(t-n)),u=Math.max(320,Math.abs(i-o)),c=e.getEntitiesForRect(s,a,l,u),h=new Map;for(const e of c){const s=e.rect.toLines();for(let a=0;a<s.length;a+=4){const l=s[a+0],u=s[a+1],c=s[a+2],f=s[a+3],d=r.Geometry.lineIntersectsLine(l,u,c,f,t,i,n,o);if(d)if(h.has(e)){const r=h.get(e);Math.hypot(t-d[0],i-d[1])<Math.hypot(t-r[0],i-r[1])&&h.set(e,d)}else h.set(e,d)}}return h}},{key:"castTerrain",value:function(e,t,i,r,n){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:320,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:this.DEFAULT_FLAGS;o=Math.ceil(o);const a=Math.cos(n),l=Math.sin(n),u=t+(Math.abs(a)>Number.EPSILON?a:0)*o,c=i+(Math.abs(l)>Number.EPSILON?l:0)*o,h=u-t,f=c-i,d=Math.sign(h),p=Math.sign(f),v=h?Math.hypot(1,f/h):0,m=f?Math.hypot(1,h/f):0;let y=0;if(e.getSolid(t,i,r))return[t,i];const b=null===e.getCollisionTile(t,i,r)?0:1;let g=b,w=b,x=!1,T=!1,_=1;let P=b?0:d>0?32-t%32:t%32+1,E=b?0:p>0?32-i%32:i%32+1,S=P*v*d,j=E*m*p;const O=new Set,C=new Set;window.logPoints&&console.time("rayCast");for(;Math.abs(y)<o&&!O.size&&!C.size;){if(d&&(!p||Math.abs(S)<Math.abs(j))){const n=Math.abs(S);let o=t+n*a,s=i+n*l;if(d>=0&&o%1>.99999&&(o=Math.round(o)),p>=0&&s%1>.99999&&(s=Math.round(s)),d<=0&&o%1<1e-5&&(o=Math.round(o)),p<=0&&s%1<1e-5&&(s=Math.round(s)),x=g,_=(g=e.getCollisionTile(o,s,r))?1:32,!g&&x&&(_=d<0?(t+-P+1)%32:32-(t+P)%32),e.getSolid(o,s,r)){O.add([o,s]);break}y=Math.abs(S),S=(P+=_)*v*d}else{const n=Math.abs(j);let o=t+n*a,s=i+n*l;if(d>=0&&o%1>.99999&&(o=Math.round(o)),p>=0&&s%1>.99999&&(s=Math.round(s)),d<=0&&o%1<1e-5&&(o=Math.round(o)),p<=0&&s%1<1e-5&&(s=Math.round(s)),T=w,_=(w=e.getCollisionTile(o,s,r))?1:32,!w&&T&&(_=p<0?(i+-E+1)%32:32-(i+E)%32),e.getSolid(o,s,r)){C.add([o,s]);break}y=Math.abs(j),j=(E+=_)*m*p}0}const R=[...O,...C];if(s&this.ALL_POINTS)return new O.union(C);const k=R.map(e=>Math.pow(e[0]-t,2)+Math.pow(e[1]-i,2)),M=Math.min(...k),B=R[k.indexOf(M)];return B&&(d>0&&B[0]%1>.99999&&(B[0]=Math.round(B[0])),d<0&&B[0]%1<1e-5&&(B[0]=Math.round(B[0])),p>0&&B[1]%1>.99999&&(B[1]=Math.round(B[1])),p<0&&B[1]%1<1e-5&&(B[1]=Math.round(B[1]))),Math.sqrt(M)>o?void 0:s&this.T_LAST_EMPTY?[B[0]+-a*Math.sign(S),B[1]+-l*Math.sign(j)]:B}}],(t=null)&&n(e.prototype,t),i&&n(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}();o(a,"T_LAST_EMPTY",1),o(a,"T_ALL_POINTS",2),o(a,"DEFAULT_FLAGS",0)}),require.register("math/Rectangle.js",function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,n(r.key),r)}}function n(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Rectangle=void 0;e.Rectangle=function(){return e=function e(t,i,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x1=t,this.y1=i,this.x2=r,this.y2=n},(t=[{key:"contains",value:function(e,t){return!(e<this.x1||e>this.x2)&&!(t<this.y1||t>this.y2)}},{key:"isOverlapping",value:function(e){return!(this.x1>=e.x2||this.x2<=e.x1)&&!(this.y1>=e.y2||this.y2<=e.y1)}},{key:"isFlushWith",value:function(e){return!(this.x1>e.x2||e.x1>this.x2)&&(!(this.y1>e.y2||e.y1>this.y2)&&(this.x1===e.x2||e.x1===this.x2||(this.y1===e.y2||e.y1===this.y2||void 0)))}},{key:"intersection",value:function(e){if(this.isOverlapping(e))return new this.constructor(Math.max(this.x1,e.x1),Math.max(this.y1,e.y1),Math.min(this.x2,e.x2),Math.min(this.y2,e.y2))}},{key:"isInside",value:function(e){return this.x1>=e.x1&&this.y1>=e.y1&&this.x2<=e.x2&&this.y2<=e.y2}},{key:"isOutside",value:function(e){return e.isInside(this)}},{key:"toLines",value:function(){return[this.x1,this.y1,this.x2,this.y1,this.x2,this.y1,this.x2,this.y2,this.x1,this.y2,this.x2,this.y2,this.x1,this.y1,this.x1,this.y2]}},{key:"toTriangles",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;return 2===e?[this.x1,this.y1,this.x2,this.y1,this.x1,this.y2,this.x1,this.y2,this.x2,this.y1,this.x2,this.y2]:3===e?[this.x1,this.y1,1,this.x2,this.y1,1,this.x1,this.y2,1,this.x1,this.y2,1,this.x2,this.y1,1,this.x2,this.y2,1]:4===e?[this.x1,this.y1,0,1,this.x2,this.y1,0,1,this.x1,this.y2,0,1,this.x1,this.y2,0,1,this.x2,this.y1,0,1,this.x2,this.y2,0,1]:[this.x1,this.y1,...e>2?Array(-2+e).fill(0):[],this.x2,this.y1,...e>2?Array(-2+e).fill(0):[],this.x1,this.y2,...e>2?Array(-2+e).fill(0):[],this.x1,this.y2,...e>2?Array(-2+e).fill(0):[],this.x2,this.y1,...e>2?Array(-2+e).fill(0):[],this.x2,this.y2,...e>2?Array(-2+e).fill(0):[]]}}])&&r(e.prototype,t),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}()}),require.register("math/SMTree.js",function(e,t,i){"use strict";function r(e,t,i){return(t=a(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,a(r.key),r)}}function s(e,t,i){return t&&o(e.prototype,t),i&&o(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.SMTree=void 0;const l=Symbol("depth");let u=function(){function e(t,i,o){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;n(this,e),this.start=t,this.end=i,this.depth=a,this.dimension=s,this.size=0,this.rectangles=new Set,this.subTree=a<1?new h(r({dimension:s},l,1+a)):null,this.prev=o}return s(e,[{key:"split",value:function(t){if(t<this.start||t>this.end)throw new RangeError("Splitting segment out of bounds!");if(t===this.start)return[this];if(t===this.end)return[this];const i=new e(this.start,t,this.prev,this.dimension,this.depth),r=new e(t,this.end,i,this.dimension,this.depth);for(const e of this.rectangles){const n=0===this.depth?e.x1:e.y1;(0===this.depth?e.x2:e.y2)<t?i.add(e):n>t?r.add(e):(i.add(e),r.add(e))}return[i,r]}},{key:"add",value:function(e){Object.freeze(e),this.subTree&&this.subTree.add(e),this.rectangles.add(e),this.size=this.rectangles.size}},{key:"delete",value:function(e){return this.subTree&&this.subTree.delete(e),this.rectangles.delete(e),this.size=this.rectangles.size,!this.rectangles.size&&this.start>-1/0}}])}();const c=e=>"x1"in e&&"y1"in e&&"x2"in e&&"y2"in e&&e.x1<e.x2&&e.y1<e.y2;let h=e.SMTree=function(){return s(function e(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r({dimension:2},l,0);n(this,e),this.depth=t[l],this.dimension=t.dimension,this.segments=[new u(-1/0,1/0,null,this.dimension,this.depth)]},[{key:"add",value:function(e){if(!c(e))throw new Error("Object supplied is not a Rectangle. Must have properties: x1, y1, x2, y2.");const t=0===this.depth?e.x1:e.y1,i=0===this.depth?e.x2:e.y2,r=this.findSegment(t);this.splitSegment(r,t);const n=this.findSegment(i);if(this.splitSegment(n,i),r!==n)for(let t=1+r;t<=n;t++)this.segments[t].add(e);else this.segments[r].add(e)}},{key:"delete",value:function(e){if(!c(e))throw new Error("Object supplied is not a Rectangle. Must have properties: x1, y1, x2, y2.");const t=0===this.depth?e.x1:e.y1,i=0===this.depth?e.x2:e.y2,r=this.findSegment(t),n=this.findSegment(i),o=[];for(let t=r;t<=n;t++)t>0&&this.segments[t].delete(e)&&o.push(t);for(let e=-1+o.length;e>=0;e--){const t=o[e];if(!this.segments[-1+t])throw new Error("Cannot delete segment without predecessor.");this.segments[-1+t].end=this.segments[t].end,this.segments[1+t].prev=this.segments[-1+t],this.segments.splice(t,1)}2===this.segments.length&&0==this.segments[0].size&&0===this.segments[1].size&&(this.segments[0].end=this.segments[1].end,this.segments.length=1)}},{key:"query",value:function(e,t,i,r){const n=new Set,o=this.findSegment(e),s=this.findSegment(i);for(let e=o;e<=s;e++){const i=this.segments[e];if(!i.subTree)continue;const o=i.subTree.findSegment(t),s=i.subTree.findSegment(r);for(let e=o;e<=s;e++)for(const t of i.subTree.segments[e].rectangles)n.add(t)}return n}},{key:"splitSegment",value:function(e,t){if(t<=this.segments[e].start||t>=this.segments[e].end)return;const i=this.segments[e].split(t);this.segments.splice(e,1,...i)}},{key:"findSegment",value:function(e){let t=0,i=-1+this.segments.length;do{const r=Math.floor(.5*(t+i)),n=this.segments[r];if(n.start<e&&n.end>=e)return r;n.start<e&&(t=1+r),n.end>e&&(i=-1+r)}while(t<=i);return-1}}])}()}),require.register("math/Split.js",function(e,t,i){"use strict";var r;function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,s(r.key),r)}}function o(e,t,i){return(t=s(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function s(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Split=void 0;let a=e.Split=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},i=[{key:"intToBytes",value:function(e){return this.value[0]=e,[...this.bytes]}},{key:"bytesToInt",value:function(e){return this.bytes[0]=e[0],this.bytes[1]=e[1],this.bytes[2]=e[2],this.bytes[3]=e[3],this.value[0]}},{key:"bytesToInt3",value:function(e){return this.bytes[0]=e[0],this.bytes[1]=e[1],this.bytes[2]=e[2],this.bytes[3]=0,this.value[0]}}],(t=null)&&n(e.prototype,t),i&&n(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}();r=a,o(a,"bytes",new Uint8ClampedArray(4)),o(a,"words",new Uint16Array(r.bytes.buffer)),o(a,"value",new Uint32Array(r.bytes.buffer))}),require.register("model/BalllController.js",function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,n(r.key),r)}}function n(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.BallController=void 0;let o=e.BallController=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},(t=[{key:"onCreate",value:function(e,t){e.xSpeed=0,e.ySpeed=0,e.height=32,e.width=32}},{key:"simulate",value:function(e){const t=e.session.world;if(e.xSpeed||e.ySpeed){let i=e.xSpeed,r=e.ySpeed;const n=t.castTerrainRay(t,e.x+0,e.y+-16,0,e.xSpeed<0?Math.PI:0,Math.abs(e.xSpeed)+16,1),o=t.castTerrainRay(t,e.x+0,e.y+-16,0,.5*Math.PI*Math.sign(e.ySpeed),Math.abs(e.ySpeed)+16,1);if(n){i=n[0]-e.x+-16*Math.sign(e.xSpeed),e.xSpeed=-e.xSpeed}if(o){r=o[1]-(e.y+-16)+-16*Math.sign(e.ySpeed),e.ySpeed=-e.ySpeed}e.x+=i,e.y+=r}else{const t=2*Math.PI*Math.random(),i=6;e.xSpeed=Math.cos(t)*i,e.ySpeed=Math.sin(t)*i}}}])&&r(e.prototype,t),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}();var s,a,l;s=o,l="./sphere.png",(a=n(a="spriteImage"))in s?Object.defineProperty(s,a,{value:l,enumerable:!0,configurable:!0,writable:!0}):s[a]=l}),require.register("model/BarrelController.js",function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,n(r.key),r)}}function n(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.BarrelController=void 0;let o=e.BarrelController=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},(t=[{key:"onCreate",value:function(e,t){e.xSpeed=0,e.ySpeed=0,e.height=48,e.width=32,e.grounded=!0,e.ySpriteOffset=6}},{key:"simulate",value:function(e){const t=e.session.world;for(t.getSolid(e.x,e.y+1)?(e.ySpeed=Math.min(0,e.ySpeed),e.grounded=!0):(e.ySpeed=Math.min(8,e.ySpeed+.5),e.grounded=!1),t.getSolid(e.x,e.y)&&!t.getSolid(e.x,e.y-1)&&(e.ySpeed=0,e.y--);t.getSolid(e.x,e.y+-e.height)&&!t.getSolid(e.x,e.y);)e.ySpeed=0,e.y++;for(;t.getSolid(e.x+.5*-e.width,e.y+-8)&&!t.getSolid(e.x+.5*e.width,e.y+-8);)e.xSpeed=0,e.x++;for(;t.getSolid(e.x+.5*e.width,e.y+-8)&&!t.getSolid(e.x-.5*e.width,e.y+-8);)e.xSpeed=0,e.x--;if(e.xSpeed||e.ySpeed){const i=Math.atan2(e.ySpeed,e.xSpeed),r=Math.hypot(e.ySpeed,e.xSpeed),n=t.castRay(e.x,e.y,0,i,r,1);let o=e.xSpeed,s=e.ySpeed;if(n.terrain){const t=Math.hypot(e.x-n.terrain[0],e.y-n.terrain[1]);o=Math.cos(i)*t,s=Math.sin(i)*t}e.x+=o,e.y+=s}}}])&&r(e.prototype,t),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}();var s,a,l;s=o,l="/barrel.png",(a=n(a="spriteImage"))in s?Object.defineProperty(s,a,{value:l,enumerable:!0,configurable:!0,writable:!0}):s[a]=l}),require.register("model/Entity.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Entity=void 0;var r=t("curvature/base/Bindable"),n=t("../math/Rectangle"),o=t("../sprite/Sprite");function s(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,a(r.key),r)}}function a(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}e.Entity=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);const i=t.controller,s=t.session,a=t.inputManager,l=t.sprite,u=t.x,c=void 0===u?0:u,h=t.y,f=void 0===h?0:h,d=t.width,p=void 0===d?32:d,v=t.height,m=void 0===v?32:v;this[r.Bindable.Prevent]=!0,this.controller=i,this.sprite=l||new o.Sprite({session:s,src:"/thing.png",width:32,height:32}),this.inputManager=a,this.session=s,this.x=c,this.y=f,this.xSpriteOffset=0,this.ySpriteOffset=0,this.width=p,this.height=m,this.rect=new n.Rectangle(c-.5*p,f-m,c+.5*p,f),i&&i.onCreate(this,t)},(t=[{key:"simulate",value:function(){this.controller&&this.controller.simulate(this),this.rect.x1=this.x-.5*this.width,this.rect.x2=this.x+.5*this.width,this.rect.y1=this.y-this.height,this.rect.y2=this.y,this.sprite.x=this.x+this.xSpriteOffset,this.sprite.y=this.y+this.ySpriteOffset,this.fixFPE()}},{key:"destroy",value:function(){this.controller&&controller.destroy(this)}},{key:"fixFPE",value:function(){this.x%1>.99999&&(this.x=Math.round(this.x)),this.y%1>.99999&&(this.y=Math.round(this.y)),this.x%1<1e-5&&(this.x=Math.round(this.x)),this.y%1<1e-5&&(this.y=Math.round(this.y))}}])&&s(e.prototype,t),i&&s(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}()}),require.register("model/InputManager.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.InputManager=void 0;var r=t("curvature/base/Bindable");function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,s(r.key),r)}}function o(e,t,i){return(t=s(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function s(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}e.InputManager=function(){return e=function e(t){let i=t.keyboard,n=t.onScreenJoyPad;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o(this,"triggers",r.Bindable.makeBindable({})),o(this,"axis",r.Bindable.makeBindable({})),i.keys.bindTo((e,t,i,r)=>{e>0?this.keyPress(t,e,i[t]):-1!==e||this.keyRelease(t,e,i[t])}),n.args.bindTo("x",e=>{this.axis[0]=e/50}),n.args.bindTo("y",e=>{this.axis[1]=e/50})},(t=[{key:"keyPress",value:function(e,t,i){if(/^[0-9]$/.test(e))this.triggers[e]=!0;else switch(e){case"ArrowRight":this.axis[0]=1;break;case"ArrowDown":this.axis[1]=1;break;case"ArrowLeft":this.axis[0]=-1;break;case"ArrowUp":this.axis[1]=-1;break;case" ":this.triggers[0]=!0}}},{key:"keyRelease",value:function(e,t,i){if(/^[0-9]$/.test(e))this.triggers[e]=!1;else switch(e){case"ArrowRight":this.axis[0]>0&&(this.axis[0]=0),this.axis[0]=0;case"ArrowLeft":this.axis[0]<0&&(this.axis[0]=0);break;case"ArrowDown":this.axis[1]>0&&(this.axis[1]=0);case"ArrowUp":this.axis[1]<0&&(this.axis[1]=0);break;case" ":this.triggers[0]=!1}}}])&&n(e.prototype,t),i&&n(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}()}),require.register("model/PlayerController.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PlayerController=void 0;var r=t("../math/Ray");function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,o(r.key),r)}}function o(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}let s=e.PlayerController=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},(t=[{key:"onCreate",value:function(e,t){e.direction="south",e.state="standing",e.xSpeed=0,e.ySpeed=0,e.grounded=!0,e.xDirection=0,e.ySpriteOffset=1}},{key:"simulate",value:function(e){"jumping"===e.state?e.height=24:e.height=48;const t=e.inputManager&&Math.min(1,Math.max(e.inputManager.axes[0].magnitude||0,-1))||0,i=(e.inputManager&&Math.min(1,Math.max(e.inputManager.axes[1].magnitude||0,-1)),e.session.world);for(i.getSolid(e.x,e.y+1)?e.ySpeed>=0&&(e.ySpeed=Math.min(0,e.ySpeed),e.grounded=!0):(e.ySpeed=Math.min(8,e.ySpeed+.5),e.grounded=!1),t?(e.xDirection=Math.sign(t),i.getSolid(e.x+Math.sign(t)*e.width*.5+Math.sign(t),e.y)||(e.xSpeed+=t*(e.grounded?.2:.4)),Math.abs(e.xSpeed)>8&&(e.xSpeed=8*Math.sign(e.xSpeed)),e.grounded&&t&&Math.sign(t)!==Math.sign(e.xSpeed)&&(e.xSpeed*=.75)):e.grounded?e.xSpeed*=.9:e.xSpeed*=.99,i.getSolid(e.x,e.y)&&!i.getSolid(e.x,e.y+-e.height)&&(e.ySpeed=0,e.y--);i.getSolid(e.x,e.y+-e.height)&&!i.getSolid(e.x,e.y);)e.ySpeed=0,e.y++;for(;i.getSolid(e.x+.5*-e.width,e.y+-8)&&!i.getSolid(e.x+.5*e.width,e.y+-8);)e.xSpeed=0,e.x++;for(;i.getSolid(e.x+.5*e.width,e.y+-8)&&!i.getSolid(e.x-.5*e.width,e.y+-8);)e.xSpeed=0,e.x--;if(e.xSpeed||e.ySpeed){const t=Math.atan2(e.ySpeed,e.xSpeed),n=Math.hypot(e.ySpeed,e.xSpeed),o=r.Ray.cast(i,e.x,e.y,0,t,n,r.Ray.T_LAST_EMPTY);let s=e.xSpeed,a=e.ySpeed;if(o.terrain){const i=Math.hypot(e.x-o.terrain[0],e.y-o.terrain[1]);s=Math.cos(t)*i,a=Math.sin(t)*i}e.x+=s,e.y+=a}e.grounded&&(e.state=t?"walking":"standing",t<0?e.direction="west":t>0&&(e.direction="east")),e.grounded&&e.inputManager.buttons[0]&&1===e.inputManager.buttons[0].time&&(e.grounded=!1,e.state="jumping",e.ySpeed=-10),e.sprite.changeAnimation(`${e.state}-${e.direction}`)}}])&&n(e.prototype,t),i&&n(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}();var a,l,u;a=s,u="/player.tsj",(l=o(l="spriteSheet"))in a?Object.defineProperty(a,l,{value:u,enumerable:!0,configurable:!0,writable:!0}):a[l]=u}),require.register("model/Spawner.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Spawner=void 0;var r=t("../sprite/SpriteSheet"),n=t("../sprite/Sprite"),o=t("./Entity");function s(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)}return i}function a(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?s(Object(i),!0).forEach(function(t){l(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):s(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function l(e,t,i){return(t=c(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function u(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,c(r.key),r)}}function c(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function h(e,t,i){return t=d(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,i||[],d(e).constructor):t.apply(e,i))}function f(){return(f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,i){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=d(e)););return e}(e,t);if(r){var n=Object.getOwnPropertyDescriptor(r,t);return n.get?n.get.call(arguments.length<3?e:i):n.value}}).apply(null,arguments)}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}e.Spawner=function(e){function t(e){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=h(this,t,[e])).entityData=e,i.spawnType=e.spawnType,i.spawnClass=e.spawnClass,i.session=e.session,i.i=0,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&p(e,t)}(t,o.Entity),i=t,(s=[{key:"simulate",value:function(){const e=a({},this.entityData),i=this.entityData.spawnClass,s=new i;e.sprite||(i.spriteSheet?e.sprite=new n.Sprite({session:e.session,spriteSheet:new r.SpriteSheet({source:i.spriteSheet})}):i.spriteImage&&(e.sprite=new n.Sprite({session:e.session,src:e.spawnClass.spriteImage})));const l=new o.Entity(a(a({},e),{},{controller:s,session:this.session,x:this.x,y:this.y}));var u,c,h,p,v;this.session.addEntity(l),this.session.removeEntity(this),(u=t,c="simulate",h=this,v=f(d(1&(p=3)?u.prototype:u),c,h),2&p&&"function"==typeof v?function(e){return v.apply(h,e)}:v)([])}}])&&u(i.prototype,s),l&&u(i,l),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,s,l}()}),require.register("overlay/overlay.frag",function(e,t,i){i.exports="precision mediump float;\n\nuniform vec4 u_color;\nvarying vec2 v_texCoord;\n\nvoid main() {\n  // gl_FragColor = texture2D(u_image, v_texCoord);\n  gl_FragColor = vec4(1.0, 1.0, 0.0, 0.25);\n}\n"}),require.register("overlay/overlay.vert",function(e,t,i){i.exports="attribute vec2 a_position;\nattribute vec2 a_texCoord;\n\nuniform vec2 u_resolution;\nvarying vec2 v_texCoord;\n\nvoid main()\n{\n  vec2 zeroToOne = a_position / u_resolution;\n  vec2 zeroToTwo = zeroToOne * 2.0;\n  vec2 clipSpace = zeroToTwo - 1.0;\n\n  gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n  v_texCoord  = a_texCoord;\n}\n"}),require.register("session/Session.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Session=void 0;var r=t("../math/QuickTree"),n=t("../sprite/SpriteBoard"),o=t("../sprite/SpriteSheet"),s=t("../sprite/Sprite"),a=t("../model/Entity"),l=t("../sprite/Camera"),u=t("../world/World"),c=t("../input/Controller"),h=t("../world/EntityPallet"),f=t("../model/PlayerController"),d=t("../model/BalllController"),p=t("../model/BarrelController");function v(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,m(r.key),r)}}function m(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}h.EntityPallet.register("@basic-platformer",f.PlayerController),h.EntityPallet.register("@barrel",p.BarrelController),h.EntityPallet.register("@ball",d.BallController);e.Session=function(){return e=function e(t){let i=t.element,r=t.world,o=t.keyboard,s=t.onScreenJoyPad;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fThen=0,this.sThen=0,this.frameLock=60,this.simulationLock=60,this.entities=new Set,this.removed=new WeakSet,this.paused=!1,this.loaded=!1,this.world=new u.World({source:new URL(r,location).href,session:this}),this.spriteBoard=new n.SpriteBoard({element:i,world:this.world,session:this}),this.keyboard=o,this.world.ready.then(()=>this.initialize({keyboard:o,onScreenJoyPad:s})),this.controller=new c.Controller({deadZone:.2}),this.controller.zero(),this.gamepad=null,window.addEventListener("gamepadconnected",e=>{console.log(e),this.gamepad=e.gamepad}),window.addEventListener("gamepaddisconnected",e=>{this.gamepad&&(this.gamepad=null)})},(t=[{key:"initialize",value:async function(){this.loaded=!0;for(const e of this.world.maps){if(!e.properties["player-start"])continue;const t=e.properties["player-start"],i=e.entityDefs[t],r=await h.EntityPallet.resolve(i.type),n=this.player=new a.Entity({controller:new r,session:this,x:i.x,y:i.y,inputManager:this.controller,sprite:new s.Sprite({session:this,spriteSheet:new o.SpriteSheet({source:"/player.tsj"}),width:32,height:48}),camera:l.Camera});this.spriteBoard.following=n,this.addEntity(n)}}},{key:"addEntity",value:function(e){if(this.entities.has(e))return;this.entities.add(e),this.spriteBoard.sprites.add(e.sprite),this.world.getMapsForPoint(e.x,e.y).forEach(t=>t.quadTree.add(e))}},{key:"removeEntity",value:function(e){this.entities.delete(e),this.spriteBoard.sprites.delete(e.sprite),r.QuickTree.deleteFromAllTrees(e),this.removed.add(e)}},{key:"simulate",value:function(e){if(!this.loaded)return!1;const t=e-this.sThen;if(0==this.simulationLock||.2+t<1e3/this.simulationLock)return!1;if(this.sThen=e,this.keyboard.update(),this.controller.update({gamepad:this.gamepad}),this.controller.readInput({gamepads:navigator.getGamepads(),keyboard:this.keyboard}),this.controller.buttons[1020]&&1===this.controller.buttons[1020].time&&(this.paused=!this.paused),this.paused||!this.player)return!1;this.entities.forEach(e=>e.sprite.visible=!1);const i=this.player,r=this.world.getEntitiesForRect(i.x,i.y,1*l.Camera.width+64,1*l.Camera.height+64);return r.delete(i),r.add(i),r.forEach(e=>{e.simulate(t),this.world.getMapsForRect(e.x,e.y,100,100).forEach(t=>this.removed.has(e)||t.quadTree.move(e)),e.sprite.visible=!0}),!0}},{key:"draw",value:function(e){if(!this.loaded)return;const t=e-this.fThen;return!(0==this.frameLock||.2+t<1e3/this.frameLock)&&(this.spriteBoard.draw(t),this.fThen=e,!0)}}])&&v(e.prototype,t),i&&v(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}()}),require.register("sprite/Camera.js",function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,o(r.key),r)}}function n(e,t,i){return(t=o(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function o(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Camera=void 0;let s=e.Camera=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)});n(s,"x",0),n(s,"y",0),n(s,"width",0),n(s,"height",0)}),require.register("sprite/MapRenderer.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MapRenderer=void 0;var r=t("curvature/base/Bindable");function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,o(r.key),r)}}function o(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}e.MapRenderer=function(){return e=function e(t){let i=t.spriteBoard,n=t.map;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this[r.Bindable.Prevent]=!0,this.spriteBoard=i,this.loaded=!1,this.map=n,this.width=0,this.height=0,this.tileWidth=0,this.tileHeight=0,this.xOffset=0,this.yOffset=0;const o=this.spriteBoard.gl2d.context;this.tileMapping=this.spriteBoard.gl2d.createTexture(1,1),this.tileTexture=this.spriteBoard.gl2d.createTexture(1,1);const s=()=>parseInt(255*Math.random());new Uint8Array([s(),s(),s(),255]);n.ready.then(()=>{this.loaded=!0,this.tileWidth=n.tileWidth,this.tileHeight=n.tileHeight,o.bindTexture(o.TEXTURE_2D,this.tileTexture),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,n.tileSetWidth,n.tileSetHeight,0,o.RGBA,o.UNSIGNED_BYTE,n.pixels),o.bindTexture(o.TEXTURE_2D,null)})},(t=[{key:"negSafeMod",value:function(e,t){return e>=0?e%t:(t+e%t)%t}},{key:"draw",value:function(){if(!this.loaded)return;const e=this.spriteBoard.gl2d.context,t=this.spriteBoard.following.sprite.x,i=this.spriteBoard.following.sprite.y,r=this.spriteBoard.zoomLevel,n=.5*this.tileWidth,o=.5*this.tileHeight,s=Math.floor(this.width/this.tileWidth),a=Math.floor(this.height/this.tileHeight),l=64*Math.floor(Math.floor(.5*this.width/64)+0),u=64*Math.floor(Math.floor(.5*this.height/64)+0),c=(t+n)/this.tileWidth+-this.negSafeMod(t+n,64)/this.tileWidth+-this.map.xWorld/this.tileWidth+-l/this.tileWidth,h=(i+o)/this.tileHeight+-this.negSafeMod(i+o,64)/this.tileHeight+-this.map.yWorld/this.tileHeight+-u/this.tileHeight;if(c+s<0||h+a<0)return;const f=r*(.5*(this.width+this.xOffset)-this.negSafeMod(t+n,64)-l),d=r*(.5*(this.height+this.yOffset)-this.negSafeMod(i+o,64)-u);this.spriteBoard.drawProgram.uniformF("u_size",this.width,this.height),this.spriteBoard.drawProgram.uniformF("u_tileSize",this.tileWidth,this.tileHeight),this.spriteBoard.drawProgram.uniformF("u_mapTextureSize",this.map.tileSetWidth,this.map.tileSetHeight),this.spriteBoard.drawProgram.uniformI("u_renderTiles",1),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,this.tileTexture),this.spriteBoard.drawProgram.uniformI("u_tiles",2),e.activeTexture(e.TEXTURE3),e.bindTexture(e.TEXTURE_2D,this.tileMapping),this.spriteBoard.drawProgram.uniformI("u_tileMapping",3);const p=this.map.getSlice(c,h,s,a,performance.now()/1e3);for(const t of p)e.texImage2D(e.TEXTURE_2D,0,e.RGBA,s,a,0,e.RGBA,e.UNSIGNED_BYTE,t),this.setRectangle(f+.5*this.tileWidth*r,d+this.tileHeight*r,this.width*r,this.height*r),e.bindFramebuffer(e.FRAMEBUFFER,this.spriteBoard.drawBuffer),e.drawArrays(e.TRIANGLES,0,6);this.spriteBoard.drawProgram.uniformI("u_renderTiles",0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE3),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,null)}},{key:"resize",value:function(e,t){this.width=e+0,this.height=t+0,this.width=128*Math.ceil(e/128)+128,this.height=128*Math.ceil(t/128)+128,this.xOffset=e-this.width,this.yOffset=t-this.height}},{key:"simulate",value:function(){}},{key:"setRectangle",value:function(e,t,i,r){const n=this.spriteBoard.gl2d.context;n.bindBuffer(n.ARRAY_BUFFER,this.spriteBoard.drawProgram.buffers.a_texCoord),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),n.STATIC_DRAW);const o=e,s=e+i,a=t,l=t+r;n.bindBuffer(n.ARRAY_BUFFER,this.spriteBoard.drawProgram.buffers.a_position),n.bufferData(n.ARRAY_BUFFER,new Float32Array([o,l,s,l,o,a,o,a,s,l,s,a]),n.STATIC_DRAW)}}])&&n(e.prototype,t),i&&n(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}()}),require.register("sprite/Parallax.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Parallax=void 0;var r=t("curvature/base/Bindable");function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,l(r.key),r)}}function o(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t,i){return(t=l(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function l(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}let u=o(function e(){s(this,e),a(this,"texture",null),a(this,"width",0),a(this,"height",0),a(this,"offset",0),a(this,"parallax",0)});e.Parallax=function(){return o(function e(t){let i=t.spriteBoard,n=t.map;s(this,e),this[r.Bindable.Prevent]=!0,this.spriteBoard=i;this.spriteBoard.gl2d.context;this.map=n,this.texture=null,this.height=0,this.slices=["parallax/mountains-0.png","parallax/sky-0-recolor.png","parallax/sky-1-recolor.png","parallax/sky-1b-recolor.png","parallax/sky-2-recolor.png"],this.parallaxLayers=[],this.textures=[],this.ready=n.ready.then(()=>this.assemble(n)).then(()=>{this.loaded=!0}),this.loaded=!1,this.x=0,this.y=0},[{key:"assemble",value:function(){const e=this.spriteBoard.gl2d.context,t=this.map.imageLayers.map((t,i)=>this.constructor.loadImage(t.image).then(r=>{var n,o;const s=this.textures[i]=e.createTexture(),a=this.parallaxLayers[i]=new u,l=r.height+t.offsety;this.height<l&&(this.height=l),a.texture=s,a.width=r.width,a.height=r.height,a.offset=null!==(n=t.offsety)&&void 0!==n?n:0,a.parallax=null!==(o=t.parallaxx)&&void 0!==o?o:1,e.bindTexture(e.TEXTURE_2D,s),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST)}));return Promise.all(t)}},{key:"draw",value:function(){if(!this.loaded)return;const e=this.spriteBoard.gl2d.context,t=this.spriteBoard.zoomLevel;this.x=this.spriteBoard.following.sprite.x+-this.spriteBoard.width/t*.5,this.y=this.spriteBoard.following.sprite.y,this.spriteBoard.drawProgram.uniformI("u_renderParallax",1),this.spriteBoard.drawProgram.uniformF("u_scroll",this.x,this.y),e.activeTexture(e.TEXTURE0);for(const i of this.parallaxLayers)e.bindTexture(e.TEXTURE_2D,i.texture),this.spriteBoard.drawProgram.uniformF("u_size",i.width,i.width),this.spriteBoard.drawProgram.uniformF("u_parallax",i.parallax,0),this.setRectangle(0,this.spriteBoard.height+(-this.height+i.offset)*t,i.width*t,i.height*t,i.width),e.bindFramebuffer(e.FRAMEBUFFER,this.spriteBoard.drawBuffer),e.drawArrays(e.TRIANGLES,0,6);this.spriteBoard.drawProgram.uniformI("u_renderParallax",0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindTexture(e.TEXTURE_2D,null)}},{key:"setRectangle",value:function(e,t,i,r){const n=this.spriteBoard.gl2d.context,o=this.spriteBoard.width/i;n.bindBuffer(n.ARRAY_BUFFER,this.spriteBoard.drawProgram.buffers.a_texCoord),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,0,o,0,0,1,0,1,o,0,o,1]),n.STATIC_DRAW);const s=e-0,a=e+this.spriteBoard.width,l=t,u=t+r;n.bindBuffer(n.ARRAY_BUFFER,this.spriteBoard.drawProgram.buffers.a_position),n.bufferData(n.ARRAY_BUFFER,new Float32Array([s,u,a,u,s,l,s,l,a,u,a,l]),n.STATIC_DRAW)}}],[{key:"loadImage",value:function(e){return this.imagePromises||(this.imagePromises={}),this.imagePromises[e]?this.imagePromises[e]:(this.imagePromises[e]=new Promise((t,i)=>{const r=new Image;r.src=e,r.addEventListener("load",e=>{t(r)})}),this.imagePromises[e])}}])}()}),require.register("sprite/Sprite.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Sprite=void 0;var r=t("curvature/base/Bindable"),n=t("./SpriteSheet"),o=t("../math/Matrix"),s=t("./Camera");function a(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,l(r.key),r)}}function l(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}e.Sprite=function(){return e=function e(t){let i=t.src,o=t.session,s=t.spriteSheet,a=(t.width,t.height,t.x),l=t.y,u=t.z;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this[r.Bindable.Prevent]=!0,this.x=a||0,this.y=l||0,this.z=u||0,this.currentAnimation=null,this.width=32,this.height=32,this.scale=1,this.visible=!1,this.moving=!1,this.textures=[],this.frames=[],this.currentDelay=0,this.currentFrame=0,this.currentFrames="",this.speed=0,this.maxSpeed=4,this.RIGHT=0,this.DOWN=1,this.LEFT=2,this.UP=3,this.EAST=this.RIGHT,this.SOUTH=this.DOWN,this.WEST=this.LEFT,this.NORTH=this.UP,this.region=[0,0,0,1],this.spriteBoard=o.spriteBoard;const c=this.spriteBoard.gl2d.context;this.texture=c.createTexture(),c.bindTexture(c.TEXTURE_2D,this.texture);const h=()=>parseInt(255*Math.random()),f=new Uint8Array([h(),h(),h(),255]);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,1,1,0,c.RGBA,c.UNSIGNED_BYTE,f),i&&!s&&(s=new n.SpriteSheet({image:i})),this.spriteSheet=s,s&&s.ready.then(()=>{this.width=s.tileWidth,this.height=s.tileHeight,this.texture=this.createTexture(s.getFrame(0));for(let e=0;e<s.tileCount;e++)this.textures[e]=this.createTexture(s.getFrame(e));this.changeAnimation("default")})},(t=[{key:"draw",value:function(e){if(this.currentDelay>0)this.currentDelay-=e;else if(this.currentFrame++,this.spriteSheet&&this.spriteSheet.animations[this.currentAnimation]){const e=this.spriteSheet.animations[this.currentAnimation];this.currentFrame>=e.length&&(this.currentFrame=this.currentFrame%e.length);const t=e[this.currentFrame].tileid,i=this.textures[t];i&&(this.currentDelay=e[this.currentFrame].duration,this.texture=i)}const t=this.spriteBoard.gl2d.context,i=this.spriteBoard.zoomLevel;this.spriteBoard.drawProgram.uniformF("u_region",0,0,0,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.texture),this.setRectangle(this.x*i-s.Camera.x+this.spriteBoard.width/2,this.y*i-s.Camera.y+this.spriteBoard.height/2+-this.height*i,this.width*i,this.height*i),t.bindFramebuffer(t.FRAMEBUFFER,this.spriteBoard.drawBuffer),t.drawArrays(t.TRIANGLES,0,6),this.spriteBoard.drawProgram.uniformF("u_region",...Object.assign(this.region||[0,0,0],{3:1})),t.bindFramebuffer(t.FRAMEBUFFER,this.spriteBoard.effectBuffer),t.drawArrays(t.TRIANGLES,0,6),this.spriteBoard.drawProgram.uniformF("u_region",0,0,0,0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,null)}},{key:"changeAnimation",value:function(e){this.spriteSheet&&this.spriteSheet.animations[e]?this.currentAnimation!==e&&(this.currentAnimation=e,this.currentDelay=0):console.warn(`Animation ${e} not found.`)}},{key:"createTexture",value:function(e){const t=this.spriteBoard.gl2d.context,i=t.createTexture();return t.bindTexture(t.TEXTURE_2D,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,e),t.bindTexture(t.TEXTURE_2D,null),i}},{key:"setRectangle",value:function(e,t,i,r){arguments.length>4&&void 0!==arguments[4]&&arguments[4];const n=this.spriteBoard.gl2d.context,s=this.spriteBoard.zoomLevel;n.bindBuffer(n.ARRAY_BUFFER,this.spriteBoard.drawProgram.buffers.a_texCoord),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),n.STATIC_DRAW);const a=t+32*s,l=e+i,u=t+r+32*s,c=new Float32Array([e,a,l,a,e,u,e,u,l,a,l,u]),h=e+.5*i,f=t+.5*r,d=o.Matrix.transform(c,o.Matrix.composite(o.Matrix.translate(h,f),o.Matrix.translate(-h,-f)));n.bindBuffer(n.ARRAY_BUFFER,this.spriteBoard.drawProgram.buffers.a_position),n.bufferData(n.ARRAY_BUFFER,d,n.STATIC_DRAW)}}])&&a(e.prototype,t),i&&a(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}()}),require.register("sprite/SpriteBoard.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SpriteBoard=void 0;var r=t("curvature/base/Bindable"),n=t("./MapRenderer"),o=t("./Parallax"),s=t("../gl2d/Gl2d"),a=t("./Camera");function l(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,u(r.key),r)}}function u(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}e.SpriteBoard=function(){return e=function e(t){let i=t.element,n=t.world;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this[r.Bindable.Prevent]=!0,this.maps=[],this.world=n,this.sprites=new Set,this.currentMap=null,this.screenScale=1,this.zoomLevel=2,this.mouse={x:null,y:null,clickX:null,clickY:null},this.parallax=null,this.width=i.width,this.height=i.height,a.Camera.width=i.width,a.Camera.height=i.height,this.gl2d=new s.Gl2d(i),this.gl2d.enableBlending();this.renderMode=0,this.drawProgram=this.gl2d.createProgram({vertexShader:this.gl2d.createShader("sprite/texture.vert"),fragmentShader:this.gl2d.createShader("sprite/texture.frag"),attributes:["a_position","a_texCoord"],uniforms:["u_image","u_effect","u_tiles","u_tileMapping","u_size","u_scale","u_scroll","u_stretch","u_tileSize","u_resolution","u_mapTextureSize","u_region","u_parallax","u_time","u_renderTiles","u_renderParallax","u_renderMode"]}),this.drawProgram.use(),this.colorLocation=this.drawProgram.uniforms.u_color,this.tilePosLocation=this.drawProgram.uniforms.u_tileNo,this.regionLocation=this.drawProgram.uniforms.u_region,this.drawLayer=this.gl2d.createTexture(1e3,1e3),this.effectLayer=this.gl2d.createTexture(1e3,1e3),this.drawBuffer=this.gl2d.createFramebuffer(this.drawLayer),this.effectBuffer=this.gl2d.createFramebuffer(this.effectLayer),document.addEventListener("mousemove",e=>{this.mouse.x=e.clientX,this.mouse.y=e.clientY}),this.mapRenderers=new Map,this.following=null},(t=[{key:"draw",value:function(e){if(this.following){a.Camera.x=(16+this.following.sprite.x)*this.zoomLevel||0,a.Camera.y=(16+this.following.sprite.y)*this.zoomLevel||0;const e=[...this.world.getMapsForPoint(this.following.x,this.following.y)];if(e[0]&&this.currentMap!==e[0]){const t=this.nextParallax=new o.Parallax({spriteBoard:this,map:e[0]});this.nextParallax.ready.then(()=>{this.nextParallax===t&&(this.parallax=t)}),this.currentMap=e[0]}const t=this.world.getMapsForRect(this.following.sprite.x,this.following.sprite.y,a.Camera.width,a.Camera.height),i=new Set;t.forEach(e=>{if(e.visible=!0,this.mapRenderers.has(e))return void i.add(this.mapRenderers.get(e));const t=new n.MapRenderer({spriteBoard:this,map:e});i.add(t),t.resize(a.Camera.width,a.Camera.height),this.mapRenderers.set(e,t)}),new Set(this.mapRenderers.keys()).difference(t).forEach(e=>{this.mapRenderers.delete(e),e.visible=!1})}const t=this.gl2d.context;if(this.drawProgram.uniformF("u_size",a.Camera.width,a.Camera.height),this.drawProgram.uniformF("u_resolution",t.canvas.width,t.canvas.height),this.drawProgram.uniformI("u_renderMode",this.renderMode),this.drawProgram.uniformF("u_time",performance.now()),this.drawProgram.uniformF("u_region",0,0,0,0),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clearColor(0,0,0,1),t.bindFramebuffer(t.FRAMEBUFFER,this.effectBuffer),t.clear(t.COLOR_BUFFER_BIT),this.currentMap&&this.currentMap.backgroundColor){const e=this.currentMap.backgroundColor.substr(1),i=parseInt(e.substr(-6,2),16)/255,r=parseInt(e.substr(-4,2),16)/255,n=parseInt(e.substr(-2,2),16)/255,o=8===e.length?parseInt(e.substr(-8,2),16)/255:1;t.clearColor(i,n,r,o)}else t.clearColor(0,0,0,1);t.bindFramebuffer(t.FRAMEBUFFER,this.drawBuffer),t.clear(t.COLOR_BUFFER_BIT),t.clearColor(0,0,0,0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.clear(t.COLOR_BUFFER_BIT),this.drawProgram.uniformF("u_size",a.Camera.width,a.Camera.height),window.smProfiling&&console.time("draw-parallax"),this.parallax&&this.parallax.draw(),window.smProfiling&&console.timeEnd("draw-parallax"),window.smProfiling&&console.time("draw-tiles"),this.mapRenderers.forEach(e=>e.draw()),window.smProfiling&&console.timeEnd("draw-tiles"),window.smProfiling&&console.time("draw-sprites");let i=[...this.sprites];i.sort((e,t)=>void 0===e.y?-1:void 0===t.y?1:e.y-t.y),i.forEach(t=>t.visible&&t.draw(e)),window.smProfiling&&console.timeEnd("draw-sprites"),window.smProfiling&&(window.smProfiling=!1),this.setRectangle(0,this.gl2d.element.height,this.gl2d.element.width,-this.gl2d.element.height),t.bindFramebuffer(t.FRAMEBUFFER,null),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.drawLayer),this.drawProgram.uniformI("u_image",0),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this.effectLayer),this.drawProgram.uniformI("u_effect",1),t.drawArrays(t.TRIANGLES,0,6),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE4),t.bindTexture(t.TEXTURE_2D,null)}},{key:"resize",value:function(e,t){const i=this.gl2d.context;e=e||this.gl2d.element.width,t=t||this.gl2d.element.height,this.width=e,this.height=t,a.Camera.x*=this.zoomLevel,a.Camera.y*=this.zoomLevel,a.Camera.width=e/this.zoomLevel,a.Camera.height=t/this.zoomLevel,this.mapRenderers.forEach(e=>e.resize(a.Camera.width,a.Camera.height)),i.bindTexture(i.TEXTURE_2D,this.drawLayer),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,this.width,this.height,0,i.RGBA,i.UNSIGNED_BYTE,null),i.bindTexture(i.TEXTURE_2D,this.effectLayer),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,this.width,this.height,0,i.RGBA,i.UNSIGNED_BYTE,null),i.bindTexture(i.TEXTURE_2D,null)}},{key:"zoom",value:function(e){const t=32*this.screenScale,i=.2*this.screenScale;let r=e*(.05*this.zoomLevel)+this.zoomLevel;r<i?r=i:r>t&&(r=t),Math.abs(r-1)<.05&&(r=1),this.zoomLevel!==r&&(this.zoomLevel=r,this.resize())}},{key:"setRectangle",value:function(e,t,i,r){const n=this.gl2d.context;n.bindBuffer(n.ARRAY_BUFFER,this.drawProgram.buffers.a_texCoord),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),n.STATIC_DRAW);const o=e,s=e+i,a=t,l=t+r;n.bindBuffer(n.ARRAY_BUFFER,this.drawProgram.buffers.a_position),n.bufferData(n.ARRAY_BUFFER,new Float32Array([o,a,s,a,o,l,o,l,s,a,s,l]),n.STREAM_DRAW)}}])&&l(e.prototype,t),i&&l(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}()}),require.register("sprite/SpriteSheet.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SpriteSheet=void 0;var r=t("./Tileset");function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,o(r.key),r)}}function o(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function s(e,t,i){return t=a(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,i||[],a(e).constructor):t.apply(e,i))}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}e.SpriteSheet=function(e){function t(e){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=s(this,t,[e])).frames=[],i.animations={default:[{tileid:0,duration:1/0}]},i.canvas=document.createElement("canvas"),i.context=i.canvas.getContext("2d",{willReadFrequently:!0}),i.ready=i.ready.then(()=>{i.processImage();for(const e of i.tiles)e.animation?i.animations[e.type]=e.animation:e.type&&(i.animations[e.type]=[{duration:1/0,tileid:e.id}])}),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t)}(t,r.Tileset),i=t,(o=[{key:"processImage",value:function(){this.canvas.width=this.image.width,this.canvas.height=this.image.height,this.context.drawImage(this.image,0,0);for(let e=0;e<this.tileCount;e++)this.frames[e]=this.getFrame(e)}},{key:"getFrame",value:function(e){const t=(e%=this.tileCount)%this.columns,i=Math.floor(e/this.columns);return this.context.getImageData(t*this.tileWidth,i*this.tileHeight,this.tileWidth,this.tileHeight).data}}])&&n(i.prototype,o),a&&n(i,a),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,a}()}),require.register("sprite/TextureBank.js",function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,n(r.key),r)}}function n(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.TextureBank=void 0;e.TextureBank=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)})}),require.register("sprite/Tileset.js",function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,n(r.key),r)}}function n(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Tileset=void 0;e.Tileset=function(){return e=function e(t){let i=t.source,r=t.map,n=t.firstgid,o=t.columns,s=t.image,a=t.imageheight,l=t.imagewidth,u=t.margin,c=t.name,h=t.spacing,f=t.tilecount,d=t.tileheight,p=t.tilewidth,v=t.tiles;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.firstGid=null!==n&&void 0!==n?n:0,this.tileCount=null!==f&&void 0!==f?f:0,this.tileHeight=null!==d&&void 0!==d?d:0,this.tileWidth=null!==p&&void 0!==p?p:0,i&&(this.source=new URL(i,location)),this.map=r,this.ready=this.getReady({source:i,columns:o,image:s,imageheight:a,imagewidth:l,margin:u,name:c,spacing:h,tilecount:f,tileheight:d,tilewidth:p,tiles:v})},(t=[{key:"getReady",value:async function(e){let t=e.source,i=e.columns,r=e.image,n=e.imageheight,o=e.imagewidth,s=e.margin,a=e.name,l=e.spacing,u=e.tilecount,c=e.tileheight,h=e.tilewidth,f=e.tiles;if(t){var d=await(await fetch(t)).json();i=d.columns,r=d.image,n=d.imageheight,o=d.imagewidth,s=d.margin,a=d.name,l=d.spacing,u=d.tilecount,c=d.tileheight,h=d.tilewidth,f=d.tiles;for(const e of f)e.id+=this.firstGid}this.columns=null!==i&&void 0!==i?i:1,this.margin=null!==s&&void 0!==s?s:0,this.name=null!==a&&void 0!==a?a:r,this.spacing=null!==l&&void 0!==l?l:0,this.tiles=null!==f&&void 0!==f?f:[],this.tileCount=null!==u&&void 0!==u?u:1,this.image=new Image,this.source?this.image.src=new URL(r,this.source):this.map?this.image.src=new URL(r,this.map.src):this.image.src=new URL(r,location),await new Promise(e=>this.image.onload=(()=>e())),this.imageWidth=null!==o&&void 0!==o?o:this.image.width,this.imageHeight=null!==n&&void 0!==n?n:this.image.height,this.tileWidth=null!==h&&void 0!==h?h:this.imageWidth,this.tileHeight=null!==c&&void 0!==c?c:this.imageHeight,this.rows=Math.ceil(n/c)||1}}])&&r(e.prototype,t),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}()}),require.register("sprite/texture.frag",function(e,t,i){i.exports="// texture.frag\n#define M_PI 3.1415926535897932384626433832795\n#define M_TAU M_PI / 2.0\nprecision mediump float;\n\nvarying vec2 v_texCoord;\nvarying vec2 v_position;\n\nuniform sampler2D u_image;\nuniform sampler2D u_effect;\nuniform sampler2D u_tiles;\nuniform sampler2D u_tileMapping;\n\nuniform vec2 u_size;\nuniform vec2 u_tileSize;\nuniform vec2 u_resolution;\nuniform vec2 u_mapTextureSize;\n\nuniform vec4 u_color;\nuniform vec4 u_region;\nuniform vec2 u_parallax;\nuniform vec2 u_scroll;\nuniform vec2 u_stretch;\n\nuniform float u_time;\nuniform float u_scale;\n\nuniform int u_renderTiles;\nuniform int u_renderParallax;\nuniform int u_renderMode;\n\nfloat masked = 0.0;\nfloat sorted = 1.0;\nfloat displace = 1.0;\nfloat blur = 1.0;\n\nvec2 rippleX(vec2 texCoord, float a, float b, float c) {\n  vec2 rippled = vec2(\n    v_texCoord.x + sin(v_texCoord.y * (a * u_size.y) + b) * c / u_size.x,\n    v_texCoord.y\n  );\n\n  if (rippled.x < 0.0) {\n    rippled.x = abs(rippled.x);\n  }\n  else if (rippled.x > u_size.x) {\n    rippled.x = u_size.x - (rippled.x - u_size.x);\n  }\n\n  return rippled;\n}\n\nvec2 rippleY(vec2 texCoord, float a, float b, float c) {\n  vec2 rippled = vec2(v_texCoord.x, v_texCoord.y + sin(v_texCoord.x * (a * u_size.x) + b) * c / u_size.y);\n\n  if (rippled.y < 0.0) {\n    rippled.x = abs(rippled.x);\n  }\n  else if (rippled.y > u_size.y) {\n    rippled.y = u_size.y - (rippled.y - u_size.y);\n  }\n\n  return rippled;\n}\n\nvec4 motionBlur(sampler2D image, float angle, float magnitude, vec2 textCoord) {\n  vec4 originalColor = texture2D(image, textCoord);\n  vec4 dispColor = originalColor;\n\n  const float max = 10.0;\n  float weight = 0.85;\n\n  for (float i = 0.0; i < max; i += 1.0) {\n    if(i > abs(magnitude) || originalColor.a < 1.0) {\n      break;\n    }\n    vec4 dispColorDown = texture2D(image, textCoord + vec2(\n      cos(angle) * i * sign(magnitude) / u_size.x,\n      sin(angle) * i * sign(magnitude) / u_size.y\n    ));\n    dispColor = dispColor * (1.0 - weight) + dispColorDown * weight;\n    weight *= 0.8;\n  }\n\n  return dispColor;\n}\n\nvec4 linearBlur(sampler2D image, float angle, float magnitude, vec2 textCoord) {\n  vec4 originalColor = texture2D(image, textCoord);\n  vec4 dispColor = texture2D(image, textCoord);\n\n  const float max = 10.0;\n  float weight = 0.65;\n\n  for (float i = 0.0; i < max; i += 0.25) {\n    if(i > abs(magnitude)) {\n      break;\n    }\n    vec4 dispColorUp = texture2D(image, textCoord + vec2(\n      cos(angle) * -i * sign(magnitude) / u_size.x,\n      sin(angle) * -i * sign(magnitude) / u_size.y\n    ));\n    vec4 dispColorDown = texture2D(image, textCoord + vec2(\n      cos(angle) * i * sign(magnitude) / u_size.x,\n      sin(angle) * i * sign(magnitude) / u_size.y\n    ));\n    dispColor = dispColor * (1.0 - weight) + dispColorDown * weight * 0.5 + dispColorUp * weight * 0.5;\n    weight *= 0.70;\n  }\n\n  return dispColor;\n}\n\nvoid main() {\n  vec4 originalColor = texture2D(u_image, v_texCoord);\n  vec4 effectColor = texture2D(u_effect,  v_texCoord);\n\n  // This only applies when drawing the parallax background\n  if (u_renderParallax == 1) {\n\n    float texelSize = 1.0 / u_size.x;\n\n    vec2 parallaxCoord = v_texCoord * vec2(1.0, -1.0) + vec2(0.0, 1.0)\n      + vec2(u_scroll.x * texelSize * u_parallax.x, 0.0);\n      // + vec2(u_time / 10000.0, 0.0);\n      // + vec2(, 0.0);\n      ;\n\n    gl_FragColor = texture2D(u_image,  parallaxCoord);\n\n    return;\n  }\n\n  // This only applies when drawing tiles.\n  if (u_renderTiles == 1) {\n    float xTiles = floor(u_size.x / u_tileSize.x);\n    float yTiles = floor(u_size.y / u_tileSize.y);\n\n    float xT = (v_texCoord.x * u_size.x) / u_tileSize.x;\n    float yT = (v_texCoord.y * u_size.y) / u_tileSize.y;\n\n    float inv_xTiles = 1.0 / xTiles;\n    float inv_yTiles = 1.0 / yTiles;\n\n    float xTile = floor(xT) * inv_xTiles;\n    float yTile = floor(yT) * inv_yTiles;\n\n    float xOff = (xT * inv_xTiles - xTile) * xTiles;\n    float yOff = (yT * inv_yTiles - yTile) * yTiles * -1.0 + 1.0;\n\n    float xWrap = u_mapTextureSize.x / u_tileSize.x;\n    float yWrap = u_mapTextureSize.y / u_tileSize.y;\n\n    // Mode 1 draws tiles' x/y values as red & green\n    if (u_renderMode == 1) {\n      gl_FragColor = vec4(xTile, yTile, 0, 1.0);\n      return;\n    }\n\n    // Mode 2 is the same as mode 1 but adds combines\n    // internal tile x/y to the blue channel\n    if (u_renderMode == 2) {\n      gl_FragColor = vec4(xTile, yTile, (xOff + yOff) * 0.5, 1.0);\n      return;\n    }\n\n    vec4 tile = texture2D(u_tileMapping, v_texCoord * vec2(1.0, -1.0) + vec2(0.0, 1.0));\n\n    float lo = tile.r * 256.0;\n    float hi = tile.g * 256.0 * 256.0;\n\n    float tileNumber = lo + hi;\n\n    if (tileNumber == 0.0) {\n      gl_FragColor.a = 0.0;\n      return;\n    }\n\n    // Mode 3 uses the tile number for the red/green channels\n    if (u_renderMode == 3) {\n      gl_FragColor = tile;\n      gl_FragColor.b = 0.5;\n      gl_FragColor.a = 1.0;\n      return;\n    }\n\n    // Mode 4 normalizes the tile number to all channels\n    if (u_renderMode == 4) {\n      gl_FragColor = vec4(\n        mod(tileNumber, 256.0) / 256.0\n        , mod(tileNumber, 256.0) / 256.0\n        , mod(tileNumber, 256.0) / 256.0\n        , 1.0\n      );\n      return;\n    }\n\n    float tileSetX = floor(mod((-1.0 + tileNumber), xWrap));\n    float tileSetY = floor((-1.0 + tileNumber) / xWrap);\n\n    vec4 tileColor = texture2D(u_tiles, vec2(\n      xOff / xWrap + tileSetX * (u_tileSize.y / u_mapTextureSize.y)\n      , yOff / yWrap + tileSetY * (u_tileSize.y / u_mapTextureSize.y)\n    ));\n\n    gl_FragColor = tileColor;\n\n    return;\n  }\n\n  // This if/else block only applies\n  // when we're drawing the effectBuffer\n  if (u_region.r > 0.0 || u_region.g > 0.0 || u_region.b > 0.0) {\n    if (masked < 1.0 || originalColor.a > 0.0) {\n      gl_FragColor = u_region;\n    }\n    return;\n  }\n  else if (u_region.a > 0.0) {\n    if (sorted > 0.0) {\n      gl_FragColor = vec4(0, 0, 0, originalColor.a > 0.0 ? 1.0 : 0.0);\n    }\n    else {\n      gl_FragColor = vec4(0, 0, 0, 0.0);\n    }\n    return;\n  };\n\n  // Mode 5 draws the effect buffer to the screen\n  if (u_renderMode == 5) {\n    gl_FragColor = effectColor;\n    return;\n  }\n\n  vec3 ripple = vec3(M_PI/8.0, u_time / 200.0, 1.0);\n\n  // This if/else block only applies\n  // when we're drawing the drawBuffer\n  if (effectColor == vec4(0, 1, 1, 1)) { // Water region\n    vec2 texCoord = v_texCoord;\n    vec4 v_blurredColor = originalColor;\n    if (displace > 0.0) {\n      texCoord = rippleX(v_texCoord, ripple.x, ripple.y, ripple.z);\n      v_blurredColor = texture2D(u_image, texCoord);\n    }\n    if (blur > 0.0) {\n      v_blurredColor = linearBlur(u_image, 0.0, 1.0, texCoord);\n    }\n    gl_FragColor = v_blurredColor * 0.65 + effectColor * 0.35;\n  }\n  else if (effectColor == vec4(1, 0, 0, 1)) { // Fire region\n    vec2 v_displacement = rippleY(v_texCoord, ripple.x * 3.0, ripple.y * 1.5, ripple.z * 0.333);\n    vec4 v_blurredColor = originalColor;\n    if (displace > 0.0) {\n      v_blurredColor = texture2D(u_image, v_displacement);\n    }\n    if (blur > 0.0) {\n      v_blurredColor = motionBlur(u_image, -M_TAU, 1.0, v_displacement);\n    }\n    gl_FragColor = v_blurredColor * 0.75 + effectColor * 0.25;\n  }\n  else { // Null region\n    gl_FragColor = originalColor;\n  }\n}\n"}),require.register("sprite/texture.vert",function(e,t,i){i.exports="// texture.vert\nprecision mediump float;\n\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\n\nuniform vec2 u_resolution;\n\nvarying vec2 v_texCoord;\nvarying vec2 v_position;\n\nvoid main()\n{\n  vec2 zeroToOne = a_position / u_resolution;\n  vec2 zeroToTwo = zeroToOne * 2.0;\n  vec2 clipSpace = zeroToTwo - 1.0;\n\n  gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n  v_texCoord  = a_texCoord;\n  v_position  = a_position;\n}\n"}),require.register("ui/OnScreenJoyPad.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.OnScreenJoyPad=void 0;var r=t("curvature/base/View");function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,o(r.key),r)}}function o(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function s(e,t,i){return t=a(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,i||[],a(e).constructor):t.apply(e,i))}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}e.OnScreenJoyPad=function(e){function i(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(r=s(this,i,[e])).template=t("./onScreenJoyPad.tmp"),r.dragStart=!1,r.args.dragging=!1,r.args.x=0,r.args.y=0,window.addEventListener("mousemove",e=>{r.moveStick(e)}),window.addEventListener("mouseup",e=>{r.dropStick(e)}),window.addEventListener("touchmove",e=>{r.moveStick(e)}),window.addEventListener("touchend",e=>{r.dropStick(e)}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t)}(i,r.View),o=i,(a=[{key:"dragStick",value:function(e){let t=e;e.preventDefault(),e.touches&&e.touches[0]&&(t=e.touches[0]),this.args.dragging=!0,this.dragStart={x:t.clientX,y:t.clientY}}},{key:"moveStick",value:function(e){if(this.args.dragging){let t=e;e.touches&&e.touches[0]&&(t=e.touches[0]),this.args.xx=t.clientX-this.dragStart.x,this.args.yy=t.clientY-this.dragStart.y;const i=50;this.args.xx<-i?this.args.x=-i:this.args.xx>i?this.args.x=i:this.args.x=this.args.xx,this.args.yy<-i?this.args.y=-i:this.args.yy>i?this.args.y=i:this.args.y=this.args.yy}}},{key:"dropStick",value:function(e){this.args.dragging=!1,this.args.x=0,this.args.y=0}}])&&n(o.prototype,a),u&&n(o,u),Object.defineProperty(o,"prototype",{writable:!1}),o;var o,a,u}()}),require.register("ui/onScreenJoyPad.tmp.html",function(e,t,i){i.exports='<div class = "controller">\n\t<div class = "joystick" cv-on = "\n\t\ttouchstart:dragStick(event);\n\t\tmousedown:dragStick(event);\n\t">\n\t\t<div class = "pad" style = "position: relative; transform:translate([[x]]px,[[y]]px);"></div>\n\t</div>\n\n\t<div class = "button">A</div>\n\t<div class = "button">B</div>\n\t<div class = "button">C</div>\n</div>'}),require.register("world/EntityPallet.js",function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,n(r.key),r)}}function n(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.EntityPallet=void 0;const o={};e.EntityPallet=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},i=[{key:"resolve",value:async function(e){if("@"===e[0]){if(o[e])return o[e]}else if("http://"===e||"https://"===e)return(await import(e)).default}},{key:"register",value:function(e,t){o[e]&&console.warn("Overwriting spawnclass!"),o[e]=t}}],(t=null)&&r(e.prototype,t),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}()}),require.register("world/TileMap.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TileMap=void 0;var r=t("curvature/base/Bindable"),n=t("./EntityPallet"),o=t("../sprite/Tileset"),s=t("../math/QuickTree"),a=t("../model/Spawner");function l(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)}return i}function u(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?l(Object(i),!0).forEach(function(t){c(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function c(e,t,i){return(t=f(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function h(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,f(r.key),r)}}function f(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}e.TileMap=function(){return e=function e(t){let i=t.fileName,n=t.session,o=t.x,a=t.y,l=t.width,u=t.height;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this[r.Bindable.Prevent]=!0,this.src=i,this.backgroundColor=null,this.tileCount=0,this.xWorld=o,this.yWorld=a,this.width=l,this.height=u,this.tileWidth=0,this.tileHeight=0,this.tileSetWidth=0,this.tileSetHeight=0,this.pixels=[],this.image=document.createElement("img"),this.session=n,this.properties={},this.entityDefs={},this.emptyTiles=new Set,this.tilesIndexes=new Map,this.canvases=new Map,this.contexts=new Map,this.tiles=null,this.tileLayers=[],this.imageLayers=[],this.objectLayers=[],this.ready=this.getReady(i),this.animations=new Map,this.visible=!1,this.quadTree=new s.QuickTree(o,o,o+this.width,a+this.height)},(t=[{key:"getReady",value:async function(e){const t=await(await fetch(e)).json();if(this.collisionLayers=t.layers.filter(e=>"tilelayer"===e.type&&"collision"===e.class),this.tileLayers=t.layers.filter(e=>"tilelayer"===e.type&&"collision"!==e.class),this.imageLayers=t.layers.filter(e=>"imagelayer"===e.type),this.objectLayers=t.layers.filter(e=>"objectgroup"===e.type),this.backgroundColor=t.backgroundcolor,t.properties)for(const e of t.properties)this.properties[e.name]=e.value;this.properties.backgroundColor&&(this.backgroundColor=this.properties.backgroundColor);const i=t.tilesets.map(t=>(t.source?t.source=new URL(t.source,e).href:t.map=this,new o.Tileset(t)));return this.width=t.width,this.height=t.height,this.tileWidth=t.tilewidth,this.tileHeight=t.tileheight,await Promise.all(i.map(e=>e.ready)),this.assemble(i),await this.spawn(),this}},{key:"assemble",value:function(e){e.sort((e,t)=>e.firstGid-t.firstGid);const t=this.tileCount=e.reduce((e,t)=>e.tileCount+t.tileCount,{tileCount:0}),i=Math.ceil(Math.sqrt(t)),r=document.createElement("canvas");this.tileSetWidth=r.width=i*this.tileWidth,this.tileSetHeight=r.height=Math.ceil(t/i)*this.tileHeight;const n=r.getContext("2d",{willReadFrequently:!0});for(const t of e){const e=t.image,i=document.createElement("canvas");i.width=e.width,i.height=e.height;const o=i.getContext("2d",{willReadFrequently:!0});o.drawImage(e,0,0);for(let e=0;e<t.tileCount;e++){const i=e*this.tileWidth%t.imageWidth,s=Math.floor(e*this.tileWidth/t.imageWidth)*this.tileHeight,a=e*this.tileWidth%r.width,l=Math.floor(e*this.tileWidth/r.width)*this.tileHeight,u=o.getImageData(i,s,this.tileWidth,this.tileHeight);n.putImageData(u,a,l);const c=new Uint32Array(u.data.buffer);let h=!0;for(const e of c)e>0&&(h=!1);h&&this.emptyTiles.add(e)}for(const e of t.tiles)e.animation&&this.animations.set(e.id,e.animation)}this.pixels=n.getImageData(0,0,r.width,r.height).data,this.tiles=n;for(const e of[...this.tileLayers,...this.collisionLayers]){const t=document.createElement("canvas"),i=t.getContext("2d",{willReadFrequently:!0});this.canvases.set(e,t),this.contexts.set(e,i);const r=new Uint32Array(e.data.map(e=>0+e)),n=new Uint8ClampedArray(r.buffer);for(const e in r){const t=r[e];this.animations.has(t)&&console.log({i:e,tile:t},this.animations.get(t))}for(let e=3;e<n.length;e+=4)n[e]=255;this.tilesIndexes.set(e,r),t.width=this.width,t.height=this.height,i.putImageData(new ImageData(n,this.width,this.height),0,0)}}},{key:"spawn",value:async function(){for(const e of this.objectLayers){const t=e.objects;for(const e of t){if(this.entityDefs[e.id]=e,"player-start"===e.name||!e.type)continue;const t=await n.EntityPallet.resolve(e.type),i=new a.Spawner(u(u({spawnType:e.type,spawnClass:t},e),{},{spriteBoard:this.session.spriteBoard,session:this.session,world:this.session.world}));i.x+=this.xWorld,i.y+=this.yWorld,this.session.addEntity(i),this.quadTree.add(i)}}}},{key:"getCollisionTile",value:function(e,t,i){return!(!this.collisionLayers||!this.collisionLayers[i])&&this.getTileFromLayer(this.collisionLayers[i],e,t)}},{key:"getColor",value:function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.getPixel(this.tileLayers[i],e,t,i)}},{key:"getSolid",value:function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this.collisionLayers||!this.collisionLayers[i])return!1;const r=this.getPixel(this.collisionLayers[i],e,t,i);return 0===r||r}},{key:"getPixel",value:function(e,t,i){const r=this.getTileFromLayer(e,t,i);if(!1===r||-1===r)return!1;const n=Math.trunc(t%this.tileWidth),o=Math.trunc(i%this.tileHeight),s=r*this.tileWidth%this.tileSetWidth,a=Math.floor(r*this.tileWidth/this.tileSetWidth);return this.pixels[s+n+(a+o)*this.tileSetWidth]}},{key:"getTileFromLayer",value:function(e,t,i){const r=-this.xWorld+t,n=-this.yWorld+i;if(r<0||r>=this.width*this.tileWidth||n<0||n>=this.height*this.tileWidth)return!1;const o=Math.floor(r/this.tileWidth),s=Math.floor(n/this.tileHeight);return-1+e.data[o+s*this.width]}},{key:"getSlice",value:function(e,t,i,r){arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.tileLayers.map(e=>this.contexts.get(e)).map(n=>n.getImageData(e,t,i,r).data)}}])&&h(e.prototype,t),i&&h(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}()}),require.register("world/World.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.World=void 0;var r=t("curvature/base/Bindable"),n=t("../math/Rectangle"),o=t("./TileMap"),s=t("../math/SMTree"),a=t("../math/Ray");function l(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)}return i}function u(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?l(Object(i),!0).forEach(function(t){c(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function c(e,t,i){return(t=f(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function h(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,f(r.key),r)}}function f(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}e.World=function(){return e=function e(t){let i=t.source,n=t.session;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this[r.Bindable.Prevent]=!0,this.ready=this.getReady(i),this.maps=[],this.mTree=new s.SMTree,this.rectMap=new Map,this.session=n,this.source=i},(t=[{key:"getReady",value:async function(e){const t=await(await fetch(e)).json();return await Promise.all(t.maps.map((t,i)=>{t.fileName=new URL(t.fileName,e).href;const r=new o.TileMap(u(u({},t),{},{session:this.session}));r.xWorld=t.x,r.yWorld=t.y,this.maps[i]=r;const s=new n.Rectangle(t.x,t.y,t.x+t.width,t.y+t.height);return this.rectMap.set(s,r),this.mTree.add(s),console.log(this),r.ready}))}},{key:"getMapsForPoint",value:function(e,t){const i=this.mTree.query(e,t,e,t),r=new Set;for(const e of i){const t=this.rectMap.get(e);r.add(t)}return r}},{key:"getMapsForRect",value:function(e,t,i,r){const n=new Set,o=this.mTree.query(e+.5*-i,t+.5*-r,e+.5*i,t+.5*r);window.smProfiling&&console.time("query mapTree");for(const e of o)n.add(this.rectMap.get(e));return window.smProfiling&&console.timeEnd("query mapTree"),n}},{key:"getSolid",value:function(e,t,i){const r=this.getMapsForPoint(e,t);for(const n of r){const r=n.getSolid(e,t,i);if(r)return r}return null}},{key:"getCollisionTile",value:function(e,t,i){const r=this.getMapsForPoint(e,t);for(const n of r){const r=n.getCollisionTile(e,t,i);if(r>0)return r}return null}},{key:"getEntitiesForRect",value:function(e,t,i,r){const n=this.getMapsForRect(e,t,i,r);let o=new Set;window.smProfiling&&console.time("query quadTree");for(const s of n)s.visible&&(o=o.union(s.quadTree.select(e+.5*-i,t+.5*-r,i,r)));return window.smProfiling&&console.timeEnd("query quadTree"),o}},{key:"castRay",value:function(e,t,i,r){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:320,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:a.Ray.DEFAULT_FLAGS;return a.Ray.cast(this,e,t,i,r,n,o)}},{key:"castTerrainRay",value:function(e,t,i,r){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:320,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:a.Ray.DEFAULT_FLAGS;return a.Ray.castTerrain(this,e,t,i,r,n,o)}},{key:"castEntityRay",value:function(e,t,i,r){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:a.Ray.DEFAULT_FLAGS;return a.Ray.castEntity(this,e,t,i,r,n)}}])&&h(e.prototype,t),i&&h(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}()}),require.register("___globals___",function(e,t,i){})}(),require("___globals___");
