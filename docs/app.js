!function(){"use strict";var e="undefined"==typeof global?self:global;if("function"!=typeof e.require){var t={},r={},i={},n={}.hasOwnProperty,o=/^\.\.?(\/|$)/,a=function(e,t){for(var r,i=[],n=(o.test(t)?e+"/"+t:t).split("/"),a=0,s=n.length;a<s;a++)".."===(r=n[a])?i.pop():"."!==r&&""!==r&&i.push(r);return i.join("/")},s=function(e){return e.split("/").slice(0,-1).join("/")},l=function(t,i){var n,o={id:t,exports:{},hot:d&&d.createHot(t)};return r[t]=o,i(o.exports,(n=t,function(t){var r=a(s(n),t);return e.require(r,n)}),o),o.exports},u=function(e){var t=i[e];return t&&e!==t?u(t):e},c=function(e,i){null==i&&(i="/");var o=u(e);if(n.call(r,o))return r[o].exports;if(n.call(t,o))return l(o,t[o]);throw new Error("Cannot find module '"+e+"' from '"+i+"'")};c.alias=function(e,t){i[t]=e};var h=/\.[^.\/]+$/,f=/\/index(\.[^\/]+)?$/;c.register=c.define=function(e,o){if(e&&"object"==typeof e)for(var a in e)n.call(e,a)&&c.register(a,e[a]);else t[e]=o,delete r[e],function(e){if(h.test(e)){var t=e.replace(h,"");n.call(i,t)&&i[t].replace(h,"")!==t+"/index"||(i[t]=e)}if(f.test(e)){var r=e.replace(f,"");n.call(i,r)||(i[r]=e)}}(e)},c.list=function(){var e=[];for(var r in t)n.call(t,r)&&e.push(r);return e};var d=e._hmr&&new e._hmr(function(e,t){return u(a(s(e),t))},c,t,r);c._cache=r,c.hmr=d&&d.wrap,c.brunch=!0,e.require=c}}(),function(){"undefined"==typeof window||window;var e=function(e,t,r){var i={},n=function(t,r){try{return e(r+"/node_modules/"+t)}catch(e){if(-1===e.toString().indexOf("Cannot find module"))throw e;if(-1!==r.indexOf("node_modules")){var o=r.split("/"),a=o.lastIndexOf("node_modules"),s=o.slice(0,a).join("/");return n(t,s)}}return i};return function(o){if(o in t&&(o=t[o]),o){if("."!==o[0]&&r){var a=n(o,r);if(a!==i)return a}return e(o)}}};require.register("curvature/base/Bag.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Bag=void 0;var e=r("./Bindable"),i=r("./Mixin"),n=r("../mixin/EventTargetMixin"),o=e=>Number(e),a=Symbol("Mapped"),s=Symbol("Has"),l=Symbol("Add"),u=Symbol("Remove"),c=Symbol("Delete");class h extends(i.Mixin.with(n.EventTargetMixin)){constructor(t){super(),this.changeCallback=t,this.content=new Map,this.current=0,this.length=0,this.list=e.Bindable.makeBindable([]),this.meta=Symbol("meta"),this.type=void 0}has(e){return this[a]?this[a].has(e):this[s](e)}[s](e){return this.content.has(e)}add(e){return this[a]?this[a].add(e):this[l](e)}[l](t){if(void 0===t||!(t instanceof Object))throw new Error("Only objects may be added to Bags.");if(this.type&&!(t instanceof this.type))throw console.error(this.type,t),new Error(`Only objects of type ${this.type} may be added to this Bag.`);if(t=e.Bindable.make(t),!this.content.has(t)){var r=new CustomEvent("adding",{detail:{item:t}});if(this.dispatchEvent(r)){var i=o(this.current++);this.content.set(t,i),this.list[i]=t,this.changeCallback&&this.changeCallback(t,this.meta,h.ITEM_ADDED,i);var n=new CustomEvent("added",{detail:{item:t,id:i}});return this.dispatchEvent(n),this.length=this.size,i}}}remove(e){return this[a]?this[a].remove(e):this[u](e)}[u](t){if(void 0===t||!(t instanceof Object))throw new Error("Only objects may be removed from Bags.");if(this.type&&!(t instanceof this.type))throw console.error(this.type,t),new Error(`Only objects of type ${this.type} may be removed from this Bag.`);if(t=e.Bindable.make(t),!this.content.has(t))return this.changeCallback&&this.changeCallback(t,this.meta,0,void 0),!1;var r=new CustomEvent("removing",{detail:{item:t}});if(this.dispatchEvent(r)){var i=this.content.get(t);delete this.list[i],this.content.delete(t),this.changeCallback&&this.changeCallback(t,this.meta,h.ITEM_REMOVED,i);var n=new CustomEvent("removed",{detail:{item:t,id:i}});return this.dispatchEvent(n),this.length=this.size,t}}delete(e){if(this[a])return this[a].delete(e);this[c](e)}[c](e){this.remove(e)}map(e=(e=>e),t=(e=>e)){var r=new WeakMap,i=new h;return i[a]=this,this.addEventListener("added",n=>{var o=n.detail.item;if(t(o)&&!r.has(o)){var a=e(o);r.set(o,a),i[l](a)}}),this.addEventListener("removed",e=>{var t=e.detail.item;if(r.has(t)){var n=r.get(t);r.delete(t),i[u](n)}}),i}get size(){return this.content.size}items(){return Array.from(this.content.entries()).map(e=>e[0])}}t.Bag=h,Object.defineProperty(h,"ITEM_ADDED",{configurable:!1,enumerable:!1,writable:!0,value:1}),Object.defineProperty(h,"ITEM_REMOVED",{configurable:!1,enumerable:!1,writable:!0,value:-1})}()}),require.register("curvature/base/Bindable.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";function e(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Object.defineProperty(t,"__esModule",{value:!0}),t.Bindable=void 0;var r=Symbol("ref"),i=Symbol("original"),n=Symbol("deck"),o=Symbol("binding"),a=Symbol("subBinding"),s=Symbol("bindingAll"),l=Symbol("isBindable"),u=Symbol("wrapping"),c=Symbol("Names"),h=Symbol("executing"),f=Symbol("stack"),d=(Symbol("object"),Symbol("wrapped")),p=Symbol("unwrapped"),v=Symbol("getProto"),m=Symbol("onGet"),b=Symbol("onAllGet"),y=Symbol("bindChain"),g=Symbol("Descriptors"),w=Symbol("Before"),_=Symbol("After"),T=Symbol("NoGetters"),E=Symbol("Prevent"),S=Object.getPrototypeOf(Int8Array),P=Set.prototype[Symbol.iterator],j=Map.prototype[Symbol.iterator],x="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:void 0,O=e=>"function"==typeof x.Map&&e instanceof x.Map||"function"==typeof x.Set&&e instanceof x.Set||"function"==typeof x.Node&&e instanceof x.Node||"function"==typeof x.WeakMap&&e instanceof x.WeakMap||"function"==typeof x.Location&&e instanceof x.Location||"function"==typeof x.Storage&&e instanceof x.Storage||"function"==typeof x.WeakSet&&e instanceof x.WeakSet||"function"==typeof x.ArrayBuffer&&e instanceof x.ArrayBuffer||"function"==typeof x.Promise&&e instanceof x.Promise||"function"==typeof x.File&&e instanceof x.File||"function"==typeof x.Event&&e instanceof x.Event||"function"==typeof x.CustomEvent&&e instanceof x.CustomEvent||"function"==typeof x.Gamepad&&e instanceof x.Gamepad||"function"==typeof x.ResizeObserver&&e instanceof x.ResizeObserver||"function"==typeof x.MutationObserver&&e instanceof x.MutationObserver||"function"==typeof x.PerformanceObserver&&e instanceof x.PerformanceObserver||"function"==typeof x.IntersectionObserver&&e instanceof x.IntersectionObserver||"function"==typeof x.IDBCursor&&e instanceof x.IDBCursor||"function"==typeof x.IDBCursorWithValue&&e instanceof x.IDBCursorWithValue||"function"==typeof x.IDBDatabase&&e instanceof x.IDBDatabase||"function"==typeof x.IDBFactory&&e instanceof x.IDBFactory||"function"==typeof x.IDBIndex&&e instanceof x.IDBIndex||"function"==typeof x.IDBKeyRange&&e instanceof x.IDBKeyRange||"function"==typeof x.IDBObjectStore&&e instanceof x.IDBObjectStore||"function"==typeof x.IDBOpenDBRequest&&e instanceof x.IDBOpenDBRequest||"function"==typeof x.IDBRequest&&e instanceof x.IDBRequest||"function"==typeof x.IDBTransaction&&e instanceof x.IDBTransaction||"function"==typeof x.IDBVersionChangeEvent&&e instanceof x.IDBVersionChangeEvent||"function"==typeof x.FileSystemFileHandle&&e instanceof x.FileSystemFileHandle||"function"==typeof x.RTCPeerConnection&&e instanceof x.RTCPeerConnection||"function"==typeof x.ServiceWorkerRegistration&&e instanceof x.ServiceWorkerRegistration||"function"==typeof x.WebGLTexture&&e instanceof x.WebGLTexture;class k{static isBindable(e){return!!(e&&e[l]&&e[E])&&e[l]===k}static onDeck(e,t){return e[n].get(t)||!1}static ref(e){return e[r]||e||!1}static makeBindable(e){return this.make(e)}static shuck(e,t){t=t||new Map;var r=Object.create({});if(e instanceof S||e instanceof ArrayBuffer){var n=e.slice(0);return t.set(e,n),n}var o=Object.keys(e);for(var a in o){var s=o[a];if("___"!==s.substring(0,3)){var l=t.get(e[s]);if(l)r[s]=l;else if(e[s]!==e){if(e[s]&&"object"==typeof e[s]){var u=e[s];k.isBindable(e[s])&&(u=e[s][i]),r[s]=this.shuck(u,t)}else r[s]=e[s];t.set(e[s],r[s])}else t.set(e[s],r),r[s]=r}}return k.isBindable(e)&&(delete r.bindTo,delete r.isBound),r}static make(e){if(e[E])return e;if(!e||!["function","object"].includes(typeof e))return e;if(r in e)return e[r];if(e[l])return e;if(Object.isSealed(e)||Object.isFrozen(e)||!Object.isExtensible(e)||O(e))return e;Object.defineProperty(e,l,{configurable:!1,enumerable:!1,writable:!1,value:k}),Object.defineProperty(e,r,{configurable:!0,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(e,i,{configurable:!1,enumerable:!1,writable:!1,value:e}),Object.defineProperty(e,n,{configurable:!1,enumerable:!1,writable:!1,value:new Map}),Object.defineProperty(e,o,{configurable:!1,enumerable:!1,writable:!1,value:Object.create(null)}),Object.defineProperty(e,a,{configurable:!1,enumerable:!1,writable:!1,value:new Map}),Object.defineProperty(e,s,{configurable:!1,enumerable:!1,writable:!1,value:new Set}),Object.defineProperty(e,h,{enumerable:!1,writable:!0}),Object.defineProperty(e,u,{enumerable:!1,writable:!0}),Object.defineProperty(e,f,{configurable:!1,enumerable:!1,writable:!1,value:[]}),Object.defineProperty(e,w,{configurable:!1,enumerable:!1,writable:!1,value:new Set}),Object.defineProperty(e,_,{configurable:!1,enumerable:!1,writable:!1,value:new Set}),Object.defineProperty(e,d,{configurable:!1,enumerable:!1,writable:!1,value:Object.preventExtensions(new Map)}),Object.defineProperty(e,p,{configurable:!1,enumerable:!1,writable:!1,value:Object.preventExtensions(new Map)}),Object.defineProperty(e,g,{configurable:!1,enumerable:!1,writable:!1,value:Object.preventExtensions(new Map)});var t=(r,i=null,n={})=>{var l=!1;if(Array.isArray(r)){var u=r.map(e=>t(e,i,n));return()=>u.forEach(e=>e())}if(r instanceof Function&&(n=i||{},i=r,l=!0),n.delay>=0&&(i=this.wrapDelayCallback(i,n.delay)),n.throttle>=0&&(i=this.wrapThrottleCallback(i,n.throttle)),n.wait>=0&&(i=this.wrapWaitCallback(i,n.wait)),n.frame&&(i=this.wrapFrameCallback(i,n.frame)),n.idle&&(i=this.wrapIdleCallback(i)),l){if(e[s].add(i),!("now"in n)||n.now)for(var c in e)i(e[c],c,e,!1);return()=>{e[s].delete(i)}}if(e[o][r]||(e[o][r]=new Set),n.children){var h=i;i=((...t)=>{var r=t[0],i=e[a].get(h);if(i&&(e[a].delete(h),i()),"object"==typeof r){var o=k.make(r);k.isBindable(o)&&e[a].set(h,o.bindTo((...e)=>h(...t,...e),Object.assign({},n,{children:!1}))),h(...t)}else h(...t)})}e[o][r].add(i),"now"in n&&!n.now||i(e[r],r,e,!1);var f=()=>{var t=e[a].get(i);t&&(e[a].delete(i),t()),e[o][r]&&e[o][r].has(i)&&e[o][r].delete(i)};return n.removeWith&&n.removeWith instanceof View&&n.removeWith.onRemove(()=>f),f};Object.defineProperty(e,"bindTo",{configurable:!1,enumerable:!1,writable:!1,value:t});Object.defineProperty(e,y,{configurable:!1,enumerable:!1,writable:!1,value:(t,r)=>{var i=t.split("."),n=i.shift(),o=i.slice(0),a=[];return a.push(e.bindTo(n,(e,t,i,n)=>{var s=o.join(".");0!==o.length?(void 0===e&&(e=i[t]=this.make({})),a=a.concat(e[y](s,r))):r(e,t,i,n)})),()=>a.forEach(e=>e())}}),Object.defineProperty(e,"___before",{configurable:!1,enumerable:!1,writable:!1,value:t=>(e[w].add(t),()=>e[w].delete(t))}),Object.defineProperty(e,"___after",{configurable:!1,enumerable:!1,writable:!1,value:t=>(e[_].add(t),()=>e[_].delete(t))});for(var R in Object.defineProperty(e,"isBound",{configurable:!1,enumerable:!1,writable:!1,value:()=>{if(e[s].size)return!0;for(var t of Object.values(e[o]))if(t.size)return!0;return!1}}),e)e[R]&&"object"==typeof e[R]&&(e[R][r]||e[R]instanceof Promise||Object.isExtensible(e[R])&&!Object.isSealed(e[R])&&(O(e[R])||(e[R]=k.make(e[R]))));var B=e[g],C=e[d],A=e[f],D=Object.create(null);return D.set=((t,r,i)=>{if(i&&"object"==typeof i&&(i=k.make(i),t[r]===i))return!0;C.has(r)&&C.delete(r);var a=e[n],l=a.has(r),u=l&&a.get(r);if(l&&u===i)return!0;if(r.slice&&"___"===r.slice(-3))return!0;if(t[r]===i||"number"==typeof i&&isNaN(u)&&isNaN(i))return!0;for(var c of(a.set(r,i),e[s]))c(i,r,t,!1);if(r in e[o])for(var h of e[o][r])h(i,r,t,!1,t[r]);if(a.delete(r),x.File&&t instanceof x.File&&"lastModifiedDate"==r||Reflect.set(t,r,i),Array.isArray(t)&&e[o].length)for(var f in e[o].length)(0,e[o].length[f])(t.length,"length",t,!1,t.length);return!0}),D.construct=((t,r)=>{var n="constructor";for(var o of t[w])o(t,n,e[f],void 0,r);var a=k.make(new t[i](...r));for(var s of t[_])s(t,n,e[f],a,r);return a}),D.deleteProperty=((t,r)=>{var i=e[n];if(i.has(r))return!0;if(!(r in t))return!0;if(B.has(r)){var a=B.get(r);if(a&&!a.configurable)return!1;B.delete(r)}for(var l of(i.set(r,null),C.has(r)&&C.delete(r),e[s]))l(void 0,r,t,!0,t[r]);if(r in e[o])for(var u of e[o][r])u(void 0,r,t,!0,t[r]);return Reflect.deleteProperty(t,r),i.delete(r),!0}),e[T]||(D.getPrototypeOf=(t=>v in e?e[v]:Reflect.getPrototypeOf(t)),D.get=((t,n)=>{if(C.has(n))return C.get(n);if(n===r||n===i||"apply"===n||"isBound"===n||"bindTo"===n||"__proto__"===n||"constructor"===n)return e[n];var o;if(B.has(n)?o=B.get(n):(o=Object.getOwnPropertyDescriptor(e,n),B.set(n,o)),o&&!o.configurable&&!o.writable)return e[n];if(b in e)return e[b](n);if(m in e&&!(n in e))return e[m](n);if(o&&!o.configurable&&!o.writable)return C.set(n,e[n]),e[n];if("function"==typeof e[n]){if(c in e[n])return e[n];e[p].set(n,e[n]);var a=Object.getPrototypeOf(e)[n]===e[n],s=O(e)||"function"==typeof e[Symbol.iterator]&&"next"===n||"function"==typeof S&&e instanceof S||"function"==typeof EventTarget&&e instanceof EventTarget||"function"==typeof Date&&e instanceof Date||"function"==typeof j&&e.prototype===j||"function"==typeof P&&e.prototype===P?e:e[r],l=function(...t){for(var r of(e[h]=n,A.unshift(n),e[w]))r(e,n,A,e,t);var i;if(new.target)i=new(e[p].get(n))(...t);else{var o=e[p].get(n);i=a?o.apply(s||e,t):o(...t)}for(var l of e[_])l(e,n,A,e,t);return e[h]=null,A.shift(),i};l[b]=(t=>e[n][t]);var u=k.make(l);return C.set(n,u),u}return e[n]})),Object.defineProperty(e,r,{configurable:!1,enumerable:!1,writable:!1,value:new Proxy(e,D)}),e[r]}static clearBindings(e){var t=(e=>(...t)=>t.map(e))(e=>Object.keys(e).map(t=>delete e[t]));e[s].clear(),t(e[d],e[o],e[_],e[w])}static resolve(e,t,r=!1){for(var i,n=t.split("."),o=n[0];n.length;){if(r&&1===n.length)return[this.make(e),n.shift(),o];(i=n.shift())in e&&e[i]&&"object"==typeof e[i]||(e[i]=Object.create(null)),e=this.make(e[i])}return[this.make(e),i,o]}static wrapDelayCallback(e,t){return(...r)=>setTimeout(()=>e(...r),t)}static wrapThrottleCallback(e,t){return this.throttles.set(e,!1),(...r)=>{this.throttles.get(e,!0)||(e(...r),this.throttles.set(e,!0),setTimeout(()=>{this.throttles.set(e,!1)},t))}}static wrapWaitCallback(e,t){return(...r)=>{var i;(i=this.waiters.get(e))&&(this.waiters.delete(e),clearTimeout(i)),i=setTimeout(()=>e(...r),t),this.waiters.set(e,i)}}static wrapFrameCallback(e,t){return(...t)=>{requestAnimationFrame(()=>e(...t))}}static wrapIdleCallback(e){return(...t)=>{(window.requestIdleCallback||requestAnimationFrame)(()=>e(...t))}}}t.Bindable=k,e(k,"waiters",new WeakMap),e(k,"throttles",new WeakMap),Object.defineProperty(k,"Prevent",{configurable:!1,enumerable:!1,writable:!1,value:E}),Object.defineProperty(k,"OnGet",{configurable:!1,enumerable:!1,writable:!1,value:m}),Object.defineProperty(k,"NoGetters",{configurable:!1,enumerable:!1,writable:!1,value:T}),Object.defineProperty(k,"GetProto",{configurable:!1,enumerable:!1,writable:!1,value:v}),Object.defineProperty(k,"OnAllGet",{configurable:!1,enumerable:!1,writable:!1,value:b})}()}),require.register("curvature/base/Cache.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Cache=void 0;t.Cache=class{static store(e,t,r,i="standard"){var n=0;r&&(n=1e3*r+(new Date).getTime()),this.buckets||(this.buckets=new Map),this.buckets.has(i)||this.buckets.set(i,new Map);var o=new CustomEvent("cvCacheStore",{cancelable:!0,detail:{key:e,value:t,expiry:r,bucket:i}});document.dispatchEvent(o)&&this.buckets.get(i).set(e,{value:t,expiration:n})}static load(e,t=!1,r="standard"){var i=new CustomEvent("cvCacheLoad",{cancelable:!0,detail:{key:e,defaultvalue:t,bucket:r}});if(!document.dispatchEvent(i))return t;if(this.buckets&&this.buckets.has(r)&&this.buckets.get(r).has(e)){var n=this.buckets.get(r).get(e);if(0===n.expiration||n.expiration>(new Date).getTime())return this.buckets.get(r).get(e).value}return t}}}()}),require.register("curvature/base/Config.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Config=void 0;var e={},i=r,n="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:void 0;try{e=i("/Config").Config}catch(t){!0===n.devMode&&console.error(t),e={}}class o{static get(e){return this.configs[e]}static set(e,t){return this.configs[e]=t,this}static dump(){return this.configs}static init(...e){for(var t in e){var r=e[t];for(var i in"string"==typeof r&&(r=JSON.parse(r)),r){var n=r[i];return this.configs[i]=n}}return this}}t.Config=o,Object.defineProperty(o,"configs",{configurable:!1,enumerable:!1,writable:!1,value:e})}()}),require.register("curvature/base/Dom.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Dom=void 0;t.Dom=class{static mapTags(e,t,r,i,n){var o=[],a=!0;i&&(a=!1);var s=!1,{Node:l,Element:u,NodeFilter:c,document:h}=globalThis.window,f=h.createTreeWalker(e,c.SHOW_ELEMENT|c.SHOW_TEXT,{acceptNode:(e,r)=>{if(!a){if(e!==i)return c.FILTER_SKIP;a=!0}return n&&e===n&&(s=!0),s?c.FILTER_SKIP:t?e instanceof u&&e.matches(t)?c.FILTER_ACCEPT:c.FILTER_SKIP:c.FILTER_ACCEPT}},!1);for(0;f.nextNode();)o.push(r(f.currentNode,f));return o}static dispatchEvent(e,t){e.dispatchEvent(t),this.mapTags(e,!1,e=>{e.dispatchEvent(t)})}}}()}),require.register("curvature/base/Mixin.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Mixin=void 0;var e=r("./Bindable"),i=Symbol("constructor");Symbol("mixinList");class n{static from(e,...t){var r=class extends e{constructor(...i){var o=e.constructor?super(...i):null;for(var a of t)switch(a[n.Constructor]&&a[n.Constructor].apply(this),typeof a){case"function":n.mixClass(a,r);break;case"object":n.mixObject(a,this)}return o}};return r}static make(...e){var t=e.pop();return n.to(t,...e)}static to(e,...t){var r={};t.map(t=>{switch(typeof t){case"object":Object.assign(r,Object.getOwnPropertyDescriptors(t));break;case"function":Object.assign(r,Object.getOwnPropertyDescriptors(t.prototype))}delete r.constructor,Object.defineProperties(e.prototype,r)})}static with(...e){return this.from(class{constructor(){}},...e)}static mixObject(e,t){for(var r of Object.getOwnPropertyNames(e))"function"!=typeof e[r]?t[r]=e[r]:t[r]=e[r].bind(t);for(var i of Object.getOwnPropertySymbols(e))"function"!=typeof e[i]?t[i]=e[i]:t[i]=e[i].bind(t)}static mixClass(e,t){for(var r of Object.getOwnPropertyNames(e.prototype))if(!["name","prototype","length"].includes(r)){var i=Object.getOwnPropertyDescriptor(t,r);i&&!i.writable||("function"==typeof e[r]?t.prototype[r]=e.prototype[r].bind(t.prototype):t.prototype[r]=e.prototype[r])}for(var n of Object.getOwnPropertySymbols(e.prototype))"function"==typeof e[n]?t.prototype[n]=e.prototype[n].bind(t.prototype):t.prototype[n]=e.prototype[n];var o=function(){if(["name","prototype","length"].includes(a))return 0;var r=Object.getOwnPropertyDescriptor(t,a);if(r&&!r.writable)return 0;if("function"!=typeof e[a])return t[a]=e[a],0;var i=t[a]||!1,n=e[a].bind(t);t[a]=((...e)=>(i&&i(...e),n(...e)))};for(var a of Object.getOwnPropertyNames(e))o();var s=function(){if("function"!=typeof e[l])return t.prototype[l]=e[l],1;var r=t[l]||!1,i=e[l].bind(t);t[l]=((...e)=>(r&&r(...e),i(...e)))};for(var l of Object.getOwnPropertySymbols(e))s()}static mix(t){for(var r={},i={},n=e.Bindable.makeBindable(t),o=function(e){var t=Object.getOwnPropertyNames(e.prototype),o=Object.getOwnPropertyNames(e),a=/^(before|after)__(.+)/,s=function(t){var i=t.match(a);if(i){switch(i[1]){case"before":n.___before((r,n,o,a,s)=>{if(n===i[2])return e[t].bind(a)(...s)});break;case"after":n.___after((r,n,o,a,s)=>{if(n===i[2])return e[t].bind(a)(...s)})}return 0}return r[t]?0:"function"!=typeof e[t]?0:void(r[t]=e[t])};for(var l of o)s(l);var u=function(t){var r=t.match(a);if(r){switch(r[1]){case"before":n.___before((i,n,o,a,s)=>{if(n===r[2])return e.prototype[t].bind(a)(...s)});break;case"after":n.___after((i,n,o,a,s)=>{if(n===r[2])return e.prototype[t].bind(a)(...s)})}return 0}return i[t]?0:"function"!=typeof e.prototype[t]?0:void(i[t]=e.prototype[t])};for(var c of t)u(c)},a=this;a&&a.prototype;a=Object.getPrototypeOf(a))o(a);for(var s in r)t[s]=r[s].bind(t);var l=function(e){t.prototype[e]=function(...t){return i[e].apply(this,t)}};for(var u in i)l(u);return n}}t.Mixin=n,n.Constructor=i}()}),require.register("curvature/base/Router.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Router=void 0;var e,i=r("./View"),n=(r("./Cache"),r("./Config")),o=r("./Routes"),a=Symbol("NotFound"),s=Symbol("Internal"),l="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:void 0;l.CustomEvent=null!==(e=l.CustomEvent)&&void 0!==e?e:l.Event;class u{static wait(e,t="DOMContentLoaded",r=document){r.addEventListener(t,()=>{this.listen(e)})}static listen(e,t=!1){this.listener=e||this.listener,this.routes=t||e.routes,Object.assign(this.query,this.queryOver({}));var r=t=>{t.preventDefault(),t.state&&"routedId"in t.state?(t.state.routedId<=this.routeCount?(this.history.splice(t.state.routedId),this.routeCount=t.state.routedId):t.state.routedId>this.routeCount&&(this.history.push(t.state.prev),this.routeCount=t.state.routedId),this.state=t.state):null!==this.prevPath&&this.prevPath!==location.pathname&&this.history.push(this.prevPath),this.isOriginLimited(location)?this.match(this.nextPath,e):this.match(location.pathname,e)};window.addEventListener("cvUrlChanged",r),window.addEventListener("popstate",r);var i=!this.isOriginLimited(location)&&location.pathname+location.search;!this.isOriginLimited(location)&&location.hash&&(i+=location.hash);var n={routedId:this.routeCount,url:location.pathname,prev:this.prevPath};this.isOriginLimited(location)||history.replaceState(n,null,location.pathname),this.go(!1!==i?i:"/")}static go(e,t=!1){var r=n.Config.get("title");r&&(document.title=r);var i={routedId:this.routeCount,prev:this.prevPath,url:location.pathname};-1===t?this.match(e,this.listener,!0):this.isOriginLimited(location)?this.nextPath=e:2===t&&location.pathname!==e?history.replaceState(i,null,e):location.pathname!==e&&history.pushState(i,null,e),(!t||t<0)&&(!1===t&&(this.path=null),t||("#"===e.substring(0,1)?window.dispatchEvent(new HashChangeEvent("hashchange")):window.dispatchEvent(new CustomEvent("cvUrlChanged")))),this.prevPath=e}static processRoute(e,t,r){return"function"==typeof e[t]?e[t].prototype instanceof i.View?new e[t](r):e[t](r):e[t]}static handleError(e,t,r,i,n,o,a,u){"undefined"!=typeof document&&document.dispatchEvent(new CustomEvent("cvRouteError",{detail:{error:e,path:o,prev:a,view:n,routes:t,selected:r}}));var c=l.devMode?"Unexpected error: "+String(e):"Unexpected error.";t[s]&&(i[s]=e,c=this.processRoute(t,s,i)),this.update(n,o,c,t,r,i,u)}static match(e,t,r=!1){var i=null,n=!1;if(!0===r&&(n=r),r&&"object"==typeof r&&(n=r.forceRefresh,i=r.event),"undefined"==typeof document||this.path!==e||n){var s="http://example.com";"undefined"!=typeof document&&(s=this.isOriginLimited(location)?s:location.origin,this.queryString=location.search);var l=new URL(e,s);e=this.path=l.pathname,"undefined"==typeof document&&(this.queryString=l.search);var u=this.prevPath,c=t&&t.args?t.args.content:null,h=this.routes||t&&t.routes||o.Routes.dump(),f=new URLSearchParams(this.queryString);for(var d in i&&i.request&&(this.request=i.request),Object.keys(this.query))delete this.query[d];for(var[p,v]of f)this.query[p]=v;var m={},b=!1,y="";for(var g in"/"===e.substring(0,1)&&(e=e.substring(1)),e=e.split("/"),this.query)m[g]=this.query[g];e:for(var w in h){var _=w.split("/");if(!(_.length<e.length&&"*"!==_[_.length-1])){for(var T in _)if("%"==_[T].substr(0,1)){var E=null,S=/^%(\w+)\??/.exec(_[T]);if(S&&S[1]&&(E=S[1]),!E)throw new Error(`${_[T]} is not a valid argument segment in route "${w}"`);if(e[T])m[E]=e[T];else{if("?"!=_[T].substr(_[T].length-1,1))continue e;m[E]=""}}else if("*"!==_[T]&&e[T]!==_[T])continue e;b=w,y=h[w],"*"===_[_.length-1]&&(m.pathparts=e.slice(_.length-1));break}}var P=new CustomEvent("cvRouteStart",{cancelable:!0,detail:{path:e,prev:u,root:t,selected:b,routes:h}});if("undefined"==typeof document||document.dispatchEvent(P)){if(!n&&t&&c&&"object"==typeof y&&c.constructor===y.constructor&&!(y instanceof Promise)&&c.update(m))return t.args.content=c,!0;b in h||(h[b]=h[a]);try{return!1===(y=this.processRoute(h,b,m))&&(y=this.processRoute(h,a,m)),"undefined"==typeof document?y instanceof Promise?y:Promise.resolve(y):y instanceof Promise?y.then(r=>this.update(t,e,r,h,b,m,n)).catch(r=>{this.handleError(r,h,b,m,t,e,u,n)}):this.update(t,e,y,h,b,m,n)}catch(r){this.handleError(r,h,b,m,t,e,u,n)}}}}static update(e,t,r,n,o,a,s){if(e){var l=this.prevPath,u=new CustomEvent("cvRoute",{cancelable:!0,detail:{result:r,path:t,prev:l,view:e,routes:n,selected:o}});!1!==r&&(e.args.content instanceof i.View&&(e.args.content.pause(!0),e.args.content.remove()),document.dispatchEvent(u)&&(e.args.content=r),r instanceof i.View&&(r.pause(!1),r.update(a,s)));var c=new CustomEvent("cvRouteEnd",{cancelable:!0,detail:{result:r,path:t,prev:l,view:e,routes:n,selected:o}});document.dispatchEvent(c)}}static isOriginLimited({origin:e}){return"null"===e||"file://"===e}static queryOver(e={}){var t=new URLSearchParams(location.search),r={},i={};for(var n of t)i[n[0]]=n[1];return delete(r=Object.assign(r,i,e)).api,r}static queryToString(e={},t=!1){var r=[],i=e;for(var n in t||(i=this.queryOver(e)),i)""!==i[n]&&r.push(n+"="+encodeURIComponent(i[n]));return r.join("&")}static setQuery(e,t,r){var i=this.queryOver();i[e]=t,void 0===t&&delete i[e];var n=this.queryToString(i,!0);this.go(location.pathname+(n?"?"+n:"?"),r)}}t.Router=u,Object.defineProperty(u,"query",{configurable:!1,enumerable:!1,writable:!1,value:{}}),Object.defineProperty(u,"history",{configurable:!1,enumerable:!1,writable:!1,value:[]}),Object.defineProperty(u,"routeCount",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(u,"prevPath",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(u,"queryString",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(u,"InternalError",{configurable:!1,enumerable:!1,writable:!1,value:s}),Object.defineProperty(u,"NotFoundError",{configurable:!1,enumerable:!1,writable:!1,value:a})}()}),require.register("curvature/base/Routes.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Routes=void 0;var e={},i=r,n=!1,o=()=>{if(!n){try{Object.assign(e,i("Routes").Routes||{})}catch(e){!0===globalThis.devMode&&console.warn(e)}n=!0}};class a{static get(e){return o(),this.routes[e]}static dump(){return o(),this.routes}}t.Routes=a,Object.defineProperty(a,"routes",{configurable:!1,enumerable:!1,writable:!1,value:e})}()}),require.register("curvature/base/RuleSet.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RuleSet=void 0;r("./Dom");var e=r("./Tag"),i=r("./View");class n{static add(e,t){return this.globalRules=this.globalRules||{},this.globalRules[e]=this.globalRules[e]||[],this.globalRules[e].push(t),this}static apply(e=document,t=null){for(var r in this.globalRules)for(var i in this.globalRules[r]){var n=this.globalRules[r][i],o=this.wrap(e,n,t),a=e.querySelectorAll(r);for(var s of a)o(s)}}add(e,t){return this.rules=this.rules||{},this.rules[e]=this.rules[e]||[],this.rules[e].push(t),this}apply(e=document,t=null){for(var r in n.apply(e,t),this.rules)for(var i in this.rules[r]){var o=this.rules[r][i],a=n.wrap(e,o,t),s=e.querySelectorAll(r);for(var l of s)a(l)}}purge(){if(this.rules)for(var[e,t]of Object.entries(this.rules))if(this.rules[e])for(var r in this.rules[e])delete this.rules[e][r]}static wait(e="DOMContentLoaded",t=document){var r=((e,t)=>()=>(t.removeEventListener(e,r),this.apply()))(e,t);t.addEventListener(e,r)}static wrap(t,r,n=null){var o=r;return(r instanceof i.View||r&&r.prototype&&r.prototype instanceof i.View)&&(o=(()=>r)),t=>{if(void 0===t.___cvApplied___&&Object.defineProperty(t,"___cvApplied___",{enumerable:!1,writable:!1,value:new WeakSet}),!t.___cvApplied___.has(r)){var a,s;n&&(a=s=n,n.viewList&&(s=n.viewList.parent));var l=new e.Tag(t,s,null,void 0,a),u=l.element.parentNode,c=l.element.nextSibling,h=o(l);if(!1!==h&&t.___cvApplied___.add(r),h instanceof HTMLElement&&(h=new e.Tag(h)),h instanceof e.Tag){if(!h.element.contains(l.element)){for(;l.element.firstChild;)h.element.appendChild(l.element.firstChild);l.remove()}c?u.insertBefore(h.element,c):u.appendChild(h.element)}h&&h.prototype&&h.prototype instanceof i.View&&(h=new h({},n)),h instanceof i.View&&(n&&(n.cleanup.push(()=>h.remove()),n.cleanup.push(n.args.bindTo((e,t,r)=>{r[t]=e,h.args[t]=e})),n.cleanup.push(h.args.bindTo((e,t,r,i)=>{r[t]=e,n.args[t]=e}))),l.clear(),h.render(l.element))}}}}t.RuleSet=n}()}),require.register("curvature/base/SetMap.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";function e(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Object.defineProperty(t,"__esModule",{value:!0}),t.SetMap=void 0;t.SetMap=class{constructor(){e(this,"_map",new Map)}has(e){return this._map.has(e)}get(e){return this._map.get(e)}getOne(e){var t=this.get(e);for(var r of t)return r}add(e,t){var r=this._map.get(e);return r||this._map.set(e,r=new Set),r.add(t)}remove(e,t){var r=this._map.get(e);if(r){var i=r.delete(t);return r.size||this._map.delete(e),i}}values(){return new Set(...[...this._map.values()].map(e=>[...e.values()]))}}}()}),require.register("curvature/base/Tag.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tag=void 0;var e=r("./Bindable"),i=Symbol("CurrentStyle"),n=Symbol("CurrentAttrs"),o=function(e){if(this.node)for(var t in e){var r=String(e[t]);this[i].has(t)&&this[i].get(t)===e[t]||Number.isNaN(e[t])||("-"===t[0]?this.node.style.setProperty(t,r):this.node.style[t]=r,void 0!==e[t]?this[i].set(t,e[t]):this[i].delete(t))}},a=function(e){return"function"==typeof this[e]?this[e]:this.node&&"function"==typeof this.node[e]?this[e]=((...t)=>this.node[e](...t)):"style"===e?this.proxy.style:this.node&&e in this.node?this.node[e]:this[e]};t.Tag=class{constructor(t,r,s,l,u){if("string"==typeof t){var c=document.createRange().createContextualFragment(t);t=c.firstChild}this.element=e.Bindable.makeBindable(t),this.node=this.element,this.parent=r,this.direct=u,this.ref=s,this.index=l,this.cleanup=[],this[e.Bindable.OnAllGet]=a.bind(this),this[i]=new Map,this[n]=new Map;var h=e.Bindable.make(o.bind(this));return Object.defineProperty(this,"style",{value:h}),this.proxy=e.Bindable.make(this),this.proxy.style.bindTo((e,t,r,n)=>{this[i].has(t)&&this[i].get(t)===e||(this.node.style[t]=e,n||void 0===e?this[i].delete(t):this[i].set(t,e))}),this.proxy.bindTo((e,r)=>{if("index"!==r)return r in t&&t[r]!==e&&(t[r]=e),!1}),this.proxy}attr(e){for(var t in e)this[n].has(t)&&void 0===e[t]?(this.node.removeAttribute(t),this[n].delete(t)):this[n].has(t)&&this[n].get(t)===e[t]||(null===e[t]?(this.node.setAttribute(t,""),this[n].set(t,"")):(this.node.setAttribute(t,e[t]),this[n].set(t,e[t])));return this}remove(){var t;for(this.node&&this.node.remove(),e.Bindable.clearBindings(this);t=this.cleanup.shift();)t();if(this.clear(),this.node){var r=new Event("cvDomDetached");this.node.dispatchEvent(r),this.node=this.element=this.ref=this.parent=void 0}}clear(){if(this.node)for(var e=new Event("cvDomDetached");this.node.firstChild;)this.node.firstChild.dispatchEvent(e),this.node.removeChild(this.node.firstChild)}pause(e=!0){}listen(e,t,r){var i=this.node;i.addEventListener(e,t,r);var n=()=>{i.removeEventListener(e,t,r)},o=()=>{n(),n=(()=>console.warn("Already removed!"))};return this.parent.onRemove(()=>o()),o}}}()}),require.register("curvature/base/Uuid.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";function e(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Object.defineProperty(t,"__esModule",{value:!0}),t.Uuid=void 0;var r=("object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:void 0).crypto;class i{constructor(t=null,n=4){if(e(this,"uuid",null),e(this,"version",4),t){if("string"!=typeof t&&!(t instanceof i)||!t.match(/[0-9A-Fa-f]{8}(-[0-9A-Fa-f]{4}){3}-[0-9A-Fa-f]{12}/))throw new Error(`Invalid input for Uuid: "${t}"`);this.version=n,this.uuid=t}else if(r&&"function"==typeof r.randomUUID)this.uuid=r.randomUUID();else{var o=r&&"function"==typeof r.randomUUID?()=>r.getRandomValues(new Uint8Array(1))[0]:()=>Math.trunc(256*Math.random());this.uuid=([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^o()&15>>e/4).toString(16))}Object.freeze(this)}[Symbol.toPrimitive](){return this.toString()}toString(){return this.uuid}toJson(){return{version:this.version,uuid:this.uuid}}}t.Uuid=i}()}),require.register("curvature/base/View.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.View=void 0;var e=r("./Bindable"),i=r("./ViewList"),n=r("./Router"),o=r("./Uuid"),a=r("./Dom"),s=r("./Tag"),l=r("./Bag"),u=r("./RuleSet"),c=r("./Mixin"),h=r("../mixin/EventTargetMixin"),f=Symbol("dontParse"),d=Symbol("expandBind"),p=Symbol("uuid");class v extends(c.Mixin.with(h.EventTargetMixin)){get _id(){return this[p]}static from(e,t={},r=null){var i=new this(t,r);return i.template=e,i}constructor(t={},r=null){super(t,r),this[h.EventTargetMixin.Parent]=r,Object.defineProperty(this,"args",{value:e.Bindable.make(t)}),Object.defineProperty(this,p,{value:this.constructor.uuid()}),Object.defineProperty(this,"nodesAttached",{value:new l.Bag((e,t,r)=>{})}),Object.defineProperty(this,"nodesDetached",{value:new l.Bag((e,t,r)=>{})}),Object.defineProperty(this,"_onRemove",{value:new l.Bag((e,t,r)=>{})}),Object.defineProperty(this,"cleanup",{value:[]}),Object.defineProperty(this,"parent",{value:r,writable:!0}),Object.defineProperty(this,"views",{value:new Map}),Object.defineProperty(this,"viewLists",{value:new Map}),Object.defineProperty(this,"withViews",{value:new Map}),Object.defineProperty(this,"tags",{value:e.Bindable.make({})}),Object.defineProperty(this,"nodes",{value:e.Bindable.make([])}),Object.defineProperty(this,"timeouts",{value:new Map}),Object.defineProperty(this,"intervals",{value:new Map}),Object.defineProperty(this,"frames",{value:[]}),Object.defineProperty(this,"ruleSet",{value:new u.RuleSet}),Object.defineProperty(this,"preRuleSet",{value:new u.RuleSet}),Object.defineProperty(this,"subBindings",{value:{}}),Object.defineProperty(this,"templates",{value:{}}),Object.defineProperty(this,"postMapping",{value:new Set}),Object.defineProperty(this,"eventCleanup",{value:[]}),Object.defineProperty(this,"unpauseCallbacks",{value:new Map}),Object.defineProperty(this,"interpolateRegex",{value:/(\[\[((?:\$+)?[\w\.\|-]+)\]\])/g}),Object.defineProperty(this,"rendered",{value:new Promise((e,t)=>Object.defineProperty(this,"renderComplete",{value:e}))}),this.onRemove(()=>{this[h.EventTargetMixin.Parent]&&(this[h.EventTargetMixin.Parent]=null)}),this.controller=this,this.template="",this.firstNode=null,this.lastNode=null,this.viewList=null,this.mainView=null,this.preserve=!1,this.removed=!1,this.loaded=Promise.resolve(this)}static isView(){return v}onFrame(e){var t=!1,r=()=>{t=!0},i=r=>{this.removed||t||(this.paused||e(Date.now()),requestAnimationFrame(i))};return requestAnimationFrame(()=>i(Date.now())),this.frames.push(r),r}onNextFrame(e){return requestAnimationFrame(()=>e(Date.now()))}onIdle(e){return requestIdleCallback(()=>e(Date.now()))}onTimeout(e,t){var r={timeout:null,callback:null,time:e,fired:!1,created:(new Date).getTime(),paused:!1},i=()=>{t(),r.fired=!0,this.timeouts.delete(r.timeout)},n=setTimeout(i,e);return r.callback=i,r.timeout=n,this.timeouts.set(r.timeout,r),n}clearTimeout(e){if(this.timeouts.has(e)){var t=this.timeouts.get(e);clearTimeout(t.timeout),this.timeouts.delete(t.timeout)}}onInterval(e,t){var r=setInterval(t,e);return this.intervals.set(r,{timeout:r,callback:t,time:e,paused:!1}),r}clearInterval(e){if(this.intervals.has(e)){var t=this.intervals.get(e);clearTimeout(t.timeout),this.intervals.delete(t.timeout)}}pause(e){if(void 0===e&&(this.paused=!this.paused),this.paused=e,this.paused){for(var[t,r]of this.timeouts)r.fired?this.timeouts.delete(r.timeout):(clearTimeout(r.timeout),r.paused=!0,r.time=Math.max(0,r.time-(Date.now()-r.created)));for(var[i,n]of this.intervals)clearInterval(n.timeout),n.paused=!0}else{for(var[o,a]of this.timeouts)a.paused&&(a.fired?this.timeouts.delete(a.timeout):(a.timeout=setTimeout(a.callback,a.time),a.paused=!1));for(var[s,l]of this.intervals)l.paused&&(l.timeout=setInterval(l.callback,l.time),l.paused=!1);for(var[,u]of this.unpauseCallbacks)u();this.unpauseCallbacks.clear()}for(var[c,h]of this.viewLists)h.pause(!!e);for(var f in this.tags)if(Array.isArray(this.tags[f]))for(var d in this.tags[f])this.tags[f][d].pause(!!e);else this.tags[f].pause(!!e)}render(e=null,t=null,r=null){var{document:i}=globalThis.window;if(e instanceof v&&(e=e.firstNode.parentNode),t instanceof v&&(t=t.firstNode),this.firstNode)return this.reRender(e,t,r);this.dispatchEvent(new CustomEvent("render"));var n,o="object"==typeof this.template&&"function"==typeof this.template.cloneNode,a=o||v.templates.has(this.template);if(n=a?o?this.template.cloneNode(!0):v.templates.get(this.template).cloneNode(!0):i.createRange().createContextualFragment(this.template),a||o||v.templates.set(this.template,n.cloneNode(!0)),this.mainView||this.preRuleSet.apply(n,this),this.mapTags(n),this.mainView||this.ruleSet.apply(n,this),!0===globalThis.devMode?(this.firstNode=i.createComment(`Template ${this._id} Start`),this.lastNode=i.createComment(`Template ${this._id} End`)):(this.firstNode=i.createTextNode(""),this.lastNode=i.createTextNode("")),this.nodes.push(this.firstNode,...Array.from(n.childNodes),this.lastNode),this.postRender(e),this.dispatchEvent(new CustomEvent("rendered")),this.dispatchAttach()){if(e){t?(e.insertBefore(this.firstNode,t),e.insertBefore(this.lastNode,t)):(e.insertBefore(this.firstNode,null),e.insertBefore(this.lastNode,null)),e.insertBefore(n,this.lastNode);var s=e.getRootNode();if(s.isConnected)this.attached(s,e),this.dispatchAttached(s,e,r);else if(r){var l=t=>{var i=e.getRootNode();this.attached(i,e),this.dispatchAttached(i,e,r),r.removeEventListener("attached",l)};r.addEventListener("attached",l)}}return this.renderComplete(this.nodes),this.nodes}}dispatchAttach(){var{CustomEvent:e}=globalThis.window;return this.dispatchEvent(new e("attach",{cancelable:!0,target:this}))}dispatchAttached(e,t,r){var{CustomEvent:i}=globalThis.window;for(var n of(this.dispatchEvent(new i("attached",{detail:{view:r||this,node:t,root:e,mainView:this}})),this.dispatchDomAttached(r),this.nodesAttached.items()))n(e,t)}dispatchDomAttached(e){var{Node:t,CustomEvent:r}=globalThis.window;this.nodes.filter(e=>e.nodeType!==t.COMMENT_NODE).forEach(t=>{t.matches&&(t.dispatchEvent(new r("cvDomAttached",{target:t,detail:{view:e||this,mainView:this}})),a.Dom.mapTags(t,!1,(t,i)=>{t.matches&&t.dispatchEvent(new r("cvDomAttached",{target:t,detail:{view:e||this,mainView:this}}))}))})}reRender(e,t,r){var{CustomEvent:i}=globalThis.window;if(this.dispatchEvent(new i("reRender"),{cancelable:!0,target:this,view:r})){var n=new DocumentFragment;if(this.firstNode.isConnected){var o=this.nodesDetached.items();for(var a in o)o[a]()}if(n.append(...this.nodes),e){t?(e.insertBefore(this.firstNode,t),e.insertBefore(this.lastNode,t)):(e.insertBefore(this.firstNode,null),e.insertBefore(this.lastNode,null)),e.insertBefore(n,this.lastNode),this.dispatchEvent(new i("reRendered"),{cancelable:!0,target:this,view:r});var s=e.getRootNode();s.isConnected&&(this.attached(s,e),this.dispatchAttached(s,e))}return this.nodes}}mapTags(e){a.Dom.mapTags(e,!1,(e,t)=>{e[f]||(e=e.matches?(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=this.mapInterpolatableTag(e)).matches("[cv-template]")&&this.mapTemplateTag(e)||e).matches("[cv-slot]")&&this.mapSlotTag(e)||e).matches("[cv-prerender]")&&this.mapPrendererTag(e)||e).matches("[cv-link]")&&this.mapLinkTag(e)||e).matches("[cv-attr]")&&this.mapAttrTag(e)||e).matches("[cv-expand]")&&this.mapExpandableTag(e)||e).matches("[cv-ref]")&&this.mapRefTag(e)||e).matches("[cv-on]")&&this.mapOnTag(e)||e).matches("[cv-each]")&&this.mapEachTag(e)||e).matches("[cv-bind]")&&this.mapBindTag(e)||e).matches("[cv-with]")&&this.mapWithTag(e)||e).matches("[cv-if]")&&this.mapIfTag(e)||e).matches("[cv-view]")&&this.mapViewTag(e)||e:this.mapInterpolatableTag(e))!==t.currentNode&&(t.currentNode=e)}),this.postMapping.forEach(e=>e())}mapExpandableTag(t){var r=t[d];r&&(r(),t[d]=!1);var[i,n]=e.Bindable.resolve(this.args,t.getAttribute("cv-expand"),!0);return t.removeAttribute("cv-expand"),i[n]||(i[n]={}),i[n]=e.Bindable.make(i[n]),this.onRemove(t[d]=i[n].bindTo((e,r,i,n,o)=>{n||void 0===e?t.removeAttribute(r,e):null!==e?t.setAttribute(r,e):t.setAttribute(r,"")})),t}mapAttrTag(e){var t=this.compileAttrTag(e)(this);return e.replaceWith(t),t}compileAttrTag(t){var r=t.getAttribute("cv-attr").split(/[,;]/).map(e=>e.split(":"));return t.removeAttribute("cv-attr"),i=>{var n=t.cloneNode(!0),o=function(){var t=r[a][1]||r[a][0],[o,s]=e.Bindable.resolve(i.args,t,!0),l=r[a][0];i.onRemove(o.bindTo(s,(e,t,r,i)=>{i||void 0===e?n.removeAttribute(l,e):null!==e?n.setAttribute(l,e):n.setAttribute(l,"")}))};for(var a in r)o();return n}}mapInterpolatableTag(t){var r=this,i=this.interpolateRegex,{Node:n,document:o}=globalThis.window;if(t.nodeType===n.TEXT_NODE){var a=t.nodeValue;if(!this.interpolatable(a))return t;for(var l,u,c=0,d=function(){var i=l[2],u=!1,d=!1,p=i.split("|"),m=!1;if(p.length>1&&(m=r.stringTransformer(p.slice(1)),i=p[0]),"$$"===i.substr(0,2)&&(u=!0,d=!0,i=i.substr(2)),"$"===i.substr(0,1)&&(u=!0,i=i.substr(1)),"000"===i.substr(0,3))return expand=!0,i=i.substr(3),0;var b=a.substring(c,l.index);c=l.index+l[1].length;var y,g=o.createTextNode(b);g[f]=!0,t.parentNode.insertBefore(g,t),(y=u?o.createElement("div"):o.createTextNode(""))[f]=!0;var w=r.args,_=i;if(i.match(/\./)&&([w,_]=e.Bindable.resolve(r.args,i,!0)),t.parentNode.insertBefore(y,t),"object"!=typeof w)return 1;var T=(w=e.Bindable.make(w)).bindTo(_,(e,i,o)=>{if(o[i]!==e&&(o[i]instanceof v||o[i]instanceof n||o[i]instanceof s.Tag)&&(o[i].preserve||o[i].remove()),d&&!(e instanceof v)){var a=null!==e&&void 0!==e?e:"";(e=new v(r.args,r)).template=a}if(m&&(e=m(e)),e instanceof v){y.nodeValue="",e[h.EventTargetMixin.Parent]=r,e.render(t.parentNode,y,r);var l=()=>{e.preserve||e.remove()};r.onRemove(l),e.onRemove(()=>r._onRemove.remove(l))}else e instanceof n?(y.nodeValue="",t.parentNode.insertBefore(e,y),r.onRemove(()=>e.remove())):e instanceof s.Tag?(y.nodeValue="",e.node?(t.parentNode.insertBefore(e.node,y),r.onRemove(()=>e.remove())):e.remove()):(e instanceof Object&&e.__toString instanceof Function&&(e=e.__toString()),u?y.innerHTML=e:y.nodeValue=e);y[f]=!0});r.onRemove(T)};(l=i.exec(a))&&(0===(u=d())||1!==u););var p=a.substring(c),m=o.createTextNode(p);m[f]=!0,t.parentNode.insertBefore(m,t),t.nodeValue=""}else if(t.nodeType===n.ELEMENT_NODE)for(var b=function(){if(!r.interpolatable(t.attributes[y].value))return 1;for(var n,o=0,a=t.attributes[y].value,s=t.attributes[y],l={},u=[];n=i.exec(a);)u.push(a.substring(o,n.index)),l[n[2]]||(l[n[2]]=[]),l[n[2]].push(u.length),u.push(n[1]),o=n.index+n[1].length;u.push(a.substring(o));var c=function(){var i=r.args,n=h,o=h.split("|"),a=!1,c=h;o.length>1&&(a=r.stringTransformer(o.slice(1)),n=o[0]),n.match(/\./)&&([i,n]=e.Bindable.resolve(r.args,n,!0));l[c];r.onRemove(i.bindTo(n,(e,i,o,h)=>{for(var f in a&&(e=a(e)),l)for(var d in l[c])u[l[c][d]]=o[f],i===n&&(u[l[c][d]]=e);r.paused?r.unpauseCallbacks.set(s,()=>t.setAttribute(s.name,u.join(""))):t.setAttribute(s.name,u.join(""))}))};for(var h in l)c()},y=0;y<t.attributes.length;y++)b();return t}mapRefTag(e){var t=e.getAttribute("cv-ref"),[r,i=null,n=null]=t.split(":"),o=s.Tag;i&&(o=this.stringToClass(i)),e.removeAttribute("cv-ref"),Object.defineProperty(e,"___tag___",{enumerable:!1,writable:!0}),this.onRemove(()=>{e.___tag___=null,e.remove()});var a=this;this.viewList&&(a=this.viewList.parent);var l=new o(e,this,r,void 0,this);for(e.___tag___=l,this.tags[r]=l;a;){var u=this.args[n];if(void 0!==u?(a.tags[r]||(a.tags[r]=[]),a.tags[r][u]=l):a.tags[r]=l,!a.parent)break;a=a.parent}return e}mapBindTag(t){var r=t.getAttribute("cv-bind"),i=this.args,n=r,o=null;r.match(/\./)&&([i,n,o]=e.Bindable.resolve(this.args,r,!0)),i!==this.args&&(this.subBindings[r]=this.subBindings[r]||[],this.onRemove(this.args.bindTo(o,()=>{for(;this.subBindings.length;)this.subBindings.shift()()})));var l=!1;"$"===n.substr(0,1)&&(n=n.substr(1),l=!0);var u=!1,c=i.bindTo(n,(e,r,i,n,o)=>{if((o instanceof v||o instanceof Node||o instanceof s.Tag)&&o!==e&&o.remove(),["INPUT","SELECT","TEXTAREA"].includes(t.tagName)){var c=t.getAttribute("type");if(c&&"checkbox"===c.toLowerCase())t.checked=!!e;else if(c&&"radio"===c.toLowerCase())t.checked=e==t.value;else if("file"!==c)if("SELECT"===t.tagName){var d=()=>{for(var r=0;r<t.options.length;r++){t.options[r].value==e&&(t.selectedIndex=r)}};d(),this.nodesAttached.add(d)}else t.value=null==e?"":e;u&&t.dispatchEvent(new CustomEvent("cvAutoChanged",{bubbles:!0})),u=!0}else if(e instanceof v){for(var p of t.childNodes)p.remove();e[h.EventTargetMixin.Parent]=this,e.render(t,null,this)}else if(e instanceof Node)t.insert(e);else if(e instanceof s.Tag)t.append(e.node);else if(l){if(t.innerHTML!==e){if(e=String(e),t.innerHTML===e.substring(0,t.innerHTML.length))t.innerHTML+=e.substring(t.innerHTML.length);else{for(var m of t.childNodes)m.remove();t.innerHTML=e}a.Dom.mapTags(t,!1,e=>e[f]=!0)}}else if(t.textContent!==e){for(var b of t.childNodes)b.remove();t.textContent=e}});i!==this.args&&this.subBindings[r].push(c),this.onRemove(c);var d=t.getAttribute("type"),p=t.getAttribute("multiple"),m=r=>{if(r.target===t)if(d&&"checkbox"===d.toLowerCase())t.checked?i[n]=r.target.getAttribute("value"):i[n]=!1;else if(r.target.matches("[contenteditable=true]"))i[n]=r.target.innerHTML;else if("file"===d&&p){var o=Array.from(r.target.files),a=i[n]||e.Bindable.onDeck(i,n);if(a&&o.length){var s=function(e){if(o[e]!==a[e])return o[e].toJSON=(()=>({name:file[e].name,size:file[e].size,type:file[e].type,date:file[e].lastModified})),a[e]=o[e],1};for(var l in o)if(s(l))break}else i[n]=o}else if("file"===d&&!p&&r.target.files.length){var u=r.target.files.item(0);u.toJSON=(()=>({name:u.name,size:u.size,type:u.type,date:u.lastModified})),i[n]=u}else i[n]=r.target.value};return"file"===d||"radio"===d?t.addEventListener("change",m):(t.addEventListener("input",m),t.addEventListener("change",m),t.addEventListener("value-changed",m)),this.onRemove(()=>{"file"===d||"radio"===d?t.removeEventListener("change",m):(t.removeEventListener("input",m),t.removeEventListener("change",m),t.removeEventListener("value-changed",m))}),t.removeAttribute("cv-bind"),t}mapOnTag(e){return String(e.getAttribute("cv-on")).split(";").map(e=>e.split(":")).forEach(t=>{var r=(t=t.map(e=>e.trim())).length,i=String(t.shift()).trim(),n=String(t.shift()||i).trim(),o=String(t.shift()||"").trim(),a=[],s=/(\w+)(?:\(([$\w\s-'",]+)\))?/.exec(n);s&&(n=s[1].replace(/(^[\s\n]+|[\s\n]+$)/,""),s[2]&&(a=s[2].split(",").map(e=>e.trim()))),a.length||a.push("$event"),i&&1!==r||(i=n);var l=t=>{for(var r,i=this,o=function(){var e=i.controller;return"function"==typeof e[n]?(r=((...t)=>{e[n](...t)}),0):"function"==typeof i[n]?(r=((...e)=>{i[n](...e)}),0):i.parent?void(i=i.parent):0};i&&0!==o(););var s=a.map(r=>{var n;return Number(r)==r?r:"event"===r||"$event"===r?t:"$view"===r?i:"$controller"===r?controller:"$tag"===r?e:"$parent"===r?this.parent:"$subview"===r?this:r in this.args?this.args[r]:(n=/^['"]([\w-]+?)["']$/.exec(r))?n[1]:void 0});if("function"!=typeof r)throw new Error(`${n} is not defined on View object.`+"\nTag:\n"+`${e.outerHTML}`);r(...s)},u={};switch(o.includes("p")?u.passive=!0:o.includes("P")&&(u.passive=!1),o.includes("c")?u.capture=!0:o.includes("C")&&(u.capture=!1),o.includes("o")?u.once=!0:o.includes("O")&&(u.once=!1),i){case"_init":l();break;case"_attach":this.nodesAttached.add(l);break;case"_detach":this.nodesDetached.add(l);break;default:e.addEventListener(i,l,u),this.onRemove(()=>{e.removeEventListener(i,l,u)})}return[i,n,a]}),e.removeAttribute("cv-on"),e}mapLinkTag(e){var t=e.getAttribute("cv-link");e.setAttribute("href",t);var r=r=>{r.preventDefault(),"http"!==t.substring(0,4)&&"//"!==t.substring(0,2)?n.Router.go(e.getAttribute("href")):globalThis.open(e.getAttribute("href",t))};return e.addEventListener("click",r),this.onRemove(((e,t)=>()=>{e.removeEventListener("click",t),e=void 0,t=void 0})(e,r)),e.removeAttribute("cv-link"),e}mapPrendererTag(e){var t=e.getAttribute("cv-prerender"),r=globalThis.prerenderer||navigator.userAgent.match(/prerender/i);return e.removeAttribute("cv-prerender"),r&&(globalThis.prerenderer=globalThis.prerenderer||!0),("never"===t&&r||"only"===t&&!r)&&this.postMapping.add(()=>e.parentNode.removeChild(e)),e}mapWithTag(t){var r=this,i=t.getAttribute("cv-with"),n=t.getAttribute("cv-carry"),o=t.getAttribute("cv-view");t.removeAttribute("cv-with"),t.removeAttribute("cv-carry"),t.removeAttribute("cv-view");var a=o?this.stringToClass(o):v,s=new DocumentFragment;[...t.childNodes].forEach(e=>s.appendChild(e));var l=[];n&&(l=n.split(",").map(e=>e.trim()));var u=this.args.bindTo(i,(i,n,o,u)=>{for(this.withViews.has(t)&&this.withViews.delete(t);t.firstChild;)t.removeChild(t.firstChild);var c=new a({},this);this.onRemove((e=>()=>{e.remove()})(c)),c.template=s;var h=function(){var e=r.args.bindTo(l[f],(e,t)=>{c.args[t]=e});c.onRemove(e),r.onRemove(()=>{e(),c.remove()})};for(var f in l)h();var d=function(){if("object"!=typeof i)return 1;var t=(i=e.Bindable.make(i)).bindTo(p,(e,t,r,i)=>{i?t in c.args&&delete c.args[t]:c.args[t]=e});c.args.bindTo(p,(e,t,r,n)=>{n?t in i&&delete i[t]:i[t]=e});r.onRemove(()=>{t(),i.isBound()||e.Bindable.clearBindings(i),c.remove()}),c.onRemove(()=>{t(),i.isBound()||e.Bindable.clearBindings(i)})};for(var p in i)d();c.render(t,null,this),this.withViews.set(t,c)});return this.onRemove(()=>{this.withViews.delete(t),u()}),t}mapViewTag(e){var t=e.getAttribute("cv-view");e.removeAttribute("cv-view");var r=new DocumentFragment;[...e.childNodes].forEach(e=>r.appendChild(e));var i=t.split(":"),n=i.shift(),o=new(i.length?this.stringToClass(i[0]):v)(this.args,this);return this.views.set(e,o),this.views.set(n,o),this.onRemove(()=>{o.remove(),this.views.delete(e),this.views.delete(n)}),o.template=r,o.render(e,null,this),e}mapEachTag(t){var r=t.getAttribute("cv-each"),n=t.getAttribute("cv-view");t.removeAttribute("cv-each"),t.removeAttribute("cv-view");var o=n?this.stringToClass(n):v,a=new DocumentFragment;[...t.childNodes].forEach(e=>a.appendChild(e));var[s,u,c]=r.split(":"),h=this.args,f=s;s.match(/\./)&&([h,f]=e.Bindable.resolve(this.args,s,!0));var d=h.bindTo(f,(e,r,n,s,h)=>{e instanceof l.Bag&&(e=e.list),this.viewLists.has(t)&&this.viewLists.get(t).remove();var f=new i.ViewList(a,u,e,this,c,o),d=()=>f.remove();this.onRemove(d),f.onRemove(()=>this._onRemove.remove(d));var p=this.args.bindTo((e,t,r,i)=>{"_id"!==t&&(i?t in f.subArgs&&delete f.subArgs[t]:f.subArgs[t]=e)}),v=f.args.bindTo((e,t,r,i,n)=>{"_id"!==t&&"value"!==t&&"___"!==String(t).substring(0,3)&&(i?delete this.args[t]:t in this.args&&(this.args[t]=e))});for(f.onRemove(p),f.onRemove(v),this.onRemove(p),this.onRemove(v);t.firstChild;)t.removeChild(t.firstChild);this.viewLists.set(t,f),f.render(t,null,this),"SELECT"===t.tagName&&f.reRender()});return this.onRemove(d),t}mapIfTag(t){var r=t,i=r.getAttribute("cv-view"),n=r.getAttribute("cv-if"),o=r.getAttribute("cv-is"),s=!1,u=!1;r.removeAttribute("cv-view"),r.removeAttribute("cv-if"),r.removeAttribute("cv-is");var c=i?this.stringToClass(i):v;"!"===n.substr(0,1)&&(n=n.substr(1),s=!0),"?"===n.substr(0,1)&&(n=n.substr(1),u=!0);var h=new DocumentFragment;[...r.childNodes].forEach(e=>h.appendChild(e));var f=this,d=new DocumentFragment,p=new c(this.args,f);p.tags.bindTo((e,t)=>this.tags[t]=e,{removeWith:this}),p.template=h;var m=f.args,b=n;n.match(/\./)&&([m,b]=e.Bindable.resolve(f.args,n,!0)),p.render(d,null,this);var y=m.bindTo(b,(e,r)=>{var i=e;u&&(e=null!==e&&void 0!==e),e instanceof l.Bag&&(e=e.list),Array.isArray(e)&&(e=!!e.length),null!==o&&(e=i==o),s&&(e=!e),e?(t.appendChild(d),[...d.childNodes].forEach(e=>a.Dom.mapTags(e,!1,(e,t)=>{e.matches&&e.dispatchEvent(new CustomEvent("cvDomAttached",{target:e,detail:{view:p||this,mainView:this}}))}))):(p.nodes.forEach(e=>d.appendChild(e)),a.Dom.mapTags(d,!1,(e,t)=>{e.matches&&new CustomEvent("cvDomDetached",{target:e,detail:{view:p||this,mainView:this}})}))},{children:Array.isArray(m[b])});f.onRemove(y);return f.onRemove(()=>{y(),f._onRemove.remove(y)}),this.onRemove(()=>{p.remove(),f!==this&&f.remove()}),t}mapTemplateTag(e){var t=e.getAttribute("cv-template");e.removeAttribute("cv-template");var r=e.innerHTML;return v.templates.has(r)||v.templates.set(r,document.createRange().createContextualFragment(e.innerHTML)),this.templates[t]=v.templates.get(r),this.postMapping.add(()=>e.remove()),e}mapSlotTag(e){var t=e.getAttribute("cv-slot"),r=this.templates[t];if(!r){for(var i=this;i&&!(r=i.templates[t]);)i=i.parent;if(!r)return void console.error(`Template ${t} not found.`)}for(e.removeAttribute("cv-slot");e.firstChild;)e.firstChild.remove();return"string"==typeof r&&(v.templates.has(r)||v.templates.set(r,document.createRange().createContextualFragment(r)),r=v.templates.get(r)),e.appendChild(r.cloneNode(!0)),e}postRender(e){}attached(e){}interpolatable(e){return!!String(e).match(this.interpolateRegex)}static uuid(){return new o.Uuid}remove(e=!1){if(this.dispatchEvent(new CustomEvent("remove",{detail:{view:this},cancelable:!0}))){var t=()=>{for(var e in this.tags)Array.isArray(this.tags[e])?(this.tags[e]&&this.tags[e].forEach(e=>e.remove()),this.tags[e].splice(0)):(this.tags[e]&&this.tags[e].remove(),this.tags[e]=void 0);for(var t in this.nodes)this.nodes[t]&&this.nodes[t].dispatchEvent(new Event("cvDomDetached")),this.nodes[t]&&this.nodes[t].remove(),this.nodes[t]=void 0;this.nodes.splice(0),this.firstNode=this.lastNode=void 0};e?t():requestAnimationFrame(t);var r=this._onRemove.items();for(var i of r)i(),this._onRemove.remove(i);for(var n of this.cleanup)n&&n();for(var[o,a]of(this.cleanup.length=0,this.viewLists))a.remove();for(var[s,l]of(this.viewLists.clear(),this.timeouts))clearTimeout(l.timeout),this.timeouts.delete(l.timeout);for(var u of this.intervals)clearInterval(u);for(var c of(this.intervals.length=0,this.frames))c();this.frames.length=0,this.preRuleSet.purge(),this.ruleSet.purge(),this.removed=!0,this.dispatchEvent(new CustomEvent("removed",{detail:{view:this},cancelable:!0}))}}findTag(e){for(var t in this.nodes){var r;if(this.nodes[t].querySelector){if(this.nodes[t].matches(e))return new s.Tag(this.nodes[t],this,void 0,void 0,this);if(r=this.nodes[t].querySelector(e))return new s.Tag(r,this,void 0,void 0,this)}}}findTags(e){var t=this.nodes.filter(t=>t.matches&&t.matches(e)),r=this.nodes.filter(e=>e.querySelectorAll).map(t=>[...t.querySelectorAll(e)]).flat().map(e=>new s.Tag(e,this,void 0,void 0,this))||[];return t.concat(r)}onRemove(e){e instanceof Event||this._onRemove.add(e)}update(){}beforeUpdate(e){}afterUpdate(e){}stringTransformer(e){return t=>{for(var r in e){for(var i=this,n=e[r];i&&!i[n];)i=i.parent;if(!i)return;t=i[e[r]](t)}return t}}stringToClass(e){if(v.refClasses.has(e))return v.refClasses.get(e);var t=e.split("/"),i=t[t.length-1],n=r(e);return v.refClasses.set(e,n[i]),n[i]}preventParsing(e){e[f]=!0}toString(){return this.nodes.map(e=>e.outerHTML).join(" ")}listen(e,t,r,i){if("string"==typeof e&&(i=r,r=t,t=e,e=this),e instanceof v)return this.listen(e.nodes,t,r,i);if(Array.isArray(e))return e.map(e=>this.listen(e,t,r,i));if(e instanceof s.Tag)return this.listen(e.element,t,r,i);e.addEventListener(t,r,i);var n=()=>e.removeEventListener(t,r,i),o=()=>{n(),n=(()=>{})};return this.onRemove(()=>o()),o}detach(){for(var e in this.nodes)this.nodes[e].remove();return this.nodes}}t.View=v,Object.defineProperty(v,"templates",{value:new Map}),Object.defineProperty(v,"refClasses",{value:new Map})}()}),require.register("curvature/base/ViewList.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ViewList=void 0;var e=r("./Bindable"),i=r("./SetMap"),n=r("./Bag");t.ViewList=class{constructor(t,r,i,o,a=null,s=null){this.removed=!1,this.args=e.Bindable.makeBindable(Object.create(null)),this.args.value=e.Bindable.makeBindable(i||Object.create(null)),this.subArgs=e.Bindable.makeBindable(Object.create(null)),this.views=[],this.cleanup=[],this.viewClass=s,this._onRemove=new n.Bag,this.template=t,this.subProperty=r,this.keyProperty=a,this.tag=null,this.downDebind=[],this.upDebind=[],this.paused=!1,this.parent=o,this.viewCount=0,this.rendered=new Promise((e,t)=>{Object.defineProperty(this,"renderComplete",{configurable:!1,writable:!0,value:e})}),this.willReRender=!1,this.args.___before((e,t,r,i,n)=>{"bindTo"!=t&&(this.paused=!0)}),this.args.___after((e,t,r,i,n)=>{"bindTo"!=t&&(this.paused=r.length>1,this.reRender())});var l=this.args.value.bindTo((e,t,r,i)=>{if(!this.paused){var n=t;if("symbol"!=typeof t)if(isNaN(t)&&(n="_"+t),i)for(var o in this.views[n]&&this.views[n].remove(!0),delete this.views[n],this.views)this.views[o]&&(isNaN(o)?this.views[o].args[this.keyProperty]=o.substr(1):this.views[o].args[this.keyProperty]=o);else this.views[n]?this.views[n]&&this.views[n].args&&(this.views[n].args[this.keyProperty]=t,this.views[n].args[this.subProperty]=e):this.viewCount?!1===this.willReRender&&(this.willReRender=requestAnimationFrame(()=>{this.willReRender=!1,this.reRender()})):this.reRender()}},{wait:0});this._onRemove.add(l),Object.preventExtensions(this)}render(e){var t=this,r=[],i=function(i){i.viewList=t,i.render(e,null,t.parent),r.push(i.rendered.then(()=>i))};for(var n of this.views)i(n);this.tag=e,Promise.all(r).then(e=>this.renderComplete(e)),this.parent.dispatchEvent(new CustomEvent("listRendered",{detail:{detail:{key:this.subProperty,value:this.args.value}}}))}reRender(){var e=this;if(!this.paused&&this.tag){var t=[],r=new i.SetMap;for(var n in this.views){var o=this.views[n];if(void 0!==o){var a=o.args[this.subProperty];r.add(a,o),t[n]=o}else t[n]=o}var s=[],l=new Set;this.downDebind.length&&this.downDebind.forEach(e=>e&&e()),this.upDebind.length&&this.upDebind.forEach(e=>e&&e()),this.upDebind.length=0,this.downDebind.length=0;var u=1/0,c=1/0,h=function(){var t=!1,i=f;if(isNaN(i)?i="_"+f:String(i).length&&(i=Number(i)),void 0!==e.args.value[f]&&r.has(e.args.value[f])){var n=r.getOne(e.args.value[f]);n&&(n.args[e.keyProperty]=f,s[i]=n,l.add(n),t=!0,isNaN(i)||(u=Math.min(u,i),i>0&&(c=Math.min(c,i))),r.remove(e.args.value[f],n))}if(!t){var o=Object.create(null),a=s[i]=new e.viewClass(o,e.parent);isNaN(i)||(u=Math.min(u,i),i>0&&(c=Math.min(c,i))),s[i].template=e.template,s[i].viewList=e,s[i].args[e.keyProperty]=f,s[i].args[e.subProperty]=e.args.value[f],e.upDebind[i]=o.bindTo(e.subProperty,(t,r,i,n)=>{var a=o[e.keyProperty];n?delete e.args.value[a]:e.args.value[a]=t}),e.downDebind[i]=e.subArgs.bindTo((e,t,r,i)=>{i?delete o[t]:o[t]=e});var h=()=>{e.upDebind.filter(e=>e).forEach(e=>e()),e.upDebind.length=0},d=()=>{e.downDebind.filter(e=>e).forEach(e=>e()),e.downDebind.length=0};a.onRemove(()=>{e._onRemove.remove(h),e._onRemove.remove(d),e.upDebind[i]&&e.upDebind[i](),e.downDebind[i]&&e.downDebind[i](),delete e.upDebind[i],delete e.downDebind[i]}),e._onRemove.add(h),e._onRemove.add(d),o[e.subProperty]=e.args.value[f]}};for(var f in this.args.value)h();for(var d in t)t[d]&&!l.has(t[d])&&t[d].remove(!0);if(Array.isArray(this.args.value)){var p=0===u&&void 0!==s[1]&&s.length>1||c===1/0?u:c,v=(e=0)=>{for(var t=s.length-e-1;t>p&&void 0===s[t];)t--;return t<p?Promise.resolve():s[t]===this.views[t]?s[t]&&!s[t].firstNode?(s[t].render(this.tag,s[t+1],this.parent),s[t].rendered.then(()=>v(Number(e)+1))):0===e||e%500?v(Number(e)+1):new Promise(t=>requestAnimationFrame(()=>t(v(Number(e)+1)))):(s[t].render(this.tag,s[t+1],this.parent),this.views.splice(t,0,s[t]),s[t].rendered.then(()=>v(e+1)))};this.rendered=v()}else{var m=[],b=Object.assign(Object.create(null),s),y=e=>parseInt(e)===e-0,g=Object.keys(s).sort((e,t)=>y(e)&&y(t)?Math.sign(e-t):y(e)||y(t)?!y(e)&&y(t)?-1:y(e)&&!y(t)?1:void 0:0),w=function(t){if(delete b[t],s[t].firstNode&&s[t]===e.views[t])return 1;s[t].render(e.tag,null,e.parent),m.push(s[t].rendered.then(()=>s[t]))};for(var _ of g)w(_);for(var T in b)delete this.args.views[T],b.remove(!0);this.rendered=Promise.all(m)}for(var E in s)isNaN(E)?s[E].args[this.keyProperty]=E.substr(1):s[E].args[this.keyProperty]=E;return this.views=Array.isArray(this.args.value)?[...s]:s,this.viewCount=s.length,l.clear(),this.willReRender=!1,this.rendered.then(()=>{this.parent.dispatchEvent(new CustomEvent("listRendered",{detail:{detail:{key:this.subProperty,value:this.args.value,tag:this.tag}}})),this.tag.dispatchEvent(new CustomEvent("listRendered",{detail:{detail:{key:this.subProperty,value:this.args.value,tag:this.tag}}}))}),this.rendered}}pause(e=!0){for(var t in this.views)this.views[t].pause(e)}onRemove(e){this._onRemove.add(e)}remove(){for(var t in this.views)this.views[t]&&this.views[t].remove(!0);var r=this._onRemove.items();for(var i in r)this._onRemove.remove(r[i]),r[i]();for(;this.cleanup.length;)this.cleanup.pop()();for(this.views=[];this.tag&&this.tag.firstChild;)this.tag.removeChild(this.tag.firstChild);this.subArgs&&e.Bindable.clearBindings(this.subArgs),e.Bindable.clearBindings(this.args),this.removed=!0}}}()}),require.register("curvature/input/Keyboard.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Keyboard=void 0;var e=r("../base/Bindable");t.Keyboard=class{static get(){return this.instance=this.instance||e.Bindable.make(new this)}constructor(){this.maxDecay=120,this.comboTime=500,this.listening=!1,this.focusElement=document.body,this[e.Bindable.NoGetters]=!0,Object.defineProperty(this,"combo",{value:e.Bindable.make([])}),Object.defineProperty(this,"whichs",{value:e.Bindable.make({})}),Object.defineProperty(this,"codes",{value:e.Bindable.make({})}),Object.defineProperty(this,"keys",{value:e.Bindable.make({})}),Object.defineProperty(this,"pressedWhich",{value:e.Bindable.make({})}),Object.defineProperty(this,"pressedCode",{value:e.Bindable.make({})}),Object.defineProperty(this,"pressedKey",{value:e.Bindable.make({})}),Object.defineProperty(this,"releasedWhich",{value:e.Bindable.make({})}),Object.defineProperty(this,"releasedCode",{value:e.Bindable.make({})}),Object.defineProperty(this,"releasedKey",{value:e.Bindable.make({})}),Object.defineProperty(this,"keyRefs",{value:e.Bindable.make({})}),document.addEventListener("keyup",e=>{this.listening&&(this.keys[e.key]>0||!this.focusElement||document.activeElement===this.focusElement||this.focusElement.contains(document.activeElement)&&!document.activeElement.matches("input,textarea"))&&(e.preventDefault(),this.releasedWhich[e.which]=Date.now(),this.releasedCode[e.code]=Date.now(),this.releasedKey[e.key]=Date.now(),this.whichs[e.which]=-1,this.codes[e.code]=-1,this.keys[e.key]=-1)}),document.addEventListener("keydown",e=>{this.listening&&(!this.focusElement||document.activeElement===this.focusElement||this.focusElement.contains(document.activeElement)&&!document.activeElement.matches("input,textarea"))&&(e.preventDefault(),e.repeat||(this.combo.push(e.code),clearTimeout(this.comboTimer),this.comboTimer=setTimeout(()=>this.combo.splice(0),this.comboTime),this.pressedWhich[e.which]=Date.now(),this.pressedCode[e.code]=Date.now(),this.pressedKey[e.key]=Date.now(),this.keys[e.key]>0||(this.whichs[e.which]=1,this.codes[e.code]=1,this.keys[e.key]=1)))});var t=e=>{for(var t in this.keys)this.keys[t]<0||(this.releasedKey[t]=Date.now(),this.keys[t]=-1);for(var r in this.codes)this.codes[r]<0||(this.releasedCode[r]=Date.now(),this.codes[r]=-1);for(var i in this.whichs)this.whichs[i]<0||(this.releasedWhich[i]=Date.now(),this.whichs[i]=-1)};window.addEventListener("blur",t),window.addEventListener("visibilitychange",()=>{"visible"!==document.visibilityState&&t()})}getKeyRef(t){return this.keyRefs[t]=this.keyRefs[t]||e.Bindable.make({})}getKeyTime(e){var t=this.releasedKey[e],r=this.pressedKey[e];return r?!t||t<r?Date.now()-r:-1*(Date.now()-t):0}getCodeTime(e){var t=this.releasedCode[e],r=this.pressedCode[e];return r?!t||t<r?Date.now()-r:-1*(Date.now()-t):0}getWhichTime(e){var t=this.releasedWhich[e],r=this.pressedWhich[e];return r?!t||t<r?Date.now()-r:-1*(Date.now()-t):0}getKey(e){return this.keys[e]?this.keys[e]:0}getKeyCode(e){return this.codes[e]?this.codes[e]:0}reset(){for(var e in this.keys)delete this.keys[e];for(var e in this.codes)delete this.codes[e];for(var e in this.whichs)delete this.whichs[e]}update(){for(var e in this.keys)this.keys[e]>0?this.keys[e]++:this.keys[e]>-this.maxDecay?this.keys[e]--:delete this.keys[e];for(var e in this.codes){var t=this.releasedCode[e],r=this.pressedCode[e],i=this.getKeyRef(e);if(this.codes[e]>0){if(i.frames=this.codes[e]++,i.time=r?Date.now()-r:0,i.down=!0,!t||t<r)return;return-1*(Date.now()-t)}this.codes[e]>-this.maxDecay?(i.frames=this.codes[e]--,i.time=t-Date.now(),i.down=!1):(i.frames=0,i.time=0,i.down=!1,delete this.codes[e])}for(var e in this.whichs)this.whichs[e]>0?this.whichs[e]++:this.whichs[e]>-this.maxDecay?this.whichs[e]--:delete this.whichs[e]}}}()}),require.register("curvature/mixin/EventTargetMixin.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventTargetMixin=void 0;var e=r("../base/Mixin"),i=Symbol("EventTargetParent"),n=Symbol("CallHandler"),o=Symbol("Capture"),a=Symbol("Bubble"),s=(Symbol("Target"),Symbol("HandlersBubble")),l=Symbol("HandlersCapture"),u=t.EventTargetMixin={[e.Mixin.Constructor](){this[l]=new Map,this[s]=new Map},dispatchEvent(...e){var t=e[0];"string"==typeof t&&(t=new CustomEvent(t),e[0]=t),t.cvPath=t.cvPath||[],t.cvTarget=t.cvCurrentTarget=this;var r=this[o](...e);if(t.cancelable&&(!1===r||t.cancelBubble))return r;var u=[];if(this[l].has(t.type)){var c=this[l].get(t.type),h=[...c];h.forEach(e=>e.push(c)),u.push(...h)}if(this[s].has(t.type)){var f=this[s].get(t.type),d=[...f];d.forEach(e=>e.push(f)),u.push(...d)}for(var[p,v,m]of(u.push([()=>this[n](...e),{},null]),u))if(v.once&&m.delete(p),r=p(t),t.cancelable&&!1===r)break;return t.cancelable&&(t.cancelBubble||!1===r)||this[a](...e),this[i]||Object.freeze(t.cvPath),t.returnValue},addEventListener(e,t,r={}){!0===r&&(r={useCapture:!0});var i=s;r.useCapture&&(i=l),this[i].has(e)||this[i].set(e,new Map),this[i].get(e).set(t,r),r.signal&&r.signal.addEventListener("abort",i=>this.removeEventListener(e,t,r),{once:!0})},removeEventListener(e,t,r={}){!0===r&&(r={useCapture:!0});var i=s;r.useCapture&&(i=l),this[i].has(e)&&this[i].get(e).delete(t)},[o](...e){var t=e[0];if(t.cvPath.push(this),this[i]){var r=this[i][o](...e);if((!t.cancelable||!1!==r&&!t.cancelBubble)&&this[i][l].has(t.type)){t.cvCurrentTarget=this[i];var{type:n}=t,a=this[i][l].get(n);for(var[s,u]of a)if(u.once&&a.delete(s),r=s(t),t.cancelable&&(!1===r||t.cancelBubble))break;return r}}},[a](...e){var t=e[0];if(t.bubbles&&this[i]&&!t.cancelBubble){if(!this[i][s].has(t.type))return this[i][a](...e);var r;t.cvCurrentTarget=this[i];var{type:o}=t,l=this[i][s].get(t.type);for(var[u,c]of l)if(c.once&&l.delete(u),r=u(t),t.cancelable&&!1===r)return r;return r=this[i][n](...e),t.cancelable&&(!1===r||t.cancelBubble)?r:this[i][a](...e)}},[n](...e){var t=e[0];if(!t.defaultPrevented){var r=`on${t.type[0].toUpperCase()+t.type.slice(1)}`;return"function"==typeof this[r]?this[r](t):void 0}}};Object.defineProperty(u,"Parent",{value:i})}()}),require.register("Config.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,o(i.key),i)}}function o(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Config=void 0,(e.Config=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)})).title="wgl2d"}),require.register("gl2d/Gl2d.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,o(i.key),i)}}function o(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Gl2d=void 0;e.Gl2d=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.element=t||document.createElement("canvas"),this.context=this.element.getContext("webgl"),this.screenScale=1,this.zoomLevel=2},(r=[{key:"cleanup",value:function(){this.context.deleteProgram(this.program)}},{key:"createShader",value:function(e){var r=null;switch(e.substring(e.lastIndexOf(".")+1).toUpperCase()){case"VERT":r=this.context.VERTEX_SHADER;break;case"FRAG":r=this.context.FRAGMENT_SHADER}var i=this.context.createShader(r),n=t(e);if(this.context.shaderSource(i,n),this.context.compileShader(i),this.context.getShaderParameter(i,this.context.COMPILE_STATUS))return i;console.error(this.context.getShaderInfoLog(i)),this.context.deleteShader(i)}},{key:"createProgram",value:function(e,t){var r=this.context.createProgram();return this.context.attachShader(r,e),this.context.attachShader(r,t),this.context.linkProgram(r),this.context.detachShader(r,e),this.context.detachShader(r,t),this.context.deleteShader(e),this.context.deleteShader(t),this.context.getProgramParameter(r,this.context.LINK_STATUS)?r:(console.error(this.context.getProgramInfoLog(r)),this.context.deleteProgram(r),r)}}])&&n(e.prototype,r),i&&n(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,r,i}()}),require.register("home/View.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.View=void 0;var n=t("curvature/base/View"),o=t("curvature/input/Keyboard"),a=t("curvature/base/Bag"),s=t("Config"),l=t("../world/Map"),u=t("../sprite/SpriteSheet"),c=t("../sprite/SpriteBoard"),h=t("../ui/Controller"),f=t("../ui/MapEditor"),d=t("../model/Entity"),p=t("../sprite/Camera"),v=t("../model/Controller"),m=t("../sprite/Sprite");function b(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,y(i.key),i)}}function y(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}function g(e,t,r){return t=w(t),function(e,t){if(t&&("object"==i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,r||[],w(e).constructor):t.apply(e,r))}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t){return(_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var T={};T.onScreenJoyPad=new h.Controller,T.keyboard=o.Keyboard.get();e.View=function(e){function r(e){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),window.smProfiling=!0,(i=g(this,r,[e])).template=t("./view.tmp"),i.routes=[],i.entities=new a.Bag,i.keyboard=T.keyboard,i.speed=24,i.maxSpeed=i.speed,i.args.controller=T.onScreenJoyPad,i.args.fps=0,i.args.sps=0,i.args.camX=0,i.args.camY=0,i.args.frameLock=60,i.args.simulationLock=60,i.args.showEditor=!1,i.keyboard.listening=!0,i.keyboard.keys.bindTo("e",function(e,t,r,n){e>0&&i.map.export()}),i.keyboard.keys.bindTo("Escape",function(e,t,r,n){-1===e&&i.spriteBoard.unselect()}),i.keyboard.keys.bindTo("Home",function(e,t,r,n){e>0&&i.args.frameLock++}),i.keyboard.keys.bindTo("End",function(e,t,r,n){e>0&&(i.args.frameLock--,i.args.frameLock<0&&(i.args.frameLock=0))}),i.keyboard.keys.bindTo("PageUp",function(e,t,r,n){e>0&&i.args.simulationLock++}),i.keyboard.keys.bindTo("PageDown",function(e,t,r,n){e>0&&(i.args.simulationLock--,i.args.simulationLock<0&&(i.args.simulationLock=0))}),i.spriteSheet=new u.SpriteSheet,i.map=new l.Map,i.map.import(),i.args.mapEditor=new f.MapEditor({spriteSheet:i.spriteSheet,map:i.map}),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_(e,t)}(r,n.View),i=r,(o=[{key:"onRendered",value:function(){var e=this,t=new c.SpriteBoard(this.tags.canvas.element,this.map);this.spriteBoard=t;var r=new d.Entity({sprite:new m.Sprite({src:void 0,spriteBoard:t,spriteSheet:this.spriteSheet}),controller:new v.Controller({keyboard:this.keyboard,onScreenJoyPad:this.args.controller}),camera:p.Camera});this.entities.add(r),this.spriteBoard.sprites.add(r.sprite),this.spriteBoard.following=r,this.keyboard.keys.bindTo("=",function(t,r,i,n){t>0&&e.zoom(1)}),this.keyboard.keys.bindTo("+",function(t,r,i,n){t>0&&e.zoom(1)}),this.keyboard.keys.bindTo("-",function(t,r,i,n){t>0&&e.zoom(-1)}),this.args.mapEditor.args.bindTo("selectedGraphic",function(t){if(t&&null!=e.spriteBoard.selected.globalX){e.args.showEditor=!1;var r=e.spriteBoard.selected.startGlobalX,i=e.spriteBoard.selected.globalX;if(i<r){var n=[r,i];i=n[0],r=n[1]}for(;r<=i;r++){var o=e.spriteBoard.selected.startGlobalY,a=e.spriteBoard.selected.globalY;if(a<o){var s=[o,a];a=s[0],o=s[1]}for(;o<=a;o++)e.map.setTile(r,o,t)}e.map.setTile(e.spriteBoard.selected.globalX,e.spriteBoard.selected.globalY,t),e.spriteBoard.resize(),e.spriteBoard.unselect()}}),this.spriteBoard.selected.bindTo(function(t,r,i,n,o){null!=e.spriteBoard.selected.localX?(e.args.mapEditor.select(e.spriteBoard.selected),e.args.showEditor=!0,e.spriteBoard.resize()):e.args.showEditor=!1},{wait:0}),this.args.showEditor=!0,window.addEventListener("resize",function(){return e.resize()});var i=0,n=0,o=[],a=function(t){window.requestAnimationFrame(a),e.spriteBoard.draw();var r=t-i;i=t,e.args.fps=(1e3/r).toFixed(3),e.args.camX=Number(p.Camera.x).toFixed(3),e.args.camY=Number(p.Camera.y).toFixed(3)};this.spriteBoard.gl2d.zoomLevel=document.body.clientWidth/1024*2,this.resize(),a(performance.now()),setInterval(function(){!function(t){var r=(t/=1e3)-n;if(0!=e.args.simulationLock){if(!(r<1/(e.args.simulationLock+e.args.simulationLock/60*10)))for(n=t,e.keyboard.update(),Object.values(e.entities.items()).map(function(e){e.simulate()}),e.args._sps=1/r,o.push(e.args._sps);o.length>5;)o.shift()}else o=[0]}(performance.now())},0),setInterval(function(){document.title="".concat(s.Config.title," ").concat(e.args.fps," FPS")},227/3),setInterval(function(){var t=o.reduce(function(e,t){return e+t},0)/o.length;e.args.sps=t.toFixed(3).padStart(5," ")},115.5)}},{key:"resize",value:function(e,t){this.args.width=this.tags.canvas.element.width=e||document.body.clientWidth,this.args.height=this.tags.canvas.element.height=t||document.body.clientHeight,this.args.rwidth=Math.trunc((e||document.body.clientWidth)/this.spriteBoard.gl2d.zoomLevel),this.args.rheight=Math.trunc((t||document.body.clientHeight)/this.spriteBoard.gl2d.zoomLevel);var r=this.spriteBoard.gl2d.screenScale;this.spriteBoard.gl2d.screenScale=document.body.clientWidth/1024,this.spriteBoard.gl2d.zoomLevel*=this.spriteBoard.gl2d.screenScale/r,this.spriteBoard.resize()}},{key:"scroll",value:function(e){var t=e.deltaY>0?-1:e.deltaY<0?1:0;this.zoom(t)}},{key:"zoom",value:function(e){var t=32*this.spriteBoard.gl2d.screenScale,r=.6667*this.spriteBoard.gl2d.screenScale,i=.05*this.spriteBoard.gl2d.zoomLevel,n=this.spriteBoard.gl2d.zoomLevel+e*i;n<r?n=r:n>t&&(n=t),this.spriteBoard.gl2d.zoomLevel!==n&&(this.spriteBoard.gl2d.zoomLevel=n,this.resize())}}])&&b(i.prototype,o),h&&b(i,h),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,h}()}),require.register("home/view.tmp.html",function(e,t,r){r.exports='<canvas\n\tcv-ref = "canvas:curvature/base/Tag"\n\tcv-on  = "wheel:scroll(event);"\n></canvas>\n<div class = "hud fps">\n [[sps]] simulations/s / [[simulationLock]] \n [[fps]] frames/s      / [[frameLock]] \n\n Res [[rwidth]] x [[rheight]]\n     [[width]] x [[height]]\n \n Pos [[camX]] x [[camY]]\n\n δ Sim:   Pg Up / Dn\n δ Frame: Home / End \n δ Scale: + / - \n\n</div>\n<div class = "reticle"></div>\n\n[[controller]]\n\n<div cv-if = "showEditor">\n\t[[mapEditor]]\n\t--\n\t[[mmm]]\n</span>\n'}),require.register("initialize.js",function(e,t,r){"use strict";var i=t("curvature/base/Router"),n=t("home/View");void 0!==Proxy&&document.addEventListener("DOMContentLoaded",function(){var e=new n.View;i.Router.listen(e),e.render(document.body)})}),require.register("inject/Container.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.Container=void 0;var n=t("./Injectable");function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,a(i.key),i)}}function a(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}function s(e,t,r){return t=l(t),function(e,t){if(t&&("object"==i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,r||[],l(e).constructor):t.apply(e,r))}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}e.Container=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),s(this,t,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(t,n.Injectable),r=t,(i=[{key:"inject",value:function(e){return new this.constructor(Object.assign({},this,e))}}])&&o(r.prototype,i),a&&o(r,a),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,i,a}()}),require.register("inject/Injectable.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t,r){return t=o(t),function(e,t){if(t&&("object"==i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,r||[],o(e).constructor):t.apply(e,r))}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,c(i.key),i)}}function u(e,t,r){return t&&l(e.prototype,t),r&&l(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function c(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Injectable=void 0;var h={},f={};e.Injectable=function(){function e(){s(this,e);var t=this.constructor.injections(),r=this.constructor.context();for(var i in h[r]||(h[r]={}),f[r]||(f[r]={}),t){var n=t[i];!h[r][i]&&n.prototype&&(/[A-Z]/.test(String(i)[0])&&(h[r][i]=n))}for(var o in t){var a=void 0,l=h[r][o]||t[o];/[A-Z]/.test(String(o)[0])?(l.prototype?f[r][o]||(f[r][o]=new l):f[r][o]=l,a=f[r][o]):a=l.prototype?new l:l,Object.defineProperty(this,o,{enumerable:!1,writable:!1,value:a})}}return u(e,null,[{key:"injections",value:function(){return{}}},{key:"context",value:function(){return"."}},{key:"inject",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".";if(!(this.prototype instanceof e||this===e))throw new Error("Cannot access injectable subclass!\n\nAre you trying to instantiate like this?\n\n\tnew X.inject({...});\n\nIf so please try:\n\n\tnew (X.inject({...}));\n\nPlease note the parenthesis.\n");var i=this.injections();return function(e){function o(){return s(this,o),n(this,o,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}(o,e),u(o,null,[{key:"injections",value:function(){return Object.assign({},i,t)}},{key:"context",value:function(){return r}}])}(this)}}])}()}),require.register("inject/Single.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,o(i.key),i)}}function o(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.single=e.Single=void 0;var a=e.Single=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name="sss."+Math.random()});e.single=new a}),require.register("model/Controller.js",function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Controller=void 0;var i=t("curvature/base/Bindable");function n(e){"@babel/helpers - typeof";return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,s(i.key),i)}}function a(e,t,r){return(t=s(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}e.Controller=function(){return e=function e(t){var r=this,n=t.keyboard,o=t.onScreenJoyPad;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a(this,"triggers",i.Bindable.makeBindable({})),a(this,"axis",i.Bindable.makeBindable({})),n.keys.bindTo(function(e,t,i,n){e>0?r.keyPress(t,e,i[t]):-1!==e||r.keyRelease(t,e,i[t])}),o.args.bindTo("x",function(e){r.axis[0]=e/50}),o.args.bindTo("y",function(e){r.axis[1]=e/50})},(t=[{key:"keyPress",value:function(e,t,r){if(/^[0-9]$/.test(e))this.triggers[e]=!0;else switch(e){case"ArrowRight":this.axis[0]=1;break;case"ArrowDown":this.axis[1]=1;break;case"ArrowLeft":this.axis[0]=-1;break;case"ArrowUp":this.axis[1]=-1}}},{key:"keyRelease",value:function(e,t,r){if(/^[0-9]$/.test(e))this.triggers[e]=!1;else switch(e){case"ArrowRight":this.axis[0]>0&&(this.axis[0]=0),this.axis[0]=0;case"ArrowLeft":this.axis[0]<0&&(this.axis[0]=0);break;case"ArrowDown":this.axis[1]>0&&(this.axis[1]=0);case"ArrowUp":this.axis[1]<0&&(this.axis[1]=0)}}}])&&o(e.prototype,t),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}()}),require.register("model/Entity.js",function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Entity=void 0;t("../sprite/Camera");function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,o(i.key),i)}}function o(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}e.Entity=function(){return e=function e(t){var r=t.sprite,i=t.controller;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.direction="south",this.state="standing",this.sprite=r,this.controller=i},(t=[{key:"create",value:function(){}},{key:"simulate",value:function(){var e=this.controller.axis[0]||0,t=this.controller.axis[1]||0;for(var r in this.controller.triggers)this.controller.triggers[r]&&console.log(r);e=Math.min(1,Math.max(e,-1)),t=Math.min(1,Math.max(t,-1)),this.sprite.x+=e>0?Math.ceil(4*e):Math.floor(4*e),this.sprite.y+=t>0?Math.ceil(4*t):Math.floor(4*t);var i,n=!1;Math.abs(e)>Math.abs(t)&&(n=!0),n?(this.direction="west",e>0&&(this.direction="east"),this.state="walking"):t?(this.direction="north",t>0&&(this.direction="south"),this.state="walking"):this.state="standing",(i=this.sprite[this.state][this.direction])&&this.sprite.setFrames(i)}},{key:"destroy",value:function(){}}])&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}()}),require.register("overlay/overlay.frag",function(e,t,r){r.exports="precision mediump float;\n\nuniform vec4 u_color;\nvarying vec2 v_texCoord;\n\nvoid main() {\n   // gl_FragColor = texture2D(u_image, v_texCoord);\n   gl_FragColor = vec4(1.0, 1.0, 0.0, 0.25);\n}\n"}),require.register("overlay/overlay.vert",function(e,t,r){r.exports="attribute vec2 a_position;\nattribute vec2 a_texCoord;\n\nuniform vec2 u_resolution;\nvarying vec2 v_texCoord;\n\nvoid main()\n{\n   vec2 zeroToOne = a_position / u_resolution;\n   vec2 zeroToTwo = zeroToOne * 2.0;\n   vec2 clipSpace = zeroToTwo - 1.0;\n\n   gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n   v_texCoord  = a_texCoord;\n}\n"}),require.register("sprite/Background.js",function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Background=void 0;var i=t("./Surface"),n=t("./Camera"),o=t("./SpriteSheet");function a(e){"@babel/helpers - typeof";return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,l(i.key),i)}}function l(e){var t=function(e,t){if("object"!=a(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=a(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==a(t)?t:t+""}e.Background=function(){return e=function e(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.spriteBoard=t,this.spriteSheet=new o.SpriteSheet,this.panes=[],this.panesXY={},this.maxPanes=9,this.map=r,this.layer=i,this.tileWidth=32,this.tileHeight=32,this.surfaceWidth=5,this.surfaceHeight=5},(t=[{key:"renderPane",value:function(e,t,r){var n,o=e*this.tileWidth*this.surfaceWidth*this.spriteBoard.gl2d.zoomLevel,a=t*this.tileHeight*this.surfaceHeight*this.spriteBoard.gl2d.zoomLevel;this.panesXY[o]&&this.panesXY[o][a]?n=this.panesXY[o][a]:(n=new i.Surface(this.spriteBoard,this.spriteSheet,this.map,this.surfaceWidth,this.surfaceHeight,o,a,this.layer),this.panesXY[o]||(this.panesXY[o]={}),this.panesXY[o][a]||(this.panesXY[o][a]=n)),this.panes.push(n),this.panes.length>this.maxPanes&&this.panes.shift()}},{key:"draw",value:function(){this.panes.length=0;var e=Math.floor(n.Camera.x/(this.surfaceWidth*this.tileWidth*this.spriteBoard.gl2d.zoomLevel)+0),t=Math.floor(n.Camera.y/(this.surfaceHeight*this.tileHeight*this.spriteBoard.gl2d.zoomLevel)+0),r=[-1,0,1];for(var i in r)for(var o in r)this.renderPane(e+r[i],t+r[o]);this.panes.forEach(function(e){return e.draw()})}},{key:"resize",value:function(e,t){for(var r in this.panesXY)for(var i in this.panesXY[r])delete this.panesXY[r][i];for(;this.panes.length;)this.panes.pop();this.surfaceWidth=Math.ceil(e/this.tileWidth),this.surfaceHeight=Math.ceil(t/this.tileHeight),this.draw()}},{key:"simulate",value:function(){}}])&&s(e.prototype,t),r&&s(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}()}),require.register("sprite/Camera.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,a(i.key),i)}}function o(e,t,r){return(t=a(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Camera=void 0;var s=e.Camera=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)});o(s,"x",0),o(s,"y",0),o(s,"width",0),o(s,"height",0)}),require.register("sprite/Sprite.js",function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Sprite=void 0;var i=t("curvature/base/Bindable"),n=t("./Camera");function o(e){"@babel/helpers - typeof";return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,s(i.key),i)}}function s(e){var t=function(e,t){if("object"!=o(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=o(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==o(t)?t:t+""}e.Sprite=function(){function e(t){var r=this,n=t.src,o=t.spriteBoard,a=t.spriteSheet;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this[i.Bindable.Prevent]=!0,this.z=0,this.x=0,this.y=0,this.width=0,this.height=0,this.scale=1,this.frames=[],this.frameDelay=4,this.currentDelay=this.frameDelay,this.currentFrame=0,this.currentFrames="",this.speed=0,this.maxSpeed=8,this.moving=!1,this.RIGHT=0,this.DOWN=1,this.LEFT=2,this.UP=3,this.EAST=this.RIGHT,this.SOUTH=this.DOWN,this.WEST=this.LEFT,this.NORTH=this.UP,this.standing={north:["player_standing_north.png"],south:["player_standing_south.png"],west:["player_standing_west.png"],east:["player_standing_east.png"]},this.walking={north:["player_walking_north.png","player_walking_north.png","player_standing_north.png","player_walking_north2.png","player_walking_north2.png","player_standing_north.png"],south:["player_walking_south.png","player_walking_south.png","player_standing_south.png","player_walking_south2.png","player_walking_south2.png","player_standing_south.png"],west:["player_walking_west.png","player_walking_west.png","player_standing_west.png","player_standing_west.png","player_walking_west2.png","player_walking_west2.png","player_standing_west.png","player_standing_west.png"],east:["player_walking_east.png","player_walking_east.png","player_standing_east.png","player_standing_east.png","player_walking_east2.png","player_walking_east2.png","player_standing_east.png","player_standing_east.png"]},this.spriteBoard=o;var s=this.spriteBoard.gl2d.context;this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture);var l=function(){return parseInt(255*Math.random())};s.texImage2D(s.TEXTURE_2D,0,s.RGBA,1,1,0,s.RGBA,s.UNSIGNED_BYTE,new Uint8Array([l(),l(),0,255])),this.spriteSheet=a,this.spriteSheet.ready.then(function(t){var i=r.spriteSheet.getFrame(n);i&&e.loadTexture(r.spriteBoard.gl2d,i).then(function(e){r.texture=e.texture,r.width=e.image.width*r.scale,r.height=e.image.height*r.scale})})}return t=e,o=[{key:"loadTexture",value:function(t,r){var i=t.context;return this.promises||(this.promises={}),this.promises[r]?this.promises[r]:(this.promises[r]=e.loadImage(r).then(function(e){var t=i.createTexture();return i.bindTexture(i.TEXTURE_2D,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e),{image:e,texture:t}}),this.promises[r])}},{key:"loadImage",value:function(e){return new Promise(function(t,r){var i=new Image;i.src=e,i.addEventListener("load",function(e){t(i)})})}}],(r=[{key:"draw",value:function(){this.frameDelay=this.maxSpeed-Math.abs(this.speed),this.frameDelay>this.maxSpeed&&(this.frameDelay=this.maxSpeed),this.currentDelay<=0?(this.currentDelay=this.frameDelay,this.currentFrame++):this.currentDelay--,this.currentFrame>=this.frames.length&&(this.currentFrame=this.currentFrame-this.frames.length);var e=this.frames[this.currentFrame];e&&(this.texture=e.texture,this.width=e.width*this.scale,this.height=e.height*this.scale);var t=this.spriteBoard.gl2d.context;t.bindTexture(t.TEXTURE_2D,this.texture),this.setRectangle(this.x*this.spriteBoard.gl2d.zoomLevel-n.Camera.x+n.Camera.width*this.spriteBoard.gl2d.zoomLevel/2,this.y*this.spriteBoard.gl2d.zoomLevel-n.Camera.y+n.Camera.height*this.spriteBoard.gl2d.zoomLevel/2+.5*-this.height*this.spriteBoard.gl2d.zoomLevel,this.width*this.spriteBoard.gl2d.zoomLevel,this.height*this.spriteBoard.gl2d.zoomLevel),t.drawArrays(t.TRIANGLES,0,6)}},{key:"setFrames",value:function(t){var r=this,i=t.join(" ");if(this.currentFrames!==i){this.currentFrames=i;this.spriteSheet.ready.then(function(i){var n=i.getFrames(t).map(function(t){return function(t){return e.loadTexture(r.spriteBoard.gl2d,t)}(t).then(function(e){return{texture:e.texture,width:e.image.width,height:e.image.height}})});Promise.all(n).then(function(e){return r.frames=e})})}}},{key:"setRectangle",value:function(e,t,r,i){var n=this.spriteBoard.gl2d.context;n.bindBuffer(n.ARRAY_BUFFER,this.spriteBoard.positionBuffer);var o=e,a=t,s=e+r,l=t+i;n.bufferData(n.ARRAY_BUFFER,new Float32Array([o+0,a,this.z,s+0,a,this.z,o,l,this.z,o,l,this.z,s+0,a,this.z,s,l,this.z]),n.STREAM_DRAW)}}])&&a(t.prototype,r),o&&a(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r,o}()}),require.register("sprite/SpriteBoard.js",function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SpriteBoard=void 0;var i=t("curvature/base/Bag"),n=t("./Background"),o=t("../gl2d/Gl2d"),a=t("./Camera"),s=t("./Sprite"),l=t("curvature/base/Bindable"),u=t("./SpriteSheet");function c(e){"@babel/helpers - typeof";return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,f(i.key),i)}}function f(e){var t=function(e,t){if("object"!=c(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=c(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==c(t)?t:t+""}e.SpriteBoard=function(){return e=function e(t,r){var c=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this[l.Bindable.Prevent]=!0,this.map=r,this.mouse={x:null,y:null,clickX:null,clickY:null},this.sprites=new i.Bag,a.Camera.width=t.width,a.Camera.height=t.height,this.gl2d=new o.Gl2d(t);var h=this.gl2d.context;h.blendFunc(h.SRC_ALPHA,h.ONE_MINUS_SRC_ALPHA),h.enable(h.BLEND),this.program=this.gl2d.createProgram(this.gl2d.createShader("sprite/texture.vert"),this.gl2d.createShader("sprite/texture.frag")),this.overlayProgram=this.gl2d.createProgram(this.gl2d.createShader("overlay/overlay.vert"),this.gl2d.createShader("overlay/overlay.frag")),this.positionLocation=h.getAttribLocation(this.program,"a_position"),this.texCoordLocation=h.getAttribLocation(this.program,"a_texCoord"),this.positionBuffer=h.createBuffer(),this.texCoordBuffer=h.createBuffer(),this.resolutionLocation=h.getUniformLocation(this.program,"u_resolution"),this.tilePosLocation=h.getUniformLocation(this.program,"u_tileNo"),this.colorLocation=h.getUniformLocation(this.program,"u_color"),this.overlayLocation=h.getAttribLocation(this.overlayProgram,"a_position"),this.overlayResolution=h.getUniformLocation(this.overlayProgram,"u_resolution"),this.overlayColor=h.getUniformLocation(this.overlayProgram,"u_color"),h.bindBuffer(h.ARRAY_BUFFER,this.positionBuffer),h.enableVertexAttribArray(this.positionLocation),h.vertexAttribPointer(this.positionLocation,3,h.FLOAT,!1,0,0),h.enableVertexAttribArray(this.texCoordLocation),h.bindBuffer(h.ARRAY_BUFFER,this.texCoordBuffer),h.vertexAttribPointer(this.texCoordLocation,2,h.FLOAT,!1,0,0),document.addEventListener("mousemove",function(e){c.mouse.x=e.clientX,c.mouse.y=e.clientY}),this.selected={localX:null,localY:null,globalX:null,globalY:null,startGlobalX:null,startGlobalY:null},this.selected=l.Bindable.makeBindable(this.selected),this.background=new n.Background(this,r);var f=new u.SpriteSheet;for(var d in Array(16).fill()){var p=new s.Sprite({src:"barrel.png",spriteBoard:this,spriteSheet:f});p.x=32*d%128,p.y=32*Math.trunc(32*d/128),this.sprites.add(p)}this.sprites.add(this.background),this.following=null},(t=[{key:"unselect",value:function(){return null!==this.selected.localX&&(this.selected.localX=null,this.selected.localY=null,this.selected.globalX=null,this.selected.globalY=null,!0)}},{key:"draw",value:function(){this.following&&(a.Camera.x=(16+this.following.sprite.x)*this.gl2d.zoomLevel||0,a.Camera.y=(16+this.following.sprite.y)*this.gl2d.zoomLevel||0);var e=this.gl2d.context;e.useProgram(this.program),e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,e.canvas.width,e.canvas.height),e.uniform2f(this.resolutionLocation,e.canvas.width,e.canvas.height);var t=this.sprites.items();window.smProfiling&&console.time("sort"),t.sort(function(e,t){return e instanceof n.Background&&!(t instanceof n.Background)?-1:t instanceof n.Background&&!(e instanceof n.Background)?1:void 0===e.z?-1:void 0===t.z?1:e.z-t.z}),window.smProfiling&&(console.timeEnd("sort"),window.smProfiling=!1),t.forEach(function(e){e.z=e instanceof n.Background?-1:e.y,e.draw()})}},{key:"resize",value:function(e,t){e=e||this.gl2d.element.width,t=t||this.gl2d.element.height,a.Camera.x*=this.gl2d.zoomLevel,a.Camera.y*=this.gl2d.zoomLevel,a.Camera.width=e/this.gl2d.zoomLevel,a.Camera.height=t/this.gl2d.zoomLevel,this.background.resize(a.Camera.width,a.Camera.height)}},{key:"setRectangle",value:function(e,t,r,i){var n=this.gl2d.context;n.bindBuffer(n.ARRAY_BUFFER,this.positionBuffer);var o=e,a=e+r,s=t,l=t+i;n.bufferData(n.ARRAY_BUFFER,new Float32Array([o,s,this.z,a,s,this.z,o,l,this.z,o,l,this.z,a,s,this.z,a,l,this.z]),n.STREAM_DRAW)}}])&&h(e.prototype,t),r&&h(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}()}),require.register("sprite/SpriteSheet.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,o(i.key),i)}}function o(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.SpriteSheet=void 0;e.SpriteSheet=function(){return e=function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.imageUrl="/spritesheet.png",this.boxesUrl="/spritesheet.json",this.vertices={},this.frames={},this.width=0,this.height=0;var r=new Request(this.boxesUrl),i=fetch(r).then(function(e){return e.json()}).then(function(e){return t.boxes=e}),n=new Promise(function(e){t.image=new Image,t.image.src=t.imageUrl,t.image.onload=function(){e()}});this.ready=Promise.all([i,n]).then(function(){return t.processImage()}).then(function(){return t})},r=[{key:"loadTexture",value:function(e,t){var r=e.context;return this.texturePromises||(this.texturePromises={}),this.texturePromises[t]?this.texturePromises[t]:this.texturePromises[t]=this.loadImage(t).then(function(e){var t=r.createTexture();return r.bindTexture(r.TEXTURE_2D,t),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),{image:e,texture:t}})}},{key:"loadImage",value:function(e){return this.imagePromises||(this.imagePromises={}),this.imagePromises[e]?this.imagePromises[e]:(this.imagePromises[e]=new Promise(function(t,r){var i=new Image;i.src=e,i.addEventListener("load",function(e){t(i)})}),this.imagePromises[e])}}],(t=[{key:"processImage",value:function(){var e=this;if(this.boxes&&this.boxes.frames){var t=document.createElement("canvas");t.width=this.image.width,t.height=this.image.height;var r=t.getContext("2d",{willReadFrequently:!0});r.drawImage(this.image,0,0);var i=[],n=function(t){var n=document.createElement("canvas");n.width=e.boxes.frames[t].frame.w,n.height=e.boxes.frames[t].frame.h;var o=n.getContext("2d");e.boxes.frames[t].frame&&o.putImageData(r.getImageData(e.boxes.frames[t].frame.x,e.boxes.frames[t].frame.y,e.boxes.frames[t].frame.w,e.boxes.frames[t].frame.h),0,0),e.boxes.frames[t].text&&(o.fillStyle=e.boxes.frames[t].color||"white",o.font=e.boxes.frames[t].font||"".concat(e.boxes.frames[t].frame.h,"px sans-serif"),o.textAlign="center",o.fillText(e.boxes.frames[t].text,e.boxes.frames[t].frame.w/2,e.boxes.frames[t].frame.h,e.boxes.frames[t].frame.w),o.textAlign=null,o.font=null),i.push(new Promise(function(r){n.toBlob(function(i){e.frames[e.boxes.frames[t].filename]=URL.createObjectURL(i),r(e.frames[e.boxes.frames[t].filename])})}))};for(var o in this.boxes.frames)n(o);return Promise.all(i)}}},{key:"getVertices",value:function(e){return this.vertices[e]}},{key:"getFrame",value:function(e){return this.frames[e]}},{key:"getFrames",value:function(e){var t=this;return Array.isArray(e)?e.map(function(e){return t.getFrame(e)}):this.getFramesByPrefix(e)}},{key:"getFramesByPrefix",value:function(e){var t=[];for(var r in this.frames)r.substring(0,e.length)===e&&t.push(this.frames[r]);return t}}])&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}()}),require.register("sprite/Surface.js",function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Surface=void 0;var i=t("curvature/base/Bindable"),n=t("./Camera");function o(e){"@babel/helpers - typeof";return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,s(i.key),i)}}function s(e){var t=function(e,t){if("object"!=o(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=o(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==o(t)?t:t+""}e.Surface=function(){return e=function e(t,r,n){var o=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:-1;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this[i.Bindable.Prevent]=!0,this.spriteBoard=t,this.spriteSheet=r,this.x=l,this.y=u,this.z=h,this.layer=c,this.xSize=a,this.ySize=s,this.tileWidth=32,this.tileHeight=32,this.width=this.xSize*this.tileWidth,this.height=this.ySize*this.tileHeight,this.map=n,this.texVertices=[];var f=this.spriteBoard.gl2d.context;this.subTextures={},this.spriteSheet.ready.then(function(e){for(var t=[],r=o.xSize*o.ySize,i=function(e){var r=e%o.xSize+Math.floor(o.x/o.tileWidth),i=Math.floor(e/o.xSize)+Math.floor(o.y/o.tileHeight),n=o.map.getTile(r,i,o.layer);if(Array.isArray(n)){var a=0;o.subTextures[e]=[],t.push(Promise.all(n.map(function(t){return o.spriteSheet.constructor.loadTexture(o.spriteBoard.gl2d,t).then(function(t){o.subTextures[e][a]=t.texture,a++})})))}else t.push(o.spriteSheet.constructor.loadTexture(gl2d,n).then(function(t){return o.subTextures[e]=t.texture}))},n=0;n<r;n++)i(n);Promise.all(t).then(function(){return o.assemble()})}),this.pane=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.pane),f.texImage2D(f.TEXTURE_2D,0,f.RGBA,this.width,this.height,0,f.RGBA,f.UNSIGNED_BYTE,null),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.NEAREST),this.frameBuffer=f.createFramebuffer(),f.bindFramebuffer(f.FRAMEBUFFER,this.frameBuffer),f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,this.pane,0)},(t=[{key:"draw",value:function(){var e=this.spriteBoard.gl2d.context;e.bindTexture(e.TEXTURE_2D,this.pane);var t=this.x+-n.Camera.x+n.Camera.width*this.spriteBoard.gl2d.zoomLevel/2,r=this.y+-n.Camera.y+n.Camera.height*this.spriteBoard.gl2d.zoomLevel/2;this.setRectangle(t,r,this.width*this.spriteBoard.gl2d.zoomLevel,this.height*this.spriteBoard.gl2d.zoomLevel),e.bindFramebuffer(e.FRAMEBUFFER,null),e.drawArrays(e.TRIANGLES,0,6)}},{key:"assemble",value:function(){var e=this.spriteBoard.gl2d.context;e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.viewport(0,0,this.width,this.height),e.clearColor(Math.random(),Math.random(),Math.random(),1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.uniform4f(this.spriteBoard.colorLocation,1,0,0,1),e.uniform2f(this.spriteBoard.resolutionLocation,this.width,this.height),this.subTextures[0][0]&&(e.bindTexture(e.TEXTURE_2D,this.subTextures[0][0]),e.bindBuffer(e.ARRAY_BUFFER,this.spriteBoard.texCoordBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,this.width/32,0,0,-this.height/32,0,-this.height/32,this.width/32,0,this.width/32,-this.height/32]),e.STATIC_DRAW),this.setRectangle(0,0,this.width,this.height),e.drawArrays(e.TRIANGLES,0,6));var t=0,r=0;for(var i in this.subTextures){for(var n in Array.isArray(this.subTextures[i])||(this.subTextures[i]=[this.subTextures[i]]),this.subTextures[i])e.uniform3f(this.spriteBoard.tilePosLocation,Number(i),Object.keys(this.subTextures).length,0),e.bindBuffer(e.ARRAY_BUFFER,this.spriteBoard.texCoordBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),e.STATIC_DRAW),this.setRectangle(t,r+this.tileHeight,this.tileWidth,-this.tileHeight),e.drawArrays(e.TRIANGLES,0,6);(t+=this.tileWidth)>=this.width&&(t=0,r+=this.tileHeight)}e.uniform3f(this.spriteBoard.tilePosLocation,0,0,0)}},{key:"setRectangle",value:function(e,t,r,i){var n=this.spriteBoard.gl2d.context;n.bindBuffer(n.ARRAY_BUFFER,this.spriteBoard.positionBuffer);var o=e,a=e+r,s=t,l=t+i;n.bufferData(n.ARRAY_BUFFER,new Float32Array([o,l,this.z,a,l,this.z,o,s,this.z,o,s,this.z,a,l,this.z,a,s,this.z]),n.STATIC_DRAW)}}])&&a(e.prototype,t),r&&a(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}()}),require.register("sprite/TextureBank.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,o(i.key),i)}}function o(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.TextureBank=void 0;e.TextureBank=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)})}),require.register("sprite/texture.frag",function(e,t,r){r.exports="// texture.frag\n\nprecision mediump float;\n\nuniform sampler2D u_image;\nuniform vec4 u_color;\nvarying vec2 v_texCoord;\nuniform vec3 u_tileNo;\n\n\nvec2 ripple(vec2 texCoord, float ripple, float disp) {\n  return vec2(v_texCoord.x + sin(v_texCoord.y * ripple) * disp, v_texCoord.y);\n}\n\nvoid main() {\n  vec2 v_displaced = ripple(v_texCoord, 0.0, 0.0);\n  // vec2 v_displaced = ripple(v_texCoord, 3.1415 * 2.0, 0.025);\n\n  if (v_displaced.x > 1.0) {\n    v_displaced.x = 1.0 - (v_displaced.x - 1.0);\n  }\n\n  if (v_displaced.x < 0.0) {\n    v_displaced.x = abs(v_displaced.x);\n  }\n\n  // gl_FragColor.w = gl_FragColor.w * 0.5;\n  if (u_tileNo.z > 0.0) {\n    gl_FragColor = vec4(u_tileNo.x / u_tileNo.y, 0, 0, 1.0);\n  } \n  else {\n    gl_FragColor = texture2D(u_image, v_displaced);\n  }\n  // gl_FragColor = gl_PointCoord.yyxx;\n}\n"}),require.register("sprite/texture.vert",function(e,t,r){r.exports="// texture.vert\n\nattribute vec3 a_position;\nattribute vec2 a_texCoord;\n\nuniform   vec2 u_resolution;\n\nvarying   vec2 v_texCoord;\n\nvoid main()\n{\n  vec2 zeroToOne = a_position.xy / u_resolution;\n  vec2 zeroToTwo = zeroToOne * 2.0;\n  vec2 clipSpace = zeroToTwo - 1.0;\n\n  gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n  v_texCoord  = a_texCoord;\n}\n"}),require.register("ui/Controller.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.Controller=void 0;var n=t("curvature/base/View");function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,a(i.key),i)}}function a(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}function s(e,t,r){return t=l(t),function(e,t){if(t&&("object"==i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,r||[],l(e).constructor):t.apply(e,r))}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}e.Controller=function(e){function r(e){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(i=s(this,r,[e])).template=t("./controller.tmp"),i.dragStart=!1,i.args.dragging=!1,i.args.x=0,i.args.y=0,window.addEventListener("mousemove",function(e){i.moveStick(e)}),window.addEventListener("mouseup",function(e){i.dropStick(e)}),window.addEventListener("touchmove",function(e){i.moveStick(e)}),window.addEventListener("touchend",function(e){i.dropStick(e)}),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(r,n.View),i=r,(a=[{key:"dragStick",value:function(e){var t=e;e.preventDefault(),e.touches&&e.touches[0]&&(t=e.touches[0]),this.args.dragging=!0,this.dragStart={x:t.clientX,y:t.clientY}}},{key:"moveStick",value:function(e){if(this.args.dragging){var t=e;e.touches&&e.touches[0]&&(t=e.touches[0]),this.args.xx=t.clientX-this.dragStart.x,this.args.yy=t.clientY-this.dragStart.y;this.args.xx<-50?this.args.x=-50:this.args.xx>50?this.args.x=50:this.args.x=this.args.xx,this.args.yy<-50?this.args.y=-50:this.args.yy>50?this.args.y=50:this.args.y=this.args.yy}}},{key:"dropStick",value:function(e){this.args.dragging=!1,this.args.x=0,this.args.y=0}}])&&o(i.prototype,a),l&&o(i,l),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,a,l}()}),require.register("ui/MapEditor.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.MapEditor=void 0;var n=t("curvature/base/View");function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,a(i.key),i)}}function a(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}function s(e,t,r){return t=l(t),function(e,t){if(t&&("object"==i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,r||[],l(e).constructor):t.apply(e,r))}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}e.MapEditor=function(e){function r(e){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(i=s(this,r,[e])).template=t("./mapEditor.tmp"),e.spriteSheet.ready.then(function(e){i.args.tiles=e.frames}),i.args.bindTo("selectedGraphic",function(e){i.args.selectedGraphic=null},{wait:0}),i.args.multiSelect=!1,i.args.selection={},i.args.selectedImage=null,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(r,n.View),i=r,(a=[{key:"selectGraphic",value:function(e){console.log(e),this.args.selectedGraphic=e}},{key:"select",value:function(e){Object.assign(this.args.selection,e),e.globalX!==e.startGlobalX||e.globalY!==e.startGlobalY?this.args.multiSelect=!0:this.args.multiSelect=!1,this.args.multiSelect||(this.args.selectedImages=this.args.map.getTile(e.globalX,e.globalY))}}])&&o(i.prototype,a),l&&o(i,l),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,a,l}()}),require.register("ui/controller.tmp.html",function(e,t,r){r.exports='<div class = "controller">\n\t<div class = "joystick" cv-on = "\n\t\ttouchstart:dragStick(event);\n\t\tmousedown:dragStick(event);\n\t">\n\t\t<div class = "pad" style = "position: relative; transform:translate([[x]]px,[[y]]px);"></div>\n\t</div>\n\n\t<div class = "button">A</div>\n\t<div class = "button">B</div>\n\t<div class = "button">C</div>\n</div>'}),require.register("ui/mapEditor.tmp.html",function(e,t,r){r.exports='<div class = "tab-page mapEditor">\n\t<div class = "tabs">\n\t\t<div>Tile</div>\n\t\t<div>Layer</div>\n\t\t<div>Object</div>\n\t\t<div>Trigger</div>\n\t\t<div>Map</div>\n\t</div>\n\n\t<div class = "tile">\n\t\t<div class = "selected">\n\t\t\t<div cv-if = "!multiSelect">\n\t\t\t\t<p style = "font-size: large">\n\t\t\t\t\t([[selection.globalX]], [[selection.globalY]])\n\t\t\t\t</p>\n\t\t\t\t<p cv-each = "selectedImages:selectedImage:sI">\n\t\t\t\t\t<button>-</button>\n\t\t\t\t\t<img class = "current" cv-attr = "src:selectedImage">\n\t\t\t\t</p>\n\t\t\t\t<button>+</button>\n\t\t\t</div>\n\t\t\t<div cv-if = "multiSelect">\n\t\t\t\t<p style = "font-size: large">\n\t\t\t\t\t([[selection.startGlobalX]], [[selection.startGlobalY]]) - ([[selection.globalX]], [[selection.globalY]])\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class = "tiles" cv-each = "tiles:tile:t">\n\t\t\t<img cv-attr = "src:tile,title:t" cv-on = "click:selectGraphic(t);">\n\t\t</div>\n\t</div>\n\t\x3c!-- <div class = "tile">OBJECT MODE</div>\n\t<div class = "tile">TRIGGER MODE</div>\n\t<div class = "tile">MAP MODE</div> --\x3e\n</div>'}),require.register("world/Actor.js",function(e,t,r){"use strict"}),require.register("world/Floor.js",function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Floor=void 0;var i=t("../sprite/Sprite");function n(e){"@babel/helpers - typeof";return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,a(i.key),i)}}function a(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}e.Floor=function(){return e=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.gl2d=t,this.sprites=[],this.resize(9,9)},(t=[{key:"resize",value:function(e,t){this.width=e,this.height=t;for(var r=0;r<e;r++)for(var n=0;n<t;n++){var o=new i.Sprite(this.gl2d,"/floorTile.png");o.x=32*r,o.y=32*n,this.sprites.push(o)}}},{key:"draw",value:function(){this.sprites.map(function(e){return e.draw()})}}])&&o(e.prototype,t),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}()}),require.register("world/Map.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.Map=void 0;var n=t("../sprite/SpriteSheet"),o=t("../inject/Injectable"),a=t("curvature/base/Bindable");function s(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,l(i.key),i)}}function l(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}function u(e,t,r){return t=c(t),function(e,t){if(t&&("object"==i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,r||[],c(e).constructor):t.apply(e,r))}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}e.Map=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=u(this,t))[a.Bindable.Prevent]=!0,e.tiles={},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(t,o.Injectable.inject({SpriteSheet:n.SpriteSheet})),r=t,(i=[{key:"getTile",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(this.tiles["".concat(e,",").concat(t,"--").concat(r)])return[this.SpriteSheet.getFrame(this.tiles["".concat(e,",").concat(t,"--").concat(r)])];return e%4==0&&t%4==0&&"cheese.png",-1===e&&-1===t?[this.SpriteSheet.getFrame("box_face.png")]:[this.SpriteSheet.getFrame("floorTile.png")]}},{key:"setTile",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.tiles["".concat(e,",").concat(t,"--").concat(i)]=r}},{key:"export",value:function(){console.log(JSON.stringify(this.tiles))}},{key:"import",value:function(e){e='{"-2,11":"lava_center_middle.png","-1,11":"lava_center_middle.png","0,11":"lava_center_middle.png"}',this.tiles=JSON.parse(e)}}])&&s(r.prototype,i),l&&s(r,l),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,i,l}()}),require.register("___globals___",function(e,t,r){})}(),require("___globals___");
