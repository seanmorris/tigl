!function(){"use strict";var e="undefined"==typeof global?self:global;if("function"!=typeof e.require){var t={},i={},r={},n={}.hasOwnProperty,o=/^\.\.?(\/|$)/,s=function(e,t){for(var i,r=[],n=(o.test(t)?e+"/"+t:t).split("/"),s=0,a=n.length;s<a;s++)".."===(i=n[s])?r.pop():"."!==i&&""!==i&&r.push(i);return r.join("/")},a=function(e){return e.split("/").slice(0,-1).join("/")},l=function(t,r){var n,o={id:t,exports:{},hot:d&&d.createHot(t)};return i[t]=o,r(o.exports,(n=t,function(t){var i=s(a(n),t);return e.require(i,n)}),o),o.exports},u=function(e){var t=r[e];return t&&e!==t?u(t):e},h=function(e,r){null==r&&(r="/");var o=u(e);if(n.call(i,o))return i[o].exports;if(n.call(t,o))return l(o,t[o]);throw new Error("Cannot find module '"+e+"' from '"+r+"'")};h.alias=function(e,t){r[t]=e};var c=/\.[^.\/]+$/,f=/\/index(\.[^\/]+)?$/;h.register=h.define=function(e,o){if(e&&"object"==typeof e)for(var s in e)n.call(e,s)&&h.register(s,e[s]);else t[e]=o,delete i[e],function(e){if(c.test(e)){var t=e.replace(c,"");n.call(r,t)&&r[t].replace(c,"")!==t+"/index"||(r[t]=e)}if(f.test(e)){var i=e.replace(f,"");n.call(r,i)||(r[i]=e)}}(e)},h.list=function(){var e=[];for(var i in t)n.call(t,i)&&e.push(i);return e};var d=e._hmr&&new e._hmr(function(e,t){return u(s(a(e),t))},h,t,i);h._cache=i,h.hmr=d&&d.wrap,h.brunch=!0,e.require=h}}(),function(){"undefined"==typeof window||window;var e=function(e,t,i){var r={},n=function(t,i){try{return e(i+"/node_modules/"+t)}catch(e){if(-1===e.toString().indexOf("Cannot find module"))throw e;if(-1!==i.indexOf("node_modules")){var o=i.split("/"),s=o.lastIndexOf("node_modules"),a=o.slice(0,s).join("/");return n(t,a)}}return r};return function(o){if(o in t&&(o=t[o]),o){if("."!==o[0]&&i){var s=n(o,i);if(s!==r)return s}return e(o)}}};require.register("curvature/base/Bag.js",function(t,i,r){i=e(i,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Bag=void 0;var e=i("./Bindable"),r=i("./Mixin"),n=i("../mixin/EventTargetMixin"),o=e=>Number(e),s=Symbol("Mapped"),a=Symbol("Has"),l=Symbol("Add"),u=Symbol("Remove"),h=Symbol("Delete");class c extends(r.Mixin.with(n.EventTargetMixin)){constructor(t){super(),this.changeCallback=t,this.content=new Map,this.current=0,this.length=0,this.list=e.Bindable.makeBindable([]),this.meta=Symbol("meta"),this.type=void 0}has(e){return this[s]?this[s].has(e):this[a](e)}[a](e){return this.content.has(e)}add(e){return this[s]?this[s].add(e):this[l](e)}[l](t){if(void 0===t||!(t instanceof Object))throw new Error("Only objects may be added to Bags.");if(this.type&&!(t instanceof this.type))throw console.error(this.type,t),new Error(`Only objects of type ${this.type} may be added to this Bag.`);if(t=e.Bindable.make(t),!this.content.has(t)){var i=new CustomEvent("adding",{detail:{item:t}});if(this.dispatchEvent(i)){var r=o(this.current++);this.content.set(t,r),this.list[r]=t,this.changeCallback&&this.changeCallback(t,this.meta,c.ITEM_ADDED,r);var n=new CustomEvent("added",{detail:{item:t,id:r}});return this.dispatchEvent(n),this.length=this.size,r}}}remove(e){return this[s]?this[s].remove(e):this[u](e)}[u](t){if(void 0===t||!(t instanceof Object))throw new Error("Only objects may be removed from Bags.");if(this.type&&!(t instanceof this.type))throw console.error(this.type,t),new Error(`Only objects of type ${this.type} may be removed from this Bag.`);if(t=e.Bindable.make(t),!this.content.has(t))return this.changeCallback&&this.changeCallback(t,this.meta,0,void 0),!1;var i=new CustomEvent("removing",{detail:{item:t}});if(this.dispatchEvent(i)){var r=this.content.get(t);delete this.list[r],this.content.delete(t),this.changeCallback&&this.changeCallback(t,this.meta,c.ITEM_REMOVED,r);var n=new CustomEvent("removed",{detail:{item:t,id:r}});return this.dispatchEvent(n),this.length=this.size,t}}delete(e){if(this[s])return this[s].delete(e);this[h](e)}[h](e){this.remove(e)}map(e=(e=>e),t=(e=>e)){var i=new WeakMap,r=new c;return r[s]=this,this.addEventListener("added",n=>{var o=n.detail.item;if(t(o)&&!i.has(o)){var s=e(o);i.set(o,s),r[l](s)}}),this.addEventListener("removed",e=>{var t=e.detail.item;if(i.has(t)){var n=i.get(t);i.delete(t),r[u](n)}}),r}get size(){return this.content.size}items(){return Array.from(this.content.entries()).map(e=>e[0])}}t.Bag=c,Object.defineProperty(c,"ITEM_ADDED",{configurable:!1,enumerable:!1,writable:!0,value:1}),Object.defineProperty(c,"ITEM_REMOVED",{configurable:!1,enumerable:!1,writable:!0,value:-1})}()}),require.register("curvature/base/Bindable.js",function(t,i,r){i=e(i,{},"curvature"),function(){"use strict";function e(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Object.defineProperty(t,"__esModule",{value:!0}),t.Bindable=void 0;var i=Symbol("ref"),r=Symbol("original"),n=Symbol("deck"),o=Symbol("binding"),s=Symbol("subBinding"),a=Symbol("bindingAll"),l=Symbol("isBindable"),u=Symbol("wrapping"),h=Symbol("Names"),c=Symbol("executing"),f=Symbol("stack"),d=(Symbol("object"),Symbol("wrapped")),p=Symbol("unwrapped"),v=Symbol("getProto"),m=Symbol("onGet"),y=Symbol("onAllGet"),g=Symbol("bindChain"),b=Symbol("Descriptors"),w=Symbol("Before"),x=Symbol("After"),T=Symbol("NoGetters"),E=Symbol("Prevent"),P=Object.getPrototypeOf(Int8Array),_=Set.prototype[Symbol.iterator],S=Map.prototype[Symbol.iterator],O="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:void 0,j=e=>"function"==typeof O.Map&&e instanceof O.Map||"function"==typeof O.Set&&e instanceof O.Set||"function"==typeof O.Node&&e instanceof O.Node||"function"==typeof O.WeakMap&&e instanceof O.WeakMap||"function"==typeof O.Location&&e instanceof O.Location||"function"==typeof O.Storage&&e instanceof O.Storage||"function"==typeof O.WeakSet&&e instanceof O.WeakSet||"function"==typeof O.ArrayBuffer&&e instanceof O.ArrayBuffer||"function"==typeof O.Promise&&e instanceof O.Promise||"function"==typeof O.File&&e instanceof O.File||"function"==typeof O.Event&&e instanceof O.Event||"function"==typeof O.CustomEvent&&e instanceof O.CustomEvent||"function"==typeof O.Gamepad&&e instanceof O.Gamepad||"function"==typeof O.ResizeObserver&&e instanceof O.ResizeObserver||"function"==typeof O.MutationObserver&&e instanceof O.MutationObserver||"function"==typeof O.PerformanceObserver&&e instanceof O.PerformanceObserver||"function"==typeof O.IntersectionObserver&&e instanceof O.IntersectionObserver||"function"==typeof O.IDBCursor&&e instanceof O.IDBCursor||"function"==typeof O.IDBCursorWithValue&&e instanceof O.IDBCursorWithValue||"function"==typeof O.IDBDatabase&&e instanceof O.IDBDatabase||"function"==typeof O.IDBFactory&&e instanceof O.IDBFactory||"function"==typeof O.IDBIndex&&e instanceof O.IDBIndex||"function"==typeof O.IDBKeyRange&&e instanceof O.IDBKeyRange||"function"==typeof O.IDBObjectStore&&e instanceof O.IDBObjectStore||"function"==typeof O.IDBOpenDBRequest&&e instanceof O.IDBOpenDBRequest||"function"==typeof O.IDBRequest&&e instanceof O.IDBRequest||"function"==typeof O.IDBTransaction&&e instanceof O.IDBTransaction||"function"==typeof O.IDBVersionChangeEvent&&e instanceof O.IDBVersionChangeEvent||"function"==typeof O.FileSystemFileHandle&&e instanceof O.FileSystemFileHandle||"function"==typeof O.RTCPeerConnection&&e instanceof O.RTCPeerConnection||"function"==typeof O.ServiceWorkerRegistration&&e instanceof O.ServiceWorkerRegistration||"function"==typeof O.WebGLTexture&&e instanceof O.WebGLTexture;class R{static isBindable(e){return!!(e&&e[l]&&e[E])&&e[l]===R}static onDeck(e,t){return e[n].get(t)||!1}static ref(e){return e[i]||e||!1}static makeBindable(e){return this.make(e)}static shuck(e,t){t=t||new Map;var i=Object.create({});if(e instanceof P||e instanceof ArrayBuffer){var n=e.slice(0);return t.set(e,n),n}var o=Object.keys(e);for(var s in o){var a=o[s];if("___"!==a.substring(0,3)){var l=t.get(e[a]);if(l)i[a]=l;else if(e[a]!==e){if(e[a]&&"object"==typeof e[a]){var u=e[a];R.isBindable(e[a])&&(u=e[a][r]),i[a]=this.shuck(u,t)}else i[a]=e[a];t.set(e[a],i[a])}else t.set(e[a],i),i[a]=i}}return R.isBindable(e)&&(delete i.bindTo,delete i.isBound),i}static make(e){if(e[E])return e;if(!e||!["function","object"].includes(typeof e))return e;if(i in e)return e[i];if(e[l])return e;if(Object.isSealed(e)||Object.isFrozen(e)||!Object.isExtensible(e)||j(e))return e;Object.defineProperty(e,l,{configurable:!1,enumerable:!1,writable:!1,value:R}),Object.defineProperty(e,i,{configurable:!0,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(e,r,{configurable:!1,enumerable:!1,writable:!1,value:e}),Object.defineProperty(e,n,{configurable:!1,enumerable:!1,writable:!1,value:new Map}),Object.defineProperty(e,o,{configurable:!1,enumerable:!1,writable:!1,value:Object.create(null)}),Object.defineProperty(e,s,{configurable:!1,enumerable:!1,writable:!1,value:new Map}),Object.defineProperty(e,a,{configurable:!1,enumerable:!1,writable:!1,value:new Set}),Object.defineProperty(e,c,{enumerable:!1,writable:!0}),Object.defineProperty(e,u,{enumerable:!1,writable:!0}),Object.defineProperty(e,f,{configurable:!1,enumerable:!1,writable:!1,value:[]}),Object.defineProperty(e,w,{configurable:!1,enumerable:!1,writable:!1,value:new Set}),Object.defineProperty(e,x,{configurable:!1,enumerable:!1,writable:!1,value:new Set}),Object.defineProperty(e,d,{configurable:!1,enumerable:!1,writable:!1,value:Object.preventExtensions(new Map)}),Object.defineProperty(e,p,{configurable:!1,enumerable:!1,writable:!1,value:Object.preventExtensions(new Map)}),Object.defineProperty(e,b,{configurable:!1,enumerable:!1,writable:!1,value:Object.preventExtensions(new Map)});var t=(i,r=null,n={})=>{var l=!1;if(Array.isArray(i)){var u=i.map(e=>t(e,r,n));return()=>u.forEach(e=>e())}if(i instanceof Function&&(n=r||{},r=i,l=!0),n.delay>=0&&(r=this.wrapDelayCallback(r,n.delay)),n.throttle>=0&&(r=this.wrapThrottleCallback(r,n.throttle)),n.wait>=0&&(r=this.wrapWaitCallback(r,n.wait)),n.frame&&(r=this.wrapFrameCallback(r,n.frame)),n.idle&&(r=this.wrapIdleCallback(r)),l){if(e[a].add(r),!("now"in n)||n.now)for(var h in e)r(e[h],h,e,!1);return()=>{e[a].delete(r)}}if(e[o][i]||(e[o][i]=new Set),n.children){var c=r;r=((...t)=>{var i=t[0],r=e[s].get(c);if(r&&(e[s].delete(c),r()),"object"==typeof i){var o=R.make(i);R.isBindable(o)&&e[s].set(c,o.bindTo((...e)=>c(...t,...e),Object.assign({},n,{children:!1}))),c(...t)}else c(...t)})}e[o][i].add(r),"now"in n&&!n.now||r(e[i],i,e,!1);var f=()=>{var t=e[s].get(r);t&&(e[s].delete(r),t()),e[o][i]&&e[o][i].has(r)&&e[o][i].delete(r)};return n.removeWith&&n.removeWith instanceof View&&n.removeWith.onRemove(()=>f),f};Object.defineProperty(e,"bindTo",{configurable:!1,enumerable:!1,writable:!1,value:t});Object.defineProperty(e,g,{configurable:!1,enumerable:!1,writable:!1,value:(t,i)=>{var r=t.split("."),n=r.shift(),o=r.slice(0),s=[];return s.push(e.bindTo(n,(e,t,r,n)=>{var a=o.join(".");0!==o.length?(void 0===e&&(e=r[t]=this.make({})),s=s.concat(e[g](a,i))):i(e,t,r,n)})),()=>s.forEach(e=>e())}}),Object.defineProperty(e,"___before",{configurable:!1,enumerable:!1,writable:!1,value:t=>(e[w].add(t),()=>e[w].delete(t))}),Object.defineProperty(e,"___after",{configurable:!1,enumerable:!1,writable:!1,value:t=>(e[x].add(t),()=>e[x].delete(t))});for(var k in Object.defineProperty(e,"isBound",{configurable:!1,enumerable:!1,writable:!1,value:()=>{if(e[a].size)return!0;for(var t of Object.values(e[o]))if(t.size)return!0;return!1}}),e)e[k]&&"object"==typeof e[k]&&(e[k][i]||e[k]instanceof Promise||Object.isExtensible(e[k])&&!Object.isSealed(e[k])&&(j(e[k])||(e[k]=R.make(e[k]))));var M=e[b],C=e[d],B=e[f],A=Object.create(null);return A.set=((t,i,r)=>{if(r&&"object"==typeof r&&(r=R.make(r),t[i]===r))return!0;C.has(i)&&C.delete(i);var s=e[n],l=s.has(i),u=l&&s.get(i);if(l&&u===r)return!0;if(i.slice&&"___"===i.slice(-3))return!0;if(t[i]===r||"number"==typeof r&&isNaN(u)&&isNaN(r))return!0;for(var h of(s.set(i,r),e[a]))h(r,i,t,!1);if(i in e[o])for(var c of e[o][i])c(r,i,t,!1,t[i]);if(s.delete(i),O.File&&t instanceof O.File&&"lastModifiedDate"==i||Reflect.set(t,i,r),Array.isArray(t)&&e[o].length)for(var f in e[o].length)(0,e[o].length[f])(t.length,"length",t,!1,t.length);return!0}),A.construct=((t,i)=>{var n="constructor";for(var o of t[w])o(t,n,e[f],void 0,i);var s=R.make(new t[r](...i));for(var a of t[x])a(t,n,e[f],s,i);return s}),A.deleteProperty=((t,i)=>{var r=e[n];if(r.has(i))return!0;if(!(i in t))return!0;if(M.has(i)){var s=M.get(i);if(s&&!s.configurable)return!1;M.delete(i)}for(var l of(r.set(i,null),C.has(i)&&C.delete(i),e[a]))l(void 0,i,t,!0,t[i]);if(i in e[o])for(var u of e[o][i])u(void 0,i,t,!0,t[i]);return Reflect.deleteProperty(t,i),r.delete(i),!0}),e[T]||(A.getPrototypeOf=(t=>v in e?e[v]:Reflect.getPrototypeOf(t)),A.get=((t,n)=>{if(C.has(n))return C.get(n);if(n===i||n===r||"apply"===n||"isBound"===n||"bindTo"===n||"__proto__"===n||"constructor"===n)return e[n];var o;if(M.has(n)?o=M.get(n):(o=Object.getOwnPropertyDescriptor(e,n),M.set(n,o)),o&&!o.configurable&&!o.writable)return e[n];if(y in e)return e[y](n);if(m in e&&!(n in e))return e[m](n);if(o&&!o.configurable&&!o.writable)return C.set(n,e[n]),e[n];if("function"==typeof e[n]){if(h in e[n])return e[n];e[p].set(n,e[n]);var s=Object.getPrototypeOf(e)[n]===e[n],a=j(e)||"function"==typeof e[Symbol.iterator]&&"next"===n||"function"==typeof P&&e instanceof P||"function"==typeof EventTarget&&e instanceof EventTarget||"function"==typeof Date&&e instanceof Date||"function"==typeof S&&e.prototype===S||"function"==typeof _&&e.prototype===_?e:e[i],l=function(...t){for(var i of(e[c]=n,B.unshift(n),e[w]))i(e,n,B,e,t);var r;if(new.target)r=new(e[p].get(n))(...t);else{var o=e[p].get(n);r=s?o.apply(a||e,t):o(...t)}for(var l of e[x])l(e,n,B,e,t);return e[c]=null,B.shift(),r};l[y]=(t=>e[n][t]);var u=R.make(l);return C.set(n,u),u}return e[n]})),Object.defineProperty(e,i,{configurable:!1,enumerable:!1,writable:!1,value:new Proxy(e,A)}),e[i]}static clearBindings(e){var t=(e=>(...t)=>t.map(e))(e=>Object.keys(e).map(t=>delete e[t]));e[a].clear(),t(e[d],e[o],e[x],e[w])}static resolve(e,t,i=!1){for(var r,n=t.split("."),o=n[0];n.length;){if(i&&1===n.length)return[this.make(e),n.shift(),o];(r=n.shift())in e&&e[r]&&"object"==typeof e[r]||(e[r]=Object.create(null)),e=this.make(e[r])}return[this.make(e),r,o]}static wrapDelayCallback(e,t){return(...i)=>setTimeout(()=>e(...i),t)}static wrapThrottleCallback(e,t){return this.throttles.set(e,!1),(...i)=>{this.throttles.get(e,!0)||(e(...i),this.throttles.set(e,!0),setTimeout(()=>{this.throttles.set(e,!1)},t))}}static wrapWaitCallback(e,t){return(...i)=>{var r;(r=this.waiters.get(e))&&(this.waiters.delete(e),clearTimeout(r)),r=setTimeout(()=>e(...i),t),this.waiters.set(e,r)}}static wrapFrameCallback(e,t){return(...t)=>{requestAnimationFrame(()=>e(...t))}}static wrapIdleCallback(e){return(...t)=>{(window.requestIdleCallback||requestAnimationFrame)(()=>e(...t))}}}t.Bindable=R,e(R,"waiters",new WeakMap),e(R,"throttles",new WeakMap),Object.defineProperty(R,"Prevent",{configurable:!1,enumerable:!1,writable:!1,value:E}),Object.defineProperty(R,"OnGet",{configurable:!1,enumerable:!1,writable:!1,value:m}),Object.defineProperty(R,"NoGetters",{configurable:!1,enumerable:!1,writable:!1,value:T}),Object.defineProperty(R,"GetProto",{configurable:!1,enumerable:!1,writable:!1,value:v}),Object.defineProperty(R,"OnAllGet",{configurable:!1,enumerable:!1,writable:!1,value:y})}()}),require.register("curvature/base/Cache.js",function(t,i,r){i=e(i,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Cache=void 0;t.Cache=class{static store(e,t,i,r="standard"){var n=0;i&&(n=1e3*i+(new Date).getTime()),this.buckets||(this.buckets=new Map),this.buckets.has(r)||this.buckets.set(r,new Map);var o=new CustomEvent("cvCacheStore",{cancelable:!0,detail:{key:e,value:t,expiry:i,bucket:r}});document.dispatchEvent(o)&&this.buckets.get(r).set(e,{value:t,expiration:n})}static load(e,t=!1,i="standard"){var r=new CustomEvent("cvCacheLoad",{cancelable:!0,detail:{key:e,defaultvalue:t,bucket:i}});if(!document.dispatchEvent(r))return t;if(this.buckets&&this.buckets.has(i)&&this.buckets.get(i).has(e)){var n=this.buckets.get(i).get(e);if(0===n.expiration||n.expiration>(new Date).getTime())return this.buckets.get(i).get(e).value}return t}}}()}),require.register("curvature/base/Config.js",function(t,i,r){i=e(i,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Config=void 0;var e={},r=i,n="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:void 0;try{e=r("/Config").Config}catch(t){!0===n.devMode&&console.error(t),e={}}class o{static get(e){return this.configs[e]}static set(e,t){return this.configs[e]=t,this}static dump(){return this.configs}static init(...e){for(var t in e){var i=e[t];for(var r in"string"==typeof i&&(i=JSON.parse(i)),i){var n=i[r];return this.configs[r]=n}}return this}}t.Config=o,Object.defineProperty(o,"configs",{configurable:!1,enumerable:!1,writable:!1,value:e})}()}),require.register("curvature/base/Dom.js",function(t,i,r){i=e(i,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Dom=void 0;t.Dom=class{static mapTags(e,t,i,r,n){var o=[],s=!0;r&&(s=!1);var a=!1,{Node:l,Element:u,NodeFilter:h,document:c}=globalThis.window,f=c.createTreeWalker(e,h.SHOW_ELEMENT|h.SHOW_TEXT,{acceptNode:(e,i)=>{if(!s){if(e!==r)return h.FILTER_SKIP;s=!0}return n&&e===n&&(a=!0),a?h.FILTER_SKIP:t?e instanceof u&&e.matches(t)?h.FILTER_ACCEPT:h.FILTER_SKIP:h.FILTER_ACCEPT}},!1);for(0;f.nextNode();)o.push(i(f.currentNode,f));return o}static dispatchEvent(e,t){e.dispatchEvent(t),this.mapTags(e,!1,e=>{e.dispatchEvent(t)})}}}()}),require.register("curvature/base/Mixin.js",function(t,i,r){i=e(i,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Mixin=void 0;var e=i("./Bindable"),r=Symbol("constructor");Symbol("mixinList");class n{static from(e,...t){var i=class extends e{constructor(...r){var o=e.constructor?super(...r):null;for(var s of t)switch(s[n.Constructor]&&s[n.Constructor].apply(this),typeof s){case"function":n.mixClass(s,i);break;case"object":n.mixObject(s,this)}return o}};return i}static make(...e){var t=e.pop();return n.to(t,...e)}static to(e,...t){var i={};t.map(t=>{switch(typeof t){case"object":Object.assign(i,Object.getOwnPropertyDescriptors(t));break;case"function":Object.assign(i,Object.getOwnPropertyDescriptors(t.prototype))}delete i.constructor,Object.defineProperties(e.prototype,i)})}static with(...e){return this.from(class{constructor(){}},...e)}static mixObject(e,t){for(var i of Object.getOwnPropertyNames(e))"function"!=typeof e[i]?t[i]=e[i]:t[i]=e[i].bind(t);for(var r of Object.getOwnPropertySymbols(e))"function"!=typeof e[r]?t[r]=e[r]:t[r]=e[r].bind(t)}static mixClass(e,t){for(var i of Object.getOwnPropertyNames(e.prototype))if(!["name","prototype","length"].includes(i)){var r=Object.getOwnPropertyDescriptor(t,i);r&&!r.writable||("function"==typeof e[i]?t.prototype[i]=e.prototype[i].bind(t.prototype):t.prototype[i]=e.prototype[i])}for(var n of Object.getOwnPropertySymbols(e.prototype))"function"==typeof e[n]?t.prototype[n]=e.prototype[n].bind(t.prototype):t.prototype[n]=e.prototype[n];var o=function(){if(["name","prototype","length"].includes(s))return 0;var i=Object.getOwnPropertyDescriptor(t,s);if(i&&!i.writable)return 0;if("function"!=typeof e[s])return t[s]=e[s],0;var r=t[s]||!1,n=e[s].bind(t);t[s]=((...e)=>(r&&r(...e),n(...e)))};for(var s of Object.getOwnPropertyNames(e))o();var a=function(){if("function"!=typeof e[l])return t.prototype[l]=e[l],1;var i=t[l]||!1,r=e[l].bind(t);t[l]=((...e)=>(i&&i(...e),r(...e)))};for(var l of Object.getOwnPropertySymbols(e))a()}static mix(t){for(var i={},r={},n=e.Bindable.makeBindable(t),o=function(e){var t=Object.getOwnPropertyNames(e.prototype),o=Object.getOwnPropertyNames(e),s=/^(before|after)__(.+)/,a=function(t){var r=t.match(s);if(r){switch(r[1]){case"before":n.___before((i,n,o,s,a)=>{if(n===r[2])return e[t].bind(s)(...a)});break;case"after":n.___after((i,n,o,s,a)=>{if(n===r[2])return e[t].bind(s)(...a)})}return 0}return i[t]?0:"function"!=typeof e[t]?0:void(i[t]=e[t])};for(var l of o)a(l);var u=function(t){var i=t.match(s);if(i){switch(i[1]){case"before":n.___before((r,n,o,s,a)=>{if(n===i[2])return e.prototype[t].bind(s)(...a)});break;case"after":n.___after((r,n,o,s,a)=>{if(n===i[2])return e.prototype[t].bind(s)(...a)})}return 0}return r[t]?0:"function"!=typeof e.prototype[t]?0:void(r[t]=e.prototype[t])};for(var h of t)u(h)},s=this;s&&s.prototype;s=Object.getPrototypeOf(s))o(s);for(var a in i)t[a]=i[a].bind(t);var l=function(e){t.prototype[e]=function(...t){return r[e].apply(this,t)}};for(var u in r)l(u);return n}}t.Mixin=n,n.Constructor=r}()}),require.register("curvature/base/Router.js",function(t,i,r){i=e(i,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Router=void 0;var e,r=i("./View"),n=(i("./Cache"),i("./Config")),o=i("./Routes"),s=Symbol("NotFound"),a=Symbol("Internal"),l="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:void 0;l.CustomEvent=null!==(e=l.CustomEvent)&&void 0!==e?e:l.Event;class u{static wait(e,t="DOMContentLoaded",i=document){i.addEventListener(t,()=>{this.listen(e)})}static listen(e,t=!1){this.listener=e||this.listener,this.routes=t||e.routes,Object.assign(this.query,this.queryOver({}));var i=t=>{t.preventDefault(),t.state&&"routedId"in t.state?(t.state.routedId<=this.routeCount?(this.history.splice(t.state.routedId),this.routeCount=t.state.routedId):t.state.routedId>this.routeCount&&(this.history.push(t.state.prev),this.routeCount=t.state.routedId),this.state=t.state):null!==this.prevPath&&this.prevPath!==location.pathname&&this.history.push(this.prevPath),this.isOriginLimited(location)?this.match(this.nextPath,e):this.match(location.pathname,e)};window.addEventListener("cvUrlChanged",i),window.addEventListener("popstate",i);var r=!this.isOriginLimited(location)&&location.pathname+location.search;!this.isOriginLimited(location)&&location.hash&&(r+=location.hash);var n={routedId:this.routeCount,url:location.pathname,prev:this.prevPath};this.isOriginLimited(location)||history.replaceState(n,null,location.pathname),this.go(!1!==r?r:"/")}static go(e,t=!1){var i=n.Config.get("title");i&&(document.title=i);var r={routedId:this.routeCount,prev:this.prevPath,url:location.pathname};-1===t?this.match(e,this.listener,!0):this.isOriginLimited(location)?this.nextPath=e:2===t&&location.pathname!==e?history.replaceState(r,null,e):location.pathname!==e&&history.pushState(r,null,e),(!t||t<0)&&(!1===t&&(this.path=null),t||("#"===e.substring(0,1)?window.dispatchEvent(new HashChangeEvent("hashchange")):window.dispatchEvent(new CustomEvent("cvUrlChanged")))),this.prevPath=e}static processRoute(e,t,i){return"function"==typeof e[t]?e[t].prototype instanceof r.View?new e[t](i):e[t](i):e[t]}static handleError(e,t,i,r,n,o,s,u){"undefined"!=typeof document&&document.dispatchEvent(new CustomEvent("cvRouteError",{detail:{error:e,path:o,prev:s,view:n,routes:t,selected:i}}));var h=l.devMode?"Unexpected error: "+String(e):"Unexpected error.";t[a]&&(r[a]=e,h=this.processRoute(t,a,r)),this.update(n,o,h,t,i,r,u)}static match(e,t,i=!1){var r=null,n=!1;if(!0===i&&(n=i),i&&"object"==typeof i&&(n=i.forceRefresh,r=i.event),"undefined"==typeof document||this.path!==e||n){var a="http://example.com";"undefined"!=typeof document&&(a=this.isOriginLimited(location)?a:location.origin,this.queryString=location.search);var l=new URL(e,a);e=this.path=l.pathname,"undefined"==typeof document&&(this.queryString=l.search);var u=this.prevPath,h=t&&t.args?t.args.content:null,c=this.routes||t&&t.routes||o.Routes.dump(),f=new URLSearchParams(this.queryString);for(var d in r&&r.request&&(this.request=r.request),Object.keys(this.query))delete this.query[d];for(var[p,v]of f)this.query[p]=v;var m={},y=!1,g="";for(var b in"/"===e.substring(0,1)&&(e=e.substring(1)),e=e.split("/"),this.query)m[b]=this.query[b];e:for(var w in c){var x=w.split("/");if(!(x.length<e.length&&"*"!==x[x.length-1])){for(var T in x)if("%"==x[T].substr(0,1)){var E=null,P=/^%(\w+)\??/.exec(x[T]);if(P&&P[1]&&(E=P[1]),!E)throw new Error(`${x[T]} is not a valid argument segment in route "${w}"`);if(e[T])m[E]=e[T];else{if("?"!=x[T].substr(x[T].length-1,1))continue e;m[E]=""}}else if("*"!==x[T]&&e[T]!==x[T])continue e;y=w,g=c[w],"*"===x[x.length-1]&&(m.pathparts=e.slice(x.length-1));break}}var _=new CustomEvent("cvRouteStart",{cancelable:!0,detail:{path:e,prev:u,root:t,selected:y,routes:c}});if("undefined"==typeof document||document.dispatchEvent(_)){if(!n&&t&&h&&"object"==typeof g&&h.constructor===g.constructor&&!(g instanceof Promise)&&h.update(m))return t.args.content=h,!0;y in c||(c[y]=c[s]);try{return!1===(g=this.processRoute(c,y,m))&&(g=this.processRoute(c,s,m)),"undefined"==typeof document?g instanceof Promise?g:Promise.resolve(g):g instanceof Promise?g.then(i=>this.update(t,e,i,c,y,m,n)).catch(i=>{this.handleError(i,c,y,m,t,e,u,n)}):this.update(t,e,g,c,y,m,n)}catch(i){this.handleError(i,c,y,m,t,e,u,n)}}}}static update(e,t,i,n,o,s,a){if(e){var l=this.prevPath,u=new CustomEvent("cvRoute",{cancelable:!0,detail:{result:i,path:t,prev:l,view:e,routes:n,selected:o}});!1!==i&&(e.args.content instanceof r.View&&(e.args.content.pause(!0),e.args.content.remove()),document.dispatchEvent(u)&&(e.args.content=i),i instanceof r.View&&(i.pause(!1),i.update(s,a)));var h=new CustomEvent("cvRouteEnd",{cancelable:!0,detail:{result:i,path:t,prev:l,view:e,routes:n,selected:o}});document.dispatchEvent(h)}}static isOriginLimited({origin:e}){return"null"===e||"file://"===e}static queryOver(e={}){var t=new URLSearchParams(location.search),i={},r={};for(var n of t)r[n[0]]=n[1];return delete(i=Object.assign(i,r,e)).api,i}static queryToString(e={},t=!1){var i=[],r=e;for(var n in t||(r=this.queryOver(e)),r)""!==r[n]&&i.push(n+"="+encodeURIComponent(r[n]));return i.join("&")}static setQuery(e,t,i){var r=this.queryOver();r[e]=t,void 0===t&&delete r[e];var n=this.queryToString(r,!0);this.go(location.pathname+(n?"?"+n:"?"),i)}}t.Router=u,Object.defineProperty(u,"query",{configurable:!1,enumerable:!1,writable:!1,value:{}}),Object.defineProperty(u,"history",{configurable:!1,enumerable:!1,writable:!1,value:[]}),Object.defineProperty(u,"routeCount",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(u,"prevPath",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(u,"queryString",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(u,"InternalError",{configurable:!1,enumerable:!1,writable:!1,value:a}),Object.defineProperty(u,"NotFoundError",{configurable:!1,enumerable:!1,writable:!1,value:s})}()}),require.register("curvature/base/Routes.js",function(t,i,r){i=e(i,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Routes=void 0;var e={},r=i,n=!1,o=()=>{if(!n){try{Object.assign(e,r("Routes").Routes||{})}catch(e){!0===globalThis.devMode&&console.warn(e)}n=!0}};class s{static get(e){return o(),this.routes[e]}static dump(){return o(),this.routes}}t.Routes=s,Object.defineProperty(s,"routes",{configurable:!1,enumerable:!1,writable:!1,value:e})}()}),require.register("curvature/base/RuleSet.js",function(t,i,r){i=e(i,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RuleSet=void 0;i("./Dom");var e=i("./Tag"),r=i("./View");class n{static add(e,t){return this.globalRules=this.globalRules||{},this.globalRules[e]=this.globalRules[e]||[],this.globalRules[e].push(t),this}static apply(e=document,t=null){for(var i in this.globalRules)for(var r in this.globalRules[i]){var n=this.globalRules[i][r],o=this.wrap(e,n,t),s=e.querySelectorAll(i);for(var a of s)o(a)}}add(e,t){return this.rules=this.rules||{},this.rules[e]=this.rules[e]||[],this.rules[e].push(t),this}apply(e=document,t=null){for(var i in n.apply(e,t),this.rules)for(var r in this.rules[i]){var o=this.rules[i][r],s=n.wrap(e,o,t),a=e.querySelectorAll(i);for(var l of a)s(l)}}purge(){if(this.rules)for(var[e,t]of Object.entries(this.rules))if(this.rules[e])for(var i in this.rules[e])delete this.rules[e][i]}static wait(e="DOMContentLoaded",t=document){var i=((e,t)=>()=>(t.removeEventListener(e,i),this.apply()))(e,t);t.addEventListener(e,i)}static wrap(t,i,n=null){var o=i;return(i instanceof r.View||i&&i.prototype&&i.prototype instanceof r.View)&&(o=(()=>i)),t=>{if(void 0===t.___cvApplied___&&Object.defineProperty(t,"___cvApplied___",{enumerable:!1,writable:!1,value:new WeakSet}),!t.___cvApplied___.has(i)){var s,a;n&&(s=a=n,n.viewList&&(a=n.viewList.parent));var l=new e.Tag(t,a,null,void 0,s),u=l.element.parentNode,h=l.element.nextSibling,c=o(l);if(!1!==c&&t.___cvApplied___.add(i),c instanceof HTMLElement&&(c=new e.Tag(c)),c instanceof e.Tag){if(!c.element.contains(l.element)){for(;l.element.firstChild;)c.element.appendChild(l.element.firstChild);l.remove()}h?u.insertBefore(c.element,h):u.appendChild(c.element)}c&&c.prototype&&c.prototype instanceof r.View&&(c=new c({},n)),c instanceof r.View&&(n&&(n.cleanup.push(()=>c.remove()),n.cleanup.push(n.args.bindTo((e,t,i)=>{i[t]=e,c.args[t]=e})),n.cleanup.push(c.args.bindTo((e,t,i,r)=>{i[t]=e,n.args[t]=e}))),l.clear(),c.render(l.element))}}}}t.RuleSet=n}()}),require.register("curvature/base/SetMap.js",function(t,i,r){i=e(i,{},"curvature"),function(){"use strict";function e(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Object.defineProperty(t,"__esModule",{value:!0}),t.SetMap=void 0;t.SetMap=class{constructor(){e(this,"_map",new Map)}has(e){return this._map.has(e)}get(e){return this._map.get(e)}getOne(e){var t=this.get(e);for(var i of t)return i}add(e,t){var i=this._map.get(e);return i||this._map.set(e,i=new Set),i.add(t)}remove(e,t){var i=this._map.get(e);if(i){var r=i.delete(t);return i.size||this._map.delete(e),r}}values(){return new Set(...[...this._map.values()].map(e=>[...e.values()]))}}}()}),require.register("curvature/base/Tag.js",function(t,i,r){i=e(i,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tag=void 0;var e=i("./Bindable"),r=Symbol("CurrentStyle"),n=Symbol("CurrentAttrs"),o=function(e){if(this.node)for(var t in e){var i=String(e[t]);this[r].has(t)&&this[r].get(t)===e[t]||Number.isNaN(e[t])||("-"===t[0]?this.node.style.setProperty(t,i):this.node.style[t]=i,void 0!==e[t]?this[r].set(t,e[t]):this[r].delete(t))}},s=function(e){return"function"==typeof this[e]?this[e]:this.node&&"function"==typeof this.node[e]?this[e]=((...t)=>this.node[e](...t)):"style"===e?this.proxy.style:this.node&&e in this.node?this.node[e]:this[e]};t.Tag=class{constructor(t,i,a,l,u){if("string"==typeof t){var h=document.createRange().createContextualFragment(t);t=h.firstChild}this.element=e.Bindable.makeBindable(t),this.node=this.element,this.parent=i,this.direct=u,this.ref=a,this.index=l,this.cleanup=[],this[e.Bindable.OnAllGet]=s.bind(this),this[r]=new Map,this[n]=new Map;var c=e.Bindable.make(o.bind(this));return Object.defineProperty(this,"style",{value:c}),this.proxy=e.Bindable.make(this),this.proxy.style.bindTo((e,t,i,n)=>{this[r].has(t)&&this[r].get(t)===e||(this.node.style[t]=e,n||void 0===e?this[r].delete(t):this[r].set(t,e))}),this.proxy.bindTo((e,i)=>{if("index"!==i)return i in t&&t[i]!==e&&(t[i]=e),!1}),this.proxy}attr(e){for(var t in e)this[n].has(t)&&void 0===e[t]?(this.node.removeAttribute(t),this[n].delete(t)):this[n].has(t)&&this[n].get(t)===e[t]||(null===e[t]?(this.node.setAttribute(t,""),this[n].set(t,"")):(this.node.setAttribute(t,e[t]),this[n].set(t,e[t])));return this}remove(){var t;for(this.node&&this.node.remove(),e.Bindable.clearBindings(this);t=this.cleanup.shift();)t();if(this.clear(),this.node){var i=new Event("cvDomDetached");this.node.dispatchEvent(i),this.node=this.element=this.ref=this.parent=void 0}}clear(){if(this.node)for(var e=new Event("cvDomDetached");this.node.firstChild;)this.node.firstChild.dispatchEvent(e),this.node.removeChild(this.node.firstChild)}pause(e=!0){}listen(e,t,i){var r=this.node;r.addEventListener(e,t,i);var n=()=>{r.removeEventListener(e,t,i)},o=()=>{n(),n=(()=>console.warn("Already removed!"))};return this.parent.onRemove(()=>o()),o}}}()}),require.register("curvature/base/Uuid.js",function(t,i,r){i=e(i,{},"curvature"),function(){"use strict";function e(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Object.defineProperty(t,"__esModule",{value:!0}),t.Uuid=void 0;var i=("object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:void 0).crypto;class r{constructor(t=null,n=4){if(e(this,"uuid",null),e(this,"version",4),t){if("string"!=typeof t&&!(t instanceof r)||!t.match(/[0-9A-Fa-f]{8}(-[0-9A-Fa-f]{4}){3}-[0-9A-Fa-f]{12}/))throw new Error(`Invalid input for Uuid: "${t}"`);this.version=n,this.uuid=t}else if(i&&"function"==typeof i.randomUUID)this.uuid=i.randomUUID();else{var o=i&&"function"==typeof i.randomUUID?()=>i.getRandomValues(new Uint8Array(1))[0]:()=>Math.trunc(256*Math.random());this.uuid=([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^o()&15>>e/4).toString(16))}Object.freeze(this)}[Symbol.toPrimitive](){return this.toString()}toString(){return this.uuid}toJson(){return{version:this.version,uuid:this.uuid}}}t.Uuid=r}()}),require.register("curvature/base/View.js",function(t,i,r){i=e(i,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.View=void 0;var e=i("./Bindable"),r=i("./ViewList"),n=i("./Router"),o=i("./Uuid"),s=i("./Dom"),a=i("./Tag"),l=i("./Bag"),u=i("./RuleSet"),h=i("./Mixin"),c=i("../mixin/EventTargetMixin"),f=Symbol("dontParse"),d=Symbol("expandBind"),p=Symbol("uuid");class v extends(h.Mixin.with(c.EventTargetMixin)){get _id(){return this[p]}static from(e,t={},i=null){var r=new this(t,i);return r.template=e,r}constructor(t={},i=null){super(t,i),this[c.EventTargetMixin.Parent]=i,Object.defineProperty(this,"args",{value:e.Bindable.make(t)}),Object.defineProperty(this,p,{value:this.constructor.uuid()}),Object.defineProperty(this,"nodesAttached",{value:new l.Bag((e,t,i)=>{})}),Object.defineProperty(this,"nodesDetached",{value:new l.Bag((e,t,i)=>{})}),Object.defineProperty(this,"_onRemove",{value:new l.Bag((e,t,i)=>{})}),Object.defineProperty(this,"cleanup",{value:[]}),Object.defineProperty(this,"parent",{value:i,writable:!0}),Object.defineProperty(this,"views",{value:new Map}),Object.defineProperty(this,"viewLists",{value:new Map}),Object.defineProperty(this,"withViews",{value:new Map}),Object.defineProperty(this,"tags",{value:e.Bindable.make({})}),Object.defineProperty(this,"nodes",{value:e.Bindable.make([])}),Object.defineProperty(this,"timeouts",{value:new Map}),Object.defineProperty(this,"intervals",{value:new Map}),Object.defineProperty(this,"frames",{value:[]}),Object.defineProperty(this,"ruleSet",{value:new u.RuleSet}),Object.defineProperty(this,"preRuleSet",{value:new u.RuleSet}),Object.defineProperty(this,"subBindings",{value:{}}),Object.defineProperty(this,"templates",{value:{}}),Object.defineProperty(this,"postMapping",{value:new Set}),Object.defineProperty(this,"eventCleanup",{value:[]}),Object.defineProperty(this,"unpauseCallbacks",{value:new Map}),Object.defineProperty(this,"interpolateRegex",{value:/(\[\[((?:\$+)?[\w\.\|-]+)\]\])/g}),Object.defineProperty(this,"rendered",{value:new Promise((e,t)=>Object.defineProperty(this,"renderComplete",{value:e}))}),this.onRemove(()=>{this[c.EventTargetMixin.Parent]&&(this[c.EventTargetMixin.Parent]=null)}),this.controller=this,this.template="",this.firstNode=null,this.lastNode=null,this.viewList=null,this.mainView=null,this.preserve=!1,this.removed=!1,this.loaded=Promise.resolve(this)}static isView(){return v}onFrame(e){var t=!1,i=()=>{t=!0},r=i=>{this.removed||t||(this.paused||e(Date.now()),requestAnimationFrame(r))};return requestAnimationFrame(()=>r(Date.now())),this.frames.push(i),i}onNextFrame(e){return requestAnimationFrame(()=>e(Date.now()))}onIdle(e){return requestIdleCallback(()=>e(Date.now()))}onTimeout(e,t){var i={timeout:null,callback:null,time:e,fired:!1,created:(new Date).getTime(),paused:!1},r=()=>{t(),i.fired=!0,this.timeouts.delete(i.timeout)},n=setTimeout(r,e);return i.callback=r,i.timeout=n,this.timeouts.set(i.timeout,i),n}clearTimeout(e){if(this.timeouts.has(e)){var t=this.timeouts.get(e);clearTimeout(t.timeout),this.timeouts.delete(t.timeout)}}onInterval(e,t){var i=setInterval(t,e);return this.intervals.set(i,{timeout:i,callback:t,time:e,paused:!1}),i}clearInterval(e){if(this.intervals.has(e)){var t=this.intervals.get(e);clearTimeout(t.timeout),this.intervals.delete(t.timeout)}}pause(e){if(void 0===e&&(this.paused=!this.paused),this.paused=e,this.paused){for(var[t,i]of this.timeouts)i.fired?this.timeouts.delete(i.timeout):(clearTimeout(i.timeout),i.paused=!0,i.time=Math.max(0,i.time-(Date.now()-i.created)));for(var[r,n]of this.intervals)clearInterval(n.timeout),n.paused=!0}else{for(var[o,s]of this.timeouts)s.paused&&(s.fired?this.timeouts.delete(s.timeout):(s.timeout=setTimeout(s.callback,s.time),s.paused=!1));for(var[a,l]of this.intervals)l.paused&&(l.timeout=setInterval(l.callback,l.time),l.paused=!1);for(var[,u]of this.unpauseCallbacks)u();this.unpauseCallbacks.clear()}for(var[h,c]of this.viewLists)c.pause(!!e);for(var f in this.tags)if(Array.isArray(this.tags[f]))for(var d in this.tags[f])this.tags[f][d].pause(!!e);else this.tags[f].pause(!!e)}render(e=null,t=null,i=null){var{document:r}=globalThis.window;if(e instanceof v&&(e=e.firstNode.parentNode),t instanceof v&&(t=t.firstNode),this.firstNode)return this.reRender(e,t,i);this.dispatchEvent(new CustomEvent("render"));var n,o="object"==typeof this.template&&"function"==typeof this.template.cloneNode,s=o||v.templates.has(this.template);if(n=s?o?this.template.cloneNode(!0):v.templates.get(this.template).cloneNode(!0):r.createRange().createContextualFragment(this.template),s||o||v.templates.set(this.template,n.cloneNode(!0)),this.mainView||this.preRuleSet.apply(n,this),this.mapTags(n),this.mainView||this.ruleSet.apply(n,this),!0===globalThis.devMode?(this.firstNode=r.createComment(`Template ${this._id} Start`),this.lastNode=r.createComment(`Template ${this._id} End`)):(this.firstNode=r.createTextNode(""),this.lastNode=r.createTextNode("")),this.nodes.push(this.firstNode,...Array.from(n.childNodes),this.lastNode),this.postRender(e),this.dispatchEvent(new CustomEvent("rendered")),this.dispatchAttach()){if(e){t?(e.insertBefore(this.firstNode,t),e.insertBefore(this.lastNode,t)):(e.insertBefore(this.firstNode,null),e.insertBefore(this.lastNode,null)),e.insertBefore(n,this.lastNode);var a=e.getRootNode();if(a.isConnected)this.attached(a,e),this.dispatchAttached(a,e,i);else if(i){var l=t=>{var r=e.getRootNode();this.attached(r,e),this.dispatchAttached(r,e,i),i.removeEventListener("attached",l)};i.addEventListener("attached",l)}}return this.renderComplete(this.nodes),this.nodes}}dispatchAttach(){var{CustomEvent:e}=globalThis.window;return this.dispatchEvent(new e("attach",{cancelable:!0,target:this}))}dispatchAttached(e,t,i){var{CustomEvent:r}=globalThis.window;for(var n of(this.dispatchEvent(new r("attached",{detail:{view:i||this,node:t,root:e,mainView:this}})),this.dispatchDomAttached(i),this.nodesAttached.items()))n(e,t)}dispatchDomAttached(e){var{Node:t,CustomEvent:i}=globalThis.window;this.nodes.filter(e=>e.nodeType!==t.COMMENT_NODE).forEach(t=>{t.matches&&(t.dispatchEvent(new i("cvDomAttached",{target:t,detail:{view:e||this,mainView:this}})),s.Dom.mapTags(t,!1,(t,r)=>{t.matches&&t.dispatchEvent(new i("cvDomAttached",{target:t,detail:{view:e||this,mainView:this}}))}))})}reRender(e,t,i){var{CustomEvent:r}=globalThis.window;if(this.dispatchEvent(new r("reRender"),{cancelable:!0,target:this,view:i})){var n=new DocumentFragment;if(this.firstNode.isConnected){var o=this.nodesDetached.items();for(var s in o)o[s]()}if(n.append(...this.nodes),e){t?(e.insertBefore(this.firstNode,t),e.insertBefore(this.lastNode,t)):(e.insertBefore(this.firstNode,null),e.insertBefore(this.lastNode,null)),e.insertBefore(n,this.lastNode),this.dispatchEvent(new r("reRendered"),{cancelable:!0,target:this,view:i});var a=e.getRootNode();a.isConnected&&(this.attached(a,e),this.dispatchAttached(a,e))}return this.nodes}}mapTags(e){s.Dom.mapTags(e,!1,(e,t)=>{e[f]||(e=e.matches?(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=this.mapInterpolatableTag(e)).matches("[cv-template]")&&this.mapTemplateTag(e)||e).matches("[cv-slot]")&&this.mapSlotTag(e)||e).matches("[cv-prerender]")&&this.mapPrendererTag(e)||e).matches("[cv-link]")&&this.mapLinkTag(e)||e).matches("[cv-attr]")&&this.mapAttrTag(e)||e).matches("[cv-expand]")&&this.mapExpandableTag(e)||e).matches("[cv-ref]")&&this.mapRefTag(e)||e).matches("[cv-on]")&&this.mapOnTag(e)||e).matches("[cv-each]")&&this.mapEachTag(e)||e).matches("[cv-bind]")&&this.mapBindTag(e)||e).matches("[cv-with]")&&this.mapWithTag(e)||e).matches("[cv-if]")&&this.mapIfTag(e)||e).matches("[cv-view]")&&this.mapViewTag(e)||e:this.mapInterpolatableTag(e))!==t.currentNode&&(t.currentNode=e)}),this.postMapping.forEach(e=>e())}mapExpandableTag(t){var i=t[d];i&&(i(),t[d]=!1);var[r,n]=e.Bindable.resolve(this.args,t.getAttribute("cv-expand"),!0);return t.removeAttribute("cv-expand"),r[n]||(r[n]={}),r[n]=e.Bindable.make(r[n]),this.onRemove(t[d]=r[n].bindTo((e,i,r,n,o)=>{n||void 0===e?t.removeAttribute(i,e):null!==e?t.setAttribute(i,e):t.setAttribute(i,"")})),t}mapAttrTag(e){var t=this.compileAttrTag(e)(this);return e.replaceWith(t),t}compileAttrTag(t){var i=t.getAttribute("cv-attr").split(/[,;]/).map(e=>e.split(":"));return t.removeAttribute("cv-attr"),r=>{var n=t.cloneNode(!0),o=function(){var t=i[s][1]||i[s][0],[o,a]=e.Bindable.resolve(r.args,t,!0),l=i[s][0];r.onRemove(o.bindTo(a,(e,t,i,r)=>{r||void 0===e?n.removeAttribute(l,e):null!==e?n.setAttribute(l,e):n.setAttribute(l,"")}))};for(var s in i)o();return n}}mapInterpolatableTag(t){var i=this,r=this.interpolateRegex,{Node:n,document:o}=globalThis.window;if(t.nodeType===n.TEXT_NODE){var s=t.nodeValue;if(!this.interpolatable(s))return t;for(var l,u,h=0,d=function(){var r=l[2],u=!1,d=!1,p=r.split("|"),m=!1;if(p.length>1&&(m=i.stringTransformer(p.slice(1)),r=p[0]),"$$"===r.substr(0,2)&&(u=!0,d=!0,r=r.substr(2)),"$"===r.substr(0,1)&&(u=!0,r=r.substr(1)),"000"===r.substr(0,3))return expand=!0,r=r.substr(3),0;var y=s.substring(h,l.index);h=l.index+l[1].length;var g,b=o.createTextNode(y);b[f]=!0,t.parentNode.insertBefore(b,t),(g=u?o.createElement("div"):o.createTextNode(""))[f]=!0;var w=i.args,x=r;if(r.match(/\./)&&([w,x]=e.Bindable.resolve(i.args,r,!0)),t.parentNode.insertBefore(g,t),"object"!=typeof w)return 1;var T=(w=e.Bindable.make(w)).bindTo(x,(e,r,o)=>{if(o[r]!==e&&(o[r]instanceof v||o[r]instanceof n||o[r]instanceof a.Tag)&&(o[r].preserve||o[r].remove()),d&&!(e instanceof v)){var s=null!==e&&void 0!==e?e:"";(e=new v(i.args,i)).template=s}if(m&&(e=m(e)),e instanceof v){g.nodeValue="",e[c.EventTargetMixin.Parent]=i,e.render(t.parentNode,g,i);var l=()=>{e.preserve||e.remove()};i.onRemove(l),e.onRemove(()=>i._onRemove.remove(l))}else e instanceof n?(g.nodeValue="",t.parentNode.insertBefore(e,g),i.onRemove(()=>e.remove())):e instanceof a.Tag?(g.nodeValue="",e.node?(t.parentNode.insertBefore(e.node,g),i.onRemove(()=>e.remove())):e.remove()):(e instanceof Object&&e.__toString instanceof Function&&(e=e.__toString()),u?g.innerHTML=e:g.nodeValue=e);g[f]=!0});i.onRemove(T)};(l=r.exec(s))&&(0===(u=d())||1!==u););var p=s.substring(h),m=o.createTextNode(p);m[f]=!0,t.parentNode.insertBefore(m,t),t.nodeValue=""}else if(t.nodeType===n.ELEMENT_NODE)for(var y=function(){if(!i.interpolatable(t.attributes[g].value))return 1;for(var n,o=0,s=t.attributes[g].value,a=t.attributes[g],l={},u=[];n=r.exec(s);)u.push(s.substring(o,n.index)),l[n[2]]||(l[n[2]]=[]),l[n[2]].push(u.length),u.push(n[1]),o=n.index+n[1].length;u.push(s.substring(o));var h=function(){var r=i.args,n=c,o=c.split("|"),s=!1,h=c;o.length>1&&(s=i.stringTransformer(o.slice(1)),n=o[0]),n.match(/\./)&&([r,n]=e.Bindable.resolve(i.args,n,!0));l[h];i.onRemove(r.bindTo(n,(e,r,o,c)=>{for(var f in s&&(e=s(e)),l)for(var d in l[h])u[l[h][d]]=o[f],r===n&&(u[l[h][d]]=e);i.paused?i.unpauseCallbacks.set(a,()=>t.setAttribute(a.name,u.join(""))):t.setAttribute(a.name,u.join(""))}))};for(var c in l)h()},g=0;g<t.attributes.length;g++)y();return t}mapRefTag(e){var t=e.getAttribute("cv-ref"),[i,r=null,n=null]=t.split(":"),o=a.Tag;r&&(o=this.stringToClass(r)),e.removeAttribute("cv-ref"),Object.defineProperty(e,"___tag___",{enumerable:!1,writable:!0}),this.onRemove(()=>{e.___tag___=null,e.remove()});var s=this;this.viewList&&(s=this.viewList.parent);var l=new o(e,this,i,void 0,this);for(e.___tag___=l,this.tags[i]=l;s;){var u=this.args[n];if(void 0!==u?(s.tags[i]||(s.tags[i]=[]),s.tags[i][u]=l):s.tags[i]=l,!s.parent)break;s=s.parent}return e}mapBindTag(t){var i=t.getAttribute("cv-bind"),r=this.args,n=i,o=null;i.match(/\./)&&([r,n,o]=e.Bindable.resolve(this.args,i,!0)),r!==this.args&&(this.subBindings[i]=this.subBindings[i]||[],this.onRemove(this.args.bindTo(o,()=>{for(;this.subBindings.length;)this.subBindings.shift()()})));var l=!1;"$"===n.substr(0,1)&&(n=n.substr(1),l=!0);var u=!1,h=r.bindTo(n,(e,i,r,n,o)=>{if((o instanceof v||o instanceof Node||o instanceof a.Tag)&&o!==e&&o.remove(),["INPUT","SELECT","TEXTAREA"].includes(t.tagName)){var h=t.getAttribute("type");if(h&&"checkbox"===h.toLowerCase())t.checked=!!e;else if(h&&"radio"===h.toLowerCase())t.checked=e==t.value;else if("file"!==h)if("SELECT"===t.tagName){var d=()=>{for(var i=0;i<t.options.length;i++){t.options[i].value==e&&(t.selectedIndex=i)}};d(),this.nodesAttached.add(d)}else t.value=null==e?"":e;u&&t.dispatchEvent(new CustomEvent("cvAutoChanged",{bubbles:!0})),u=!0}else if(e instanceof v){for(var p of t.childNodes)p.remove();e[c.EventTargetMixin.Parent]=this,e.render(t,null,this)}else if(e instanceof Node)t.insert(e);else if(e instanceof a.Tag)t.append(e.node);else if(l){if(t.innerHTML!==e){if(e=String(e),t.innerHTML===e.substring(0,t.innerHTML.length))t.innerHTML+=e.substring(t.innerHTML.length);else{for(var m of t.childNodes)m.remove();t.innerHTML=e}s.Dom.mapTags(t,!1,e=>e[f]=!0)}}else if(t.textContent!==e){for(var y of t.childNodes)y.remove();t.textContent=e}});r!==this.args&&this.subBindings[i].push(h),this.onRemove(h);var d=t.getAttribute("type"),p=t.getAttribute("multiple"),m=i=>{if(i.target===t)if(d&&"checkbox"===d.toLowerCase())t.checked?r[n]=i.target.getAttribute("value"):r[n]=!1;else if(i.target.matches("[contenteditable=true]"))r[n]=i.target.innerHTML;else if("file"===d&&p){var o=Array.from(i.target.files),s=r[n]||e.Bindable.onDeck(r,n);if(s&&o.length){var a=function(e){if(o[e]!==s[e])return o[e].toJSON=(()=>({name:file[e].name,size:file[e].size,type:file[e].type,date:file[e].lastModified})),s[e]=o[e],1};for(var l in o)if(a(l))break}else r[n]=o}else if("file"===d&&!p&&i.target.files.length){var u=i.target.files.item(0);u.toJSON=(()=>({name:u.name,size:u.size,type:u.type,date:u.lastModified})),r[n]=u}else r[n]=i.target.value};return"file"===d||"radio"===d?t.addEventListener("change",m):(t.addEventListener("input",m),t.addEventListener("change",m),t.addEventListener("value-changed",m)),this.onRemove(()=>{"file"===d||"radio"===d?t.removeEventListener("change",m):(t.removeEventListener("input",m),t.removeEventListener("change",m),t.removeEventListener("value-changed",m))}),t.removeAttribute("cv-bind"),t}mapOnTag(e){return String(e.getAttribute("cv-on")).split(";").map(e=>e.split(":")).forEach(t=>{var i=(t=t.map(e=>e.trim())).length,r=String(t.shift()).trim(),n=String(t.shift()||r).trim(),o=String(t.shift()||"").trim(),s=[],a=/(\w+)(?:\(([$\w\s-'",]+)\))?/.exec(n);a&&(n=a[1].replace(/(^[\s\n]+|[\s\n]+$)/,""),a[2]&&(s=a[2].split(",").map(e=>e.trim()))),s.length||s.push("$event"),r&&1!==i||(r=n);var l=t=>{for(var i,r=this,o=function(){var e=r.controller;return"function"==typeof e[n]?(i=((...t)=>{e[n](...t)}),0):"function"==typeof r[n]?(i=((...e)=>{r[n](...e)}),0):r.parent?void(r=r.parent):0};r&&0!==o(););var a=s.map(i=>{var n;return Number(i)==i?i:"event"===i||"$event"===i?t:"$view"===i?r:"$controller"===i?controller:"$tag"===i?e:"$parent"===i?this.parent:"$subview"===i?this:i in this.args?this.args[i]:(n=/^['"]([\w-]+?)["']$/.exec(i))?n[1]:void 0});if("function"!=typeof i)throw new Error(`${n} is not defined on View object.`+"\nTag:\n"+`${e.outerHTML}`);i(...a)},u={};switch(o.includes("p")?u.passive=!0:o.includes("P")&&(u.passive=!1),o.includes("c")?u.capture=!0:o.includes("C")&&(u.capture=!1),o.includes("o")?u.once=!0:o.includes("O")&&(u.once=!1),r){case"_init":l();break;case"_attach":this.nodesAttached.add(l);break;case"_detach":this.nodesDetached.add(l);break;default:e.addEventListener(r,l,u),this.onRemove(()=>{e.removeEventListener(r,l,u)})}return[r,n,s]}),e.removeAttribute("cv-on"),e}mapLinkTag(e){var t=e.getAttribute("cv-link");e.setAttribute("href",t);var i=i=>{i.preventDefault(),"http"!==t.substring(0,4)&&"//"!==t.substring(0,2)?n.Router.go(e.getAttribute("href")):globalThis.open(e.getAttribute("href",t))};return e.addEventListener("click",i),this.onRemove(((e,t)=>()=>{e.removeEventListener("click",t),e=void 0,t=void 0})(e,i)),e.removeAttribute("cv-link"),e}mapPrendererTag(e){var t=e.getAttribute("cv-prerender"),i=globalThis.prerenderer||navigator.userAgent.match(/prerender/i);return e.removeAttribute("cv-prerender"),i&&(globalThis.prerenderer=globalThis.prerenderer||!0),("never"===t&&i||"only"===t&&!i)&&this.postMapping.add(()=>e.parentNode.removeChild(e)),e}mapWithTag(t){var i=this,r=t.getAttribute("cv-with"),n=t.getAttribute("cv-carry"),o=t.getAttribute("cv-view");t.removeAttribute("cv-with"),t.removeAttribute("cv-carry"),t.removeAttribute("cv-view");var s=o?this.stringToClass(o):v,a=new DocumentFragment;[...t.childNodes].forEach(e=>a.appendChild(e));var l=[];n&&(l=n.split(",").map(e=>e.trim()));var u=this.args.bindTo(r,(r,n,o,u)=>{for(this.withViews.has(t)&&this.withViews.delete(t);t.firstChild;)t.removeChild(t.firstChild);var h=new s({},this);this.onRemove((e=>()=>{e.remove()})(h)),h.template=a;var c=function(){var e=i.args.bindTo(l[f],(e,t)=>{h.args[t]=e});h.onRemove(e),i.onRemove(()=>{e(),h.remove()})};for(var f in l)c();var d=function(){if("object"!=typeof r)return 1;var t=(r=e.Bindable.make(r)).bindTo(p,(e,t,i,r)=>{r?t in h.args&&delete h.args[t]:h.args[t]=e});h.args.bindTo(p,(e,t,i,n)=>{n?t in r&&delete r[t]:r[t]=e});i.onRemove(()=>{t(),r.isBound()||e.Bindable.clearBindings(r),h.remove()}),h.onRemove(()=>{t(),r.isBound()||e.Bindable.clearBindings(r)})};for(var p in r)d();h.render(t,null,this),this.withViews.set(t,h)});return this.onRemove(()=>{this.withViews.delete(t),u()}),t}mapViewTag(e){var t=e.getAttribute("cv-view");e.removeAttribute("cv-view");var i=new DocumentFragment;[...e.childNodes].forEach(e=>i.appendChild(e));var r=t.split(":"),n=r.shift(),o=new(r.length?this.stringToClass(r[0]):v)(this.args,this);return this.views.set(e,o),this.views.set(n,o),this.onRemove(()=>{o.remove(),this.views.delete(e),this.views.delete(n)}),o.template=i,o.render(e,null,this),e}mapEachTag(t){var i=t.getAttribute("cv-each"),n=t.getAttribute("cv-view");t.removeAttribute("cv-each"),t.removeAttribute("cv-view");var o=n?this.stringToClass(n):v,s=new DocumentFragment;[...t.childNodes].forEach(e=>s.appendChild(e));var[a,u,h]=i.split(":"),c=this.args,f=a;a.match(/\./)&&([c,f]=e.Bindable.resolve(this.args,a,!0));var d=c.bindTo(f,(e,i,n,a,c)=>{e instanceof l.Bag&&(e=e.list),this.viewLists.has(t)&&this.viewLists.get(t).remove();var f=new r.ViewList(s,u,e,this,h,o),d=()=>f.remove();this.onRemove(d),f.onRemove(()=>this._onRemove.remove(d));var p=this.args.bindTo((e,t,i,r)=>{"_id"!==t&&(r?t in f.subArgs&&delete f.subArgs[t]:f.subArgs[t]=e)}),v=f.args.bindTo((e,t,i,r,n)=>{"_id"!==t&&"value"!==t&&"___"!==String(t).substring(0,3)&&(r?delete this.args[t]:t in this.args&&(this.args[t]=e))});for(f.onRemove(p),f.onRemove(v),this.onRemove(p),this.onRemove(v);t.firstChild;)t.removeChild(t.firstChild);this.viewLists.set(t,f),f.render(t,null,this),"SELECT"===t.tagName&&f.reRender()});return this.onRemove(d),t}mapIfTag(t){var i=t,r=i.getAttribute("cv-view"),n=i.getAttribute("cv-if"),o=i.getAttribute("cv-is"),a=!1,u=!1;i.removeAttribute("cv-view"),i.removeAttribute("cv-if"),i.removeAttribute("cv-is");var h=r?this.stringToClass(r):v;"!"===n.substr(0,1)&&(n=n.substr(1),a=!0),"?"===n.substr(0,1)&&(n=n.substr(1),u=!0);var c=new DocumentFragment;[...i.childNodes].forEach(e=>c.appendChild(e));var f=this,d=new DocumentFragment,p=new h(this.args,f);p.tags.bindTo((e,t)=>this.tags[t]=e,{removeWith:this}),p.template=c;var m=f.args,y=n;n.match(/\./)&&([m,y]=e.Bindable.resolve(f.args,n,!0)),p.render(d,null,this);var g=m.bindTo(y,(e,i)=>{var r=e;u&&(e=null!==e&&void 0!==e),e instanceof l.Bag&&(e=e.list),Array.isArray(e)&&(e=!!e.length),null!==o&&(e=r==o),a&&(e=!e),e?(t.appendChild(d),[...d.childNodes].forEach(e=>s.Dom.mapTags(e,!1,(e,t)=>{e.matches&&e.dispatchEvent(new CustomEvent("cvDomAttached",{target:e,detail:{view:p||this,mainView:this}}))}))):(p.nodes.forEach(e=>d.appendChild(e)),s.Dom.mapTags(d,!1,(e,t)=>{e.matches&&new CustomEvent("cvDomDetached",{target:e,detail:{view:p||this,mainView:this}})}))},{children:Array.isArray(m[y])});f.onRemove(g);return f.onRemove(()=>{g(),f._onRemove.remove(g)}),this.onRemove(()=>{p.remove(),f!==this&&f.remove()}),t}mapTemplateTag(e){var t=e.getAttribute("cv-template");e.removeAttribute("cv-template");var i=e.innerHTML;return v.templates.has(i)||v.templates.set(i,document.createRange().createContextualFragment(e.innerHTML)),this.templates[t]=v.templates.get(i),this.postMapping.add(()=>e.remove()),e}mapSlotTag(e){var t=e.getAttribute("cv-slot"),i=this.templates[t];if(!i){for(var r=this;r&&!(i=r.templates[t]);)r=r.parent;if(!i)return void console.error(`Template ${t} not found.`)}for(e.removeAttribute("cv-slot");e.firstChild;)e.firstChild.remove();return"string"==typeof i&&(v.templates.has(i)||v.templates.set(i,document.createRange().createContextualFragment(i)),i=v.templates.get(i)),e.appendChild(i.cloneNode(!0)),e}postRender(e){}attached(e){}interpolatable(e){return!!String(e).match(this.interpolateRegex)}static uuid(){return new o.Uuid}remove(e=!1){if(this.dispatchEvent(new CustomEvent("remove",{detail:{view:this},cancelable:!0}))){var t=()=>{for(var e in this.tags)Array.isArray(this.tags[e])?(this.tags[e]&&this.tags[e].forEach(e=>e.remove()),this.tags[e].splice(0)):(this.tags[e]&&this.tags[e].remove(),this.tags[e]=void 0);for(var t in this.nodes)this.nodes[t]&&this.nodes[t].dispatchEvent(new Event("cvDomDetached")),this.nodes[t]&&this.nodes[t].remove(),this.nodes[t]=void 0;this.nodes.splice(0),this.firstNode=this.lastNode=void 0};e?t():requestAnimationFrame(t);var i=this._onRemove.items();for(var r of i)r(),this._onRemove.remove(r);for(var n of this.cleanup)n&&n();for(var[o,s]of(this.cleanup.length=0,this.viewLists))s.remove();for(var[a,l]of(this.viewLists.clear(),this.timeouts))clearTimeout(l.timeout),this.timeouts.delete(l.timeout);for(var u of this.intervals)clearInterval(u);for(var h of(this.intervals.length=0,this.frames))h();this.frames.length=0,this.preRuleSet.purge(),this.ruleSet.purge(),this.removed=!0,this.dispatchEvent(new CustomEvent("removed",{detail:{view:this},cancelable:!0}))}}findTag(e){for(var t in this.nodes){var i;if(this.nodes[t].querySelector){if(this.nodes[t].matches(e))return new a.Tag(this.nodes[t],this,void 0,void 0,this);if(i=this.nodes[t].querySelector(e))return new a.Tag(i,this,void 0,void 0,this)}}}findTags(e){var t=this.nodes.filter(t=>t.matches&&t.matches(e)),i=this.nodes.filter(e=>e.querySelectorAll).map(t=>[...t.querySelectorAll(e)]).flat().map(e=>new a.Tag(e,this,void 0,void 0,this))||[];return t.concat(i)}onRemove(e){e instanceof Event||this._onRemove.add(e)}update(){}beforeUpdate(e){}afterUpdate(e){}stringTransformer(e){return t=>{for(var i in e){for(var r=this,n=e[i];r&&!r[n];)r=r.parent;if(!r)return;t=r[e[i]](t)}return t}}stringToClass(e){if(v.refClasses.has(e))return v.refClasses.get(e);var t=e.split("/"),r=t[t.length-1],n=i(e);return v.refClasses.set(e,n[r]),n[r]}preventParsing(e){e[f]=!0}toString(){return this.nodes.map(e=>e.outerHTML).join(" ")}listen(e,t,i,r){if("string"==typeof e&&(r=i,i=t,t=e,e=this),e instanceof v)return this.listen(e.nodes,t,i,r);if(Array.isArray(e))return e.map(e=>this.listen(e,t,i,r));if(e instanceof a.Tag)return this.listen(e.element,t,i,r);e.addEventListener(t,i,r);var n=()=>e.removeEventListener(t,i,r),o=()=>{n(),n=(()=>{})};return this.onRemove(()=>o()),o}detach(){for(var e in this.nodes)this.nodes[e].remove();return this.nodes}}t.View=v,Object.defineProperty(v,"templates",{value:new Map}),Object.defineProperty(v,"refClasses",{value:new Map})}()}),require.register("curvature/base/ViewList.js",function(t,i,r){i=e(i,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ViewList=void 0;var e=i("./Bindable"),r=i("./SetMap"),n=i("./Bag");t.ViewList=class{constructor(t,i,r,o,s=null,a=null){this.removed=!1,this.args=e.Bindable.makeBindable(Object.create(null)),this.args.value=e.Bindable.makeBindable(r||Object.create(null)),this.subArgs=e.Bindable.makeBindable(Object.create(null)),this.views=[],this.cleanup=[],this.viewClass=a,this._onRemove=new n.Bag,this.template=t,this.subProperty=i,this.keyProperty=s,this.tag=null,this.downDebind=[],this.upDebind=[],this.paused=!1,this.parent=o,this.viewCount=0,this.rendered=new Promise((e,t)=>{Object.defineProperty(this,"renderComplete",{configurable:!1,writable:!0,value:e})}),this.willReRender=!1,this.args.___before((e,t,i,r,n)=>{"bindTo"!=t&&(this.paused=!0)}),this.args.___after((e,t,i,r,n)=>{"bindTo"!=t&&(this.paused=i.length>1,this.reRender())});var l=this.args.value.bindTo((e,t,i,r)=>{if(!this.paused){var n=t;if("symbol"!=typeof t)if(isNaN(t)&&(n="_"+t),r)for(var o in this.views[n]&&this.views[n].remove(!0),delete this.views[n],this.views)this.views[o]&&(isNaN(o)?this.views[o].args[this.keyProperty]=o.substr(1):this.views[o].args[this.keyProperty]=o);else this.views[n]?this.views[n]&&this.views[n].args&&(this.views[n].args[this.keyProperty]=t,this.views[n].args[this.subProperty]=e):this.viewCount?!1===this.willReRender&&(this.willReRender=requestAnimationFrame(()=>{this.willReRender=!1,this.reRender()})):this.reRender()}},{wait:0});this._onRemove.add(l),Object.preventExtensions(this)}render(e){var t=this,i=[],r=function(r){r.viewList=t,r.render(e,null,t.parent),i.push(r.rendered.then(()=>r))};for(var n of this.views)r(n);this.tag=e,Promise.all(i).then(e=>this.renderComplete(e)),this.parent.dispatchEvent(new CustomEvent("listRendered",{detail:{detail:{key:this.subProperty,value:this.args.value}}}))}reRender(){var e=this;if(!this.paused&&this.tag){var t=[],i=new r.SetMap;for(var n in this.views){var o=this.views[n];if(void 0!==o){var s=o.args[this.subProperty];i.add(s,o),t[n]=o}else t[n]=o}var a=[],l=new Set;this.downDebind.length&&this.downDebind.forEach(e=>e&&e()),this.upDebind.length&&this.upDebind.forEach(e=>e&&e()),this.upDebind.length=0,this.downDebind.length=0;var u=1/0,h=1/0,c=function(){var t=!1,r=f;if(isNaN(r)?r="_"+f:String(r).length&&(r=Number(r)),void 0!==e.args.value[f]&&i.has(e.args.value[f])){var n=i.getOne(e.args.value[f]);n&&(n.args[e.keyProperty]=f,a[r]=n,l.add(n),t=!0,isNaN(r)||(u=Math.min(u,r),r>0&&(h=Math.min(h,r))),i.remove(e.args.value[f],n))}if(!t){var o=Object.create(null),s=a[r]=new e.viewClass(o,e.parent);isNaN(r)||(u=Math.min(u,r),r>0&&(h=Math.min(h,r))),a[r].template=e.template,a[r].viewList=e,a[r].args[e.keyProperty]=f,a[r].args[e.subProperty]=e.args.value[f],e.upDebind[r]=o.bindTo(e.subProperty,(t,i,r,n)=>{var s=o[e.keyProperty];n?delete e.args.value[s]:e.args.value[s]=t}),e.downDebind[r]=e.subArgs.bindTo((e,t,i,r)=>{r?delete o[t]:o[t]=e});var c=()=>{e.upDebind.filter(e=>e).forEach(e=>e()),e.upDebind.length=0},d=()=>{e.downDebind.filter(e=>e).forEach(e=>e()),e.downDebind.length=0};s.onRemove(()=>{e._onRemove.remove(c),e._onRemove.remove(d),e.upDebind[r]&&e.upDebind[r](),e.downDebind[r]&&e.downDebind[r](),delete e.upDebind[r],delete e.downDebind[r]}),e._onRemove.add(c),e._onRemove.add(d),o[e.subProperty]=e.args.value[f]}};for(var f in this.args.value)c();for(var d in t)t[d]&&!l.has(t[d])&&t[d].remove(!0);if(Array.isArray(this.args.value)){var p=0===u&&void 0!==a[1]&&a.length>1||h===1/0?u:h,v=(e=0)=>{for(var t=a.length-e-1;t>p&&void 0===a[t];)t--;return t<p?Promise.resolve():a[t]===this.views[t]?a[t]&&!a[t].firstNode?(a[t].render(this.tag,a[t+1],this.parent),a[t].rendered.then(()=>v(Number(e)+1))):0===e||e%500?v(Number(e)+1):new Promise(t=>requestAnimationFrame(()=>t(v(Number(e)+1)))):(a[t].render(this.tag,a[t+1],this.parent),this.views.splice(t,0,a[t]),a[t].rendered.then(()=>v(e+1)))};this.rendered=v()}else{var m=[],y=Object.assign(Object.create(null),a),g=e=>parseInt(e)===e-0,b=Object.keys(a).sort((e,t)=>g(e)&&g(t)?Math.sign(e-t):g(e)||g(t)?!g(e)&&g(t)?-1:g(e)&&!g(t)?1:void 0:0),w=function(t){if(delete y[t],a[t].firstNode&&a[t]===e.views[t])return 1;a[t].render(e.tag,null,e.parent),m.push(a[t].rendered.then(()=>a[t]))};for(var x of b)w(x);for(var T in y)delete this.args.views[T],y.remove(!0);this.rendered=Promise.all(m)}for(var E in a)isNaN(E)?a[E].args[this.keyProperty]=E.substr(1):a[E].args[this.keyProperty]=E;return this.views=Array.isArray(this.args.value)?[...a]:a,this.viewCount=a.length,l.clear(),this.willReRender=!1,this.rendered.then(()=>{this.parent.dispatchEvent(new CustomEvent("listRendered",{detail:{detail:{key:this.subProperty,value:this.args.value,tag:this.tag}}})),this.tag.dispatchEvent(new CustomEvent("listRendered",{detail:{detail:{key:this.subProperty,value:this.args.value,tag:this.tag}}}))}),this.rendered}}pause(e=!0){for(var t in this.views)this.views[t].pause(e)}onRemove(e){this._onRemove.add(e)}remove(){for(var t in this.views)this.views[t]&&this.views[t].remove(!0);var i=this._onRemove.items();for(var r in i)this._onRemove.remove(i[r]),i[r]();for(;this.cleanup.length;)this.cleanup.pop()();for(this.views=[];this.tag&&this.tag.firstChild;)this.tag.removeChild(this.tag.firstChild);this.subArgs&&e.Bindable.clearBindings(this.subArgs),e.Bindable.clearBindings(this.args),this.removed=!0}}}()}),require.register("curvature/input/Keyboard.js",function(t,i,r){i=e(i,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Keyboard=void 0;var e=i("../base/Bindable");t.Keyboard=class{static get(){return this.instance=this.instance||e.Bindable.make(new this)}constructor(){this.maxDecay=120,this.comboTime=500,this.listening=!1,this.focusElement=document.body,this[e.Bindable.NoGetters]=!0,Object.defineProperty(this,"combo",{value:e.Bindable.make([])}),Object.defineProperty(this,"whichs",{value:e.Bindable.make({})}),Object.defineProperty(this,"codes",{value:e.Bindable.make({})}),Object.defineProperty(this,"keys",{value:e.Bindable.make({})}),Object.defineProperty(this,"pressedWhich",{value:e.Bindable.make({})}),Object.defineProperty(this,"pressedCode",{value:e.Bindable.make({})}),Object.defineProperty(this,"pressedKey",{value:e.Bindable.make({})}),Object.defineProperty(this,"releasedWhich",{value:e.Bindable.make({})}),Object.defineProperty(this,"releasedCode",{value:e.Bindable.make({})}),Object.defineProperty(this,"releasedKey",{value:e.Bindable.make({})}),Object.defineProperty(this,"keyRefs",{value:e.Bindable.make({})}),document.addEventListener("keyup",e=>{this.listening&&(this.keys[e.key]>0||!this.focusElement||document.activeElement===this.focusElement||this.focusElement.contains(document.activeElement)&&!document.activeElement.matches("input,textarea"))&&(e.preventDefault(),this.releasedWhich[e.which]=Date.now(),this.releasedCode[e.code]=Date.now(),this.releasedKey[e.key]=Date.now(),this.whichs[e.which]=-1,this.codes[e.code]=-1,this.keys[e.key]=-1)}),document.addEventListener("keydown",e=>{this.listening&&(!this.focusElement||document.activeElement===this.focusElement||this.focusElement.contains(document.activeElement)&&!document.activeElement.matches("input,textarea"))&&(e.preventDefault(),e.repeat||(this.combo.push(e.code),clearTimeout(this.comboTimer),this.comboTimer=setTimeout(()=>this.combo.splice(0),this.comboTime),this.pressedWhich[e.which]=Date.now(),this.pressedCode[e.code]=Date.now(),this.pressedKey[e.key]=Date.now(),this.keys[e.key]>0||(this.whichs[e.which]=1,this.codes[e.code]=1,this.keys[e.key]=1)))});var t=e=>{for(var t in this.keys)this.keys[t]<0||(this.releasedKey[t]=Date.now(),this.keys[t]=-1);for(var i in this.codes)this.codes[i]<0||(this.releasedCode[i]=Date.now(),this.codes[i]=-1);for(var r in this.whichs)this.whichs[r]<0||(this.releasedWhich[r]=Date.now(),this.whichs[r]=-1)};window.addEventListener("blur",t),window.addEventListener("visibilitychange",()=>{"visible"!==document.visibilityState&&t()})}getKeyRef(t){return this.keyRefs[t]=this.keyRefs[t]||e.Bindable.make({})}getKeyTime(e){var t=this.releasedKey[e],i=this.pressedKey[e];return i?!t||t<i?Date.now()-i:-1*(Date.now()-t):0}getCodeTime(e){var t=this.releasedCode[e],i=this.pressedCode[e];return i?!t||t<i?Date.now()-i:-1*(Date.now()-t):0}getWhichTime(e){var t=this.releasedWhich[e],i=this.pressedWhich[e];return i?!t||t<i?Date.now()-i:-1*(Date.now()-t):0}getKey(e){return this.keys[e]?this.keys[e]:0}getKeyCode(e){return this.codes[e]?this.codes[e]:0}reset(){for(var e in this.keys)delete this.keys[e];for(var e in this.codes)delete this.codes[e];for(var e in this.whichs)delete this.whichs[e]}update(){for(var e in this.keys)this.keys[e]>0?this.keys[e]++:this.keys[e]>-this.maxDecay?this.keys[e]--:delete this.keys[e];for(var e in this.codes){var t=this.releasedCode[e],i=this.pressedCode[e],r=this.getKeyRef(e);if(this.codes[e]>0){if(r.frames=this.codes[e]++,r.time=i?Date.now()-i:0,r.down=!0,!t||t<i)return;return-1*(Date.now()-t)}this.codes[e]>-this.maxDecay?(r.frames=this.codes[e]--,r.time=t-Date.now(),r.down=!1):(r.frames=0,r.time=0,r.down=!1,delete this.codes[e])}for(var e in this.whichs)this.whichs[e]>0?this.whichs[e]++:this.whichs[e]>-this.maxDecay?this.whichs[e]--:delete this.whichs[e]}}}()}),require.register("curvature/mixin/EventTargetMixin.js",function(t,i,r){i=e(i,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventTargetMixin=void 0;var e=i("../base/Mixin"),r=Symbol("EventTargetParent"),n=Symbol("CallHandler"),o=Symbol("Capture"),s=Symbol("Bubble"),a=(Symbol("Target"),Symbol("HandlersBubble")),l=Symbol("HandlersCapture"),u=t.EventTargetMixin={[e.Mixin.Constructor](){this[l]=new Map,this[a]=new Map},dispatchEvent(...e){var t=e[0];"string"==typeof t&&(t=new CustomEvent(t),e[0]=t),t.cvPath=t.cvPath||[],t.cvTarget=t.cvCurrentTarget=this;var i=this[o](...e);if(t.cancelable&&(!1===i||t.cancelBubble))return i;var u=[];if(this[l].has(t.type)){var h=this[l].get(t.type),c=[...h];c.forEach(e=>e.push(h)),u.push(...c)}if(this[a].has(t.type)){var f=this[a].get(t.type),d=[...f];d.forEach(e=>e.push(f)),u.push(...d)}for(var[p,v,m]of(u.push([()=>this[n](...e),{},null]),u))if(v.once&&m.delete(p),i=p(t),t.cancelable&&!1===i)break;return t.cancelable&&(t.cancelBubble||!1===i)||this[s](...e),this[r]||Object.freeze(t.cvPath),t.returnValue},addEventListener(e,t,i={}){!0===i&&(i={useCapture:!0});var r=a;i.useCapture&&(r=l),this[r].has(e)||this[r].set(e,new Map),this[r].get(e).set(t,i),i.signal&&i.signal.addEventListener("abort",r=>this.removeEventListener(e,t,i),{once:!0})},removeEventListener(e,t,i={}){!0===i&&(i={useCapture:!0});var r=a;i.useCapture&&(r=l),this[r].has(e)&&this[r].get(e).delete(t)},[o](...e){var t=e[0];if(t.cvPath.push(this),this[r]){var i=this[r][o](...e);if((!t.cancelable||!1!==i&&!t.cancelBubble)&&this[r][l].has(t.type)){t.cvCurrentTarget=this[r];var{type:n}=t,s=this[r][l].get(n);for(var[a,u]of s)if(u.once&&s.delete(a),i=a(t),t.cancelable&&(!1===i||t.cancelBubble))break;return i}}},[s](...e){var t=e[0];if(t.bubbles&&this[r]&&!t.cancelBubble){if(!this[r][a].has(t.type))return this[r][s](...e);var i;t.cvCurrentTarget=this[r];var{type:o}=t,l=this[r][a].get(t.type);for(var[u,h]of l)if(h.once&&l.delete(u),i=u(t),t.cancelable&&!1===i)return i;return i=this[r][n](...e),t.cancelable&&(!1===i||t.cancelBubble)?i:this[r][s](...e)}},[n](...e){var t=e[0];if(!t.defaultPrevented){var i=`on${t.type[0].toUpperCase()+t.type.slice(1)}`;return"function"==typeof this[i]?this[i](t):void 0}}};Object.defineProperty(u,"Parent",{value:r})}()}),require.register("import-mapper/ImportMapper.js",function(t,i,r){i=e(i,{},"import-mapper"),function(){const e=globalThis["##IMPORTS##"]=globalThis["##IMPORTS##"]||{},t="data:application/javascript;charset=utf-8,",i=Symbol("processRequires"),n=Symbol("forceDefault");r.exports.ImportMapper=class{constructor(e,t){e&&("function"!=typeof e[Symbol.iterator]&&(e=Object.entries(e)),Object.assign(this.imports={},this[i](e)))}add(e,t){this.imports[e]=t}generate(){const e=document.createElement("script"),t=this.imports;return e.setAttribute("type","importmap"),e.innerHTML=JSON.stringify({imports:t},null,4),e}register(){const e=this.generate();document.head.append(e),e.remove()}[i](i){const r=[...i].map(i=>{if(Array.isArray(i)&&2===i.length){let r=Object.keys(i[1]);return"object"==typeof i[1]&&i[1][n]&&(i[1]=i[1][n],r=[n]),[i[0],((i,r)=>{let o=typeof r;i[0]===n&&(o="default-object");const s=crypto.randomUUID();return"object"===o?(e[s]=r,t+encodeURIComponent(`export const { ${i.join(",")} } = globalThis['##IMPORTS##']['${s}'];`)):(e[s]=r,t+encodeURIComponent(`export default globalThis['##IMPORTS##']['${s}'];`))})(r,i[1])]}const r=globalThis.require(i),o=Object.keys(r);if(o.length)return"object"==typeof r||"function"==typeof r?[i,((e,i)=>t+encodeURIComponent(`export const { ${e.join(",")} } = globalThis.require(${JSON.stringify(i)});`))(o,i)]:[i,(e=>t+encodeURIComponent(`export default ${JSON.stringify(e)};`))(r)]});return Object.fromEntries(r.filter(e=>e))}static forceDefault(e){return{[n]:e}}}}()}),require.register("Config.js",function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,n(r.key),r)}}function n(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Config=void 0,(e.Config=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)})).title="tigl"}),require.register("gl2d/Gl2d.js",function(e,t,i){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,a(r.key),r)}}function o(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,t,i){return(t=a(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function a(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Gl2d=void 0;let l=function(){return o(function e(t){let i=t.gl,n=t.vertexShader,o=t.fragmentShader,a=t.uniforms,l=t.attributes;r(this,e),s(this,"context",null),s(this,"program",null),s(this,"attributes",{}),s(this,"buffers",{}),s(this,"uniforms",{}),this.context=i,this.program=i.createProgram(),i.attachShader(this.program,n),i.attachShader(this.program,o),i.linkProgram(this.program),i.detachShader(this.program,n),i.detachShader(this.program,o),i.deleteShader(n),i.deleteShader(o),i.getProgramParameter(this.program,i.LINK_STATUS)||(console.error(i.getProgramInfoLog(this.program)),i.deleteProgram(this.program));for(const e of a){const t=i.getUniformLocation(this.program,e);null!==t?this.uniforms[e]=t:console.warn(`Uniform ${e} not found.`)}for(const e of l){const t=i.getAttribLocation(this.program,e);if(null===t){console.warn(`Attribute ${e} not found.`);continue}const r=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,r),i.enableVertexAttribArray(t),i.vertexAttribPointer(t,2,i.FLOAT,!1,0,0),this.attributes[e]=t,this.buffers[e]=r}},[{key:"use",value:function(){this.context.useProgram(this.program)}},{key:"uniformF",value:function(e){const t=this.context;for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];t[`uniform${r.length}f`](this.uniforms[e],...r)}},{key:"uniformI",value:function(e){const t=this.context;for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];t[`uniform${r.length}i`](this.uniforms[e],...r)}}])}();e.Gl2d=function(){return o(function e(t){r(this,e),this.element=t||document.createElement("canvas"),this.context=this.element.getContext("webgl")},[{key:"createShader",value:function(e){let i=null;switch(e.substring(e.lastIndexOf(".")+1).toUpperCase()){case"VERT":i=this.context.VERTEX_SHADER;break;case"FRAG":i=this.context.FRAGMENT_SHADER}const r=this.context.createShader(i),n=t(e);if(this.context.shaderSource(r,n),this.context.compileShader(r),this.context.getShaderParameter(r,this.context.COMPILE_STATUS))return r;console.error(this.context.getShaderInfoLog(r)),this.context.deleteShader(r)}},{key:"createProgram",value:function(e){let t=e.vertexShader,i=e.fragmentShader,r=e.uniforms,n=e.attributes;const o=this.context;return new l({gl:o,vertexShader:t,fragmentShader:i,uniforms:r,attributes:n})}},{key:"createTexture",value:function(e,t){const i=this.context,r=i.createTexture();return i.bindTexture(i.TEXTURE_2D,r),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,t,0,i.RGBA,i.UNSIGNED_BYTE,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),r}},{key:"createFramebuffer",value:function(e){const t=this.context,i=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),i}},{key:"enableBlending",value:function(){const e=this.context;e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.enable(e.BLEND)}}])}()}),require.register("home/View.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.View=void 0;var r=t("curvature/base/View"),n=t("../sprite/Camera"),o=t("../ui/OnScreenJoyPad"),s=t("curvature/input/Keyboard"),a=t("../session/Session"),l=(t("Config"),t("../model/PlayerController")),u=t("../model/BallController"),h=t("../model/BarrelController"),c=t("../model/BoxController"),f=t("../model/MapMover");function d(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)}return i}function p(e,t,i){return(t=m(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function v(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,m(r.key),r)}}function m(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function y(e,t,i){return t=g(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,i||[],g(e).constructor):t.apply(e,i))}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){return(b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}const w={};w.onScreenJoyPad=new o.OnScreenJoyPad,w.keyboard=s.Keyboard.get();e.View=function(e){function i(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),window.smProfiling=!0,(r=y(this,i,[e])).template=t("./view.tmp"),r.routes=[],r.keyboard=w.keyboard,r.speed=24,r.maxSpeed=r.speed,r.args.joypad=w.onScreenJoyPad,r.args.fps=0,r.args.sps=0,r.args.camX=0,r.args.camY=0,r.args.showEditor=!1,r.keyboard.listening=!0,r.args.mouseClass="mouse-moved",r.keyboard.keys.bindTo("Home",(e,t,i,n)=>{!r.session||e<0||e%5==0&&(r.session.frameLock++,r.args.frameLock=r.session.frameLock)}),r.keyboard.keys.bindTo("End",(e,t,i,n)=>{!r.session||e<0||e%5==0&&(r.session.frameLock--,r.session.frameLock<0&&(r.session.frameLock=0),r.args.frameLock=r.session.frameLock)}),r.keyboard.keys.bindTo("PageUp",(e,t,i,n)=>{!r.session||e<0||(e%5==0&&r.session.simulationLock++,r.args.simulationLock=r.session.simulationLock)}),r.keyboard.keys.bindTo("PageDown",(e,t,i,n)=>{!r.session||e<0||(e%5==0&&(r.session.simulationLock--,r.session.simulationLock<0&&(r.session.simulationLock=0)),r.args.simulationLock=r.session.simulationLock)}),r.keyboard.keys.bindTo("=",(e,t,i,n)=>{e>0&&r.zoom(1)}),r.keyboard.keys.bindTo("+",(e,t,i,n)=>{e>0&&r.zoom(1)}),r.keyboard.keys.bindTo("-",(e,t,i,n)=>{e>0&&r.zoom(-1)}),r.keyboard.keys.bindTo("0",(e,t,i,n)=>{e>0&&(r.session.spriteBoard.renderMode=0)}),r.keyboard.keys.bindTo("1",(e,t,i,n)=>{e>0&&(r.session.spriteBoard.renderMode=1)}),r.keyboard.keys.bindTo("2",(e,t,i,n)=>{e>0&&(r.session.spriteBoard.renderMode=2)}),r.keyboard.keys.bindTo("3",(e,t,i,n)=>{e>0&&(r.session.spriteBoard.renderMode=3)}),r.keyboard.keys.bindTo("4",(e,t,i,n)=>{e>0&&(r.session.spriteBoard.renderMode=4)}),r.keyboard.keys.bindTo("5",(e,t,i,n)=>{e>0&&(r.session.spriteBoard.renderMode=5)}),r.keyboard.keys.bindTo("6",(e,t,i,n)=>{e>0&&(r.session.spriteBoard.renderMode=6)}),r.keyboard.keys.bindTo("7",(e,t,i,n)=>{e>0&&(r.session.spriteBoard.renderMode=7)}),r.keyboard.keys.bindTo("8",(e,t,i,n)=>{e>0&&(r.session.spriteBoard.renderMode=8)}),r.keyboard.keys.bindTo("9",(e,t,i,n)=>{e>0&&(r.session.spriteBoard.renderMode=9)}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&b(e,t)}(i,r.View),o=i,(s=[{key:"onRendered",value:function(){const e={worldSrc:"/tile-world.compiled.world",mapPallet:{"@moving-map":f.MapMover},entityPallet:{"@basic-platformer":l.PlayerController,"@barrel":h.BarrelController,"@ball":u.BallController,"@box":c.BoxController}};this.session=new a.Session(function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?d(Object(i),!0).forEach(function(t){p(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):d(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}({onScreenJoyPad:this.args.joypad,keyboard:this.keyboard,element:this.tags.canvas.element},e)),this.args.frameLock=this.session.frameLock,this.args.simulationLock=this.session.simulationLock,window.addEventListener("resize",()=>this.resize());let t=0,i=0;const r=e=>{setTimeout(()=>r(performance.now()),0),document.hidden||this.session.simulate(e)&&(this.args.sps=(1e3/(e-i)).toFixed(3),i=e)},o=e=>{window.requestAnimationFrame(o),document.hidden||this.session.draw(e)&&(this.args.fps=(1e3/(e-t)).toFixed(3),this.args.camX=Number(n.Camera.x).toFixed(3),this.args.camY=Number(n.Camera.y).toFixed(3),t=e,this.session.spriteBoard.following&&(this.args.posX=Number(this.session.spriteBoard.following.x).toFixed(3),this.args.posY=Number(this.session.spriteBoard.following.y).toFixed(3)))};this.session.spriteBoard.zoomLevel=document.body.clientHeight/1280*1.5,this.resize(),r(performance.now()),o(performance.now())}},{key:"mousemove",value:function(){this.args.mouseClass="mouse-moved",this.mouseTimer&&clearTimeout(this.mouseTimer),this.mouseTimer=this.onTimeout(500,()=>this.args.mouseClass="mouse-idle")}},{key:"resize",value:function(e,t){const i=this.session.spriteBoard.screenScale;this.session.spriteBoard.screenScale=document.body.clientHeight/1280,this.session.spriteBoard.zoomLevel*=this.session.spriteBoard.screenScale/i,this.args.width=this.tags.canvas.element.width=e||document.body.clientWidth,this.args.height=this.tags.canvas.element.height=t||document.body.clientHeight,this.args.rwidth=Math.trunc((e||document.body.clientWidth)/this.session.spriteBoard.zoomLevel),this.args.rheight=Math.trunc((t||document.body.clientHeight)/this.session.spriteBoard.zoomLevel),this.session.spriteBoard.resize()}},{key:"scroll",value:function(e){this.zoom(-Math.sign(e.deltaY))}},{key:"zoom",value:function(e){this.session&&this.session.spriteBoard.zoom(e)}}])&&v(o.prototype,s),m&&v(o,m),Object.defineProperty(o,"prototype",{writable:!1}),o;var o,s,m}()}),require.register("home/view.tmp.html",function(e,t,i){i.exports='<canvas\n\tcv-ref = "canvas:curvature/base/Tag"\n\tcv-on  = "wheel:scroll(event):p;mousemove"\n\tclass  = "[[mouseClass]]"\n></canvas>\n\n<div class = "hud fps">[[sps]] simulations/s / [[simulationLock]]\n[[fps]] frames/s      / [[frameLock]]\n\nRes [[rwidth]] x [[rheight]]\n    [[width]] x [[height]]\n\nCam [[camX]] x [[camY]]\nPos [[posX]] x [[posY]]\n\n Sim:   Pg Up / Dn\n Frame: Home / End\n Scale: + / -\n</div>\n<div class = "reticle"></div>\n\n[[joypad]]\n'}),require.register("initialize.js",function(e,t,i){"use strict";var r=t("curvature/base/Router"),n=t("home/View");const o=new(t("import-mapper/ImportMapper").ImportMapper)(globalThis.require.list()),s=new n.View;r.Router.listen(s,{"*":function(){}}),document.addEventListener("DOMContentLoaded",()=>{o.register(),s.render(document.body)})}),require.register("inject/Container.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Container=void 0;var r=t("./Injectable");function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,o(r.key),r)}}function o(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function s(e,t,i){return t=a(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,i||[],a(e).constructor):t.apply(e,i))}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}e.Container=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),s(this,t,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t)}(t,r.Injectable),i=t,(o=[{key:"inject",value:function(e){return new this.constructor(Object.assign({},this,e))}}])&&n(i.prototype,o),a&&n(i,a),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,a}()}),require.register("inject/Injectable.js",function(e,t,i){"use strict";function r(e,t,i){return t=n(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,i||[],n(e).constructor):t.apply(e,i))}function n(e){return(n=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){return(o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,u(r.key),r)}}function l(e,t,i){return t&&a(e.prototype,t),i&&a(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function u(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Injectable=void 0;let h={},c={};e.Injectable=function(){function e(){s(this,e);let t=this.constructor.injections(),i=this.constructor.context();h[i]||(h[i]={}),c[i]||(c[i]={});for(let e in t){let r=t[e];!h[i][e]&&r.prototype&&(/[A-Z]/.test(String(e)[0])&&(h[i][e]=r))}for(let e in t){let r=void 0,n=h[i][e]||t[e];/[A-Z]/.test(String(e)[0])?(n.prototype?c[i][e]||(c[i][e]=new n):c[i][e]=n,r=c[i][e]):r=n.prototype?new n:n,Object.defineProperty(this,e,{enumerable:!1,writable:!1,value:r})}}return l(e,null,[{key:"injections",value:function(){return{}}},{key:"context",value:function(){return"."}},{key:"inject",value:function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".";if(!(this.prototype instanceof e||this===e))throw new Error("Cannot access injectable subclass!\n\nAre you trying to instantiate like this?\n\n\tnew X.inject({...});\n\nIf so please try:\n\n\tnew (X.inject({...}));\n\nPlease note the parenthesis.\n");let n=this.injections();return function(e){function a(){return s(this,a),r(this,a,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&o(e,t)}(a,e),l(a,null,[{key:"injections",value:function(){return Object.assign({},n,t)}},{key:"context",value:function(){return i}}])}(this)}}])}()}),require.register("inject/Single.js",function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,n(r.key),r)}}function n(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.single=e.Single=void 0;let o=e.Single=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name="sss."+Math.random()});e.single=new o}),require.register("input/Axis.js",function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,o(r.key),r)}}function n(e,t,i){return(t=o(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function o(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Axis=void 0;e.Axis=function(){return e=function e(t){let i=t.deadZone,r=void 0===i?0:i,o=t.proportional,s=void 0===o||o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n(this,"magnitude",0),n(this,"delta",0),r&&(this.proportional=s,this.deadZone=r)},(t=[{key:"tilt",value:function(e){e=this.deadZone&&Math.abs(e)>=this.deadZone?(Math.abs(e)-this.deadZone)/(1-this.deadZone)*Math.sign(e):0,this.delta=Number(e-this.magnitude).toFixed(3)-0,this.magnitude=Number(e).toFixed(3)-0}},{key:"zero",value:function(){this.magnitude=this.delta=0}}])&&r(e.prototype,t),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}()}),require.register("input/Button.js",function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,o(r.key),r)}}function n(e,t,i){return(t=o(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function o(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Button=void 0;e.Button=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n(this,"active",!1),n(this,"pressure",0),n(this,"delta",0),n(this,"time",0)},(t=[{key:"update",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.pressure?this.time++:!this.pressure&&this.time>0?this.time=-1:!this.pressure&&this.time<0&&this.time--,this.time<-1&&-1===this.delta&&(this.delta=0)}},{key:"press",value:function(e){this.delta=Number(e-this.pressure).toFixed(3)-0,this.pressure=Number(e).toFixed(3)-0,this.active=!0,this.time=this.time>0?this.time:0}},{key:"release",value:function(){this.delta=Number(-this.pressure).toFixed(3)-0,this.pressure=0,this.active=!1}},{key:"zero",value:function(){this.pressure=this.delta=0,this.active=!1}}])&&r(e.prototype,t),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}()}),require.register("input/Controller.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Controller=void 0;var r=t("./Axis"),n=t("./Button");function o(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,s(r.key),r)}}function s(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}const a={Space:0,Enter:0,NumpadEnter:0,ControlLeft:1,ControlRight:1,ShiftLeft:2,ShiftRight:2,KeyZ:3,KeyQ:4,KeyE:5,Digit1:6,Digit3:7,KeyBackspace:8,KeyW:12,KeyA:14,KeyS:13,KeyD:15,KeyH:112,KeyJ:113,KeyK:114,KeyL:115,KeyP:1020,KeyO:1209,Pause:1020,Tab:11,ArrowUp:12,ArrowDown:13,ArrowLeft:14,ArrowRight:15,KeyMeta:16,Numpad4:112,Numpad2:113,Numpad8:114,Numpad6:115,Backquote:1010,NumpadAdd:1011,NumpadSubtract:1012,NumpadMultiply:1013,NumpadDivide:1014,PageUp:1022,PageDown:1023,Home:1024,End:1025,Escape:[1020,1050],KeyB:1201};[...Array(12)].map((e,t)=>a[`F${t}`]=2e3+t);const l={12:-1,13:1,14:-0,15:0,112:-2,113:3,114:-3,115:2},u={"-6":14,"+6":15,"-7":12,"+7":13},h={0:1200,1:1201,9:1020,4:1022,5:1023};e.Controller=function(){return e=function e(t){t.keys;let i=t.deadZone,r=void 0===i?0:i;t.gamepad,t.keyboard;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.deadZone=r,Object.defineProperties(this,{buttons:{value:{}},pressure:{value:{}},axes:{value:{}},keys:{value:{}}})},(t=[{key:"update",value:function(){let e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).gamepad;for(const e in this.buttons){this.buttons[e].update()}if(e&&this.willRumble){if("object"!=typeof this.willRumble&&(this.willRumble={duration:1e3,strongMagnitude:1,weakMagnitude:1}),e.id&&String(e.id).match(/playstation.{0,5}3/i)){this.willRumble.duration<100&&this.willRumble.strongMagnitude<.75&&(this.willRumble.duration=0,this.willRumble.weakMagnitude=0,this.willRumble.strongMagnitude=0),setTimeout(()=>{this.willRumble||e.vibrationActuator.playEffect("dual-rumble",{duration:0,weakMagnitude:0,strongMagnitude:0})},this.willRumble.duration+-1)}e.vibrationActuator&&e.vibrationActuator.playEffect&&e.vibrationActuator.playEffect("dual-rumble",this.willRumble),this.willRumble=!1}}},{key:"rumble",value:function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.willRumble=e}},{key:"readInput",value:function(e){let t=e.keyboard,i=e.onScreenJoyPad,o=e.gamepads,s=void 0===o?[]:o;const c={},f={},d={},p=new Set;for(let e=0;e<s.length;e++){const t=s[e];if(t)for(const e in t.buttons){const i=t.buttons[e];i.pressed&&(this.press(e,i.value),f[e]=!0,p.add(t))}}if(t){for(const e in[...Array(10)])f[e]||t.getKeyCode(e)>0&&(this.press(e,1),f[e]=!0,p.add(t));for(let e in a){if(f[e])continue;let i=a[e];Array.isArray(i)||(i=a[e]=[i]);for(const r of i)t.getKeyCode(e)>0&&(this.press(r,1),f[r]=!0)}}for(const e of s)if(e)for(const t in e.buttons){if(d[t])continue;if(f[t])continue;const i=e.buttons[t];this.buttons[t]&&!i.pressed&&this.buttons[t].active&&(this.release(t),d[t]=!0)}if(t){for(const e in[...Array(10)])d[e]||f[e]||t.getKeyCode(e)<0&&(this.release(e),d[e]=!0);for(let e in a){let i=a[e];Array.isArray(i)||(i=a[e]=[i]);for(const r of i)d[r]||f[r]||t.getKeyCode(e)<0&&(this.release(r),d[e]=!0)}}for(let e=0;e<s.length;e++){const t=s[e];if(t)for(const e in t.axes){const i=t.axes[e];Math.abs(i)<this.deadZone?c[e]||this.tilt(e,0):(c[e]=!0,this.tilt(e,i))}}if(i){Math.abs(i.args.x)<this.deadZone?c[0]||this.tilt(0,0):(c[0]=!0,this.tilt(0,i.args.x/Math.max(75,i.limit))),Math.abs(i.args.y)<this.deadZone?c[1]||this.tilt(1,0):(c[1]=!0,this.tilt(1,i.args.y/Math.max(75,i.limit)));for(const e in i.buttons)d[e]||f[e]||(1===i.buttons[e]?(this.press(e),f[e]=!0):-1===i.buttons[e]&&(this.release(e),d[e]=!0,i.buttons[e]=0))}for(let e in l){this.buttons[e]||(this.buttons[e]=new n.Button);const t=l[e],i=Math.sign(1/t),r=Math.abs(t);c[r]||(this.buttons[e].active?(c[r]=!0,this.tilt(r,i)):c[r]||this.tilt(r,0))}for(let e in u){const t=u[e];if(d[t])continue;if(f[t])continue;const i=[e.slice(0,1),e.slice(1)],n=(i[0],i[1]);this.axes[n]||(this.axes[n]=new r.Axis({deadZone:this.deadZone}));const o=this.axes[n];if(o.magnitude&&Math.sign(e)!==Math.sign(o.magnitude))continue;const s=Math.abs(o.magnitude);s?(this.press(t,s),f[t]=!0):(this.release(t,s),d[t]=!0)}for(const e in h){const t=h[e];d[t]||(f[t]||(this.buttons[t]||(this.buttons[t]=new n.Button),this.buttons[e]||(this.buttons[e]=new n.Button),this.buttons[e].active?(this.press(t,this.buttons[e].pressure),f[t]=!0):f[t]||(this.release(t,this.buttons[e].pressure),d[t]=!0)))}return p}},{key:"tilt",value:function(e,t){this.axes[e]||(this.axes[e]=new r.Axis({deadZone:this.deadZone})),this.axes[e].tilt(t)}},{key:"press",value:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.buttons[e]||(this.buttons[e]=new n.Button),this.buttons[e].press(t)}},{key:"release",value:function(e){this.buttons[e]||(this.buttons[e]=new n.Button),this.buttons[e].release()}},{key:"serialize",value:function(){const e={};for(const t in this.buttons)e[t]=this.buttons[t].pressure;const t={};for(const e in this.axes)t[e]=this.axes[e].magnitude;return{axes:t,buttons:e}}},{key:"replay",value:function(e){if(e.buttons)for(const t in e.buttons)e.buttons[t]>0?this.press(t,e.buttons[t]):this.release(t);if(e.axes)for(const t in e.axes)e.axes[t].magnitude!==e.axes[t]&&this.tilt(t,e.axes[t])}},{key:"zero",value:function(){for(const e in this.axes)this.axes[e].zero();for(const e in this.buttons)this.buttons[e].zero()}},{key:"buttonIsMapped",value:function(e){return e in h}},{key:"keyIsMapped",value:function(e){return e in a}}])&&o(e.prototype,t),i&&o(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}()}),require.register("math/Geometry.js",function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,n(r.key),r)}}function n(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Geometry=void 0;e.Geometry=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},i=[{key:"lineIntersectsLine",value:function(e,t,i,r,n,o,s,a){const l=i-e,u=r-t,h=s-n,c=a-o,f=l*c-u*h;if(0===f)return!1;const d=n-e,p=o-t,v=(d*u-p*l)/f;if(v<0||v>1)return!1;const m=(d*c-p*h)/f;return!(m<0||m>1)&&[e+m*l,t+m*u,m]}}],(t=null)&&r(e.prototype,t),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}()}),require.register("math/Matrix.js",function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,n(r.key),r)}}function n(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Matrix=void 0;e.Matrix=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},i=[{key:"identity",value:function(){return[[1,0,0],[0,1,0],[0,0,1]]}},{key:"translate",value:function(e,t){return[[1,0,e],[0,1,t],[0,0,1]]}},{key:"scale",value:function(e,t){return[[e,0,0],[0,t,0],[0,0,1]]}},{key:"rotate",value:function(e){const t=Math.sin(e),i=Math.cos(e);return[[i,-t,0],[t,i,0],[0,0,1]]}},{key:"shearX",value:function(e){return[[1,e,0],[0,1,0],[0,0,1]]}},{key:"shearY",value:function(e){return[[1,0,0],[e,1,0],[0,0,1]]}},{key:"multiply",value:function(e,t){if(e.length!==t.length)throw new Error("Invalid matrices");if(e[0].length!==t.length)throw new Error("Incompatible matrices");const i=Array(e.length).fill().map(()=>Array(t[0].length).fill(0));for(let r=0;r<e.length;r++)for(let n=0;n<t[0].length;n++)for(let o=0;o<e[0].length;o++)i[r][n]+=e[r][o]*t[o][n];return i}},{key:"composite",value:function(){let e=this.identity();for(let t=0;t<arguments.length;t++)e=this.multiply(e,t<0||arguments.length<=t?void 0:arguments[t]);return e}},{key:"transform",value:function(e,t){const i=[];for(let r=0;r<e.length;r+=2){const n=[e[r],e[r+1],1];for(const e of t)i.push(n[0]*e[0]+n[1]*e[1]+n[2]*e[2])}return new Float32Array(i.filter((e,t)=>(1+t)%3))}}],(t=null)&&r(e.prototype,t),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}()}),require.register("math/MotionGraph.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MotionGraph=void 0;var r=t("../model/Entity"),n=t("../sprite/Region");function o(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,a(r.key),r)}}function s(e,t,i){return(t=a(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function a(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}s(e.MotionGraph=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s(this,"backmap",new WeakMap),s(this,"entities",new Map)},i=[{key:"deleteFromAllGraphs",value:function(e){if(!this.globalMap.has(e))return;const t=this.globalMap.get(e);for(const i of t)i.delete(e)}}],(t=[{key:"add",value:function(e,t){this.backmap.has(e)&&this.entities.get(this.backmap.get(e)).delete(e),this.entities.has(t)||this.entities.set(t,new Set),this.entities.get(t).add(e),this.backmap.set(e,t),this.constructor.globalMap.has(e)||this.constructor.globalMap.set(e,new Set),this.constructor.globalMap.get(e).add(this)}},{key:"getParent",value:function(e){return this.backmap.get(e)}},{key:"delete",value:function(e){this.backmap.has(e)&&(this.entities.get(this.backmap.get(e)).delete(e),this.backmap.delete(e))}},{key:"moveChildren",value:function(e,t,i){if(!this.entities.has(e))return new Set;if(0===t&&0===i)return new Set;let o=this.entities.get(e);for(const s of o){if(e.session.removed.has(s))continue;const o=e.session.world.getMapsForPoint(s.x,s.y);s instanceof r.Entity?(s.x+=t,s.y+=i,o.forEach(e=>e.moveEntity(s))):s instanceof n.Region&&(s.move(t,i),o.forEach(e=>e.regionTree.move(s.rect))),this.moveChildren(s,t,i)}return o}}])&&o(e.prototype,t),i&&o(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}(),"globalMap",new WeakMap)}),require.register("math/QuadTree.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.QuadTree=void 0;var r=t("curvature/base/Bindable"),n=t("./Rectangle");function o(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,s(r.key),r)}}function s(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function a(e,t,i){return t=l(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,i||[],l(e).constructor):t.apply(e,i))}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}e.QuadTree=function(e){function t(e,i,n,o){var s;let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(s=a(this,t,[e,i,n,o]))[r.Bindable.Prevent]=!0,s.count=0,s.items=new Set,s.split=!1,s.minSize=l||10,s.backMap=u?u.backMap:new Map,s.parent=u,s.root=u?u.root:s,s.ulCell=null,s.urCell=null,s.blCell=null,s.brCell=null,s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(t,n.Rectangle),i=t,(s=[{key:"add",value:function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this.contains(e.x+i,e.y+r))return this.parent||console.warn("No QuadTree cell found!"),!1;const n=this.x2-this.x1,o=this.y2-this.y1;if(this.split)return this.ulCell.add(e,i,r)||this.urCell.add(e,i,r)||this.blCell.add(e,i,r)||this.brCell.add(e,i,r);if(this.items.size&&n>this.minSize&&o>this.minSize){this.split=!0;const s=.5*n,a=.5*o;this.ulCell=new t(this.x1,this.y1,this.x1+s,this.y1+a,this.minSize,this),this.blCell=new t(this.x1,this.y1+a,this.x1+s,this.y2,this.minSize,this),this.urCell=new t(this.x1+s,this.y1,this.x2,this.y1+a,this.minSize,this),this.brCell=new t(this.x1+s,this.y1+a,this.x2,this.y2,this.minSize,this);let l=this;for(;l;)l.count-=this.items.size,l=l.parent;for(const e of this.items){let t=this,n=!1;for(;t&&!(n=t.ulCell.add(e,i,r)||t.urCell.add(e,i,r)||t.blCell.add(e,i,r)||t.brCell.add(e,i,r));)t=t.parent;n||this.root.onBadSplit(e),this.items.delete(e)}return this.ulCell.add(e,i,r)||this.urCell.add(e,i,r)||this.blCell.add(e,i,r)||this.brCell.add(e,i,r)}if(!this.items.has(e)){let e=this;for(;e;)e.count++,e=e.parent}return this.backMap.set(e,this),this.items.add(e),!0}},{key:"move",value:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this.backMap.has(e))return this.add(e,t,i);const r=this.backMap.get(e);let n=r;for(;n&&!n.contains(e.x+t,e.y+i);)n=n.parent;return n?(n!==r&&(r.delete(e),n.add(e,t,i)),!0):(console.warn("No QuadTree cell found!"),r.delete(e),!1)}},{key:"delete",value:function(e){if(!this.backMap.has(e))return console.warn("Entity not in QuadTree."),!1;const t=this.backMap.get(e);this.backMap.delete(e),t.items.delete(e),t.parent&&t.parent.prune();let i=t;for(;i;)i.count--,i=i.parent;return!0}},{key:"isPrunable",value:function(){return this.split?this.ulCell.isPrunable()&&this.urCell.isPrunable()&&this.blCell.isPrunable()&&this.brCell.isPrunable():0===this.items.size}},{key:"prune",value:function(){return!!this.isPrunable()&&(this.split=!1,this.ulCell=null,this.urCell=null,this.blCell=null,this.brCell=null,!0)}},{key:"findLeaf",value:function(e,t){var i,r,n;return this.contains(e,t)?this.split?null!==(i=null!==(r=null!==(n=this.ulCell.findLeaf(e,t))&&void 0!==n?n:this.urCell.findLeaf(e,t))&&void 0!==r?r:this.blCell.findLeaf(e,t))&&void 0!==i?i:this.brCell.findLeaf(e,t):this:null}},{key:"has",value:function(e){return this.split?this.ulCell.has(e)||this.urCell.has(e)||this.blCell.has(e)||this.brCell.has(e):this.items.has(e)}},{key:"select",value:function(e,t,i,r){return e>this.x2||i<this.x1?new Set:t>this.y2||r<this.y1?new Set:this.split?new Set([...this.ulCell.select(e,t,i,r),...this.urCell.select(e,t,i,r),...this.blCell.select(e,t,i,r),...this.brCell.select(e,t,i,r)]):new Set(this.items)}},{key:"dump",value:function(){return this.split?new Set([...this.ulCell.dump(),...this.urCell.dump(),...this.blCell.dump(),...this.brCell.dump()]):new Set(this.items)}},{key:"onBadSplit",value:function(e){console.warn("Bad split!",e)}}])&&o(i.prototype,s),l&&o(i,l),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,s,l}()}),require.register("math/QuickTree.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.QuickTree=void 0;var r=t("./QuadTree"),n=t("./Rectangle");function o(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,s(r.key),r)}}function s(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function a(e,t,i){return t=h(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,i||[],h(e).constructor):t.apply(e,i))}function l(e,t,i,r){var n=u(h(1&r?e.prototype:e),t,i);return 2&r&&"function"==typeof n?function(e){return n.apply(i,e)}:n}function u(){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,i){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(r){var n=Object.getOwnPropertyDescriptor(r,t);return n.get?n.get.call(arguments.length<3?e:i):n.value}}).apply(null,arguments)}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}const f=new WeakMap;e.QuickTree=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a(this,t,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}(t,r.QuadTree),i=t,u=[{key:"deleteFromAllTrees",value:function(e){f.has(e)&&f.get(e).forEach(t=>t.delete(e))}}],(s=[{key:"add",value:function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;l(t,"add",this,3)([e,i,r])?(f.has(e)||f.set(e,new Set),f.get(e).add(this)):this.parent||console.warn("Failed to add object to QuickTree.")}},{key:"delete",value:function(e){l(t,"delete",this,3)([e])&&f.has(e)&&f.get(e).delete(this)}},{key:"select",value:function(e,i,r,o){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const u=new n.Rectangle(e,i,r,o),h=l(t,"select",this,3)([e,i,r,o]);for(const e of h)u.contains(e.x+s,e.y+a)||h.delete(e);return h}},{key:"onBadSplit",value:function(e){if(e.session&&e.session.world){const t=e.session.world.getMapsForPoint(e.x,e.y);t.forEach(t=>console.log(t.moveEntity(e))),t.size||console.warn("Bad split!",e)}}}])&&o(i.prototype,s),u&&o(i,u),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,s,u}()}),require.register("math/Ray.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Ray=void 0;var r=t("./Geometry");function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,s(r.key),r)}}function o(e,t,i){return(t=s(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function s(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}let a=e.Ray=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},i=[{key:"cast",value:function(e,t,i,r){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:320,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.DEFAULT_FLAGS,s=arguments.length>6?arguments[6]:void 0;return{terrain:this.castTerrain(e,t,i,r,n,o,s),entities:this.castEntity(e,t,i,r,n,o)}}},{key:"castEntity",value:function(e,t,i,n){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:320,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.DEFAULT_FLAGS,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;const l=Math.cos(n),u=Math.sin(n),h=t+(Math.abs(l)>Number.EPSILON?l:0)*o,c=i+(Math.abs(u)>Number.EPSILON?u:0)*o,f=.5*(t+h),d=.5*(i+c),p=Math.max(320,Math.abs(t-h)),v=Math.max(320,Math.abs(i-c)),m=e.getEntitiesForRect(f,d,p,v),y=new Map;for(const e of m){if(e===a)continue;let n=e.rect;if(!a||s&this.E_NO_MINK||(n=n.expand(a.rect)),n.contains(t,i)){y.set(e,[t,i,0,0]);continue}const o=n.toLines();for(let n=0;n<o.length;n+=4){const s=o[n+0],a=o[n+1],l=o[n+2],u=o[n+3],f=r.Geometry.lineIntersectsLine(s,a,l,u,t,i,h,c);if(f)if(y.has(e)){const t=y.get(e);f[2]<t[2]&&y.set(e,f)}else y.set(e,f)}}return y}},{key:"castTerrain",value:function(e,t,i,r){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:320,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.DEFAULT_FLAGS,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;n=Math.ceil(n);const a=Math.cos(r),l=Math.sin(r),u=t+(Math.abs(a)>Number.EPSILON?a:0)*n,h=i+(Math.abs(l)>Number.EPSILON?l:0)*n,c=u-t,f=h-i,d=Math.sign(c),p=Math.sign(f),v=c?Math.hypot(1,f/c):0,m=f?Math.hypot(1,c/f):0;let y=0;if(e.getSolid(t,i,s))return o&this.T_GET_LENGTH?0:[t,i];const g=null===e.getCollisionTile(t,i,s)?0:1;let b=g,w=g,x=!1,T=!1,E=1;let P=g?0:d>0?32-t%32:t%32+1,_=g?0:p>0?32-i%32:i%32+1,S=P*v*d,O=_*m*p;const j=new Set,R=new Set;for(;Math.abs(y)<n&&!j.size&&!R.size;){if(d&&(!p||Math.abs(S)<Math.abs(O))){const r=Math.abs(S);let n=t+r*a,o=i+r*l;if(d>=0&&n%1>.99999&&(n=Math.round(n)),p>=0&&o%1>.99999&&(o=Math.round(o)),d<=0&&n%1<1e-5&&(n=Math.round(n)),p<=0&&o%1<1e-5&&(o=Math.round(o)),x=b,E=(b=e.getCollisionTile(n,o,s))?1:32,!b&&x&&(E=d<0?(t+-P+1)%32:32-(t+P)%32),e.getSolid(n,o,s)){j.add([n,o]);break}y=Math.abs(S),S=(P+=E)*v*d}else{const r=Math.abs(O);let n=t+r*a,o=i+r*l;if(d>=0&&n%1>.99999&&(n=Math.round(n)),p>=0&&o%1>.99999&&(o=Math.round(o)),d<=0&&n%1<1e-5&&(n=Math.round(n)),p<=0&&o%1<1e-5&&(o=Math.round(o)),T=w,E=(w=e.getCollisionTile(n,o,s))?1:32,!w&&T&&(E=p<0?(i+-_+1)%32:32-(i+_)%32),e.getSolid(n,o,s)){R.add([n,o]);break}y=Math.abs(O),O=(_+=E)*m*p}0}const k=[...j,...R];if(o&this.T_ALL_POINTS)return new j.union(R);const M=k.map(e=>Math.pow(e[0]-t,2)+Math.pow(e[1]-i,2)),C=Math.min(...M),B=k[M.indexOf(C)];return B&&(d>0&&B[0]%1>.99999&&(B[0]=Math.round(B[0])),d<0&&B[0]%1<1e-5&&(B[0]=Math.round(B[0])),p>0&&B[1]%1>.99999&&(B[1]=Math.round(B[1])),p<0&&B[1]%1<1e-5&&(B[1]=Math.round(B[1]))),Math.sqrt(C)>n?void 0:B?(o&this.T_LAST_EMPTY&&(B[0]+=-a*Math.sign(S),B[1]+=-l*Math.sign(O)),o&this.T_SNAP_TO_INT&&(d>0&&(B[0]=Math.floor(B[0])),d<0&&(B[0]=Math.ceil(B[0])),p>0&&(B[1]=Math.floor(B[1])),p<0&&(B[1]=Math.ceil(B[1]))),o&this.T_GET_LENGTH?Math.hypot(t-B[0],i-B[1]):B):void 0}}],(t=null)&&n(e.prototype,t),i&&n(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}();o(a,"T_LAST_EMPTY",1),o(a,"T_ALL_POINTS",2),o(a,"T_SNAP_TO_INT",4),o(a,"T_GET_LENGTH",8),o(a,"E_NO_MINK",16),o(a,"DEFAULT_FLAGS",0)}),require.register("math/Rectangle.js",function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,n(r.key),r)}}function n(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Rectangle=void 0;e.Rectangle=function(){function e(t,i,r,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t>r||i>n)throw new Error("Not a rectangle!");this.x1=t,this.y1=i,this.x2=r,this.y2=n}return t=e,n=[{key:"clone",value:function(t){return new e(t.x1,t.y1,t.x2,t.y2)}}],(i=[{key:"contains",value:function(e,t){return!(e<this.x1||e>this.x2)&&!(t<this.y1||t>this.y2)}},{key:"isOverlapping",value:function(e){return!(this.x1>=e.x2||e.x1>=this.x2)&&!(this.y1>=e.y2||e.y1>=this.y2)}},{key:"isFlushWith",value:function(e){return!(this.x1>e.x2||e.x1>this.x2)&&(!(this.y1>e.y2||e.y1>this.y2)&&(this.x1===e.x2||e.x1===this.x2||(this.y1===e.y2||e.y1===this.y2||void 0)))}},{key:"intersection",value:function(e){if(this.isOverlapping(e))return new this.constructor(Math.max(this.x1,e.x1),Math.max(this.y1,e.y1),Math.min(this.x2,e.x2),Math.min(this.y2,e.y2))}},{key:"isInside",value:function(e){return this.x1>=e.x1&&this.y1>=e.y1&&this.x2<=e.x2&&this.y2<=e.y2}},{key:"isOutside",value:function(e){return e.isInside(this)}},{key:"expand",value:function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const s=t.x2-t.x1,a=t.y2-t.y1,l=.5*(i+n),u=.5*(r+o),h=this.x1+-s*(1-l),c=this.x2+s*l;return new e(h,this.y1+-a*(1-u),c,this.y2+a*u)}},{key:"toLines",value:function(){const e=this.x1,t=this.y1,i=this.x2,r=this.y2;return[e,t,i,t,i,t,i,r,e,r,i,r,e,t,e,r]}},{key:"toTriangles",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;return 2===e?[this.x1,this.y1,this.x2,this.y1,this.x1,this.y2,this.x1,this.y2,this.x2,this.y1,this.x2,this.y2]:3===e?[this.x1,this.y1,1,this.x2,this.y1,1,this.x1,this.y2,1,this.x1,this.y2,1,this.x2,this.y1,1,this.x2,this.y2,1]:4===e?[this.x1,this.y1,0,1,this.x2,this.y1,0,1,this.x1,this.y2,0,1,this.x1,this.y2,0,1,this.x2,this.y1,0,1,this.x2,this.y2,0,1]:[this.x1,this.y1,...e>2?Array(-2+e).fill(0):[],this.x2,this.y1,...e>2?Array(-2+e).fill(0):[],this.x1,this.y2,...e>2?Array(-2+e).fill(0):[],this.x1,this.y2,...e>2?Array(-2+e).fill(0):[],this.x2,this.y1,...e>2?Array(-2+e).fill(0):[],this.x2,this.y2,...e>2?Array(-2+e).fill(0):[]]}}])&&r(t.prototype,i),n&&r(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,i,n}()}),require.register("math/SMTree.js",function(e,t,i){"use strict";function r(e,t,i){return(t=a(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,a(r.key),r)}}function s(e,t,i){return t&&o(e.prototype,t),i&&o(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.SMTree=void 0;const l=Symbol("depth");let u=function(){function e(t,i,o){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;n(this,e),this.start=t,this.end=i,this.depth=a,this.dimension=s,this.size=0,this.rectangles=new Set,this.subTree=a<1?new c(r({dimension:s},l,1+a)):null,this.prev=o}return s(e,[{key:"split",value:function(t){if(t<this.start||t>this.end)throw new RangeError("Splitting segment out of bounds!");if(t===this.start)return[this];if(t===this.end)return[this];const i=new e(this.start,t,this.prev,this.dimension,this.depth),r=new e(t,this.end,i,this.dimension,this.depth);for(const e of this.rectangles){const n=0===this.depth?e.x1:e.y1;(0===this.depth?e.x2:e.y2)<t?i.add(e):n>t?r.add(e):(i.add(e),r.add(e))}return[i,r]}},{key:"add",value:function(e){this.subTree&&this.subTree.add(e),this.rectangles.add(e),this.size=this.rectangles.size}},{key:"delete",value:function(e){return this.subTree&&this.subTree.delete(e),this.rectangles.delete(e),this.size=this.rectangles.size,!this.rectangles.size&&this.start>-1/0}},{key:"has",value:function(e){return this.rectangles.has(e)}}])}();const h=e=>"x1"in e&&"y1"in e&&"x2"in e&&"y2"in e&&e.x1<e.x2&&e.y1<e.y2;let c=e.SMTree=function(){return s(function e(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r({dimension:2},l,0);n(this,e),this.depth=t[l],this.dimension=t.dimension,this.segments=[new u(-1/0,1/0,null,this.dimension,this.depth)],this.rectangles=new WeakSet,this.snapshots=new WeakMap},[{key:"add",value:function(e){if(!h(e))throw new Error("Object supplied is not a Rectangle. Must have properties: x1, y1, x2, y2.");this.rectangles.add(e),this.snapshots.set(e,{x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2});const t=0===this.depth?e.x1:e.y1,i=0===this.depth?e.x2:e.y2,r=this.findSegment(t);this.splitSegment(r,t);const n=this.findSegment(i);if(this.splitSegment(n,i),r!==n)for(let o=1+r;o<=n;o++)this.segments[o].start<t||this.segments[o].end>i||this.segments[o].add(e);else this.segments[r].add(e)}},{key:"delete",value:function(e){if(!h(e))throw new Error("Object supplied is not a Rectangle. Must have properties: x1, y1, x2, y2.");if(!this.rectangles.has(e))return console.warn("Rectangle not in tree!"),!1;const t=this.snapshots.get(e);this.rectangles.delete(e),this.snapshots.delete(e);const i=0===this.depth?t.x1:t.y1,r=0===this.depth?t.x2:t.y2,n=this.findSegment(i);let o=this.findSegment(r),s=0;for(let t=n;t<=o;t++){const i=this.segments[t],r=this.segments[t-1],n=this.segments[t+1];i.has(e)&&(i.delete(e),s++),i.rectangles.size===r.rectangles.size&&(i.rectangles.symmetricDifference(r.rectangles).size>0||(r.end=i.end,n&&(n.prev=r),this.segments.splice(t,1),o--,t--))}return s}},{key:"move",value:function(e){this.delete(e),this.add(e)}},{key:"query",value:function(e,t,i,r){const n=this.findSegment(e),o=this.findSegment(i);let s=new Set;for(let e=n;e<=o;e++){const i=this.segments[e];if(!i.subTree)continue;const n=i.subTree.findSegment(t),o=i.subTree.findSegment(r);for(let e=n;e<=o;e++)s=s.union(i.subTree.segments[e].rectangles)}return s}},{key:"splitSegment",value:function(e,t){if(t<=this.segments[e].start||t>=this.segments[e].end)return;const i=this.segments[e].split(t);this.segments.splice(e,1,...i)}},{key:"findSegment",value:function(e){if(isNaN(e))throw new Error("World.findSegment takes a number param.");let t=0,i=-1+this.segments.length;do{const r=Math.floor(.5*(t+i)),n=this.segments[r];if(n.start<=e&&n.end>e)return r;n.start<e&&(t=1+r),n.end>e&&(i=-1+r)}while(t<=i);return-1}}])}()}),require.register("math/Split.js",function(e,t,i){"use strict";var r;function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,s(r.key),r)}}function o(e,t,i){return(t=s(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function s(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Split=void 0;let a=e.Split=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},i=[{key:"intToBytes",value:function(e){return this.value[0]=e,[...this.bytes]}},{key:"bytesToInt",value:function(e){return this.bytes[0]=e[0],this.bytes[1]=e[1],this.bytes[2]=e[2],this.bytes[3]=e[3],this.value[0]}},{key:"bytesToInt3",value:function(e){return this.bytes[0]=e[0],this.bytes[1]=e[1],this.bytes[2]=e[2],this.bytes[3]=0,this.value[0]}}],(t=null)&&n(e.prototype,t),i&&n(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}();r=a,o(a,"bytes",new Uint8ClampedArray(4)),o(a,"words",new Uint16Array(r.bytes.buffer)),o(a,"value",new Uint32Array(r.bytes.buffer))}),require.register("math/roundSquareWave.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.roundedSquareWave=void 0;e.roundedSquareWave=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t=Math.min(1,Math.max(0,t));const i=Math.round(10*(1-t)),r=Math.pow(i,3)+4;return.5*(Math.pow(Math.cos(Math.pow(Math.sin(Math.PI/2+e*Math.PI),1+i)),r)+(1-Math.pow(Math.cos(Math.pow(Math.sin(e*Math.PI),1+i)),r)))}}),require.register("model/BallController.js",function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,n(r.key),r)}}function n(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.BallController=void 0;let o=e.BallController=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},(t=[{key:"create",value:function(e,t){e.xSpeed=0,e.ySpeed=0,e.height=32,e.width=32}},{key:"destroy",value:function(e){}},{key:"simulate",value:function(e){const t=e.session.world;if(e.xSpeed||e.ySpeed){let i=e.xSpeed,r=e.ySpeed;const n=t.castTerrainRay(e.x+0,e.y+-16,e.xSpeed<0?Math.PI:0,Math.abs(e.xSpeed)+16,1),o=t.castTerrainRay(e.x+0,e.y+-16,.5*Math.PI*Math.sign(e.ySpeed),Math.abs(e.ySpeed)+16,1);if(n){i=n[0]-e.x+-16*Math.sign(e.xSpeed),e.xSpeed=-e.xSpeed}if(o){r=o[1]-(e.y+-16)+-16*Math.sign(e.ySpeed),e.ySpeed=-e.ySpeed}e.x+=i,e.y+=r}else{const t=2*Math.PI*Math.random(),i=6;e.xSpeed=Math.cos(t)*i,e.ySpeed=Math.sin(t)*i}}},{key:"collide",value:function(e,t,i){}},{key:"sleep",value:function(e){}},{key:"wakeup",value:function(e){}}])&&r(e.prototype,t),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}();var s,a,l;s=o,l="./sphere.png",(a=n(a="spriteImage"))in s?Object.defineProperty(s,a,{value:l,enumerable:!0,configurable:!0,writable:!0}):s[a]=l}),require.register("model/BarrelController.js",function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,n(r.key),r)}}function n(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.BarrelController=void 0;let o=e.BarrelController=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},(t=[{key:"create",value:function(e,t){e.xSpeed=0,e.ySpeed=0,e.height=32,e.width=26,e.ySpriteOffset=6,e.grounded=!0,this.shot=!1}},{key:"destroy",value:function(e){}},{key:"simulate",value:function(e){const t=e.session.world;if(t.getSolid(e.x,e.y+1)?(e.ySpeed=Math.min(0,e.ySpeed),e.grounded=!0):(e.ySpeed=Math.min(8,e.ySpeed+.5),e.grounded=!1),e.xSpeed||e.ySpeed){const i=Math.atan2(e.ySpeed,e.xSpeed),r=Math.hypot(e.ySpeed,e.xSpeed),n=t.castRay(e.x,e.y+-4,i,r,1);let o=e.xSpeed,s=e.ySpeed;n.terrain&&(o=n.terrain[0]-e.x,s=n.terrain[1]-e.y),e.x+=o,e.y+=s,this.shot||(e.xSpeed*=.9125)}else e.shot=!1;for(t.getSolid(e.x,e.y)&&!t.getSolid(e.x,e.y+-e.height)&&(e.ySpeed=0,e.y--);t.getSolid(e.x,e.y+-e.height)&&!t.getSolid(e.x,e.y);)e.ySpeed=0,e.y++;for(;t.getSolid(e.x+.5*-e.width,e.y+-8)&&!t.getSolid(e.x+.5*e.width,e.y+-8);)this.stop(e,e.xSpeed),e.xSpeed=0,e.x++;for(;t.getSolid(e.x+.5*e.width,e.y+-8)&&!t.getSolid(e.x+.5*-e.width,e.y+-8);)this.stop(e,e.xSpeed),e.xSpeed=0,e.x--}},{key:"collide",value:function(e,t,i){if(Math.abs(Math.sign(e.x-t.x)-Math.sign(t.xSpeed))<2){const i=Math.abs(t.x+-e.x),r=.5*(t.width+e.width)+Math.abs(t.xSpeed),n=Math.sign(e.x-t.x);e.xSpeed=t.xSpeed,i<r&&(e.xSpeed+=(r-i)*n),t.controller.pushing=e}}},{key:"sleep",value:function(e){}},{key:"wakeup",value:function(e){}},{key:"stop",value:function(e){e.xSpeed,this.shot=!1}}])&&r(e.prototype,t),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}();var s,a,l;s=o,l="/barrel.png",(a=n(a="spriteImage"))in s?Object.defineProperty(s,a,{value:l,enumerable:!0,configurable:!0,writable:!0}):s[a]=l}),require.register("model/BoxController.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BoxController=void 0;var r=t("../math/roundSquareWave"),n=t("./Entity");function o(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,a(r.key),r)}}function s(e,t,i){return(t=a(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function a(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}s(e.BoxController=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s(this,"frames",0)},(t=[{key:"create",value:function(e,t){t.gid?(e.x+=.5*t.width,e.y+=-1):(e.x+=.5*t.width,e.y+=t.height+-1),this.xOriginal=e.x,this.yOriginal=e.y,e.map&&(this.xOriginal-=e.map.x,this.yOriginal-=e.map.y),e.flags|=n.Entity.E_PLATFORM,e.flags|=n.Entity.E_STATIC}},{key:"destroy",value:function(e){}},{key:"simulate",value:function(e){if(e.sprite.width=e.width,e.sprite.height=e.height,e.props.has("xOscillate")){var t;const i=e.props.get("xOscillate"),n=null!==(t=e.props.get("delay"))&&void 0!==t?t:1500,o=e.session.world.age,s=(0,r.roundedSquareWave)(o/n,.6),a=e.lastMap?e.lastMap.x:0;e.x=a+this.xOriginal+s*i}if(e.props.has("yOscillate")){var i;const t=e.props.get("yOscillate"),o=null!==(i=e.props.get("delay"))&&void 0!==i?i:1500,s=e.session.world.age,a=(0,r.roundedSquareWave)(s/o,.6),l=e.lastMap?e.lastMap.y:0,u=this.yOriginal+l+a*t,h=u-e.y;if(h<0){e.session.world.getEntitiesForRect(e.x,e.y-.5*e.height,e.width,e.height+-h).forEach(t=>{t.flags&n.Entity.E_STATIC||t.ySpeed<h||(t.y=e.y-e.height)})}e.y=u}}},{key:"collide",value:function(e){}},{key:"sleep",value:function(e){}},{key:"wakeup",value:function(e){}}])&&o(e.prototype,t),i&&o(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}(),"spriteColor",[0,0,0,255])}),require.register("model/Entity.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Entity=void 0;var r=t("curvature/base/Bindable"),n=t("../math/Rectangle"),o=t("../sprite/Sprite"),s=t("../world/Properties");function a(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,u(r.key),r)}}function l(e,t,i){return(t=u(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function u(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}let h=e.Entity=function(){return e=function e(t){var i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this[r.Bindable.Prevent]=!0;const a=t.controller,l=t.session,u=t.inputManager,h=t.sprite,c=t.x,f=void 0===c?0:c,d=t.y,p=void 0===d?0:d,v=t.width,m=void 0===v?32:v,y=t.height,g=void 0===y?32:y;this.controller=a,this.id=t.id,this.xSpriteOffset=0,this.ySpriteOffset=h?0:15,this.flags=0,this.x=f,this.y=p,this.width=m,this.height=g,this.sprite=h||new o.Sprite({session:l,src:"/thing.png",width:32,height:32}),this.inputManager=u,this.session=l,this.props=new s.Properties(null!==(i=t.properties)&&void 0!==i?i:[],this),this.entityData=t,this.rect=new n.Rectangle(f-.5*m,p-g,f+.5*m,p),this.xOrigin=f,this.yOrigin=f,this.sleeping=!1,this.fresh=!0,this.map=t.map,this.grounded=!1,this.controller&&this.controller.create(this,this.entityData)},(t=[{key:"simulate",value:function(){const e=this.x,t=this.y,i=this.session.world,r=i.motionGraph.getParent(this),n=i.getMapsForPoint(this.x,this.y),o=[...n][0];i.motionGraph.getParent(r)||n.has(r)||i.motionGraph.delete(this),this.grounded&&!i.motionGraph.getParent(this)&&i.motionGraph.add(this,o),this.fresh&&(this.fresh=!1),this.controller&&this.controller.simulate(this),0===e&&0===t||(i.motionGraph.moveChildren(this,this.x-e,this.y-t),this.rect.x1=this.x-.5*this.width,this.rect.x2=this.x+.5*this.width,this.rect.y1=this.y-this.height,this.rect.y2=this.y),this.sprite&&(this.sprite.x=this.x+this.xSpriteOffset,this.sprite.y=this.y+this.ySpriteOffset),this.fixFPE()}},{key:"collide",value:function(e,t){this.controller&&this.controller.collide(this,e,t)}},{key:"sleep",value:function(){this.sleeping||(this.controller&&this.controller.sleep(this),this.sleeping=!0)}},{key:"wakeup",value:function(){this.sleeping&&(this.controller&&this.controller.wakeup(this),this.sleeping=!1)}},{key:"destroy",value:function(){this.controller&&this.controller.destroy(this)}},{key:"fixFPE",value:function(){this.x%1>.99999&&(this.x=Math.round(this.x)),this.y%1>.99999&&(this.y=Math.round(this.y)),this.x%1<1e-5&&(this.x=Math.round(this.x)),this.y%1<1e-5&&(this.y=Math.round(this.y))}}])&&a(e.prototype,t),i&&a(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}();l(h,"E_SOLID",1),l(h,"E_PLATFORM",16),l(h,"E_STATIC",128)}),require.register("model/MapMover.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MapMover=void 0;var r=t("../math/roundSquareWave");function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,o(r.key),r)}}function o(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}e.MapMover=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},(t=[{key:"create",value:function(e){this.yOriginal=e.y}},{key:"simulate",value:function(e,t){if(e.props.get("yOscillate")){const t=e.props.get("yOscillate"),i=e.props.get("delay"),n=e.session.world.age,o=(0,r.roundedSquareWave)(n/i,.6);e.y=this.yOriginal+o*t}}}])&&n(e.prototype,t),i&&n(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}()}),require.register("model/PlayerController.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PlayerController=void 0;var r=t("../math/Ray"),n=t("./Entity");function o(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,s(r.key),r)}}function s(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}let a=e.PlayerController=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},(t=[{key:"create",value:function(e,t){this.direction="south",this.state="standing",e.xSpeed=0,e.ySpeed=0,e.height=34,e.width=24,e.grounded=!0,e.grounded=0,this.gravity=.5,this.lastMap=null,this.pushing=null,this.xDirection=0}},{key:"destroy",value:function(e){}},{key:"simulate",value:function(e){"jumping"===this.state?e.height=24:e.height=34;const t=e.inputManager&&Math.min(1,Math.max(e.inputManager.axes[0].magnitude||0,-1))||0,i=(e.inputManager&&Math.min(1,Math.max(e.inputManager.axes[1].magnitude||0,-1)),e.session.world),o=i.getRegionsForPoint(e.x,e.y),s=i.getMapsForPoint(e.x,e.y),a=i.getSolid(e.x,e.y+1),l=[...i.getEntitiesForPoint(e.x,e.y+1)].filter(e=>e.flags&n.Entity.E_SOLID||e.flags&n.Entity.E_PLATFORM),u=[...s][0];let h=this.gravity;if(o.forEach(e=>{var t;h*=null!==(t=e.gravity)&&void 0!==t?t:1}),a?e.ySpeed>=0&&(e.ySpeed=Math.min(0,e.ySpeed),e.grounded=!0):(e.ySpeed=Math.min(8,e.ySpeed+h),e.grounded=!1),a)i.motionGraph.add(e,u),this.lastMap=u;else if(l.length){const t=l[0].y-l[0].height;e.ySpeed>=0&&e.y<t+16&&(e.y=t,e.ySpeed=Math.min(0,e.ySpeed),e.grounded=!0,i.motionGraph.add(e,l[0]))}else s.has(this.lastMap)?i.motionGraph.add(e,this.lastMap):s.has(this.lastMap)||i.motionGraph.delete(e);t?(this.xDirection=Math.sign(t),i.getSolid(e.x+Math.sign(t)*e.width*.5+Math.sign(t),e.y)||(e.xSpeed+=t*(e.grounded?.2:.3)),Math.abs(e.xSpeed)>8&&(e.xSpeed=8*Math.sign(e.xSpeed)),e.grounded&&t&&Math.sign(t)!==Math.sign(e.xSpeed)&&(e.xSpeed*=.75)):e.grounded?e.xSpeed*=.9:e.xSpeed*=.99,this.pushing&&(e.xSpeed&&Math.sign(e.xSpeed)!==Math.sign(this.pushing.x-e.x)&&(this.pushing=null),e.grounded||(this.pushing=null));const c=Math.atan2(e.ySpeed,e.xSpeed),f=Math.hypot(e.ySpeed,e.xSpeed),d=r.Ray.castEntity(i,e.x,e.y,this.xDirection<0?Math.PI:0,Math.min(f,.5*e.width),r.Ray.T_LAST_EMPTY,e);if(d&&(d.delete(e),d.forEach((t,i)=>{i.collide(e,t),e.collide(i,t)})),e.xSpeed||e.ySpeed){if(o.forEach(t=>{e.xSpeed*=t.drag,e.ySpeed>0&&(e.ySpeed*=t.drag)}),!e.grounded){const t=r.Ray.castTerrain(i,e.x,e.y+1,this.xDirection<0?Math.PI:0,f+.5*e.width,r.Ray.T_LAST_EMPTY);if(t){Math.hypot(e.x-t[0],e.y-t[1])<.5*e.width&&(e.y-=2,e.x+=Math.sign(e.xSpeed))}}const t=r.Ray.castTerrain(i,e.x,e.y,c,f,r.Ray.T_LAST_EMPTY);let n=e.xSpeed,s=e.ySpeed;t&&(n=t[0]-e.x,s=t[1]-e.y),e.x+=n,e.y+=s}for(i.getSolid(e.x,e.y)&&!i.getSolid(e.x,e.y+-e.height)&&(e.ySpeed=0,e.y--);i.getSolid(e.x,e.y+-e.height)&&!i.getSolid(e.x,e.y);)e.ySpeed=0,e.y++;for(;i.getSolid(e.x+.5*-e.width,e.y+-8)&&!i.getSolid(e.x+.5*e.width,e.y+-8);)e.xSpeed=0,e.x++;for(;i.getSolid(e.x+.5*e.width,e.y+-8)&&!i.getSolid(e.x-.5*e.width,e.y+-8);)e.xSpeed=0,e.x--;e.grounded&&(this.state=t?"walking":"standing",t<0?this.direction="west":t>0&&(this.direction="east")),e.inputManager&&(e.grounded&&e.inputManager.buttons[0]&&1===e.inputManager.buttons[0].time&&(e.grounded=!1,this.state="jumping",e.ySpeed=-10),!e.grounded&&e.inputManager.buttons[0]&&-1===e.inputManager.buttons[0].time&&(e.ySpeed=Math.max(-4,e.ySpeed)),this.pushing&&e.inputManager.buttons[1]&&1===e.inputManager.buttons[1].time&&(this.pushing.controller.shot=!0,this.pushing.xSpeed*=4,this.pushing=null)),e.sprite&&("jumping"===this.state?(e.sprite.scaleX=this.xDirection,e.sprite.changeAnimation(`${this.state}`)):(e.sprite.scaleX=1,e.sprite.changeAnimation(`${this.state}-${this.direction}`))),"jumping"===this.state&&"south"===this.direction&&(this.xDirection=1,this.direction="east")}},{key:"collide",value:function(e,t,i){if(t.flags&n.Entity.E_PLATFORM){const i=t.y-t.height;e.ySpeed>0&&e.y<i+16&&(e.ySpeed=0,e.grounded=!0,this.y=i)}}},{key:"sleep",value:function(e){}},{key:"wakeup",value:function(e){}}])&&o(e.prototype,t),i&&o(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}();var l,u,h;l=a,h="/player.tsj",(u=s(u="spriteSheet"))in l?Object.defineProperty(l,u,{value:h,enumerable:!0,configurable:!0,writable:!0}):l[u]=h}),require.register("model/Spawner.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Spawner=void 0;var r=t("../sprite/SpriteSheet"),n=t("../sprite/Sprite"),o=t("./Entity"),s=t("../world/Properties");function a(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)}return i}function l(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?a(Object(i),!0).forEach(function(t){u(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function u(e,t,i){return(t=c(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function h(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,c(r.key),r)}}function c(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function f(e,t,i){return t=p(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,i||[],p(e).constructor):t.apply(e,i))}function d(){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,i){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}(e,t);if(r){var n=Object.getOwnPropertyDescriptor(r,t);return n.get?n.get.call(arguments.length<3?e:i):n.value}}).apply(null,arguments)}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}e.Spawner=function(e){function t(e){var i,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=f(this,t,[e])).spawnData=e,r.spawnType=e.spawnType,r.spawnClass=e.spawnClass,r.session=e.session,r.props=new s.Properties(null!==(i=e.properties)&&void 0!==i?i:[],r),r.flags|=o.Entity.E_STATIC,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&v(e,t)}(t,o.Entity),i=t,(a=[{key:"simulate",value:function(){const e=this.spawnData.spawnClass,i=l({},this.spawnData.entityDef),s=new e;i.sprite||(e.spriteSheet?i.sprite=new n.Sprite({session:this.spawnData.session,spriteSheet:new r.SpriteSheet({src:e.spriteSheet})}):e.spriteImage?i.sprite=new n.Sprite({session:this.spawnData.session,src:e.spriteImage}):this.spawnData.gid?i.sprite=new n.Sprite({session:this.spawnData.session,src:this.spawnData.map.getTileImage(this.spawnData.gid),tiled:!0}):this.props.has("color")?i.sprite=new n.Sprite({session:this.spawnData.session,color:this.props.get("color"),width:this.width,height:this.height}):e.spriteColor&&(i.sprite=new n.Sprite({session:this.spawnData.session,color:e.spriteColor,width:this.width,height:this.height})));const a=this.spawnData.map,u=new o.Entity(l(l({},i),{},{controller:s,session:this.session,x:this.x,y:this.y,map:a}));var h,c,f,v,m;this.session.world.motionGraph.add(u,a),u.lastMap=a,this.session.addEntity(u),this.session.removeEntity(this),(h=t,c="simulate",f=this,m=d(p(1&(v=3)?h.prototype:h),c,f),2&v&&"function"==typeof m?function(e){return m.apply(f,e)}:m)([])}}])&&h(i.prototype,a),u&&h(i,u),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,a,u}()}),require.register("overlay/overlay.frag",function(e,t,i){i.exports="precision mediump float;\n\nuniform vec4 u_color;\nvarying vec2 v_texCoord;\n\nvoid main() {\n  // gl_FragColor = texture2D(u_image, v_texCoord);\n  gl_FragColor = vec4(1.0, 1.0, 0.0, 0.25);\n}\n"}),require.register("overlay/overlay.vert",function(e,t,i){i.exports="attribute vec2 a_position;\nattribute vec2 a_texCoord;\n\nuniform vec2 u_resolution;\nvarying vec2 v_texCoord;\n\nvoid main()\n{\n  vec2 zeroToOne = a_position / u_resolution;\n  vec2 zeroToTwo = zeroToOne * 2.0;\n  vec2 clipSpace = zeroToTwo - 1.0;\n\n  gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n  v_texCoord  = a_texCoord;\n}\n"}),require.register("session/Session.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Session=void 0;var r=t("../math/QuickTree"),n=t("../sprite/SpriteBoard"),o=t("../sprite/SpriteSheet"),s=t("../sprite/Sprite"),a=t("../model/Entity"),l=t("../sprite/Camera"),u=t("../world/World"),h=t("../math/MotionGraph"),c=t("../input/Controller"),f=t("../world/Pallet");function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var r,n,o,s,a=[],l=!0,u=!1;try{if(o=(i=i.call(e)).next,0===t){if(Object(i)!==i)return;l=!1}else for(;!(l=(r=o.call(i)).done)&&(a.push(r.value),a.length!==t);l=!0);}catch(e){u=!0,n=e}finally{try{if(!l&&null!=i.return&&(s=i.return(),Object(s)!==s))return}finally{if(u)throw n}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return p(e,t);var i={}.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?p(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=Array(t);i<t;i++)r[i]=e[i];return r}function v(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,m(r.key),r)}}function m(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}const y=new URLSearchParams(location.search),g=!!y.has("start")&&y.get("start").split(",").map(Number);console.log(location.search,y,g);e.Session=function(){return e=function e(t){let i=t.element,r=t.keyboard,o=t.onScreenJoyPad,s=t.worldSrc,a=t.mapPallet,l=void 0===a?{}:a,h=t.entityPallet,p=void 0===h?{}:h;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.entityPallet=new f.Pallet,this.mapPallet=new f.Pallet,Object.entries(p).forEach(e=>{let t=d(e,2),i=t[0],r=t[1];return this.entityPallet.register(i,r)}),Object.entries(l).forEach(e=>{let t=d(e,2),i=t[0],r=t[1];return this.mapPallet.register(i,r)}),this.fThen=0,this.sThen=0,this.frameLock=60,this.simulationLock=60,this.entities=new Set,this.removed=new WeakSet,this.awake=new Set,this.paused=!1,this.loaded=!1,this.overscan=640,this.world=new u.World({src:s,session:this}),this.spriteBoard=new n.SpriteBoard({element:i,world:this.world,session:this}),this.keyboard=r,this.onScreenJoyPad=o,this.world.ready.then(()=>this.initialize({keyboard:r,onScreenJoyPad:o})),this.controller=new c.Controller({deadZone:.2}),this.controller.zero(),this.gamepad=null,window.addEventListener("gamepadconnected",e=>{this.gamepad=e.gamepad}),window.addEventListener("gamepaddisconnected",e=>{this.gamepad&&(this.gamepad=null)})},(t=[{key:"initialize",value:async function(){if(this.loaded=!0,g){this.world.getMapsForPoint(...g).forEach(e=>e.initialize())}for(const i of this.world.maps){var e,t;if(!i.loaded)continue;if(!i.props.has("player-start"))continue;const r=i.props.get("player-start"),n=i.entityDefs[r],u=await this.entityPallet.resolve(n.type),h=null!==(e=g[0])&&void 0!==e?e:n.x,c=null!==(t=g[1])&&void 0!==t?t:n.y,f=this.player=new a.Entity({controller:new u,session:this,x:h,y:c,inputManager:this.controller,sprite:new s.Sprite({session:this,spriteSheet:new o.SpriteSheet({src:"/player.tsj"})}),camera:l.Camera});this.spriteBoard.following=f,this.addEntity(f)}}},{key:"addEntity",value:function(e){if(this.entities.has(e))return;this.entities.add(e),this.world.getMapsForPoint(e.x,e.y).forEach(t=>t.addEntity(e))}},{key:"removeEntity",value:function(e){e.destroy(),this.entities.delete(e),this.awake.delete(e),this.spriteBoard.sprites.delete(e.sprite),r.QuickTree.deleteFromAllTrees(e),h.MotionGraph.deleteFromAllGraphs(e),this.removed.add(e)}},{key:"simulate",value:function(e){if(!this.loaded)return!1;const t=e-this.sThen;if(0==this.simulationLock||.2+t<1e3/this.simulationLock)return!1;if(this.sThen=e,this.keyboard.update(),this.controller.update({gamepad:this.gamepad}),this.controller.readInput({onScreenJoyPad:this.onScreenJoyPad,gamepads:navigator.getGamepads(),keyboard:this.keyboard}),this.controller.buttons[1020]&&1===this.controller.buttons[1020].time&&(this.paused=!this.paused),this.paused||!this.player)return!1;this.entities.forEach(e=>{e.sprite&&(e.sprite.visible=!1)});const i=this.player;this.spriteBoard.sprites.clear(),this.spriteBoard.regions.clear(),this.world.simulate(t),this.world.getMapsForRect(i.x,i.y,l.Camera.width,l.Camera.height).forEach(e=>{e.simulate(t),e.getRegionsForRect(i.x+-1*l.Camera.width+64,i.y+-1*l.Camera.height+64,i.x+1*l.Camera.width+64,i.y+1*l.Camera.height+64).forEach(e=>{e.simulate(t),this.spriteBoard.regions.add(e)})});const r=this.world.getEntitiesForRect(i.x,i.y,1*l.Camera.width+this.overscan,1*l.Camera.height+this.overscan);return r.delete(i),r.add(i),this.awake.difference(r).forEach(e=>{e.sprite&&(e.sprite.visible=!1),e.sleep(),this.awake.delete(e)}),r.forEach(e=>{if(this.awake.add(e),e.sleeping&&e.wakeup(),e.simulate(t),this.removed.has(e))return;this.world.getMapsForPoint(e.x,e.y).forEach(t=>t.moveEntity(e)),e.sprite&&(this.spriteBoard.sprites.add(e.sprite),e.sprite.visible=!0)}),!0}},{key:"draw",value:function(e){if(!this.loaded)return;const t=e-this.fThen;return!(0==this.frameLock||.2+t<1e3/this.frameLock)&&(this.spriteBoard.draw(t),this.fThen=e,!0)}}])&&v(e.prototype,t),i&&v(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}()}),require.register("sprite/Camera.js",function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,o(r.key),r)}}function n(e,t,i){return(t=o(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function o(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Camera=void 0;let s=e.Camera=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)});n(s,"x",0),n(s,"y",0),n(s,"width",0),n(s,"height",0)}),require.register("sprite/MapRenderer.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MapRenderer=void 0;var r=t("curvature/base/Bindable");function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,o(r.key),r)}}function o(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}e.MapRenderer=function(){return e=function e(t){let i=t.spriteBoard,n=t.map;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this[r.Bindable.Prevent]=!0,this.spriteBoard=i,this.loaded=!1,this.map=n,this.width=0,this.height=0,this.tileWidth=0,this.tileHeight=0,this.xOffset=0,this.yOffset=0;const o=this.spriteBoard.gl2d.context;this.tileMapping=this.spriteBoard.gl2d.createTexture(1,1),this.tileTexture=this.spriteBoard.gl2d.createTexture(1,1),n.initialize(),n.ready.then(()=>{this.loaded=!0,this.tileWidth=n.tileWidth,this.tileHeight=n.tileHeight,o.bindTexture(o.TEXTURE_2D,this.tileTexture),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,n.tileSetWidth,n.tileSetHeight,0,o.RGBA,o.UNSIGNED_BYTE,n.pixels),o.bindTexture(o.TEXTURE_2D,null)})},(t=[{key:"negSafeMod",value:function(e,t){return e>=0?e%t:(t+e%t)%t}},{key:"draw",value:function(e,t){if(!this.loaded)return;const i=this.spriteBoard.gl2d.context,r=-this.map.x+this.spriteBoard.following.x,n=-this.map.y+this.spriteBoard.following.y,o=this.spriteBoard.zoomLevel,s=.5*this.tileWidth,a=.5*this.tileHeight,l=Math.floor(this.width/this.tileWidth),u=Math.floor(this.height/this.tileHeight),h=64*Math.floor(Math.floor(.5*this.width/64)+0),c=64*Math.floor(Math.floor(.5*this.height/64)+0),f=(r+s)/this.tileWidth+-this.negSafeMod(r+s,64)/this.tileWidth+-h/this.tileWidth,d=(n+a)/this.tileHeight+-this.negSafeMod(n+a,64)/this.tileHeight+-c/this.tileHeight;if(f+l<0||d+u<0)return;const p=o*(.5*(this.width+this.xOffset)-this.negSafeMod(r+s,64)-h),v=o*(.5*(this.height+this.yOffset)-this.negSafeMod(n+a,64)-c);this.spriteBoard.drawProgram.uniformF("u_size",this.width,this.height),this.spriteBoard.drawProgram.uniformF("u_tileSize",this.tileWidth,this.tileHeight),this.spriteBoard.drawProgram.uniformF("u_mapTextureSize",this.map.tileSetWidth,this.map.tileSetHeight),this.spriteBoard.drawProgram.uniformI("u_renderTiles",1),i.activeTexture(i.TEXTURE2),i.bindTexture(i.TEXTURE_2D,this.tileTexture),this.spriteBoard.drawProgram.uniformI("u_tiles",2),i.activeTexture(i.TEXTURE3),i.bindTexture(i.TEXTURE_2D,this.tileMapping),this.spriteBoard.drawProgram.uniformI("u_tileMapping",3);const m=this.map.getSlice(t,f,d,l,u,e);for(const e of m)i.texImage2D(i.TEXTURE_2D,0,i.RGBA,l,u,0,i.RGBA,i.UNSIGNED_BYTE,e),this.setRectangle(p+.5*this.tileWidth*o,v+this.tileHeight*o,this.width*o,this.height*o),this.spriteBoard.drawProgram.uniformF("u_region",1,1,1,0),"foreground"===t&&this.spriteBoard.drawProgram.uniformF("u_region",1,1,1,1),i.bindFramebuffer(i.FRAMEBUFFER,this.spriteBoard.effectBuffer),i.drawArrays(i.TRIANGLES,0,6),this.spriteBoard.drawProgram.uniformF("u_region",0,0,0,0),i.bindFramebuffer(i.FRAMEBUFFER,this.spriteBoard.drawBuffer),i.drawArrays(i.TRIANGLES,0,6);this.spriteBoard.drawProgram.uniformI("u_renderTiles",0),i.bindFramebuffer(i.FRAMEBUFFER,null),i.activeTexture(i.TEXTURE2),i.bindTexture(i.TEXTURE_2D,null),i.activeTexture(i.TEXTURE3),i.bindTexture(i.TEXTURE_2D,null),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,null)}},{key:"resize",value:function(e,t){this.width=e+0,this.height=t+0,this.width=128*Math.ceil(e/128)+128,this.height=128*Math.ceil(t/128)+128,this.xOffset=e-this.width,this.yOffset=t-this.height}},{key:"simulate",value:function(){}},{key:"setRectangle",value:function(e,t,i,r){const n=this.spriteBoard.gl2d.context;n.bindBuffer(n.ARRAY_BUFFER,this.spriteBoard.drawProgram.buffers.a_texCoord),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),n.STATIC_DRAW);const o=e,s=e+i,a=t,l=t+r;n.bindBuffer(n.ARRAY_BUFFER,this.spriteBoard.drawProgram.buffers.a_position),n.bufferData(n.ARRAY_BUFFER,new Float32Array([o,l,s,l,o,a,o,a,s,l,s,a]),n.STATIC_DRAW)}}])&&n(e.prototype,t),i&&n(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}()}),require.register("sprite/Parallax.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Parallax=void 0;var r=t("curvature/base/Bindable");function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,l(r.key),r)}}function o(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t,i){return(t=l(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function l(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}let u=o(function e(){s(this,e),a(this,"texture",null),a(this,"width",0),a(this,"height",0),a(this,"offset",0),a(this,"parallax",0)});e.Parallax=function(){return o(function e(t){let i=t.spriteBoard,n=t.map;s(this,e),this[r.Bindable.Prevent]=!0,this.spriteBoard=i;this.spriteBoard.gl2d.context;this.map=n,this.texture=null,this.height=0,this.parallaxLayers=[],this.textures=[],this.ready=n.ready.then(()=>this.assemble(n)).then(()=>{this.loaded=!0}),this.loaded=!1,this.x=0,this.y=0},[{key:"assemble",value:function(){const e=this.spriteBoard.gl2d.context,t=this.map.imageLayers.map((t,i)=>this.constructor.loadImage(new URL(t.image,this.map.src)).then(r=>{var n,o;const s=this.textures[i]=e.createTexture(),a=this.parallaxLayers[i]=new u,l=r.height+t.offsety;this.height<l&&(this.height=l),a.texture=s,a.width=r.width,a.height=r.height,a.offset=null!==(n=t.offsety)&&void 0!==n?n:0,a.parallax=null!==(o=t.parallaxx)&&void 0!==o?o:1,e.bindTexture(e.TEXTURE_2D,s),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST)}));return Promise.all(t)}},{key:"draw",value:function(){if(!this.loaded)return;const e=this.spriteBoard.gl2d.context,t=this.spriteBoard.zoomLevel;this.x=this.spriteBoard.following.x+-this.spriteBoard.width/t*.5,this.y=this.spriteBoard.following.y,this.spriteBoard.drawProgram.uniformI("u_renderParallax",1),this.spriteBoard.drawProgram.uniformF("u_scroll",this.x,this.y),e.activeTexture(e.TEXTURE0);for(const i of this.parallaxLayers)e.bindTexture(e.TEXTURE_2D,i.texture),this.spriteBoard.drawProgram.uniformF("u_size",i.width,i.width),this.spriteBoard.drawProgram.uniformF("u_parallax",i.parallax,0),this.setRectangle(0,this.spriteBoard.height+(-this.height+i.offset)*t,i.width*t,i.height*t,i.width),e.bindFramebuffer(e.FRAMEBUFFER,this.spriteBoard.drawBuffer),e.drawArrays(e.TRIANGLES,0,6);this.spriteBoard.drawProgram.uniformI("u_renderParallax",0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindTexture(e.TEXTURE_2D,null)}},{key:"setRectangle",value:function(e,t,i,r){const n=this.spriteBoard.gl2d.context,o=this.spriteBoard.width/i;n.bindBuffer(n.ARRAY_BUFFER,this.spriteBoard.drawProgram.buffers.a_texCoord),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,0,o,0,0,1,0,1,o,0,o,1]),n.STATIC_DRAW);const s=e-0,a=e+this.spriteBoard.width,l=t,u=t+r;n.bindBuffer(n.ARRAY_BUFFER,this.spriteBoard.drawProgram.buffers.a_position),n.bufferData(n.ARRAY_BUFFER,new Float32Array([s,u,a,u,s,l,s,l,a,u,a,l]),n.STATIC_DRAW)}}],[{key:"loadImage",value:function(e){return this.imagePromises||(this.imagePromises={}),this.imagePromises[e]?this.imagePromises[e]:(this.imagePromises[e]=new Promise((t,i)=>{const r=new Image;r.src=e,r.addEventListener("load",e=>{t(r)})}),this.imagePromises[e])}}])}()}),require.register("sprite/Region.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Region=void 0;var r=t("curvature/base/Bindable"),n=(t("./SpriteSheet"),t("../math/Matrix")),o=t("./Camera"),s=t("../math/Rectangle");function a(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,l(r.key),r)}}function l(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}const u=new WeakMap;e.Region=function(){return e=function e(t){let i=t.x,n=t.y,o=t.z,a=t.width,l=t.height,h=t.session,c=t.spriteBoard;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this[r.Bindable.Prevent]=!0,this.x=i||0,this.y=n||0,this.z=o||0,this.width=a||32,this.height=l||32,this.originalWidth=a,this.originalHeight=l,this.visible=!1,this.gravity=.5,this.drag=.95,this.rect=new s.Rectangle(this.x,this.y,this.x+this.width,this.y+this.height),u.set(this.rect,this),this.spriteBoard=c,this.session=h,this.region=[0,1,1,1];const f=this.spriteBoard.gl2d.context;this.texture=f.createTexture();const d=new Uint8ClampedArray([255*this.region[0],255*this.region[1],255*this.region[2],255*this.region[3]]);f.bindTexture(f.TEXTURE_2D,this.texture),f.texImage2D(f.TEXTURE_2D,0,f.RGBA,1,1,0,f.RGBA,f.UNSIGNED_BYTE,d)},t=[{key:"move",value:function(e,t){this.x+=e,this.y+=t,this.rect.x1+=e,this.rect.x2+=e,this.rect.y1+=t,this.rect.y2+=t}},{key:"resize",value:function(e,t,i,r){const n=this.width,o=this.height,s=i*(1-e/n)*n,a=r*(1-t/o)*o;this.width=e,this.height=t,this.x+=s,this.y+=a,this.rect.x1=this.x,this.rect.y1=this.y,this.rect.x2=this.rect.x1+e,this.rect.y2=this.rect.y1+e}},{key:"simulate",value:function(e){this.resize(this.width,this.originalHeight*(.5*Math.sin(this.session.world.age/3e3)+.5),1,1)}},{key:"draw",value:function(e){const t=this.spriteBoard.gl2d.context,i=this.spriteBoard.zoomLevel;this.spriteBoard.drawProgram.uniformF("u_region",0,0,0,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.texture),this.setRectangle(this.x*i-o.Camera.x+this.spriteBoard.width/2,this.y*i-o.Camera.y+this.spriteBoard.height/2,this.width*i,this.height*i),this.spriteBoard.drawProgram.uniformF("u_region",...Object.assign(this.region||[0,0,0],{3:1})),t.bindFramebuffer(t.FRAMEBUFFER,this.spriteBoard.effectBuffer),t.drawArrays(t.TRIANGLES,0,6),this.spriteBoard.drawProgram.uniformF("u_region",0,0,0,0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,null)}},{key:"setRectangle",value:function(e,t,i,r){const o=this.spriteBoard.gl2d.context,s=this.spriteBoard.zoomLevel;o.bindBuffer(o.ARRAY_BUFFER,this.spriteBoard.drawProgram.buffers.a_texCoord),o.bufferData(o.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),o.STATIC_DRAW);const a=e+i,l=t+r,u=new Float32Array([e,t,a,t,e,l,e,l,a,t,a,l]),h=e+i,c=t+r,f=n.Matrix.transform(u,n.Matrix.composite(n.Matrix.translate(h+0*-i,c+s+16*s),n.Matrix.translate(-h,-c)));o.bindBuffer(o.ARRAY_BUFFER,this.spriteBoard.drawProgram.buffers.a_position),o.bufferData(o.ARRAY_BUFFER,f,o.STATIC_DRAW)}}],i=[{key:"fromRect",value:function(e){return u.get(e)}}],t&&a(e.prototype,t),i&&a(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}()}),require.register("sprite/Sprite.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Sprite=void 0;var r=t("curvature/base/Bindable"),n=t("./SpriteSheet"),o=t("../math/Matrix"),s=t("./Camera");function a(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,l(r.key),r)}}function l(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}e.Sprite=function(){return e=function e(t){let i=t.src,o=t.color,s=(t.pixels,t.session),a=t.spriteSheet,l=t.x,u=t.y,h=t.z,c=t.width,f=t.height,d=t.originalWidth,p=t.originalHeight,v=t.tiled,m=void 0!==v&&v;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this[r.Bindable.Prevent]=!0,this.x=l||0,this.y=u||0,this.z=h||0,this.currentAnimation=null,this.width=c||32,this.height=f||32,this.originalWidth=null!==d&&void 0!==d?d:this.width,this.originalHeight=null!==p&&void 0!==p?p:this.height,this.tiled=m,this.scale=1,this.scaleX=1,this.scaleY=1,this.theta=0,this.shearX=0,this.shearY=0,this.xCenter=.5,this.yCenter=1,this.visible=!1,this.textures=[],this.frames=[],this.currentDelay=0,this.currentFrame=0,this.currentFrames="",this.speed=0,this.maxSpeed=4,this.RIGHT=0,this.DOWN=1,this.LEFT=2,this.UP=3,this.EAST=this.RIGHT,this.SOUTH=this.DOWN,this.WEST=this.LEFT,this.NORTH=this.UP,this.region=[0,0,0,1],this.spriteBoard=s.spriteBoard;const y=this.spriteBoard.gl2d.context;this.texture=y.createTexture();const g=o?new Uint8Array(o):new Uint8Array([Math.trunc(255*Math.random()),Math.trunc(255*Math.random()),Math.trunc(255*Math.random()),255]);y.bindTexture(y.TEXTURE_2D,this.texture),y.texImage2D(y.TEXTURE_2D,0,y.RGBA,1,1,0,y.RGBA,y.UNSIGNED_BYTE,g),i&&!a&&(a=new n.SpriteSheet({image:i})),this.spriteSheet=a,a&&a.ready.then(()=>{this.width=a.tileWidth,this.height=a.tileHeight,this.originalWidth=null!==d&&void 0!==d?d:this.width,this.originalHeight=null!==p&&void 0!==p?p:this.height,this.texture=this.createTexture(a.getFrame(0));for(let e=0;e<a.tileCount;e++)this.textures[e]=this.createTexture(a.getFrame(e));this.changeAnimation("default")})},(t=[{key:"draw",value:function(e){if(this.currentDelay>0)this.currentDelay-=e;else if(this.currentFrame++,this.spriteSheet&&this.spriteSheet.animations[this.currentAnimation]){const e=this.spriteSheet.animations[this.currentAnimation];this.currentFrame>=e.length&&(this.currentFrame=this.currentFrame%e.length);const t=e[this.currentFrame].tileid,i=this.textures[t];i&&(this.currentDelay=e[this.currentFrame].duration,this.texture=i)}const t=this.spriteBoard.gl2d.context,i=this.spriteBoard.zoomLevel;this.spriteBoard.drawProgram.uniformF("u_region",0,0,0,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.texture),this.setRectangle(this.x*i-s.Camera.x+this.spriteBoard.width/2,this.y*i-s.Camera.y+this.spriteBoard.height/2+-this.height*i,this.width*i,this.height*i),t.bindFramebuffer(t.FRAMEBUFFER,this.spriteBoard.drawBuffer),t.drawArrays(t.TRIANGLES,0,6),this.spriteBoard.drawProgram.uniformF("u_region",...Object.assign(this.region||[0,0,0],{3:1})),t.bindFramebuffer(t.FRAMEBUFFER,this.spriteBoard.effectBuffer),t.drawArrays(t.TRIANGLES,0,6),this.spriteBoard.drawProgram.uniformF("u_region",0,0,0,0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,null)}},{key:"changeAnimation",value:function(e){this.spriteSheet&&this.spriteSheet.animations[e]&&this.currentAnimation!==e&&(this.currentAnimation=e,this.currentDelay=0)}},{key:"createTexture",value:function(e){const t=this.spriteBoard.gl2d.context,i=t.createTexture();return t.bindTexture(t.TEXTURE_2D,i),this.tiled?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,e),t.bindTexture(t.TEXTURE_2D,null),i}},{key:"setRectangle",value:function(e,t,i,r){const n=this.spriteBoard.gl2d.context,s=this.spriteBoard.zoomLevel,a=this.width/this.originalWidth,l=this.height/this.originalHeight;n.bindBuffer(n.ARRAY_BUFFER,this.spriteBoard.drawProgram.buffers.a_texCoord),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,0,a,0,0,l,0,l,a,0,a,l]),n.STATIC_DRAW);const u=e+i,h=t+r,c=new Float32Array([e,t,u,t,e,h,e,h,u,t,u,h]),f=e+i*this.xCenter,d=t+r*this.yCenter,p=o.Matrix.transform(c,o.Matrix.composite(o.Matrix.translate(f+.5*-i,d+s+16*s),o.Matrix.shearX(this.shearX),o.Matrix.shearX(this.shearY),o.Matrix.scale(this.scale*this.scaleX,this.scale*this.scaleY),o.Matrix.rotate(this.theta),o.Matrix.translate(-f,-d)));n.bindBuffer(n.ARRAY_BUFFER,this.spriteBoard.drawProgram.buffers.a_position),n.bufferData(n.ARRAY_BUFFER,p,n.STATIC_DRAW)}}])&&a(e.prototype,t),i&&a(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}()}),require.register("sprite/SpriteBoard.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SpriteBoard=void 0;var r=t("curvature/base/Bindable"),n=t("./MapRenderer"),o=t("./Parallax"),s=t("../gl2d/Gl2d"),a=t("./Camera");t("./Region");function l(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,u(r.key),r)}}function u(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}e.SpriteBoard=function(){return e=function e(t){let i=t.element,n=t.world;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this[r.Bindable.Prevent]=!0,this.maps=[],this.currentMap=null,this.world=n,this.sprites=new Set,this.regions=new Set,this.screenScale=1,this.zoomLevel=2,this.mouse={x:null,y:null,clickX:null,clickY:null},this.parallax=null,this.width=i.width,this.height=i.height,a.Camera.width=i.width,a.Camera.height=i.height,this.gl2d=new s.Gl2d(i),this.gl2d.enableBlending();this.renderMode=0,this.drawProgram=this.gl2d.createProgram({vertexShader:this.gl2d.createShader("sprite/texture.vert"),fragmentShader:this.gl2d.createShader("sprite/texture.frag"),attributes:["a_position","a_texCoord"],uniforms:["u_image","u_effect","u_tiles","u_tileMapping","u_size","u_scroll","u_tileSize","u_resolution","u_mapTextureSize","u_region","u_parallax","u_time","u_renderTiles","u_renderParallax","u_renderMode"]}),this.drawProgram.use(),this.drawLayer=this.gl2d.createTexture(1e3,1e3),this.effectLayer=this.gl2d.createTexture(1e3,1e3),this.drawBuffer=this.gl2d.createFramebuffer(this.drawLayer),this.effectBuffer=this.gl2d.createFramebuffer(this.effectLayer),document.addEventListener("mousemove",e=>{this.mouse.x=e.clientX,this.mouse.y=e.clientY}),this.mapRenderers=new Map,this.following=null},(t=[{key:"draw",value:function(e){if(this.following){a.Camera.x=this.following.x*this.zoomLevel||0,a.Camera.y=this.following.y*this.zoomLevel||0;const e=[...this.world.getMapsForPoint(this.following.x,this.following.y)];if(e[0]&&this.currentMap!==e[0]){const t=this.nextParallax=new o.Parallax({spriteBoard:this,map:e[0]});this.nextParallax.ready.then(()=>{this.nextParallax===t&&(this.parallax=t)}),this.currentMap=e[0]}const t=this.world.getMapsForRect(this.following.x,this.following.y,a.Camera.width,a.Camera.height),i=new Set;t.forEach(e=>{if(e.visible=!0,this.mapRenderers.has(e))return void i.add(this.mapRenderers.get(e));const t=new n.MapRenderer({spriteBoard:this,map:e});i.add(t),t.resize(a.Camera.width,a.Camera.height),this.mapRenderers.set(e,t)}),new Set(this.mapRenderers.keys()).difference(t).forEach(e=>{this.mapRenderers.delete(e),e.visible=!1})}const t=this.gl2d.context;if(this.drawProgram.uniformF("u_size",a.Camera.width,a.Camera.height),this.drawProgram.uniformF("u_resolution",t.canvas.width,t.canvas.height),this.drawProgram.uniformI("u_renderMode",this.renderMode),this.drawProgram.uniformF("u_time",performance.now()),this.drawProgram.uniformF("u_region",0,0,0,0),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clearColor(0,0,0,1),t.bindFramebuffer(t.FRAMEBUFFER,this.effectBuffer),t.clear(t.COLOR_BUFFER_BIT),this.currentMap&&this.currentMap.backgroundColor){const e=this.currentMap.backgroundColor,i=e[0]/255,r=e[1]/255,n=e[2]/255,o=e[3]/255;t.clearColor(i,n,r,o)}else t.clearColor(0,0,0,1);t.bindFramebuffer(t.FRAMEBUFFER,this.drawBuffer),t.clear(t.COLOR_BUFFER_BIT),t.clearColor(0,0,0,0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.clear(t.COLOR_BUFFER_BIT),this.drawProgram.uniformF("u_size",a.Camera.width,a.Camera.height);let i=[...this.sprites];i.sort((e,t)=>void 0===e.y?-1:void 0===t.y?1:e.y-t.y),this.parallax&&this.parallax.draw(),this.mapRenderers.forEach(t=>t.draw(e,"background")),i.forEach(t=>t.visible&&t.draw(e)),this.mapRenderers.forEach(t=>t.draw(e,"midground")),this.regions.forEach(e=>e.draw()),this.mapRenderers.forEach(t=>t.draw(e,"foreground")),this.setRectangle(0,this.gl2d.element.height,this.gl2d.element.width,-this.gl2d.element.height),t.bindFramebuffer(t.FRAMEBUFFER,null),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.drawLayer),this.drawProgram.uniformI("u_image",0),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this.effectLayer),this.drawProgram.uniformI("u_effect",1),t.drawArrays(t.TRIANGLES,0,6),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE4),t.bindTexture(t.TEXTURE_2D,null)}},{key:"resize",value:function(e,t){const i=this.gl2d.context;e=e||this.gl2d.element.width,t=t||this.gl2d.element.height,this.width=e,this.height=t,a.Camera.x*=this.zoomLevel,a.Camera.y*=this.zoomLevel,a.Camera.width=e/this.zoomLevel,a.Camera.height=t/this.zoomLevel,this.mapRenderers.forEach(e=>e.resize(a.Camera.width,a.Camera.height)),i.bindTexture(i.TEXTURE_2D,this.drawLayer),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,this.width,this.height,0,i.RGBA,i.UNSIGNED_BYTE,null),i.bindTexture(i.TEXTURE_2D,this.effectLayer),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,this.width,this.height,0,i.RGBA,i.UNSIGNED_BYTE,null),i.bindTexture(i.TEXTURE_2D,null)}},{key:"zoom",value:function(e){const t=32*this.screenScale,i=.2*this.screenScale;let r=e*(.05*this.zoomLevel)+this.zoomLevel;r<i?r=i:r>t&&(r=t),Math.abs(r-1)<.05&&(r=1),this.zoomLevel!==r&&(this.zoomLevel=r,this.resize())}},{key:"setRectangle",value:function(e,t,i,r){const n=this.gl2d.context;n.bindBuffer(n.ARRAY_BUFFER,this.drawProgram.buffers.a_texCoord),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),n.STATIC_DRAW);const o=e,s=e+i,a=t,l=t+r;n.bindBuffer(n.ARRAY_BUFFER,this.drawProgram.buffers.a_position),n.bufferData(n.ARRAY_BUFFER,new Float32Array([o,a,s,a,o,l,o,l,s,a,s,l]),n.STREAM_DRAW)}}])&&l(e.prototype,t),i&&l(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}()}),require.register("sprite/SpriteSheet.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SpriteSheet=void 0;var r=t("./Tileset");function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,o(r.key),r)}}function o(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function s(e,t,i){return t=a(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,i||[],a(e).constructor):t.apply(e,i))}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}e.SpriteSheet=function(e){function t(e){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=s(this,t,[e])).animations={default:[{tileid:0,duration:1/0}]},i.canvas=document.createElement("canvas"),i.context=i.canvas.getContext("2d",{willReadFrequently:!0}),i.frames=[],i.ready=i.ready.then(()=>{i.processImage();for(const e of i.tiles)e.animation?i.animations[e.type]=e.animation:e.type&&(i.animations[e.type]=[{duration:1/0,tileid:e.id}])}),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t)}(t,r.Tileset),i=t,(o=[{key:"processImage",value:function(){this.canvas.width=this.image.width,this.canvas.height=this.image.height,this.context.drawImage(this.image,0,0);for(let e=0;e<this.tileCount;e++)this.frames[e]=this.getFrame(e)}},{key:"getFrame",value:function(e){const t=(e%=this.tileCount)%this.columns,i=Math.floor(e/this.columns);return this.context.getImageData(t*this.tileWidth,i*this.tileHeight,this.tileWidth,this.tileHeight).data}}])&&n(i.prototype,o),a&&n(i,a),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,a}()}),require.register("sprite/TextureBank.js",function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,n(r.key),r)}}function n(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.TextureBank=void 0;e.TextureBank=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)})}),require.register("sprite/Tileset.js",function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,n(r.key),r)}}function n(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Tileset=void 0;const o=new Map;e.Tileset=function(){return e=function e(t){let i=t.source,r=t.src,n=t.map,o=t.firstgid,s=t.columns,a=t.image,l=t.imageheight,u=t.imagewidth,h=t.margin,c=t.name,f=t.spacing,d=t.tilecount,p=t.tileheight,v=t.tilewidth,m=t.tiles;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.firstGid=null!==o&&void 0!==o?o:0,this.tileCount=null!==d&&void 0!==d?d:0,this.tileHeight=null!==p&&void 0!==p?p:0,this.tileWidth=null!==v&&void 0!==v?v:0,(r=null!==r&&void 0!==r?r:i)&&(this.src=new URL(r,location)),this.map=n,this.animations={},this.ready=this.getReady({src:r,columns:s,image:a,imageheight:l,imagewidth:u,margin:h,name:c,spacing:f,tilecount:d,tileheight:p,tilewidth:v,tiles:m})},(t=[{key:"getReady",value:async function(e){let t=e.src,i=e.columns,r=e.image,n=e.imageheight,s=e.imagewidth,a=e.margin,l=e.name,u=e.spacing,h=e.tilecount,c=e.tileheight,f=e.tilewidth,d=e.tiles;if(t){o.has(t)||(console.log(t),o.set(t,fetch(t)));var p=await(await o.get(t)).clone().json();if(i=p.columns,r=p.image,n=p.imageheight,s=p.imagewidth,a=p.margin,l=p.name,u=p.spacing,h=p.tilecount,c=p.tileheight,f=p.tilewidth,d=p.tiles)for(const e of d)e.id+=this.firstGid}this.columns=null!==i&&void 0!==i?i:1,this.margin=null!==a&&void 0!==a?a:0,this.name=null!==l&&void 0!==l?l:r,this.spacing=null!==u&&void 0!==u?u:0,this.tiles=null!==d&&void 0!==d?d:[],this.tileCount=null!==h&&void 0!==h?h:1;let v=null;if(v=this.src?new URL(r,this.src):this.map?new URL(r,this.map.src):new URL(r,location),!o.has(v.href)){const e=new Image;e.src=v,o.set(v.href,new Promise(t=>e.onload=(()=>t(e))))}this.image=await o.get(v.href),this.imageWidth=null!==s&&void 0!==s?s:this.image.width,this.imageHeight=null!==n&&void 0!==n?n:this.image.height,this.tileWidth=null!==f&&void 0!==f?f:this.imageWidth,this.tileHeight=null!==c&&void 0!==c?c:this.imageHeight,this.rows=Math.ceil(n/c)||1;for(const e of this.tiles)e.animation&&(this.animations[e.id]=e.animation)}}])&&r(e.prototype,t),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}()}),require.register("sprite/texture.frag",function(e,t,i){i.exports="// texture.frag\n#define M_PI 3.1415926535897932384626433832795\n#define M_TAU M_PI / 2.0\nprecision mediump float;\n\nvarying vec2 v_texCoord;\nvarying vec2 v_position;\n\nuniform sampler2D u_image;\nuniform sampler2D u_effect;\nuniform sampler2D u_tiles;\nuniform sampler2D u_tileMapping;\n\nuniform vec2 u_size;\nuniform vec2 u_tileSize;\nuniform vec2 u_resolution;\nuniform vec2 u_mapTextureSize;\n\nuniform vec4 u_color;\nuniform vec4 u_region;\nuniform vec2 u_parallax;\nuniform vec2 u_scroll;\n\nuniform float u_time;\nuniform int u_renderTiles;\nuniform int u_renderParallax;\nuniform int u_renderMode;\n\nfloat masked = 0.0;\nfloat sorted = 1.0;\nfloat displace = 1.0;\nfloat blur = 1.0;\n\nvec2 rippleX(vec2 texCoord, float a, float b, float c) {\n  vec2 rippled = vec2(\n    v_texCoord.x + sin(v_texCoord.y * (a * u_size.y) + b) * c / u_size.x,\n    v_texCoord.y\n  );\n\n  if (rippled.x < 0.0) {\n    rippled.x = abs(rippled.x);\n  }\n  else if (rippled.x > u_size.x) {\n    rippled.x = u_size.x - (rippled.x - u_size.x);\n  }\n\n  return rippled;\n}\n\nvec2 rippleY(vec2 texCoord, float a, float b, float c) {\n  vec2 rippled = vec2(v_texCoord.x, v_texCoord.y + sin(v_texCoord.x * (a * u_size.x) + b) * c / u_size.y);\n\n  if (rippled.y < 0.0) {\n    rippled.x = abs(rippled.x);\n  }\n  else if (rippled.y > u_size.y) {\n    rippled.y = u_size.y - (rippled.y - u_size.y);\n  }\n\n  return rippled;\n}\n\nvec4 motionBlur(sampler2D image, float angle, float magnitude, vec2 textCoord) {\n  vec4 originalColor = texture2D(image, textCoord);\n  vec4 dispColor = originalColor;\n\n  const float max = 10.0;\n  float weight = 0.85;\n\n  for (float i = 0.0; i < max; i += 1.0) {\n    if(i > abs(magnitude) || originalColor.a < 1.0) {\n      break;\n    }\n    vec4 dispColorDown = texture2D(image, textCoord + vec2(\n      cos(angle) * i * sign(magnitude) / u_size.x,\n      sin(angle) * i * sign(magnitude) / u_size.y\n    ));\n    dispColor = dispColor * (1.0 - weight) + dispColorDown * weight;\n    weight *= 0.8;\n  }\n\n  return dispColor;\n}\n\nvec4 linearBlur(sampler2D image, float angle, float magnitude, vec2 textCoord) {\n  vec4 originalColor = texture2D(image, textCoord);\n  vec4 dispColor = texture2D(image, textCoord);\n\n  const float max = 10.0;\n  float weight = 0.65;\n\n  for (float i = 0.0; i < max; i += 0.25) {\n    if(i > abs(magnitude)) {\n      break;\n    }\n    vec4 dispColorUp = texture2D(image, textCoord + vec2(\n      cos(angle) * -i * sign(magnitude) / u_size.x,\n      sin(angle) * -i * sign(magnitude) / u_size.y\n    ));\n    vec4 dispColorDown = texture2D(image, textCoord + vec2(\n      cos(angle) * i * sign(magnitude) / u_size.x,\n      sin(angle) * i * sign(magnitude) / u_size.y\n    ));\n    dispColor = dispColor * (1.0 - weight) + dispColorDown * weight * 0.5 + dispColorUp * weight * 0.5;\n    weight *= 0.70;\n  }\n\n  return dispColor;\n}\n\nvoid main() {\n  vec4 originalColor = texture2D(u_image, v_texCoord);\n  vec4 effectColor = texture2D(u_effect,  v_texCoord);\n\n  // This only applies when drawing the parallax background\n  if (u_renderParallax == 1) {\n    float texelSize = 1.0 / u_size.x;\n    vec2 parallaxCoord = v_texCoord * vec2(1.0, -1.0) + vec2(0.0, 1.0)\n      + vec2(u_scroll.x * texelSize * u_parallax.x, 0.0);\n      // + vec2(u_time / 10000.0, 0.0);\n      // + vec2(, 0.0);\n      ;\n\n    gl_FragColor = texture2D(u_image,  parallaxCoord);\n    return;\n  }\n\n  // This only applies when drawing tiles.\n  if (u_renderTiles == 1) {\n    float xTiles = floor(u_size.x / u_tileSize.x);\n    float yTiles = floor(u_size.y / u_tileSize.y);\n\n    float xT = (v_texCoord.x * u_size.x) / u_tileSize.x;\n    float yT = (v_texCoord.y * u_size.y) / u_tileSize.y;\n\n    float inv_xTiles = 1.0 / xTiles;\n    float inv_yTiles = 1.0 / yTiles;\n\n    float xTile = floor(xT) * inv_xTiles;\n    float yTile = floor(yT) * inv_yTiles;\n\n    float xOff = (xT * inv_xTiles - xTile) * xTiles;\n    float yOff = (yT * inv_yTiles - yTile) * yTiles * -1.0 + 1.0;\n\n    float xWrap = u_mapTextureSize.x / u_tileSize.x;\n    float yWrap = u_mapTextureSize.y / u_tileSize.y;\n\n    // Mode 1 draws tiles' x/y values as red & green\n    if (u_renderMode == 1) {\n      gl_FragColor = vec4(xTile, yTile, 0, 1.0);\n      return;\n    }\n\n    // Mode 2 is the same as mode 1 but adds combines\n    // internal tile x/y to the blue channel\n    if (u_renderMode == 2) {\n      gl_FragColor = vec4(xTile, yTile, (xOff + yOff) * 0.5, 1.0);\n      return;\n    }\n\n    vec4 tile = texture2D(u_tileMapping, v_texCoord * vec2(1.0, -1.0) + vec2(0.0, 1.0));\n\n    int lo = int(tile.r * 256.0);\n    int hi = int(tile.g * 256.0);\n    int vh = int(tile.b * 256.0);\n    int vv = int(tile.a * 256.0);\n\n    int tileNumber = hi * 256 + lo;\n\n    if (tileNumber == 0) {\n      gl_FragColor.a = 0.0;\n      return;\n    }\n\n    // Mode 3 uses the tile number for the red/green channels\n    if (u_renderMode == 3) {\n      gl_FragColor = tile;\n      gl_FragColor.b = 0.5;\n      gl_FragColor.a = 1.0;\n      return;\n    }\n\n    // Mode 4 normalizes the tile number to all channels\n    if (u_renderMode == 4) {\n      gl_FragColor = vec4(\n        mod(float(tileNumber), 256.0) / 256.0\n        , mod(float(tileNumber), 256.0) / 256.0\n        , mod(float(tileNumber), 256.0) / 256.0\n        , 1.0\n      );\n      return;\n    }\n\n    float tileSetX = floor(mod((-1.0 + float(tileNumber)), xWrap));\n    float tileSetY = floor((-1.0 + float(tileNumber)) / xWrap);\n\n    if (vv == 254) { // Flipped Horizontally\n      xOff = 1.0 - xOff;\n    }\n\n    if (vv == 253) { // Flipped Vertically\n      yOff = 1.0 - yOff;\n    }\n\n    if (vv == 252) { // Flipped Both\n      xOff = 1.0 - xOff;\n      yOff = 1.0 - yOff;\n    }\n\n    if (vv == 245) {\n      xOff = xOff;\n      yOff = 1.0 - yOff;\n    }\n\n    if (vv == 244) {\n      xOff = 1.0 - xOff;\n      yOff = 1.0 - yOff;\n    }\n\n    if (vv == 243) { // Rotated left, flipped vertically\n      float tmp = xOff;\n      xOff = yOff;\n      yOff = tmp;\n    }\n\n    if (vv == 242) {\n      float tmp = xOff;\n      xOff = yOff;\n      yOff = 1.0 - tmp;\n    }\n\n    if (vv == 241) {\n      float tmp = xOff;\n      xOff = 1.0 - yOff;\n      yOff = tmp;\n    }\n\n    if (vv == 240) {\n      float tmp = xOff;\n      xOff = 1.0 - yOff;\n      yOff = 1.0 - tmp;\n    }\n\n    vec4 tileColor = texture2D(u_tiles, vec2(\n      xOff / xWrap + tileSetX * (u_tileSize.x / u_mapTextureSize.x)\n      , yOff / yWrap + tileSetY * (u_tileSize.y / u_mapTextureSize.y)\n    ));\n\n    if(u_region == vec4(1.0, 1.0, 1.0, 1.0)) {\n      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n      return;\n    }\n    else if(u_region == vec4(1.0, 1.0, 1.0, 0.0)) {\n      gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n      return;\n    }\n\n    gl_FragColor = tileColor;\n\n    return;\n  }\n\n  // This if/else block only applies\n  // when we're drawing the effectBuffer\n  if (u_region.r > 0.0 || u_region.g > 0.0 || u_region.b > 0.0) { // We have an effect color\n    if (masked < 1.0 || originalColor.a > 0.0) { // Use the provided color\n      gl_FragColor = u_region;\n    }\n    return;\n  }\n  else if (u_region.a > 0.0) {\n    if (sorted > 0.0) {\n      gl_FragColor = vec4(0.0, 0.0, 0.0, originalColor.a > 0.0 ? 1.0 : 0.0);\n    }\n    else {\n      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n    }\n    return;\n  };\n\n  // Mode 5 draws the effect buffer to the screen\n  if (u_renderMode == 5) {\n    gl_FragColor = effectColor;\n    return;\n  }\n\n  vec3 ripple = vec3(M_PI/8.0, u_time / 200.0, 1.0);\n\n  // This if/else block only applies\n  // when we're drawing the drawBuffer\n  if (effectColor == vec4(0, 1, 1, 1)) { // Water effect\n    vec2 texCoord = v_texCoord;\n    vec4 v_blurredColor = originalColor;\n    if (displace > 0.0) {\n      texCoord = rippleX(v_texCoord, ripple.x * 0.1, ripple.y, ripple.z * 2.0);\n      v_blurredColor = texture2D(u_image, texCoord);\n    }\n    if (blur > 0.0) {\n      v_blurredColor = linearBlur(u_image, 0.0, 1.0, texCoord);\n    }\n    gl_FragColor = v_blurredColor * 0.65 + effectColor * 0.35;\n  }\n  else if (effectColor == vec4(1, 0, 0, 1)) { // Fire effect\n    vec2 v_displacement = rippleY(v_texCoord, ripple.x * 3.0, ripple.y * 1.5, ripple.z * 0.333);\n    vec4 v_blurredColor = originalColor;\n    if (displace > 0.0) {\n      v_blurredColor = texture2D(u_image, v_displacement);\n    }\n    if (blur > 0.0) {\n      v_blurredColor = motionBlur(u_image, -M_TAU, 1.0, v_displacement);\n    }\n    gl_FragColor = v_blurredColor * 0.75 + effectColor * 0.25;\n  }\n  else { // Null effect\n    gl_FragColor = originalColor;\n  }\n}\n"}),require.register("sprite/texture.vert",function(e,t,i){i.exports="// texture.vert\nprecision mediump float;\n\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\n\nuniform vec2 u_resolution;\n\nvarying vec2 v_texCoord;\nvarying vec2 v_position;\n\nvoid main()\n{\n  vec2 zeroToOne = a_position / u_resolution;\n  vec2 zeroToTwo = zeroToOne * 2.0;\n  vec2 clipSpace = zeroToTwo - 1.0;\n\n  gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n  v_texCoord  = a_texCoord;\n  v_position  = a_position;\n}\n"}),require.register("ui/OnScreenJoyPad.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.OnScreenJoyPad=void 0;var r=t("curvature/base/View");function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,o(r.key),r)}}function o(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function s(e,t,i){return t=a(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,i||[],a(e).constructor):t.apply(e,i))}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}e.OnScreenJoyPad=function(e){function i(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(r=s(this,i,[e])).template=t("./onScreenJoyPad.tmp"),r.dragStart=!1,r.args.dragging=!1,r.args.x=0,r.args.y=0,r.buttons=[],window.addEventListener("mousemove",e=>{r.moveStick(e)}),window.addEventListener("mouseup",e=>{r.dropStick(e)}),window.addEventListener("touchmove",e=>{r.moveStick(e)}),window.addEventListener("touchend",e=>{r.dropStick(e)}),r.draggingTouches=new Set,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t)}(i,r.View),o=i,(a=[{key:"dragStick",value:function(e){if(e.changedTouches){new Set(e.changedTouches).forEach(e=>this.draggingTouches.add(e.identifier))}let t=e;e.preventDefault(),e.touches&&e.touches[0]&&(t=e.touches[0]),this.args.dragging=!0,this.dragStart={x:t.clientX,y:t.clientY}}},{key:"moveStick",value:function(e){if(this.args.dragging){let t=e;e.touches&&e.touches[0]&&(t=e.touches[0]),this.args.xx=t.clientX-this.dragStart.x,this.args.yy=t.clientY-this.dragStart.y,this.limit=.5*this.tags.joystick.offsetWidth,this.args.xx<-this.limit?this.args.x=-this.limit:this.args.xx>this.limit?this.args.x=this.limit:this.args.x=this.args.xx,this.args.yy<-this.limit?this.args.y=-this.limit:this.args.yy>this.limit?this.args.y=this.limit:this.args.y=this.args.yy}}},{key:"dropStick",value:function(e){if(e.changedTouches){let t=!1;for(const i of e.changedTouches)if(this.draggingTouches.has(i.identifier)){t=!0;break}if(!t)return}this.args.dragging=!1,this.args.x=0,this.args.y=0}},{key:"releaseButton",value:function(e,t){this.buttons[t]=-1}},{key:"pressButton",value:function(e,t){this.buttons[t]=this.buttons[t]||0,this.buttons[t]++}},{key:"contextmenu",value:function(e){console.log(e),e.preventDefault()}}])&&n(o.prototype,a),u&&n(o,u),Object.defineProperty(o,"prototype",{writable:!1}),o;var o,a,u}()}),require.register("ui/onScreenJoyPad.tmp.html",function(e,t,i){i.exports='<div class = "controller" cv-on = "contextmenu::c;">\n\t<div\n\t\tclass = "joystick"\n\t\tcv-ref = "joystick"\n\t\tcv-on = "\n\t\ttouchstart:dragStick(event);\n\t\tmousedown:dragStick(event);\n\t">\n\t\t<div class = "pad" style = "position: relative; transform:translate([[x]]px,[[y]]px);"></div>\n\t</div>\n\n\t<div class = "buttons">\n\t\t<div class = "button" cv-on = "\n\t\t\tmousedown:pressButton(event, 0);\n\t\t\ttouchstart:pressButton(event, 0);\n\t\t\tmouseup:releaseButton(event, 0);\n\t\t\ttouchend:releaseButton(event, 0);\n\t\t\tmouseleave:releaseButton(event, 0);\n\t\t\t">A</div>\n\n\t\t<div class = "button" cv-on = "\n\t\t\tmousedown:pressButton(event, 1);\n\t\t\ttouchstart:pressButton(event, 1);\n\t\t\tmouseup:releaseButton(event, 1);\n\t\t\ttouchend:releaseButton(event, 1);\n\t\t\tmouseleave:releaseButton(event, 1);">B</div>\n\n\t\t\x3c!-- <div class = "button" cv-on = "\n\t\t\tmousedown:pressButton(event, 2);\n\t\t\ttouchstart:pressButton(event, 2);\n\t\t\tmouseup:releaseButton(event, 0);\n\t\t\ttouchend:releaseButton(event, 0);\n\t\t\tmouseleave:releaseButton(event, 2);">C</div> --\x3e\n\t</div>\n</div>\n'}),require.register("world/Pallet.js",function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,n(r.key),r)}}function n(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Pallet=void 0;e.Pallet=function(){return e=function e(){var t,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t=this,r={},(i=n(i="objectPallet"))in t?Object.defineProperty(t,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[i]=r},(t=[{key:"resolve",value:async function(e){if("@"===e[0]){if(this.objectPallet[e])return this.objectPallet[e]}else if("http://"===e||"https://"===e)return(await import(e)).default}},{key:"register",value:function(e,t){this.objectPallet[e]&&console.warn("Overwriting spawnclass!"),this.objectPallet[e]=t}}])&&r(e.prototype,t),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}()}),require.register("world/Properties.js",function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,n(r.key),r)}}function n(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Properties=void 0;e.Properties=function(){return e=function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.properties={},this.owner=i,this.add(...t)},(t=[{key:"get",value:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.properties[e])return this.properties[e][t]}},{key:"has",value:function(e){return!!this.properties[e]}},{key:"add",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];for(const e of t)switch(this.properties[e.name]||(this.properties[e.name]=[]),e.type){case"color":this.properties[e.name].push(new Uint8ClampedArray([parseInt(e.value.substr(3,2),16),parseInt(e.value.substr(5,2),16),parseInt(e.value.substr(7,2),16),parseInt(e.value.substr(1,2),16)]));break;case"file":this.properties[e.name].push([new URL(e.value,this.owner.src)]);break;default:this.properties[e.name].push(e.value)}}},{key:"getAll",value:function(e){return[...this.properties[e]]}}])&&r(e.prototype,t),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}()}),require.register("world/TileMap.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TileMap=void 0;var r=t("curvature/base/Bindable"),n=t("../sprite/Tileset"),o=t("../math/QuickTree"),s=t("../model/Spawner"),a=t("../math/SMTree"),l=t("../sprite/Region"),u=t("../math/Rectangle"),h=t("./Properties");function c(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)}return i}function f(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?c(Object(i),!0).forEach(function(t){d(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):c(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function d(e,t,i){return(t=y(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,y(r.key),r)}}function m(e,t,i){return t&&v(e.prototype,t),i&&v(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function y(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}const g=new Map;let b=function(){return m(function e(t){let i=t.frames,r=t.x,n=t.y;p(this,e),this.x=r,this.y=n,this.acc=0,this.current=0,this.frames=i},[{key:"animate",value:function(e){for(this.acc+=e;this.acc>this.frames[this.current].duration;)this.acc-=this.frames[this.current].duration,this.current++,this.current>-1+this.frames.length&&(this.current=0);return 1+this.frames[this.current].tileid}}])}();e.TileMap=function(){return m(function e(t){var i;p(this,e);const n=t.fileName,s=t.session,l=t.x,c=t.y,f=t.width,d=t.height;this[r.Bindable.Prevent]=!0,this.src=n,this.backgroundColor=null,this.tileCount=0,this.x=l,this.y=c,this.loaded=!1,this.worldWidth=f,this.worldHeight=d,this.rect=new u.Rectangle(this.x,this.y,this.x+this.worldWidth,this.y+this.worldHeight),this.tileWidth=0,this.tileHeight=0,this.tileSetWidth=0,this.tileSetHeight=0,this.props=new h.Properties(null!==(i=t.properties)&&void 0!==i?i:[],this),this.pixels=null,this.values=null,this.image=document.createElement("img"),this.session=s,this.entityDefs={},this.emptyTiles=new Set,this.tilesIndexes=new Map,this.canvases=new Map,this.contexts=new Map,this.tiles=null,this.xOrigin=l,this.yOrigin=c,this.tileLayers=[],this.imageLayers=[],this.objectLayers=[],this.visible=!1,this.age=0,this.quadTree=new o.QuickTree(-64,-64,this.worldWidth+64,this.worldHeight+64),this.regionTree=new a.SMTree,this.animationTrees=new Map,this.entityMap=new Map,this.animatedTiles=new Map,this.animations=new Map},[{key:"initialize",value:function(){return this.ready?this.ready:this.ready=this.getReady(this.src)}},{key:"selectEntities",value:function(e,t,i,r){return this.quadTree.select(e-this.x,t-this.y,i-this.x,r-this.y,-this.x,-this.y)}},{key:"addEntity",value:function(e){return this.quadTree.add(e,-this.x,-this.y)}},{key:"moveEntity",value:function(e){return this.quadTree.move(e,-this.x,-this.y)}},{key:"getReady",value:async function(e){var t;g.has(e)||g.set(e,fetch(e));const i=await(await g.get(e)).clone().json();this.props.add(...null!==(t=i.properties)&&void 0!==t?t:[]),i.layers.forEach(e=>{var t;e.props=new h.Properties(null!==(t=e.properties)&&void 0!==t?t:[],this)}),this.collisionLayers=i.layers.filter(e=>"tilelayer"===e.type&&"collision"===e.class),this.tileLayers=i.layers.filter(e=>"tilelayer"===e.type&&"collision"!==e.class),this.imageLayers=i.layers.filter(e=>"imagelayer"===e.type),this.objectLayers=i.layers.filter(e=>"objectgroup"===e.type),this.backgroundColor=i.backgroundcolor,this.props.has("backgroundColor")&&(this.backgroundColor=this.props.get("backgroundColor"));const r=i.tilesets.map(t=>(t.source?t.source=new URL(t.source,e).href:t.map=this,new n.Tileset(t)));return this.width=i.width,this.height=i.height,this.tileWidth=i.tilewidth,this.tileHeight=i.tileheight,await Promise.all(r.map(e=>e.ready)),this.assemble(r),await this.spawn(),this.loaded=!0,i.class&&(this.controller=new(await this.session.mapPallet.resolve(i.class)),this.controller.create(this)),this}},{key:"assemble",value:function(e){e.sort((e,t)=>e.firstGid-t.firstGid);const t=this.tileCount=e.reduce((e,t)=>e+t.tileCount,0),i=Math.ceil(Math.sqrt(t)),r=document.createElement("canvas");this.tileSetWidth=r.width=i*this.tileWidth,this.tileSetHeight=r.height=Math.ceil(t/i)*this.tileHeight;const n=r.getContext("2d",{willReadFrequently:!0});for(const t of e){const e=t.image,i=document.createElement("canvas");i.width=e.width,i.height=e.height;const o=i.getContext("2d",{willReadFrequently:!0});o.drawImage(e,0,0);for(let e=0;e<t.tileCount;e++){const i=e+-1+t.firstGid,s=e*this.tileWidth%t.imageWidth,a=Math.floor(e*this.tileWidth/t.imageWidth)*this.tileHeight,l=i*this.tileWidth%r.width,u=Math.floor(i*this.tileWidth/r.width)*this.tileHeight,h=o.getImageData(s,a,this.tileWidth,this.tileHeight);n.putImageData(h,l,u);const c=new Uint32Array(h.data.buffer);let f=!0;for(const e of c)e>0&&(f=!1);f&&this.emptyTiles.add(i)}for(const e of t.tiles)e.animation&&this.animatedTiles.set(e.id,e.animation)}this.pixels=n.getImageData(0,0,r.width,r.height).data,this.values=new Uint32Array(this.pixels.buffer),this.tiles=n;for(const e of[...this.tileLayers,...this.collisionLayers]){const t=document.createElement("canvas"),i=t.getContext("2d",{willReadFrequently:!0});this.canvases.set(e,t),this.contexts.set(e,i);const r=new Uint32Array(e.data.map(Number)),n=new Uint8ClampedArray(r.buffer);for(const t in r){const i=r[t],s=268435455&i,a=n[4*t+3];if(this.animatedTiles.has(s)&&!this.animatedTiles.has(i)){const e=this.animatedTiles.get(s).map(e=>f({},e));this.animatedTiles.set(i,e),console.log(e),128&a&&e.forEach(e=>{e.tileid&=16777215,e.tileid|=254<<24}),64&a&&e.forEach(e=>{e.tileid&=16777215,e.tileid|=253<<24}),536870912&a&&e.forEach(e=>{e.tileid&=16777215,e.tileid|=251<<24}),1610612736&a&&e.forEach(e=>{e.tileid&=16777215,e.tileid|=247<<24})}if(this.animatedTiles.has(i)){this.animationTrees.has(e)||this.animationTrees.set(e,new o.QuickTree(0,0,this.width,this.height,.1));const r=this.animationTrees.get(e),n=this.animatedTiles.get(i),s=t%this.width,a=Math.floor(t/this.width),l=new b({frames:n,x:s,y:a});r.add(l)}}for(let e=3;e<n.length;e+=4){const t=n[e];n[e]=255,128&t&&(n[e]&=254),64&t&&(n[e]&=253),32&t&&(n[e]&=251),96&t&&(n[e]&=247),t&&console.log(n[e],t)}this.tilesIndexes.set(e,r),t.width=this.width,t.height=this.height,i.putImageData(new ImageData(n,this.width,this.height),0,0)}}},{key:"spawn",value:async function(){for(const e of this.objectLayers){const t=e.objects;for(const e of t){if(this.entityDefs[e.id]=f({},e),e.x+=this.xOrigin,e.y+=this.yOrigin,!e.type||"#player-start"===e.name)continue;if("#region"===e.name){const t=new l.Region(f({spriteBoard:this.session.spriteBoard,session:this.session},e));this.session.world.motionGraph.add(t,this),this.session.spriteBoard.regions.add(t),this.regionTree.add(t.rect);continue}const t=await this.session.entityPallet.resolve(e.type);if(!t){console.warn(`SpawnClass not found: ${e.type}`);continue}const i=new s.Spawner(f(f({spawnType:e.type,spawnClass:t,entityDef:e},e),{},{spriteBoard:this.session.spriteBoard,session:this.session,world:this.session.world,map:this}));this.session.world.motionGraph.add(i,this),i.lastMap=this,this.session.addEntity(i),this.addEntity(i)}}}},{key:"simulate",value:function(e){if(!this.loaded)return;const t=this.x,i=this.y,r=this.session.world;this.age+=e,this.controller&&this.controller.simulate(this,e),r.motionGraph.moveChildren(this,this.x-t,this.y-i),this.rect.x1=this.x,this.rect.y1=this.y,this.rect.x2=this.x+this.width*this.tileWidth,this.rect.y2=this.y+this.height*this.tileHeight,t===this.x&&i===this.y||r.mapTree.move(r.mapRects.get(this))}},{key:"getCollisionTile",value:function(e,t,i){return!this.loaded||!(!this.collisionLayers||!this.collisionLayers[i])&&this.getTileFromLayer(this.collisionLayers[i],e,t)}},{key:"getColor",value:function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.getPixel(this.tileLayers[i],e,t,i)}},{key:"getSolid",value:function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this.loaded)return!0;if(!this.collisionLayers||!this.collisionLayers[i])return!1;return this.getPixel(this.collisionLayers[i],e,t,i)}},{key:"getPixel",value:function(e,t,i){if(!this.loaded)return!1;const r=this.getTileFromLayer(e,t,i);if(!1===r||-1===r)return!1;const n=Math.trunc((-this.x+t)%this.tileWidth),o=Math.trunc((-this.y+i)%this.tileHeight),s=r*this.tileWidth%this.tileSetWidth,a=Math.floor(r*this.tileWidth/this.tileSetWidth)*this.tileHeight;return this.values[s+n+(a+o)*this.tileSetWidth]}},{key:"getTileFromLayer",value:function(e,t,i){if(!this.loaded)return!1;const r=-this.x+t,n=-this.y+i;if(r<0||r>=this.width*this.tileWidth||n<0||n>=this.height*this.tileWidth)return!1;const o=Math.floor(r/this.tileWidth),s=Math.floor(n/this.tileHeight);return-1+e.data[o+s*this.width]}},{key:"getSlice",value:function(e,t,i,r,n){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return this.loaded?this.tileLayers.filter(t=>{var i;return e===(null!==(i=t.props.get("priority"))&&void 0!==i?i:"background")}).map(e=>{const s=this.contexts.get(e).getImageData(t,i,r,n).data,a=this.animationTrees.get(e);if(a){const e=new Uint32Array(s.buffer),l=a.select(t,i,t+r,i+n);for(const n of l){const s=n.x-t,a=n.y-i;if(s<r){e[s+a*r]=n.animate(o)}}}return s}):[]}},{key:"getTileImage",value:function(e){const t=(e=-1+e)*this.tileWidth%this.tileSetWidth,i=Math.floor(e*this.tileWidth/this.tileSetWidth)*this.tileHeight,r=this.tiles.getImageData(t,i,this.tileWidth,this.tileHeight),n=document.createElement("canvas"),o=n.getContext("2d");return n.width=this.tileWidth,n.height=this.tileHeight,o.putImageData(r,0,0),n.toDataURL()}},{key:"getRegionsForPoint",value:function(e,t){const i=new Set;return this.loaded?(this.regionTree.query(e,t,e,t).forEach(r=>{r.contains(e,t)&&i.add(l.Region.fromRect(r))}),i):i}},{key:"getRegionsForRect",value:function(e,t,i,r){const n=new Set;if(!this.loaded)return n;const o=new u.Rectangle(e,t,i,r);return this.regionTree.query(e,t,i,r).forEach(e=>{o.isOverlapping(e)&&n.add(l.Region.fromRect(e))}),n}}])}()}),require.register("world/World.js",function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.World=void 0;var r=t("curvature/base/Bindable"),n=t("../math/MotionGraph"),o=t("./TileMap"),s=t("../math/SMTree"),a=t("../math/Ray");function l(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)}return i}function u(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?l(Object(i),!0).forEach(function(t){h(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function h(e,t,i){return(t=f(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function c(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,f(r.key),r)}}function f(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}const d=new Map;e.World=function(){return e=function e(t){let i=t.src,o=t.session;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this[r.Bindable.Prevent]=!0,this.src=new URL(i,location),this.ready=this.getReady(this.src),this.maps=[],this.motionGraph=new n.MotionGraph,this.rectMap=new Map,this.mapRects=new Map,this.mapTree=new s.SMTree,this.session=o,this.async=!1,this.age=0},(t=[{key:"simulate",value:function(e){this.age+=e}},{key:"getReady",value:async function(e){d.has(e)||d.set(e,fetch(e));const t=await(await d.get(e)).clone().json();return await Promise.all(t.maps.map((i,r)=>{i.fileName=new URL(i.fileName,e).href;const n=new o.TileMap(u(u({},i),{},{session:this.session}));return this.maps[r]=n,this.mapRects.set(n,n.rect),this.rectMap.set(n.rect,n),this.mapTree.add(n.rect),!t.async||n.props.has("player-start")?n.initialize():Promise.resolve()}))}},{key:"getMapsForPoint",value:function(e,t){const i=this.mapTree.query(e,t,e,t),r=new Set;for(const e of i){const t=this.rectMap.get(e);r.add(t)}return r}},{key:"getMapsForRect",value:function(e,t,i,r){const n=new Set,o=this.mapTree.query(e+.5*-i,t+.5*-r,e+.5*i,t+.5*r);for(const e of o)n.add(this.rectMap.get(e));return n}},{key:"getSolid",value:function(e,t,i){const r=this.getMapsForPoint(e,t);for(const n of r){const r=n.getSolid(e,t,i);if(r)return r}return null}},{key:"getCollisionTile",value:function(e,t,i){const r=this.getMapsForPoint(e,t);for(const n of r){const r=n.getCollisionTile(e,t,i);if(r>0)return r}return null}},{key:"getEntitiesForPoint",value:function(e,t){const i=this.getMapsForPoint(e,t);let r=new Set;for(const n of i){if(!n.visible)continue;const i=500,o=500,s=n.selectEntities(e+.5*-i,t+.5*-o,e+.5*i,t+.5*o);for(const i of s)i.rect.contains(e,t)&&r.add(i)}return r}},{key:"getEntitiesForRect",value:function(e,t,i,r){const n=this.getMapsForRect(e,t,i,r);let o=new Set;for(const s of n)s.visible&&(o=o.union(s.selectEntities(e+.5*-i,t+.5*-r,e+.5*i,t+.5*r)));return o}},{key:"getRegionsForPoint",value:function(e,t){const i=this.getMapsForPoint(e,t);let r=new Set;for(const n of i)n.visible&&(r=r.union(n.getRegionsForPoint(e,t)));return r}},{key:"getRegionsForRect",value:function(e,t,i,r){const n=this.getMapsForRect(e,t,i,r);let o=new Set;for(const s of n)s.visible&&(o=o.union(s.getRegionsForRect(e+.5*-i,t+.5*-r,e+.5*i,t+.5*r)));return o}},{key:"castRay",value:function(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:320,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:a.Ray.DEFAULT_FLAGS,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return a.Ray.cast(this,e,t,i,r,n,o)}},{key:"castTerrainRay",value:function(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:320,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:a.Ray.DEFAULT_FLAGS,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return a.Ray.castTerrain(this,e,t,i,r,n,o)}},{key:"castEntityRay",value:function(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:320,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:a.Ray.DEFAULT_FLAGS;return a.Ray.castEntity(this,e,t,i,r,endY,n)}}])&&c(e.prototype,t),i&&c(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}()}),require.alias("import-mapper/ImportMapper.js","import-mapper"),require.register("___globals___",function(e,t,i){})}(),require("___globals___");
