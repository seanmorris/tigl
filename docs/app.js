!function(){"use strict";var e="undefined"==typeof global?self:global;if("function"!=typeof e.require){var t={},r={},i={},n={}.hasOwnProperty,o=/^\.\.?(\/|$)/,s=function(e,t){for(var r,i=[],n=(o.test(t)?e+"/"+t:t).split("/"),s=0,a=n.length;s<a;s++)".."===(r=n[s])?i.pop():"."!==r&&""!==r&&i.push(r);return i.join("/")},a=function(e){return e.split("/").slice(0,-1).join("/")},l=function(t,i){var n,o={id:t,exports:{},hot:d&&d.createHot(t)};return r[t]=o,i(o.exports,(n=t,function(t){var r=s(a(n),t);return e.require(r,n)}),o),o.exports},u=function(e){var t=i[e];return t&&e!==t?u(t):e},c=function(e,i){null==i&&(i="/");var o=u(e);if(n.call(r,o))return r[o].exports;if(n.call(t,o))return l(o,t[o]);throw new Error("Cannot find module '"+e+"' from '"+i+"'")};c.alias=function(e,t){i[t]=e};var h=/\.[^.\/]+$/,f=/\/index(\.[^\/]+)?$/;c.register=c.define=function(e,o){if(e&&"object"==typeof e)for(var s in e)n.call(e,s)&&c.register(s,e[s]);else t[e]=o,delete r[e],function(e){if(h.test(e)){var t=e.replace(h,"");n.call(i,t)&&i[t].replace(h,"")!==t+"/index"||(i[t]=e)}if(f.test(e)){var r=e.replace(f,"");n.call(i,r)||(i[r]=e)}}(e)},c.list=function(){var e=[];for(var r in t)n.call(t,r)&&e.push(r);return e};var d=e._hmr&&new e._hmr(function(e,t){return u(s(a(e),t))},c,t,r);c._cache=r,c.hmr=d&&d.wrap,c.brunch=!0,e.require=c}}(),function(){"undefined"==typeof window||window;var e=function(e,t,r){var i={},n=function(t,r){try{return e(r+"/node_modules/"+t)}catch(e){if(-1===e.toString().indexOf("Cannot find module"))throw e;if(-1!==r.indexOf("node_modules")){var o=r.split("/"),s=o.lastIndexOf("node_modules"),a=o.slice(0,s).join("/");return n(t,a)}}return i};return function(o){if(o in t&&(o=t[o]),o){if("."!==o[0]&&r){var s=n(o,r);if(s!==i)return s}return e(o)}}};require.register("curvature/base/Bag.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Bag=void 0;var e=r("./Bindable"),i=r("./Mixin"),n=r("../mixin/EventTargetMixin"),o=e=>Number(e),s=Symbol("Mapped"),a=Symbol("Has"),l=Symbol("Add"),u=Symbol("Remove"),c=Symbol("Delete");class h extends(i.Mixin.with(n.EventTargetMixin)){constructor(t){super(),this.changeCallback=t,this.content=new Map,this.current=0,this.length=0,this.list=e.Bindable.makeBindable([]),this.meta=Symbol("meta"),this.type=void 0}has(e){return this[s]?this[s].has(e):this[a](e)}[a](e){return this.content.has(e)}add(e){return this[s]?this[s].add(e):this[l](e)}[l](t){if(void 0===t||!(t instanceof Object))throw new Error("Only objects may be added to Bags.");if(this.type&&!(t instanceof this.type))throw console.error(this.type,t),new Error(`Only objects of type ${this.type} may be added to this Bag.`);if(t=e.Bindable.make(t),!this.content.has(t)){var r=new CustomEvent("adding",{detail:{item:t}});if(this.dispatchEvent(r)){var i=o(this.current++);this.content.set(t,i),this.list[i]=t,this.changeCallback&&this.changeCallback(t,this.meta,h.ITEM_ADDED,i);var n=new CustomEvent("added",{detail:{item:t,id:i}});return this.dispatchEvent(n),this.length=this.size,i}}}remove(e){return this[s]?this[s].remove(e):this[u](e)}[u](t){if(void 0===t||!(t instanceof Object))throw new Error("Only objects may be removed from Bags.");if(this.type&&!(t instanceof this.type))throw console.error(this.type,t),new Error(`Only objects of type ${this.type} may be removed from this Bag.`);if(t=e.Bindable.make(t),!this.content.has(t))return this.changeCallback&&this.changeCallback(t,this.meta,0,void 0),!1;var r=new CustomEvent("removing",{detail:{item:t}});if(this.dispatchEvent(r)){var i=this.content.get(t);delete this.list[i],this.content.delete(t),this.changeCallback&&this.changeCallback(t,this.meta,h.ITEM_REMOVED,i);var n=new CustomEvent("removed",{detail:{item:t,id:i}});return this.dispatchEvent(n),this.length=this.size,t}}delete(e){if(this[s])return this[s].delete(e);this[c](e)}[c](e){this.remove(e)}map(e=(e=>e),t=(e=>e)){var r=new WeakMap,i=new h;return i[s]=this,this.addEventListener("added",n=>{var o=n.detail.item;if(t(o)&&!r.has(o)){var s=e(o);r.set(o,s),i[l](s)}}),this.addEventListener("removed",e=>{var t=e.detail.item;if(r.has(t)){var n=r.get(t);r.delete(t),i[u](n)}}),i}get size(){return this.content.size}items(){return Array.from(this.content.entries()).map(e=>e[0])}}t.Bag=h,Object.defineProperty(h,"ITEM_ADDED",{configurable:!1,enumerable:!1,writable:!0,value:1}),Object.defineProperty(h,"ITEM_REMOVED",{configurable:!1,enumerable:!1,writable:!0,value:-1})}()}),require.register("curvature/base/Bindable.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";function e(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Object.defineProperty(t,"__esModule",{value:!0}),t.Bindable=void 0;var r=Symbol("ref"),i=Symbol("original"),n=Symbol("deck"),o=Symbol("binding"),s=Symbol("subBinding"),a=Symbol("bindingAll"),l=Symbol("isBindable"),u=Symbol("wrapping"),c=Symbol("Names"),h=Symbol("executing"),f=Symbol("stack"),d=(Symbol("object"),Symbol("wrapped")),p=Symbol("unwrapped"),y=Symbol("getProto"),v=Symbol("onGet"),m=Symbol("onAllGet"),b=Symbol("bindChain"),g=Symbol("Descriptors"),w=Symbol("Before"),T=Symbol("After"),x=Symbol("NoGetters"),S=Symbol("Prevent"),_=Object.getPrototypeOf(Int8Array),E=Set.prototype[Symbol.iterator],P=Map.prototype[Symbol.iterator],j="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:void 0,O=e=>"function"==typeof j.Map&&e instanceof j.Map||"function"==typeof j.Set&&e instanceof j.Set||"function"==typeof j.Node&&e instanceof j.Node||"function"==typeof j.WeakMap&&e instanceof j.WeakMap||"function"==typeof j.Location&&e instanceof j.Location||"function"==typeof j.Storage&&e instanceof j.Storage||"function"==typeof j.WeakSet&&e instanceof j.WeakSet||"function"==typeof j.ArrayBuffer&&e instanceof j.ArrayBuffer||"function"==typeof j.Promise&&e instanceof j.Promise||"function"==typeof j.File&&e instanceof j.File||"function"==typeof j.Event&&e instanceof j.Event||"function"==typeof j.CustomEvent&&e instanceof j.CustomEvent||"function"==typeof j.Gamepad&&e instanceof j.Gamepad||"function"==typeof j.ResizeObserver&&e instanceof j.ResizeObserver||"function"==typeof j.MutationObserver&&e instanceof j.MutationObserver||"function"==typeof j.PerformanceObserver&&e instanceof j.PerformanceObserver||"function"==typeof j.IntersectionObserver&&e instanceof j.IntersectionObserver||"function"==typeof j.IDBCursor&&e instanceof j.IDBCursor||"function"==typeof j.IDBCursorWithValue&&e instanceof j.IDBCursorWithValue||"function"==typeof j.IDBDatabase&&e instanceof j.IDBDatabase||"function"==typeof j.IDBFactory&&e instanceof j.IDBFactory||"function"==typeof j.IDBIndex&&e instanceof j.IDBIndex||"function"==typeof j.IDBKeyRange&&e instanceof j.IDBKeyRange||"function"==typeof j.IDBObjectStore&&e instanceof j.IDBObjectStore||"function"==typeof j.IDBOpenDBRequest&&e instanceof j.IDBOpenDBRequest||"function"==typeof j.IDBRequest&&e instanceof j.IDBRequest||"function"==typeof j.IDBTransaction&&e instanceof j.IDBTransaction||"function"==typeof j.IDBVersionChangeEvent&&e instanceof j.IDBVersionChangeEvent||"function"==typeof j.FileSystemFileHandle&&e instanceof j.FileSystemFileHandle||"function"==typeof j.RTCPeerConnection&&e instanceof j.RTCPeerConnection||"function"==typeof j.ServiceWorkerRegistration&&e instanceof j.ServiceWorkerRegistration||"function"==typeof j.WebGLTexture&&e instanceof j.WebGLTexture;class C{static isBindable(e){return!!(e&&e[l]&&e[S])&&e[l]===C}static onDeck(e,t){return e[n].get(t)||!1}static ref(e){return e[r]||e||!1}static makeBindable(e){return this.make(e)}static shuck(e,t){t=t||new Map;var r=Object.create({});if(e instanceof _||e instanceof ArrayBuffer){var n=e.slice(0);return t.set(e,n),n}var o=Object.keys(e);for(var s in o){var a=o[s];if("___"!==a.substring(0,3)){var l=t.get(e[a]);if(l)r[a]=l;else if(e[a]!==e){if(e[a]&&"object"==typeof e[a]){var u=e[a];C.isBindable(e[a])&&(u=e[a][i]),r[a]=this.shuck(u,t)}else r[a]=e[a];t.set(e[a],r[a])}else t.set(e[a],r),r[a]=r}}return C.isBindable(e)&&(delete r.bindTo,delete r.isBound),r}static make(e){if(e[S])return e;if(!e||!["function","object"].includes(typeof e))return e;if(r in e)return e[r];if(e[l])return e;if(Object.isSealed(e)||Object.isFrozen(e)||!Object.isExtensible(e)||O(e))return e;Object.defineProperty(e,l,{configurable:!1,enumerable:!1,writable:!1,value:C}),Object.defineProperty(e,r,{configurable:!0,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(e,i,{configurable:!1,enumerable:!1,writable:!1,value:e}),Object.defineProperty(e,n,{configurable:!1,enumerable:!1,writable:!1,value:new Map}),Object.defineProperty(e,o,{configurable:!1,enumerable:!1,writable:!1,value:Object.create(null)}),Object.defineProperty(e,s,{configurable:!1,enumerable:!1,writable:!1,value:new Map}),Object.defineProperty(e,a,{configurable:!1,enumerable:!1,writable:!1,value:new Set}),Object.defineProperty(e,h,{enumerable:!1,writable:!0}),Object.defineProperty(e,u,{enumerable:!1,writable:!0}),Object.defineProperty(e,f,{configurable:!1,enumerable:!1,writable:!1,value:[]}),Object.defineProperty(e,w,{configurable:!1,enumerable:!1,writable:!1,value:new Set}),Object.defineProperty(e,T,{configurable:!1,enumerable:!1,writable:!1,value:new Set}),Object.defineProperty(e,d,{configurable:!1,enumerable:!1,writable:!1,value:Object.preventExtensions(new Map)}),Object.defineProperty(e,p,{configurable:!1,enumerable:!1,writable:!1,value:Object.preventExtensions(new Map)}),Object.defineProperty(e,g,{configurable:!1,enumerable:!1,writable:!1,value:Object.preventExtensions(new Map)});var t=(r,i=null,n={})=>{var l=!1;if(Array.isArray(r)){var u=r.map(e=>t(e,i,n));return()=>u.forEach(e=>e())}if(r instanceof Function&&(n=i||{},i=r,l=!0),n.delay>=0&&(i=this.wrapDelayCallback(i,n.delay)),n.throttle>=0&&(i=this.wrapThrottleCallback(i,n.throttle)),n.wait>=0&&(i=this.wrapWaitCallback(i,n.wait)),n.frame&&(i=this.wrapFrameCallback(i,n.frame)),n.idle&&(i=this.wrapIdleCallback(i)),l){if(e[a].add(i),!("now"in n)||n.now)for(var c in e)i(e[c],c,e,!1);return()=>{e[a].delete(i)}}if(e[o][r]||(e[o][r]=new Set),n.children){var h=i;i=((...t)=>{var r=t[0],i=e[s].get(h);if(i&&(e[s].delete(h),i()),"object"==typeof r){var o=C.make(r);C.isBindable(o)&&e[s].set(h,o.bindTo((...e)=>h(...t,...e),Object.assign({},n,{children:!1}))),h(...t)}else h(...t)})}e[o][r].add(i),"now"in n&&!n.now||i(e[r],r,e,!1);var f=()=>{var t=e[s].get(i);t&&(e[s].delete(i),t()),e[o][r]&&e[o][r].has(i)&&e[o][r].delete(i)};return n.removeWith&&n.removeWith instanceof View&&n.removeWith.onRemove(()=>f),f};Object.defineProperty(e,"bindTo",{configurable:!1,enumerable:!1,writable:!1,value:t});Object.defineProperty(e,b,{configurable:!1,enumerable:!1,writable:!1,value:(t,r)=>{var i=t.split("."),n=i.shift(),o=i.slice(0),s=[];return s.push(e.bindTo(n,(e,t,i,n)=>{var a=o.join(".");0!==o.length?(void 0===e&&(e=i[t]=this.make({})),s=s.concat(e[b](a,r))):r(e,t,i,n)})),()=>s.forEach(e=>e())}}),Object.defineProperty(e,"___before",{configurable:!1,enumerable:!1,writable:!1,value:t=>(e[w].add(t),()=>e[w].delete(t))}),Object.defineProperty(e,"___after",{configurable:!1,enumerable:!1,writable:!1,value:t=>(e[T].add(t),()=>e[T].delete(t))});for(var R in Object.defineProperty(e,"isBound",{configurable:!1,enumerable:!1,writable:!1,value:()=>{if(e[a].size)return!0;for(var t of Object.values(e[o]))if(t.size)return!0;return!1}}),e)e[R]&&"object"==typeof e[R]&&(e[R][r]||e[R]instanceof Promise||Object.isExtensible(e[R])&&!Object.isSealed(e[R])&&(O(e[R])||(e[R]=C.make(e[R]))));var k=e[g],M=e[d],B=e[f],A=Object.create(null);return A.set=((t,r,i)=>{if(i&&"object"==typeof i&&(i=C.make(i),t[r]===i))return!0;M.has(r)&&M.delete(r);var s=e[n],l=s.has(r),u=l&&s.get(r);if(l&&u===i)return!0;if(r.slice&&"___"===r.slice(-3))return!0;if(t[r]===i||"number"==typeof i&&isNaN(u)&&isNaN(i))return!0;for(var c of(s.set(r,i),e[a]))c(i,r,t,!1);if(r in e[o])for(var h of e[o][r])h(i,r,t,!1,t[r]);if(s.delete(r),j.File&&t instanceof j.File&&"lastModifiedDate"==r||Reflect.set(t,r,i),Array.isArray(t)&&e[o].length)for(var f in e[o].length)(0,e[o].length[f])(t.length,"length",t,!1,t.length);return!0}),A.construct=((t,r)=>{var n="constructor";for(var o of t[w])o(t,n,e[f],void 0,r);var s=C.make(new t[i](...r));for(var a of t[T])a(t,n,e[f],s,r);return s}),A.deleteProperty=((t,r)=>{var i=e[n];if(i.has(r))return!0;if(!(r in t))return!0;if(k.has(r)){var s=k.get(r);if(s&&!s.configurable)return!1;k.delete(r)}for(var l of(i.set(r,null),M.has(r)&&M.delete(r),e[a]))l(void 0,r,t,!0,t[r]);if(r in e[o])for(var u of e[o][r])u(void 0,r,t,!0,t[r]);return Reflect.deleteProperty(t,r),i.delete(r),!0}),e[x]||(A.getPrototypeOf=(t=>y in e?e[y]:Reflect.getPrototypeOf(t)),A.get=((t,n)=>{if(M.has(n))return M.get(n);if(n===r||n===i||"apply"===n||"isBound"===n||"bindTo"===n||"__proto__"===n||"constructor"===n)return e[n];var o;if(k.has(n)?o=k.get(n):(o=Object.getOwnPropertyDescriptor(e,n),k.set(n,o)),o&&!o.configurable&&!o.writable)return e[n];if(m in e)return e[m](n);if(v in e&&!(n in e))return e[v](n);if(o&&!o.configurable&&!o.writable)return M.set(n,e[n]),e[n];if("function"==typeof e[n]){if(c in e[n])return e[n];e[p].set(n,e[n]);var s=Object.getPrototypeOf(e)[n]===e[n],a=O(e)||"function"==typeof e[Symbol.iterator]&&"next"===n||"function"==typeof _&&e instanceof _||"function"==typeof EventTarget&&e instanceof EventTarget||"function"==typeof Date&&e instanceof Date||"function"==typeof P&&e.prototype===P||"function"==typeof E&&e.prototype===E?e:e[r],l=function(...t){for(var r of(e[h]=n,B.unshift(n),e[w]))r(e,n,B,e,t);var i;if(new.target)i=new(e[p].get(n))(...t);else{var o=e[p].get(n);i=s?o.apply(a||e,t):o(...t)}for(var l of e[T])l(e,n,B,e,t);return e[h]=null,B.shift(),i};l[m]=(t=>e[n][t]);var u=C.make(l);return M.set(n,u),u}return e[n]})),Object.defineProperty(e,r,{configurable:!1,enumerable:!1,writable:!1,value:new Proxy(e,A)}),e[r]}static clearBindings(e){var t=(e=>(...t)=>t.map(e))(e=>Object.keys(e).map(t=>delete e[t]));e[a].clear(),t(e[d],e[o],e[T],e[w])}static resolve(e,t,r=!1){for(var i,n=t.split("."),o=n[0];n.length;){if(r&&1===n.length)return[this.make(e),n.shift(),o];(i=n.shift())in e&&e[i]&&"object"==typeof e[i]||(e[i]=Object.create(null)),e=this.make(e[i])}return[this.make(e),i,o]}static wrapDelayCallback(e,t){return(...r)=>setTimeout(()=>e(...r),t)}static wrapThrottleCallback(e,t){return this.throttles.set(e,!1),(...r)=>{this.throttles.get(e,!0)||(e(...r),this.throttles.set(e,!0),setTimeout(()=>{this.throttles.set(e,!1)},t))}}static wrapWaitCallback(e,t){return(...r)=>{var i;(i=this.waiters.get(e))&&(this.waiters.delete(e),clearTimeout(i)),i=setTimeout(()=>e(...r),t),this.waiters.set(e,i)}}static wrapFrameCallback(e,t){return(...t)=>{requestAnimationFrame(()=>e(...t))}}static wrapIdleCallback(e){return(...t)=>{(window.requestIdleCallback||requestAnimationFrame)(()=>e(...t))}}}t.Bindable=C,e(C,"waiters",new WeakMap),e(C,"throttles",new WeakMap),Object.defineProperty(C,"Prevent",{configurable:!1,enumerable:!1,writable:!1,value:S}),Object.defineProperty(C,"OnGet",{configurable:!1,enumerable:!1,writable:!1,value:v}),Object.defineProperty(C,"NoGetters",{configurable:!1,enumerable:!1,writable:!1,value:x}),Object.defineProperty(C,"GetProto",{configurable:!1,enumerable:!1,writable:!1,value:y}),Object.defineProperty(C,"OnAllGet",{configurable:!1,enumerable:!1,writable:!1,value:m})}()}),require.register("curvature/base/Cache.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Cache=void 0;t.Cache=class{static store(e,t,r,i="standard"){var n=0;r&&(n=1e3*r+(new Date).getTime()),this.buckets||(this.buckets=new Map),this.buckets.has(i)||this.buckets.set(i,new Map);var o=new CustomEvent("cvCacheStore",{cancelable:!0,detail:{key:e,value:t,expiry:r,bucket:i}});document.dispatchEvent(o)&&this.buckets.get(i).set(e,{value:t,expiration:n})}static load(e,t=!1,r="standard"){var i=new CustomEvent("cvCacheLoad",{cancelable:!0,detail:{key:e,defaultvalue:t,bucket:r}});if(!document.dispatchEvent(i))return t;if(this.buckets&&this.buckets.has(r)&&this.buckets.get(r).has(e)){var n=this.buckets.get(r).get(e);if(0===n.expiration||n.expiration>(new Date).getTime())return this.buckets.get(r).get(e).value}return t}}}()}),require.register("curvature/base/Config.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Config=void 0;var e={},i=r,n="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:void 0;try{e=i("/Config").Config}catch(t){!0===n.devMode&&console.error(t),e={}}class o{static get(e){return this.configs[e]}static set(e,t){return this.configs[e]=t,this}static dump(){return this.configs}static init(...e){for(var t in e){var r=e[t];for(var i in"string"==typeof r&&(r=JSON.parse(r)),r){var n=r[i];return this.configs[i]=n}}return this}}t.Config=o,Object.defineProperty(o,"configs",{configurable:!1,enumerable:!1,writable:!1,value:e})}()}),require.register("curvature/base/Dom.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Dom=void 0;t.Dom=class{static mapTags(e,t,r,i,n){var o=[],s=!0;i&&(s=!1);var a=!1,{Node:l,Element:u,NodeFilter:c,document:h}=globalThis.window,f=h.createTreeWalker(e,c.SHOW_ELEMENT|c.SHOW_TEXT,{acceptNode:(e,r)=>{if(!s){if(e!==i)return c.FILTER_SKIP;s=!0}return n&&e===n&&(a=!0),a?c.FILTER_SKIP:t?e instanceof u&&e.matches(t)?c.FILTER_ACCEPT:c.FILTER_SKIP:c.FILTER_ACCEPT}},!1);for(0;f.nextNode();)o.push(r(f.currentNode,f));return o}static dispatchEvent(e,t){e.dispatchEvent(t),this.mapTags(e,!1,e=>{e.dispatchEvent(t)})}}}()}),require.register("curvature/base/Mixin.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Mixin=void 0;var e=r("./Bindable"),i=Symbol("constructor");Symbol("mixinList");class n{static from(e,...t){var r=class extends e{constructor(...i){var o=e.constructor?super(...i):null;for(var s of t)switch(s[n.Constructor]&&s[n.Constructor].apply(this),typeof s){case"function":n.mixClass(s,r);break;case"object":n.mixObject(s,this)}return o}};return r}static make(...e){var t=e.pop();return n.to(t,...e)}static to(e,...t){var r={};t.map(t=>{switch(typeof t){case"object":Object.assign(r,Object.getOwnPropertyDescriptors(t));break;case"function":Object.assign(r,Object.getOwnPropertyDescriptors(t.prototype))}delete r.constructor,Object.defineProperties(e.prototype,r)})}static with(...e){return this.from(class{constructor(){}},...e)}static mixObject(e,t){for(var r of Object.getOwnPropertyNames(e))"function"!=typeof e[r]?t[r]=e[r]:t[r]=e[r].bind(t);for(var i of Object.getOwnPropertySymbols(e))"function"!=typeof e[i]?t[i]=e[i]:t[i]=e[i].bind(t)}static mixClass(e,t){for(var r of Object.getOwnPropertyNames(e.prototype))if(!["name","prototype","length"].includes(r)){var i=Object.getOwnPropertyDescriptor(t,r);i&&!i.writable||("function"==typeof e[r]?t.prototype[r]=e.prototype[r].bind(t.prototype):t.prototype[r]=e.prototype[r])}for(var n of Object.getOwnPropertySymbols(e.prototype))"function"==typeof e[n]?t.prototype[n]=e.prototype[n].bind(t.prototype):t.prototype[n]=e.prototype[n];var o=function(){if(["name","prototype","length"].includes(s))return 0;var r=Object.getOwnPropertyDescriptor(t,s);if(r&&!r.writable)return 0;if("function"!=typeof e[s])return t[s]=e[s],0;var i=t[s]||!1,n=e[s].bind(t);t[s]=((...e)=>(i&&i(...e),n(...e)))};for(var s of Object.getOwnPropertyNames(e))o();var a=function(){if("function"!=typeof e[l])return t.prototype[l]=e[l],1;var r=t[l]||!1,i=e[l].bind(t);t[l]=((...e)=>(r&&r(...e),i(...e)))};for(var l of Object.getOwnPropertySymbols(e))a()}static mix(t){for(var r={},i={},n=e.Bindable.makeBindable(t),o=function(e){var t=Object.getOwnPropertyNames(e.prototype),o=Object.getOwnPropertyNames(e),s=/^(before|after)__(.+)/,a=function(t){var i=t.match(s);if(i){switch(i[1]){case"before":n.___before((r,n,o,s,a)=>{if(n===i[2])return e[t].bind(s)(...a)});break;case"after":n.___after((r,n,o,s,a)=>{if(n===i[2])return e[t].bind(s)(...a)})}return 0}return r[t]?0:"function"!=typeof e[t]?0:void(r[t]=e[t])};for(var l of o)a(l);var u=function(t){var r=t.match(s);if(r){switch(r[1]){case"before":n.___before((i,n,o,s,a)=>{if(n===r[2])return e.prototype[t].bind(s)(...a)});break;case"after":n.___after((i,n,o,s,a)=>{if(n===r[2])return e.prototype[t].bind(s)(...a)})}return 0}return i[t]?0:"function"!=typeof e.prototype[t]?0:void(i[t]=e.prototype[t])};for(var c of t)u(c)},s=this;s&&s.prototype;s=Object.getPrototypeOf(s))o(s);for(var a in r)t[a]=r[a].bind(t);var l=function(e){t.prototype[e]=function(...t){return i[e].apply(this,t)}};for(var u in i)l(u);return n}}t.Mixin=n,n.Constructor=i}()}),require.register("curvature/base/Router.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Router=void 0;var e,i=r("./View"),n=(r("./Cache"),r("./Config")),o=r("./Routes"),s=Symbol("NotFound"),a=Symbol("Internal"),l="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:void 0;l.CustomEvent=null!==(e=l.CustomEvent)&&void 0!==e?e:l.Event;class u{static wait(e,t="DOMContentLoaded",r=document){r.addEventListener(t,()=>{this.listen(e)})}static listen(e,t=!1){this.listener=e||this.listener,this.routes=t||e.routes,Object.assign(this.query,this.queryOver({}));var r=t=>{t.preventDefault(),t.state&&"routedId"in t.state?(t.state.routedId<=this.routeCount?(this.history.splice(t.state.routedId),this.routeCount=t.state.routedId):t.state.routedId>this.routeCount&&(this.history.push(t.state.prev),this.routeCount=t.state.routedId),this.state=t.state):null!==this.prevPath&&this.prevPath!==location.pathname&&this.history.push(this.prevPath),this.isOriginLimited(location)?this.match(this.nextPath,e):this.match(location.pathname,e)};window.addEventListener("cvUrlChanged",r),window.addEventListener("popstate",r);var i=!this.isOriginLimited(location)&&location.pathname+location.search;!this.isOriginLimited(location)&&location.hash&&(i+=location.hash);var n={routedId:this.routeCount,url:location.pathname,prev:this.prevPath};this.isOriginLimited(location)||history.replaceState(n,null,location.pathname),this.go(!1!==i?i:"/")}static go(e,t=!1){var r=n.Config.get("title");r&&(document.title=r);var i={routedId:this.routeCount,prev:this.prevPath,url:location.pathname};-1===t?this.match(e,this.listener,!0):this.isOriginLimited(location)?this.nextPath=e:2===t&&location.pathname!==e?history.replaceState(i,null,e):location.pathname!==e&&history.pushState(i,null,e),(!t||t<0)&&(!1===t&&(this.path=null),t||("#"===e.substring(0,1)?window.dispatchEvent(new HashChangeEvent("hashchange")):window.dispatchEvent(new CustomEvent("cvUrlChanged")))),this.prevPath=e}static processRoute(e,t,r){return"function"==typeof e[t]?e[t].prototype instanceof i.View?new e[t](r):e[t](r):e[t]}static handleError(e,t,r,i,n,o,s,u){"undefined"!=typeof document&&document.dispatchEvent(new CustomEvent("cvRouteError",{detail:{error:e,path:o,prev:s,view:n,routes:t,selected:r}}));var c=l.devMode?"Unexpected error: "+String(e):"Unexpected error.";t[a]&&(i[a]=e,c=this.processRoute(t,a,i)),this.update(n,o,c,t,r,i,u)}static match(e,t,r=!1){var i=null,n=!1;if(!0===r&&(n=r),r&&"object"==typeof r&&(n=r.forceRefresh,i=r.event),"undefined"==typeof document||this.path!==e||n){var a="http://example.com";"undefined"!=typeof document&&(a=this.isOriginLimited(location)?a:location.origin,this.queryString=location.search);var l=new URL(e,a);e=this.path=l.pathname,"undefined"==typeof document&&(this.queryString=l.search);var u=this.prevPath,c=t&&t.args?t.args.content:null,h=this.routes||t&&t.routes||o.Routes.dump(),f=new URLSearchParams(this.queryString);for(var d in i&&i.request&&(this.request=i.request),Object.keys(this.query))delete this.query[d];for(var[p,y]of f)this.query[p]=y;var v={},m=!1,b="";for(var g in"/"===e.substring(0,1)&&(e=e.substring(1)),e=e.split("/"),this.query)v[g]=this.query[g];e:for(var w in h){var T=w.split("/");if(!(T.length<e.length&&"*"!==T[T.length-1])){for(var x in T)if("%"==T[x].substr(0,1)){var S=null,_=/^%(\w+)\??/.exec(T[x]);if(_&&_[1]&&(S=_[1]),!S)throw new Error(`${T[x]} is not a valid argument segment in route "${w}"`);if(e[x])v[S]=e[x];else{if("?"!=T[x].substr(T[x].length-1,1))continue e;v[S]=""}}else if("*"!==T[x]&&e[x]!==T[x])continue e;m=w,b=h[w],"*"===T[T.length-1]&&(v.pathparts=e.slice(T.length-1));break}}var E=new CustomEvent("cvRouteStart",{cancelable:!0,detail:{path:e,prev:u,root:t,selected:m,routes:h}});if("undefined"==typeof document||document.dispatchEvent(E)){if(!n&&t&&c&&"object"==typeof b&&c.constructor===b.constructor&&!(b instanceof Promise)&&c.update(v))return t.args.content=c,!0;m in h||(h[m]=h[s]);try{return!1===(b=this.processRoute(h,m,v))&&(b=this.processRoute(h,s,v)),"undefined"==typeof document?b instanceof Promise?b:Promise.resolve(b):b instanceof Promise?b.then(r=>this.update(t,e,r,h,m,v,n)).catch(r=>{this.handleError(r,h,m,v,t,e,u,n)}):this.update(t,e,b,h,m,v,n)}catch(r){this.handleError(r,h,m,v,t,e,u,n)}}}}static update(e,t,r,n,o,s,a){if(e){var l=this.prevPath,u=new CustomEvent("cvRoute",{cancelable:!0,detail:{result:r,path:t,prev:l,view:e,routes:n,selected:o}});!1!==r&&(e.args.content instanceof i.View&&(e.args.content.pause(!0),e.args.content.remove()),document.dispatchEvent(u)&&(e.args.content=r),r instanceof i.View&&(r.pause(!1),r.update(s,a)));var c=new CustomEvent("cvRouteEnd",{cancelable:!0,detail:{result:r,path:t,prev:l,view:e,routes:n,selected:o}});document.dispatchEvent(c)}}static isOriginLimited({origin:e}){return"null"===e||"file://"===e}static queryOver(e={}){var t=new URLSearchParams(location.search),r={},i={};for(var n of t)i[n[0]]=n[1];return delete(r=Object.assign(r,i,e)).api,r}static queryToString(e={},t=!1){var r=[],i=e;for(var n in t||(i=this.queryOver(e)),i)""!==i[n]&&r.push(n+"="+encodeURIComponent(i[n]));return r.join("&")}static setQuery(e,t,r){var i=this.queryOver();i[e]=t,void 0===t&&delete i[e];var n=this.queryToString(i,!0);this.go(location.pathname+(n?"?"+n:"?"),r)}}t.Router=u,Object.defineProperty(u,"query",{configurable:!1,enumerable:!1,writable:!1,value:{}}),Object.defineProperty(u,"history",{configurable:!1,enumerable:!1,writable:!1,value:[]}),Object.defineProperty(u,"routeCount",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(u,"prevPath",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(u,"queryString",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(u,"InternalError",{configurable:!1,enumerable:!1,writable:!1,value:a}),Object.defineProperty(u,"NotFoundError",{configurable:!1,enumerable:!1,writable:!1,value:s})}()}),require.register("curvature/base/Routes.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Routes=void 0;var e={},i=r,n=!1,o=()=>{if(!n){try{Object.assign(e,i("Routes").Routes||{})}catch(e){!0===globalThis.devMode&&console.warn(e)}n=!0}};class s{static get(e){return o(),this.routes[e]}static dump(){return o(),this.routes}}t.Routes=s,Object.defineProperty(s,"routes",{configurable:!1,enumerable:!1,writable:!1,value:e})}()}),require.register("curvature/base/RuleSet.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RuleSet=void 0;r("./Dom");var e=r("./Tag"),i=r("./View");class n{static add(e,t){return this.globalRules=this.globalRules||{},this.globalRules[e]=this.globalRules[e]||[],this.globalRules[e].push(t),this}static apply(e=document,t=null){for(var r in this.globalRules)for(var i in this.globalRules[r]){var n=this.globalRules[r][i],o=this.wrap(e,n,t),s=e.querySelectorAll(r);for(var a of s)o(a)}}add(e,t){return this.rules=this.rules||{},this.rules[e]=this.rules[e]||[],this.rules[e].push(t),this}apply(e=document,t=null){for(var r in n.apply(e,t),this.rules)for(var i in this.rules[r]){var o=this.rules[r][i],s=n.wrap(e,o,t),a=e.querySelectorAll(r);for(var l of a)s(l)}}purge(){if(this.rules)for(var[e,t]of Object.entries(this.rules))if(this.rules[e])for(var r in this.rules[e])delete this.rules[e][r]}static wait(e="DOMContentLoaded",t=document){var r=((e,t)=>()=>(t.removeEventListener(e,r),this.apply()))(e,t);t.addEventListener(e,r)}static wrap(t,r,n=null){var o=r;return(r instanceof i.View||r&&r.prototype&&r.prototype instanceof i.View)&&(o=(()=>r)),t=>{if(void 0===t.___cvApplied___&&Object.defineProperty(t,"___cvApplied___",{enumerable:!1,writable:!1,value:new WeakSet}),!t.___cvApplied___.has(r)){var s,a;n&&(s=a=n,n.viewList&&(a=n.viewList.parent));var l=new e.Tag(t,a,null,void 0,s),u=l.element.parentNode,c=l.element.nextSibling,h=o(l);if(!1!==h&&t.___cvApplied___.add(r),h instanceof HTMLElement&&(h=new e.Tag(h)),h instanceof e.Tag){if(!h.element.contains(l.element)){for(;l.element.firstChild;)h.element.appendChild(l.element.firstChild);l.remove()}c?u.insertBefore(h.element,c):u.appendChild(h.element)}h&&h.prototype&&h.prototype instanceof i.View&&(h=new h({},n)),h instanceof i.View&&(n&&(n.cleanup.push(()=>h.remove()),n.cleanup.push(n.args.bindTo((e,t,r)=>{r[t]=e,h.args[t]=e})),n.cleanup.push(h.args.bindTo((e,t,r,i)=>{r[t]=e,n.args[t]=e}))),l.clear(),h.render(l.element))}}}}t.RuleSet=n}()}),require.register("curvature/base/SetMap.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";function e(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Object.defineProperty(t,"__esModule",{value:!0}),t.SetMap=void 0;t.SetMap=class{constructor(){e(this,"_map",new Map)}has(e){return this._map.has(e)}get(e){return this._map.get(e)}getOne(e){var t=this.get(e);for(var r of t)return r}add(e,t){var r=this._map.get(e);return r||this._map.set(e,r=new Set),r.add(t)}remove(e,t){var r=this._map.get(e);if(r){var i=r.delete(t);return r.size||this._map.delete(e),i}}values(){return new Set(...[...this._map.values()].map(e=>[...e.values()]))}}}()}),require.register("curvature/base/Tag.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tag=void 0;var e=r("./Bindable"),i=Symbol("CurrentStyle"),n=Symbol("CurrentAttrs"),o=function(e){if(this.node)for(var t in e){var r=String(e[t]);this[i].has(t)&&this[i].get(t)===e[t]||Number.isNaN(e[t])||("-"===t[0]?this.node.style.setProperty(t,r):this.node.style[t]=r,void 0!==e[t]?this[i].set(t,e[t]):this[i].delete(t))}},s=function(e){return"function"==typeof this[e]?this[e]:this.node&&"function"==typeof this.node[e]?this[e]=((...t)=>this.node[e](...t)):"style"===e?this.proxy.style:this.node&&e in this.node?this.node[e]:this[e]};t.Tag=class{constructor(t,r,a,l,u){if("string"==typeof t){var c=document.createRange().createContextualFragment(t);t=c.firstChild}this.element=e.Bindable.makeBindable(t),this.node=this.element,this.parent=r,this.direct=u,this.ref=a,this.index=l,this.cleanup=[],this[e.Bindable.OnAllGet]=s.bind(this),this[i]=new Map,this[n]=new Map;var h=e.Bindable.make(o.bind(this));return Object.defineProperty(this,"style",{value:h}),this.proxy=e.Bindable.make(this),this.proxy.style.bindTo((e,t,r,n)=>{this[i].has(t)&&this[i].get(t)===e||(this.node.style[t]=e,n||void 0===e?this[i].delete(t):this[i].set(t,e))}),this.proxy.bindTo((e,r)=>{if("index"!==r)return r in t&&t[r]!==e&&(t[r]=e),!1}),this.proxy}attr(e){for(var t in e)this[n].has(t)&&void 0===e[t]?(this.node.removeAttribute(t),this[n].delete(t)):this[n].has(t)&&this[n].get(t)===e[t]||(null===e[t]?(this.node.setAttribute(t,""),this[n].set(t,"")):(this.node.setAttribute(t,e[t]),this[n].set(t,e[t])));return this}remove(){var t;for(this.node&&this.node.remove(),e.Bindable.clearBindings(this);t=this.cleanup.shift();)t();if(this.clear(),this.node){var r=new Event("cvDomDetached");this.node.dispatchEvent(r),this.node=this.element=this.ref=this.parent=void 0}}clear(){if(this.node)for(var e=new Event("cvDomDetached");this.node.firstChild;)this.node.firstChild.dispatchEvent(e),this.node.removeChild(this.node.firstChild)}pause(e=!0){}listen(e,t,r){var i=this.node;i.addEventListener(e,t,r);var n=()=>{i.removeEventListener(e,t,r)},o=()=>{n(),n=(()=>console.warn("Already removed!"))};return this.parent.onRemove(()=>o()),o}}}()}),require.register("curvature/base/Uuid.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";function e(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Object.defineProperty(t,"__esModule",{value:!0}),t.Uuid=void 0;var r=("object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:void 0).crypto;class i{constructor(t=null,n=4){if(e(this,"uuid",null),e(this,"version",4),t){if("string"!=typeof t&&!(t instanceof i)||!t.match(/[0-9A-Fa-f]{8}(-[0-9A-Fa-f]{4}){3}-[0-9A-Fa-f]{12}/))throw new Error(`Invalid input for Uuid: "${t}"`);this.version=n,this.uuid=t}else if(r&&"function"==typeof r.randomUUID)this.uuid=r.randomUUID();else{var o=r&&"function"==typeof r.randomUUID?()=>r.getRandomValues(new Uint8Array(1))[0]:()=>Math.trunc(256*Math.random());this.uuid=([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^o()&15>>e/4).toString(16))}Object.freeze(this)}[Symbol.toPrimitive](){return this.toString()}toString(){return this.uuid}toJson(){return{version:this.version,uuid:this.uuid}}}t.Uuid=i}()}),require.register("curvature/base/View.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.View=void 0;var e=r("./Bindable"),i=r("./ViewList"),n=r("./Router"),o=r("./Uuid"),s=r("./Dom"),a=r("./Tag"),l=r("./Bag"),u=r("./RuleSet"),c=r("./Mixin"),h=r("../mixin/EventTargetMixin"),f=Symbol("dontParse"),d=Symbol("expandBind"),p=Symbol("uuid");class y extends(c.Mixin.with(h.EventTargetMixin)){get _id(){return this[p]}static from(e,t={},r=null){var i=new this(t,r);return i.template=e,i}constructor(t={},r=null){super(t,r),this[h.EventTargetMixin.Parent]=r,Object.defineProperty(this,"args",{value:e.Bindable.make(t)}),Object.defineProperty(this,p,{value:this.constructor.uuid()}),Object.defineProperty(this,"nodesAttached",{value:new l.Bag((e,t,r)=>{})}),Object.defineProperty(this,"nodesDetached",{value:new l.Bag((e,t,r)=>{})}),Object.defineProperty(this,"_onRemove",{value:new l.Bag((e,t,r)=>{})}),Object.defineProperty(this,"cleanup",{value:[]}),Object.defineProperty(this,"parent",{value:r,writable:!0}),Object.defineProperty(this,"views",{value:new Map}),Object.defineProperty(this,"viewLists",{value:new Map}),Object.defineProperty(this,"withViews",{value:new Map}),Object.defineProperty(this,"tags",{value:e.Bindable.make({})}),Object.defineProperty(this,"nodes",{value:e.Bindable.make([])}),Object.defineProperty(this,"timeouts",{value:new Map}),Object.defineProperty(this,"intervals",{value:new Map}),Object.defineProperty(this,"frames",{value:[]}),Object.defineProperty(this,"ruleSet",{value:new u.RuleSet}),Object.defineProperty(this,"preRuleSet",{value:new u.RuleSet}),Object.defineProperty(this,"subBindings",{value:{}}),Object.defineProperty(this,"templates",{value:{}}),Object.defineProperty(this,"postMapping",{value:new Set}),Object.defineProperty(this,"eventCleanup",{value:[]}),Object.defineProperty(this,"unpauseCallbacks",{value:new Map}),Object.defineProperty(this,"interpolateRegex",{value:/(\[\[((?:\$+)?[\w\.\|-]+)\]\])/g}),Object.defineProperty(this,"rendered",{value:new Promise((e,t)=>Object.defineProperty(this,"renderComplete",{value:e}))}),this.onRemove(()=>{this[h.EventTargetMixin.Parent]&&(this[h.EventTargetMixin.Parent]=null)}),this.controller=this,this.template="",this.firstNode=null,this.lastNode=null,this.viewList=null,this.mainView=null,this.preserve=!1,this.removed=!1,this.loaded=Promise.resolve(this)}static isView(){return y}onFrame(e){var t=!1,r=()=>{t=!0},i=r=>{this.removed||t||(this.paused||e(Date.now()),requestAnimationFrame(i))};return requestAnimationFrame(()=>i(Date.now())),this.frames.push(r),r}onNextFrame(e){return requestAnimationFrame(()=>e(Date.now()))}onIdle(e){return requestIdleCallback(()=>e(Date.now()))}onTimeout(e,t){var r={timeout:null,callback:null,time:e,fired:!1,created:(new Date).getTime(),paused:!1},i=()=>{t(),r.fired=!0,this.timeouts.delete(r.timeout)},n=setTimeout(i,e);return r.callback=i,r.timeout=n,this.timeouts.set(r.timeout,r),n}clearTimeout(e){if(this.timeouts.has(e)){var t=this.timeouts.get(e);clearTimeout(t.timeout),this.timeouts.delete(t.timeout)}}onInterval(e,t){var r=setInterval(t,e);return this.intervals.set(r,{timeout:r,callback:t,time:e,paused:!1}),r}clearInterval(e){if(this.intervals.has(e)){var t=this.intervals.get(e);clearTimeout(t.timeout),this.intervals.delete(t.timeout)}}pause(e){if(void 0===e&&(this.paused=!this.paused),this.paused=e,this.paused){for(var[t,r]of this.timeouts)r.fired?this.timeouts.delete(r.timeout):(clearTimeout(r.timeout),r.paused=!0,r.time=Math.max(0,r.time-(Date.now()-r.created)));for(var[i,n]of this.intervals)clearInterval(n.timeout),n.paused=!0}else{for(var[o,s]of this.timeouts)s.paused&&(s.fired?this.timeouts.delete(s.timeout):(s.timeout=setTimeout(s.callback,s.time),s.paused=!1));for(var[a,l]of this.intervals)l.paused&&(l.timeout=setInterval(l.callback,l.time),l.paused=!1);for(var[,u]of this.unpauseCallbacks)u();this.unpauseCallbacks.clear()}for(var[c,h]of this.viewLists)h.pause(!!e);for(var f in this.tags)if(Array.isArray(this.tags[f]))for(var d in this.tags[f])this.tags[f][d].pause(!!e);else this.tags[f].pause(!!e)}render(e=null,t=null,r=null){var{document:i}=globalThis.window;if(e instanceof y&&(e=e.firstNode.parentNode),t instanceof y&&(t=t.firstNode),this.firstNode)return this.reRender(e,t,r);this.dispatchEvent(new CustomEvent("render"));var n,o="object"==typeof this.template&&"function"==typeof this.template.cloneNode,s=o||y.templates.has(this.template);if(n=s?o?this.template.cloneNode(!0):y.templates.get(this.template).cloneNode(!0):i.createRange().createContextualFragment(this.template),s||o||y.templates.set(this.template,n.cloneNode(!0)),this.mainView||this.preRuleSet.apply(n,this),this.mapTags(n),this.mainView||this.ruleSet.apply(n,this),!0===globalThis.devMode?(this.firstNode=i.createComment(`Template ${this._id} Start`),this.lastNode=i.createComment(`Template ${this._id} End`)):(this.firstNode=i.createTextNode(""),this.lastNode=i.createTextNode("")),this.nodes.push(this.firstNode,...Array.from(n.childNodes),this.lastNode),this.postRender(e),this.dispatchEvent(new CustomEvent("rendered")),this.dispatchAttach()){if(e){t?(e.insertBefore(this.firstNode,t),e.insertBefore(this.lastNode,t)):(e.insertBefore(this.firstNode,null),e.insertBefore(this.lastNode,null)),e.insertBefore(n,this.lastNode);var a=e.getRootNode();if(a.isConnected)this.attached(a,e),this.dispatchAttached(a,e,r);else if(r){var l=t=>{var i=e.getRootNode();this.attached(i,e),this.dispatchAttached(i,e,r),r.removeEventListener("attached",l)};r.addEventListener("attached",l)}}return this.renderComplete(this.nodes),this.nodes}}dispatchAttach(){var{CustomEvent:e}=globalThis.window;return this.dispatchEvent(new e("attach",{cancelable:!0,target:this}))}dispatchAttached(e,t,r){var{CustomEvent:i}=globalThis.window;for(var n of(this.dispatchEvent(new i("attached",{detail:{view:r||this,node:t,root:e,mainView:this}})),this.dispatchDomAttached(r),this.nodesAttached.items()))n(e,t)}dispatchDomAttached(e){var{Node:t,CustomEvent:r}=globalThis.window;this.nodes.filter(e=>e.nodeType!==t.COMMENT_NODE).forEach(t=>{t.matches&&(t.dispatchEvent(new r("cvDomAttached",{target:t,detail:{view:e||this,mainView:this}})),s.Dom.mapTags(t,!1,(t,i)=>{t.matches&&t.dispatchEvent(new r("cvDomAttached",{target:t,detail:{view:e||this,mainView:this}}))}))})}reRender(e,t,r){var{CustomEvent:i}=globalThis.window;if(this.dispatchEvent(new i("reRender"),{cancelable:!0,target:this,view:r})){var n=new DocumentFragment;if(this.firstNode.isConnected){var o=this.nodesDetached.items();for(var s in o)o[s]()}if(n.append(...this.nodes),e){t?(e.insertBefore(this.firstNode,t),e.insertBefore(this.lastNode,t)):(e.insertBefore(this.firstNode,null),e.insertBefore(this.lastNode,null)),e.insertBefore(n,this.lastNode),this.dispatchEvent(new i("reRendered"),{cancelable:!0,target:this,view:r});var a=e.getRootNode();a.isConnected&&(this.attached(a,e),this.dispatchAttached(a,e))}return this.nodes}}mapTags(e){s.Dom.mapTags(e,!1,(e,t)=>{e[f]||(e=e.matches?(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=this.mapInterpolatableTag(e)).matches("[cv-template]")&&this.mapTemplateTag(e)||e).matches("[cv-slot]")&&this.mapSlotTag(e)||e).matches("[cv-prerender]")&&this.mapPrendererTag(e)||e).matches("[cv-link]")&&this.mapLinkTag(e)||e).matches("[cv-attr]")&&this.mapAttrTag(e)||e).matches("[cv-expand]")&&this.mapExpandableTag(e)||e).matches("[cv-ref]")&&this.mapRefTag(e)||e).matches("[cv-on]")&&this.mapOnTag(e)||e).matches("[cv-each]")&&this.mapEachTag(e)||e).matches("[cv-bind]")&&this.mapBindTag(e)||e).matches("[cv-with]")&&this.mapWithTag(e)||e).matches("[cv-if]")&&this.mapIfTag(e)||e).matches("[cv-view]")&&this.mapViewTag(e)||e:this.mapInterpolatableTag(e))!==t.currentNode&&(t.currentNode=e)}),this.postMapping.forEach(e=>e())}mapExpandableTag(t){var r=t[d];r&&(r(),t[d]=!1);var[i,n]=e.Bindable.resolve(this.args,t.getAttribute("cv-expand"),!0);return t.removeAttribute("cv-expand"),i[n]||(i[n]={}),i[n]=e.Bindable.make(i[n]),this.onRemove(t[d]=i[n].bindTo((e,r,i,n,o)=>{n||void 0===e?t.removeAttribute(r,e):null!==e?t.setAttribute(r,e):t.setAttribute(r,"")})),t}mapAttrTag(e){var t=this.compileAttrTag(e)(this);return e.replaceWith(t),t}compileAttrTag(t){var r=t.getAttribute("cv-attr").split(/[,;]/).map(e=>e.split(":"));return t.removeAttribute("cv-attr"),i=>{var n=t.cloneNode(!0),o=function(){var t=r[s][1]||r[s][0],[o,a]=e.Bindable.resolve(i.args,t,!0),l=r[s][0];i.onRemove(o.bindTo(a,(e,t,r,i)=>{i||void 0===e?n.removeAttribute(l,e):null!==e?n.setAttribute(l,e):n.setAttribute(l,"")}))};for(var s in r)o();return n}}mapInterpolatableTag(t){var r=this,i=this.interpolateRegex,{Node:n,document:o}=globalThis.window;if(t.nodeType===n.TEXT_NODE){var s=t.nodeValue;if(!this.interpolatable(s))return t;for(var l,u,c=0,d=function(){var i=l[2],u=!1,d=!1,p=i.split("|"),v=!1;if(p.length>1&&(v=r.stringTransformer(p.slice(1)),i=p[0]),"$$"===i.substr(0,2)&&(u=!0,d=!0,i=i.substr(2)),"$"===i.substr(0,1)&&(u=!0,i=i.substr(1)),"000"===i.substr(0,3))return expand=!0,i=i.substr(3),0;var m=s.substring(c,l.index);c=l.index+l[1].length;var b,g=o.createTextNode(m);g[f]=!0,t.parentNode.insertBefore(g,t),(b=u?o.createElement("div"):o.createTextNode(""))[f]=!0;var w=r.args,T=i;if(i.match(/\./)&&([w,T]=e.Bindable.resolve(r.args,i,!0)),t.parentNode.insertBefore(b,t),"object"!=typeof w)return 1;var x=(w=e.Bindable.make(w)).bindTo(T,(e,i,o)=>{if(o[i]!==e&&(o[i]instanceof y||o[i]instanceof n||o[i]instanceof a.Tag)&&(o[i].preserve||o[i].remove()),d&&!(e instanceof y)){var s=null!==e&&void 0!==e?e:"";(e=new y(r.args,r)).template=s}if(v&&(e=v(e)),e instanceof y){b.nodeValue="",e[h.EventTargetMixin.Parent]=r,e.render(t.parentNode,b,r);var l=()=>{e.preserve||e.remove()};r.onRemove(l),e.onRemove(()=>r._onRemove.remove(l))}else e instanceof n?(b.nodeValue="",t.parentNode.insertBefore(e,b),r.onRemove(()=>e.remove())):e instanceof a.Tag?(b.nodeValue="",e.node?(t.parentNode.insertBefore(e.node,b),r.onRemove(()=>e.remove())):e.remove()):(e instanceof Object&&e.__toString instanceof Function&&(e=e.__toString()),u?b.innerHTML=e:b.nodeValue=e);b[f]=!0});r.onRemove(x)};(l=i.exec(s))&&(0===(u=d())||1!==u););var p=s.substring(c),v=o.createTextNode(p);v[f]=!0,t.parentNode.insertBefore(v,t),t.nodeValue=""}else if(t.nodeType===n.ELEMENT_NODE)for(var m=function(){if(!r.interpolatable(t.attributes[b].value))return 1;for(var n,o=0,s=t.attributes[b].value,a=t.attributes[b],l={},u=[];n=i.exec(s);)u.push(s.substring(o,n.index)),l[n[2]]||(l[n[2]]=[]),l[n[2]].push(u.length),u.push(n[1]),o=n.index+n[1].length;u.push(s.substring(o));var c=function(){var i=r.args,n=h,o=h.split("|"),s=!1,c=h;o.length>1&&(s=r.stringTransformer(o.slice(1)),n=o[0]),n.match(/\./)&&([i,n]=e.Bindable.resolve(r.args,n,!0));l[c];r.onRemove(i.bindTo(n,(e,i,o,h)=>{for(var f in s&&(e=s(e)),l)for(var d in l[c])u[l[c][d]]=o[f],i===n&&(u[l[c][d]]=e);r.paused?r.unpauseCallbacks.set(a,()=>t.setAttribute(a.name,u.join(""))):t.setAttribute(a.name,u.join(""))}))};for(var h in l)c()},b=0;b<t.attributes.length;b++)m();return t}mapRefTag(e){var t=e.getAttribute("cv-ref"),[r,i=null,n=null]=t.split(":"),o=a.Tag;i&&(o=this.stringToClass(i)),e.removeAttribute("cv-ref"),Object.defineProperty(e,"___tag___",{enumerable:!1,writable:!0}),this.onRemove(()=>{e.___tag___=null,e.remove()});var s=this;this.viewList&&(s=this.viewList.parent);var l=new o(e,this,r,void 0,this);for(e.___tag___=l,this.tags[r]=l;s;){var u=this.args[n];if(void 0!==u?(s.tags[r]||(s.tags[r]=[]),s.tags[r][u]=l):s.tags[r]=l,!s.parent)break;s=s.parent}return e}mapBindTag(t){var r=t.getAttribute("cv-bind"),i=this.args,n=r,o=null;r.match(/\./)&&([i,n,o]=e.Bindable.resolve(this.args,r,!0)),i!==this.args&&(this.subBindings[r]=this.subBindings[r]||[],this.onRemove(this.args.bindTo(o,()=>{for(;this.subBindings.length;)this.subBindings.shift()()})));var l=!1;"$"===n.substr(0,1)&&(n=n.substr(1),l=!0);var u=!1,c=i.bindTo(n,(e,r,i,n,o)=>{if((o instanceof y||o instanceof Node||o instanceof a.Tag)&&o!==e&&o.remove(),["INPUT","SELECT","TEXTAREA"].includes(t.tagName)){var c=t.getAttribute("type");if(c&&"checkbox"===c.toLowerCase())t.checked=!!e;else if(c&&"radio"===c.toLowerCase())t.checked=e==t.value;else if("file"!==c)if("SELECT"===t.tagName){var d=()=>{for(var r=0;r<t.options.length;r++){t.options[r].value==e&&(t.selectedIndex=r)}};d(),this.nodesAttached.add(d)}else t.value=null==e?"":e;u&&t.dispatchEvent(new CustomEvent("cvAutoChanged",{bubbles:!0})),u=!0}else if(e instanceof y){for(var p of t.childNodes)p.remove();e[h.EventTargetMixin.Parent]=this,e.render(t,null,this)}else if(e instanceof Node)t.insert(e);else if(e instanceof a.Tag)t.append(e.node);else if(l){if(t.innerHTML!==e){if(e=String(e),t.innerHTML===e.substring(0,t.innerHTML.length))t.innerHTML+=e.substring(t.innerHTML.length);else{for(var v of t.childNodes)v.remove();t.innerHTML=e}s.Dom.mapTags(t,!1,e=>e[f]=!0)}}else if(t.textContent!==e){for(var m of t.childNodes)m.remove();t.textContent=e}});i!==this.args&&this.subBindings[r].push(c),this.onRemove(c);var d=t.getAttribute("type"),p=t.getAttribute("multiple"),v=r=>{if(r.target===t)if(d&&"checkbox"===d.toLowerCase())t.checked?i[n]=r.target.getAttribute("value"):i[n]=!1;else if(r.target.matches("[contenteditable=true]"))i[n]=r.target.innerHTML;else if("file"===d&&p){var o=Array.from(r.target.files),s=i[n]||e.Bindable.onDeck(i,n);if(s&&o.length){var a=function(e){if(o[e]!==s[e])return o[e].toJSON=(()=>({name:file[e].name,size:file[e].size,type:file[e].type,date:file[e].lastModified})),s[e]=o[e],1};for(var l in o)if(a(l))break}else i[n]=o}else if("file"===d&&!p&&r.target.files.length){var u=r.target.files.item(0);u.toJSON=(()=>({name:u.name,size:u.size,type:u.type,date:u.lastModified})),i[n]=u}else i[n]=r.target.value};return"file"===d||"radio"===d?t.addEventListener("change",v):(t.addEventListener("input",v),t.addEventListener("change",v),t.addEventListener("value-changed",v)),this.onRemove(()=>{"file"===d||"radio"===d?t.removeEventListener("change",v):(t.removeEventListener("input",v),t.removeEventListener("change",v),t.removeEventListener("value-changed",v))}),t.removeAttribute("cv-bind"),t}mapOnTag(e){return String(e.getAttribute("cv-on")).split(";").map(e=>e.split(":")).forEach(t=>{var r=(t=t.map(e=>e.trim())).length,i=String(t.shift()).trim(),n=String(t.shift()||i).trim(),o=String(t.shift()||"").trim(),s=[],a=/(\w+)(?:\(([$\w\s-'",]+)\))?/.exec(n);a&&(n=a[1].replace(/(^[\s\n]+|[\s\n]+$)/,""),a[2]&&(s=a[2].split(",").map(e=>e.trim()))),s.length||s.push("$event"),i&&1!==r||(i=n);var l=t=>{for(var r,i=this,o=function(){var e=i.controller;return"function"==typeof e[n]?(r=((...t)=>{e[n](...t)}),0):"function"==typeof i[n]?(r=((...e)=>{i[n](...e)}),0):i.parent?void(i=i.parent):0};i&&0!==o(););var a=s.map(r=>{var n;return Number(r)==r?r:"event"===r||"$event"===r?t:"$view"===r?i:"$controller"===r?controller:"$tag"===r?e:"$parent"===r?this.parent:"$subview"===r?this:r in this.args?this.args[r]:(n=/^['"]([\w-]+?)["']$/.exec(r))?n[1]:void 0});if("function"!=typeof r)throw new Error(`${n} is not defined on View object.`+"\nTag:\n"+`${e.outerHTML}`);r(...a)},u={};switch(o.includes("p")?u.passive=!0:o.includes("P")&&(u.passive=!1),o.includes("c")?u.capture=!0:o.includes("C")&&(u.capture=!1),o.includes("o")?u.once=!0:o.includes("O")&&(u.once=!1),i){case"_init":l();break;case"_attach":this.nodesAttached.add(l);break;case"_detach":this.nodesDetached.add(l);break;default:e.addEventListener(i,l,u),this.onRemove(()=>{e.removeEventListener(i,l,u)})}return[i,n,s]}),e.removeAttribute("cv-on"),e}mapLinkTag(e){var t=e.getAttribute("cv-link");e.setAttribute("href",t);var r=r=>{r.preventDefault(),"http"!==t.substring(0,4)&&"//"!==t.substring(0,2)?n.Router.go(e.getAttribute("href")):globalThis.open(e.getAttribute("href",t))};return e.addEventListener("click",r),this.onRemove(((e,t)=>()=>{e.removeEventListener("click",t),e=void 0,t=void 0})(e,r)),e.removeAttribute("cv-link"),e}mapPrendererTag(e){var t=e.getAttribute("cv-prerender"),r=globalThis.prerenderer||navigator.userAgent.match(/prerender/i);return e.removeAttribute("cv-prerender"),r&&(globalThis.prerenderer=globalThis.prerenderer||!0),("never"===t&&r||"only"===t&&!r)&&this.postMapping.add(()=>e.parentNode.removeChild(e)),e}mapWithTag(t){var r=this,i=t.getAttribute("cv-with"),n=t.getAttribute("cv-carry"),o=t.getAttribute("cv-view");t.removeAttribute("cv-with"),t.removeAttribute("cv-carry"),t.removeAttribute("cv-view");var s=o?this.stringToClass(o):y,a=new DocumentFragment;[...t.childNodes].forEach(e=>a.appendChild(e));var l=[];n&&(l=n.split(",").map(e=>e.trim()));var u=this.args.bindTo(i,(i,n,o,u)=>{for(this.withViews.has(t)&&this.withViews.delete(t);t.firstChild;)t.removeChild(t.firstChild);var c=new s({},this);this.onRemove((e=>()=>{e.remove()})(c)),c.template=a;var h=function(){var e=r.args.bindTo(l[f],(e,t)=>{c.args[t]=e});c.onRemove(e),r.onRemove(()=>{e(),c.remove()})};for(var f in l)h();var d=function(){if("object"!=typeof i)return 1;var t=(i=e.Bindable.make(i)).bindTo(p,(e,t,r,i)=>{i?t in c.args&&delete c.args[t]:c.args[t]=e});c.args.bindTo(p,(e,t,r,n)=>{n?t in i&&delete i[t]:i[t]=e});r.onRemove(()=>{t(),i.isBound()||e.Bindable.clearBindings(i),c.remove()}),c.onRemove(()=>{t(),i.isBound()||e.Bindable.clearBindings(i)})};for(var p in i)d();c.render(t,null,this),this.withViews.set(t,c)});return this.onRemove(()=>{this.withViews.delete(t),u()}),t}mapViewTag(e){var t=e.getAttribute("cv-view");e.removeAttribute("cv-view");var r=new DocumentFragment;[...e.childNodes].forEach(e=>r.appendChild(e));var i=t.split(":"),n=i.shift(),o=new(i.length?this.stringToClass(i[0]):y)(this.args,this);return this.views.set(e,o),this.views.set(n,o),this.onRemove(()=>{o.remove(),this.views.delete(e),this.views.delete(n)}),o.template=r,o.render(e,null,this),e}mapEachTag(t){var r=t.getAttribute("cv-each"),n=t.getAttribute("cv-view");t.removeAttribute("cv-each"),t.removeAttribute("cv-view");var o=n?this.stringToClass(n):y,s=new DocumentFragment;[...t.childNodes].forEach(e=>s.appendChild(e));var[a,u,c]=r.split(":"),h=this.args,f=a;a.match(/\./)&&([h,f]=e.Bindable.resolve(this.args,a,!0));var d=h.bindTo(f,(e,r,n,a,h)=>{e instanceof l.Bag&&(e=e.list),this.viewLists.has(t)&&this.viewLists.get(t).remove();var f=new i.ViewList(s,u,e,this,c,o),d=()=>f.remove();this.onRemove(d),f.onRemove(()=>this._onRemove.remove(d));var p=this.args.bindTo((e,t,r,i)=>{"_id"!==t&&(i?t in f.subArgs&&delete f.subArgs[t]:f.subArgs[t]=e)}),y=f.args.bindTo((e,t,r,i,n)=>{"_id"!==t&&"value"!==t&&"___"!==String(t).substring(0,3)&&(i?delete this.args[t]:t in this.args&&(this.args[t]=e))});for(f.onRemove(p),f.onRemove(y),this.onRemove(p),this.onRemove(y);t.firstChild;)t.removeChild(t.firstChild);this.viewLists.set(t,f),f.render(t,null,this),"SELECT"===t.tagName&&f.reRender()});return this.onRemove(d),t}mapIfTag(t){var r=t,i=r.getAttribute("cv-view"),n=r.getAttribute("cv-if"),o=r.getAttribute("cv-is"),a=!1,u=!1;r.removeAttribute("cv-view"),r.removeAttribute("cv-if"),r.removeAttribute("cv-is");var c=i?this.stringToClass(i):y;"!"===n.substr(0,1)&&(n=n.substr(1),a=!0),"?"===n.substr(0,1)&&(n=n.substr(1),u=!0);var h=new DocumentFragment;[...r.childNodes].forEach(e=>h.appendChild(e));var f=this,d=new DocumentFragment,p=new c(this.args,f);p.tags.bindTo((e,t)=>this.tags[t]=e,{removeWith:this}),p.template=h;var v=f.args,m=n;n.match(/\./)&&([v,m]=e.Bindable.resolve(f.args,n,!0)),p.render(d,null,this);var b=v.bindTo(m,(e,r)=>{var i=e;u&&(e=null!==e&&void 0!==e),e instanceof l.Bag&&(e=e.list),Array.isArray(e)&&(e=!!e.length),null!==o&&(e=i==o),a&&(e=!e),e?(t.appendChild(d),[...d.childNodes].forEach(e=>s.Dom.mapTags(e,!1,(e,t)=>{e.matches&&e.dispatchEvent(new CustomEvent("cvDomAttached",{target:e,detail:{view:p||this,mainView:this}}))}))):(p.nodes.forEach(e=>d.appendChild(e)),s.Dom.mapTags(d,!1,(e,t)=>{e.matches&&new CustomEvent("cvDomDetached",{target:e,detail:{view:p||this,mainView:this}})}))},{children:Array.isArray(v[m])});f.onRemove(b);return f.onRemove(()=>{b(),f._onRemove.remove(b)}),this.onRemove(()=>{p.remove(),f!==this&&f.remove()}),t}mapTemplateTag(e){var t=e.getAttribute("cv-template");e.removeAttribute("cv-template");var r=e.innerHTML;return y.templates.has(r)||y.templates.set(r,document.createRange().createContextualFragment(e.innerHTML)),this.templates[t]=y.templates.get(r),this.postMapping.add(()=>e.remove()),e}mapSlotTag(e){var t=e.getAttribute("cv-slot"),r=this.templates[t];if(!r){for(var i=this;i&&!(r=i.templates[t]);)i=i.parent;if(!r)return void console.error(`Template ${t} not found.`)}for(e.removeAttribute("cv-slot");e.firstChild;)e.firstChild.remove();return"string"==typeof r&&(y.templates.has(r)||y.templates.set(r,document.createRange().createContextualFragment(r)),r=y.templates.get(r)),e.appendChild(r.cloneNode(!0)),e}postRender(e){}attached(e){}interpolatable(e){return!!String(e).match(this.interpolateRegex)}static uuid(){return new o.Uuid}remove(e=!1){if(this.dispatchEvent(new CustomEvent("remove",{detail:{view:this},cancelable:!0}))){var t=()=>{for(var e in this.tags)Array.isArray(this.tags[e])?(this.tags[e]&&this.tags[e].forEach(e=>e.remove()),this.tags[e].splice(0)):(this.tags[e]&&this.tags[e].remove(),this.tags[e]=void 0);for(var t in this.nodes)this.nodes[t]&&this.nodes[t].dispatchEvent(new Event("cvDomDetached")),this.nodes[t]&&this.nodes[t].remove(),this.nodes[t]=void 0;this.nodes.splice(0),this.firstNode=this.lastNode=void 0};e?t():requestAnimationFrame(t);var r=this._onRemove.items();for(var i of r)i(),this._onRemove.remove(i);for(var n of this.cleanup)n&&n();for(var[o,s]of(this.cleanup.length=0,this.viewLists))s.remove();for(var[a,l]of(this.viewLists.clear(),this.timeouts))clearTimeout(l.timeout),this.timeouts.delete(l.timeout);for(var u of this.intervals)clearInterval(u);for(var c of(this.intervals.length=0,this.frames))c();this.frames.length=0,this.preRuleSet.purge(),this.ruleSet.purge(),this.removed=!0,this.dispatchEvent(new CustomEvent("removed",{detail:{view:this},cancelable:!0}))}}findTag(e){for(var t in this.nodes){var r;if(this.nodes[t].querySelector){if(this.nodes[t].matches(e))return new a.Tag(this.nodes[t],this,void 0,void 0,this);if(r=this.nodes[t].querySelector(e))return new a.Tag(r,this,void 0,void 0,this)}}}findTags(e){var t=this.nodes.filter(t=>t.matches&&t.matches(e)),r=this.nodes.filter(e=>e.querySelectorAll).map(t=>[...t.querySelectorAll(e)]).flat().map(e=>new a.Tag(e,this,void 0,void 0,this))||[];return t.concat(r)}onRemove(e){e instanceof Event||this._onRemove.add(e)}update(){}beforeUpdate(e){}afterUpdate(e){}stringTransformer(e){return t=>{for(var r in e){for(var i=this,n=e[r];i&&!i[n];)i=i.parent;if(!i)return;t=i[e[r]](t)}return t}}stringToClass(e){if(y.refClasses.has(e))return y.refClasses.get(e);var t=e.split("/"),i=t[t.length-1],n=r(e);return y.refClasses.set(e,n[i]),n[i]}preventParsing(e){e[f]=!0}toString(){return this.nodes.map(e=>e.outerHTML).join(" ")}listen(e,t,r,i){if("string"==typeof e&&(i=r,r=t,t=e,e=this),e instanceof y)return this.listen(e.nodes,t,r,i);if(Array.isArray(e))return e.map(e=>this.listen(e,t,r,i));if(e instanceof a.Tag)return this.listen(e.element,t,r,i);e.addEventListener(t,r,i);var n=()=>e.removeEventListener(t,r,i),o=()=>{n(),n=(()=>{})};return this.onRemove(()=>o()),o}detach(){for(var e in this.nodes)this.nodes[e].remove();return this.nodes}}t.View=y,Object.defineProperty(y,"templates",{value:new Map}),Object.defineProperty(y,"refClasses",{value:new Map})}()}),require.register("curvature/base/ViewList.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ViewList=void 0;var e=r("./Bindable"),i=r("./SetMap"),n=r("./Bag");t.ViewList=class{constructor(t,r,i,o,s=null,a=null){this.removed=!1,this.args=e.Bindable.makeBindable(Object.create(null)),this.args.value=e.Bindable.makeBindable(i||Object.create(null)),this.subArgs=e.Bindable.makeBindable(Object.create(null)),this.views=[],this.cleanup=[],this.viewClass=a,this._onRemove=new n.Bag,this.template=t,this.subProperty=r,this.keyProperty=s,this.tag=null,this.downDebind=[],this.upDebind=[],this.paused=!1,this.parent=o,this.viewCount=0,this.rendered=new Promise((e,t)=>{Object.defineProperty(this,"renderComplete",{configurable:!1,writable:!0,value:e})}),this.willReRender=!1,this.args.___before((e,t,r,i,n)=>{"bindTo"!=t&&(this.paused=!0)}),this.args.___after((e,t,r,i,n)=>{"bindTo"!=t&&(this.paused=r.length>1,this.reRender())});var l=this.args.value.bindTo((e,t,r,i)=>{if(!this.paused){var n=t;if("symbol"!=typeof t)if(isNaN(t)&&(n="_"+t),i)for(var o in this.views[n]&&this.views[n].remove(!0),delete this.views[n],this.views)this.views[o]&&(isNaN(o)?this.views[o].args[this.keyProperty]=o.substr(1):this.views[o].args[this.keyProperty]=o);else this.views[n]?this.views[n]&&this.views[n].args&&(this.views[n].args[this.keyProperty]=t,this.views[n].args[this.subProperty]=e):this.viewCount?!1===this.willReRender&&(this.willReRender=requestAnimationFrame(()=>{this.willReRender=!1,this.reRender()})):this.reRender()}},{wait:0});this._onRemove.add(l),Object.preventExtensions(this)}render(e){var t=this,r=[],i=function(i){i.viewList=t,i.render(e,null,t.parent),r.push(i.rendered.then(()=>i))};for(var n of this.views)i(n);this.tag=e,Promise.all(r).then(e=>this.renderComplete(e)),this.parent.dispatchEvent(new CustomEvent("listRendered",{detail:{detail:{key:this.subProperty,value:this.args.value}}}))}reRender(){var e=this;if(!this.paused&&this.tag){var t=[],r=new i.SetMap;for(var n in this.views){var o=this.views[n];if(void 0!==o){var s=o.args[this.subProperty];r.add(s,o),t[n]=o}else t[n]=o}var a=[],l=new Set;this.downDebind.length&&this.downDebind.forEach(e=>e&&e()),this.upDebind.length&&this.upDebind.forEach(e=>e&&e()),this.upDebind.length=0,this.downDebind.length=0;var u=1/0,c=1/0,h=function(){var t=!1,i=f;if(isNaN(i)?i="_"+f:String(i).length&&(i=Number(i)),void 0!==e.args.value[f]&&r.has(e.args.value[f])){var n=r.getOne(e.args.value[f]);n&&(n.args[e.keyProperty]=f,a[i]=n,l.add(n),t=!0,isNaN(i)||(u=Math.min(u,i),i>0&&(c=Math.min(c,i))),r.remove(e.args.value[f],n))}if(!t){var o=Object.create(null),s=a[i]=new e.viewClass(o,e.parent);isNaN(i)||(u=Math.min(u,i),i>0&&(c=Math.min(c,i))),a[i].template=e.template,a[i].viewList=e,a[i].args[e.keyProperty]=f,a[i].args[e.subProperty]=e.args.value[f],e.upDebind[i]=o.bindTo(e.subProperty,(t,r,i,n)=>{var s=o[e.keyProperty];n?delete e.args.value[s]:e.args.value[s]=t}),e.downDebind[i]=e.subArgs.bindTo((e,t,r,i)=>{i?delete o[t]:o[t]=e});var h=()=>{e.upDebind.filter(e=>e).forEach(e=>e()),e.upDebind.length=0},d=()=>{e.downDebind.filter(e=>e).forEach(e=>e()),e.downDebind.length=0};s.onRemove(()=>{e._onRemove.remove(h),e._onRemove.remove(d),e.upDebind[i]&&e.upDebind[i](),e.downDebind[i]&&e.downDebind[i](),delete e.upDebind[i],delete e.downDebind[i]}),e._onRemove.add(h),e._onRemove.add(d),o[e.subProperty]=e.args.value[f]}};for(var f in this.args.value)h();for(var d in t)t[d]&&!l.has(t[d])&&t[d].remove(!0);if(Array.isArray(this.args.value)){var p=0===u&&void 0!==a[1]&&a.length>1||c===1/0?u:c,y=(e=0)=>{for(var t=a.length-e-1;t>p&&void 0===a[t];)t--;return t<p?Promise.resolve():a[t]===this.views[t]?a[t]&&!a[t].firstNode?(a[t].render(this.tag,a[t+1],this.parent),a[t].rendered.then(()=>y(Number(e)+1))):0===e||e%500?y(Number(e)+1):new Promise(t=>requestAnimationFrame(()=>t(y(Number(e)+1)))):(a[t].render(this.tag,a[t+1],this.parent),this.views.splice(t,0,a[t]),a[t].rendered.then(()=>y(e+1)))};this.rendered=y()}else{var v=[],m=Object.assign(Object.create(null),a),b=e=>parseInt(e)===e-0,g=Object.keys(a).sort((e,t)=>b(e)&&b(t)?Math.sign(e-t):b(e)||b(t)?!b(e)&&b(t)?-1:b(e)&&!b(t)?1:void 0:0),w=function(t){if(delete m[t],a[t].firstNode&&a[t]===e.views[t])return 1;a[t].render(e.tag,null,e.parent),v.push(a[t].rendered.then(()=>a[t]))};for(var T of g)w(T);for(var x in m)delete this.args.views[x],m.remove(!0);this.rendered=Promise.all(v)}for(var S in a)isNaN(S)?a[S].args[this.keyProperty]=S.substr(1):a[S].args[this.keyProperty]=S;return this.views=Array.isArray(this.args.value)?[...a]:a,this.viewCount=a.length,l.clear(),this.willReRender=!1,this.rendered.then(()=>{this.parent.dispatchEvent(new CustomEvent("listRendered",{detail:{detail:{key:this.subProperty,value:this.args.value,tag:this.tag}}})),this.tag.dispatchEvent(new CustomEvent("listRendered",{detail:{detail:{key:this.subProperty,value:this.args.value,tag:this.tag}}}))}),this.rendered}}pause(e=!0){for(var t in this.views)this.views[t].pause(e)}onRemove(e){this._onRemove.add(e)}remove(){for(var t in this.views)this.views[t]&&this.views[t].remove(!0);var r=this._onRemove.items();for(var i in r)this._onRemove.remove(r[i]),r[i]();for(;this.cleanup.length;)this.cleanup.pop()();for(this.views=[];this.tag&&this.tag.firstChild;)this.tag.removeChild(this.tag.firstChild);this.subArgs&&e.Bindable.clearBindings(this.subArgs),e.Bindable.clearBindings(this.args),this.removed=!0}}}()}),require.register("curvature/input/Keyboard.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Keyboard=void 0;var e=r("../base/Bindable");t.Keyboard=class{static get(){return this.instance=this.instance||e.Bindable.make(new this)}constructor(){this.maxDecay=120,this.comboTime=500,this.listening=!1,this.focusElement=document.body,this[e.Bindable.NoGetters]=!0,Object.defineProperty(this,"combo",{value:e.Bindable.make([])}),Object.defineProperty(this,"whichs",{value:e.Bindable.make({})}),Object.defineProperty(this,"codes",{value:e.Bindable.make({})}),Object.defineProperty(this,"keys",{value:e.Bindable.make({})}),Object.defineProperty(this,"pressedWhich",{value:e.Bindable.make({})}),Object.defineProperty(this,"pressedCode",{value:e.Bindable.make({})}),Object.defineProperty(this,"pressedKey",{value:e.Bindable.make({})}),Object.defineProperty(this,"releasedWhich",{value:e.Bindable.make({})}),Object.defineProperty(this,"releasedCode",{value:e.Bindable.make({})}),Object.defineProperty(this,"releasedKey",{value:e.Bindable.make({})}),Object.defineProperty(this,"keyRefs",{value:e.Bindable.make({})}),document.addEventListener("keyup",e=>{this.listening&&(this.keys[e.key]>0||!this.focusElement||document.activeElement===this.focusElement||this.focusElement.contains(document.activeElement)&&!document.activeElement.matches("input,textarea"))&&(e.preventDefault(),this.releasedWhich[e.which]=Date.now(),this.releasedCode[e.code]=Date.now(),this.releasedKey[e.key]=Date.now(),this.whichs[e.which]=-1,this.codes[e.code]=-1,this.keys[e.key]=-1)}),document.addEventListener("keydown",e=>{this.listening&&(!this.focusElement||document.activeElement===this.focusElement||this.focusElement.contains(document.activeElement)&&!document.activeElement.matches("input,textarea"))&&(e.preventDefault(),e.repeat||(this.combo.push(e.code),clearTimeout(this.comboTimer),this.comboTimer=setTimeout(()=>this.combo.splice(0),this.comboTime),this.pressedWhich[e.which]=Date.now(),this.pressedCode[e.code]=Date.now(),this.pressedKey[e.key]=Date.now(),this.keys[e.key]>0||(this.whichs[e.which]=1,this.codes[e.code]=1,this.keys[e.key]=1)))});var t=e=>{for(var t in this.keys)this.keys[t]<0||(this.releasedKey[t]=Date.now(),this.keys[t]=-1);for(var r in this.codes)this.codes[r]<0||(this.releasedCode[r]=Date.now(),this.codes[r]=-1);for(var i in this.whichs)this.whichs[i]<0||(this.releasedWhich[i]=Date.now(),this.whichs[i]=-1)};window.addEventListener("blur",t),window.addEventListener("visibilitychange",()=>{"visible"!==document.visibilityState&&t()})}getKeyRef(t){return this.keyRefs[t]=this.keyRefs[t]||e.Bindable.make({})}getKeyTime(e){var t=this.releasedKey[e],r=this.pressedKey[e];return r?!t||t<r?Date.now()-r:-1*(Date.now()-t):0}getCodeTime(e){var t=this.releasedCode[e],r=this.pressedCode[e];return r?!t||t<r?Date.now()-r:-1*(Date.now()-t):0}getWhichTime(e){var t=this.releasedWhich[e],r=this.pressedWhich[e];return r?!t||t<r?Date.now()-r:-1*(Date.now()-t):0}getKey(e){return this.keys[e]?this.keys[e]:0}getKeyCode(e){return this.codes[e]?this.codes[e]:0}reset(){for(var e in this.keys)delete this.keys[e];for(var e in this.codes)delete this.codes[e];for(var e in this.whichs)delete this.whichs[e]}update(){for(var e in this.keys)this.keys[e]>0?this.keys[e]++:this.keys[e]>-this.maxDecay?this.keys[e]--:delete this.keys[e];for(var e in this.codes){var t=this.releasedCode[e],r=this.pressedCode[e],i=this.getKeyRef(e);if(this.codes[e]>0){if(i.frames=this.codes[e]++,i.time=r?Date.now()-r:0,i.down=!0,!t||t<r)return;return-1*(Date.now()-t)}this.codes[e]>-this.maxDecay?(i.frames=this.codes[e]--,i.time=t-Date.now(),i.down=!1):(i.frames=0,i.time=0,i.down=!1,delete this.codes[e])}for(var e in this.whichs)this.whichs[e]>0?this.whichs[e]++:this.whichs[e]>-this.maxDecay?this.whichs[e]--:delete this.whichs[e]}}}()}),require.register("curvature/mixin/EventTargetMixin.js",function(t,r,i){r=e(r,{},"curvature"),function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventTargetMixin=void 0;var e=r("../base/Mixin"),i=Symbol("EventTargetParent"),n=Symbol("CallHandler"),o=Symbol("Capture"),s=Symbol("Bubble"),a=(Symbol("Target"),Symbol("HandlersBubble")),l=Symbol("HandlersCapture"),u=t.EventTargetMixin={[e.Mixin.Constructor](){this[l]=new Map,this[a]=new Map},dispatchEvent(...e){var t=e[0];"string"==typeof t&&(t=new CustomEvent(t),e[0]=t),t.cvPath=t.cvPath||[],t.cvTarget=t.cvCurrentTarget=this;var r=this[o](...e);if(t.cancelable&&(!1===r||t.cancelBubble))return r;var u=[];if(this[l].has(t.type)){var c=this[l].get(t.type),h=[...c];h.forEach(e=>e.push(c)),u.push(...h)}if(this[a].has(t.type)){var f=this[a].get(t.type),d=[...f];d.forEach(e=>e.push(f)),u.push(...d)}for(var[p,y,v]of(u.push([()=>this[n](...e),{},null]),u))if(y.once&&v.delete(p),r=p(t),t.cancelable&&!1===r)break;return t.cancelable&&(t.cancelBubble||!1===r)||this[s](...e),this[i]||Object.freeze(t.cvPath),t.returnValue},addEventListener(e,t,r={}){!0===r&&(r={useCapture:!0});var i=a;r.useCapture&&(i=l),this[i].has(e)||this[i].set(e,new Map),this[i].get(e).set(t,r),r.signal&&r.signal.addEventListener("abort",i=>this.removeEventListener(e,t,r),{once:!0})},removeEventListener(e,t,r={}){!0===r&&(r={useCapture:!0});var i=a;r.useCapture&&(i=l),this[i].has(e)&&this[i].get(e).delete(t)},[o](...e){var t=e[0];if(t.cvPath.push(this),this[i]){var r=this[i][o](...e);if((!t.cancelable||!1!==r&&!t.cancelBubble)&&this[i][l].has(t.type)){t.cvCurrentTarget=this[i];var{type:n}=t,s=this[i][l].get(n);for(var[a,u]of s)if(u.once&&s.delete(a),r=a(t),t.cancelable&&(!1===r||t.cancelBubble))break;return r}}},[s](...e){var t=e[0];if(t.bubbles&&this[i]&&!t.cancelBubble){if(!this[i][a].has(t.type))return this[i][s](...e);var r;t.cvCurrentTarget=this[i];var{type:o}=t,l=this[i][a].get(t.type);for(var[u,c]of l)if(c.once&&l.delete(u),r=u(t),t.cancelable&&!1===r)return r;return r=this[i][n](...e),t.cancelable&&(!1===r||t.cancelBubble)?r:this[i][s](...e)}},[n](...e){var t=e[0];if(!t.defaultPrevented){var r=`on${t.type[0].toUpperCase()+t.type.slice(1)}`;return"function"==typeof this[r]?this[r](t):void 0}}};Object.defineProperty(u,"Parent",{value:i})}()}),require.register("Config.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,o(i.key),i)}}function o(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Config=void 0,(e.Config=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)})).title="tigl"}),require.register("gl2d/Gl2d.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,l(i.key),i)}}function s(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e,t,r){return(t=l(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Gl2d=void 0;let u=function(){return s(function e(t){let r=t.gl,i=t.vertexShader,o=t.fragmentShader,s=t.uniforms,l=t.attributes;n(this,e),a(this,"context",null),a(this,"program",null),a(this,"attributes",{}),a(this,"buffers",{}),a(this,"uniforms",{}),this.context=r,this.program=r.createProgram(),r.attachShader(this.program,i),r.attachShader(this.program,o),r.linkProgram(this.program),r.detachShader(this.program,i),r.detachShader(this.program,o),r.deleteShader(i),r.deleteShader(o),r.getProgramParameter(this.program,r.LINK_STATUS)||(console.error(r.getProgramInfoLog(this.program)),r.deleteProgram(this.program));for(const e of s){const t=r.getUniformLocation(this.program,e);null!==t?this.uniforms[e]=t:console.warn(`Uniform ${e} not found.`)}for(const e of l){const t=r.getAttribLocation(this.program,e);if(null===t){console.warn(`Attribute ${e} not found.`);continue}const i=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,i),r.enableVertexAttribArray(t),r.vertexAttribPointer(t,2,r.FLOAT,!1,0,0),this.attributes[e]=t,this.buffers[e]=i}},[{key:"use",value:function(){this.context.useProgram(this.program)}},{key:"uniformF",value:function(e){const t=this.context;for(var r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];t[`uniform${i.length}f`](this.uniforms[e],...i)}},{key:"uniformI",value:function(e){const t=this.context;for(var r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];t[`uniform${i.length}i`](this.uniforms[e],...i)}}])}();e.Gl2d=function(){return s(function e(t){n(this,e),this.element=t||document.createElement("canvas"),this.context=this.element.getContext("webgl"),this.screenScale=1,this.zoomLevel=2},[{key:"createShader",value:function(e){let r=null;switch(e.substring(e.lastIndexOf(".")+1).toUpperCase()){case"VERT":r=this.context.VERTEX_SHADER;break;case"FRAG":r=this.context.FRAGMENT_SHADER}const i=this.context.createShader(r),n=t(e);if(this.context.shaderSource(i,n),this.context.compileShader(i),this.context.getShaderParameter(i,this.context.COMPILE_STATUS))return i;console.error(this.context.getShaderInfoLog(i)),this.context.deleteShader(i)}},{key:"createProgram",value:function(e){let t=e.vertexShader,r=e.fragmentShader,i=e.uniforms,n=e.attributes;const o=this.context;return new u({gl:o,vertexShader:t,fragmentShader:r,uniforms:i,attributes:n})}},{key:"createTexture",value:function(e,t){const r=this.context,i=r.createTexture();return r.bindTexture(r.TEXTURE_2D,i),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e,t,0,r.RGBA,r.UNSIGNED_BYTE,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),i}},{key:"createFramebuffer",value:function(e){const t=this.context,r=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),r}},{key:"enableBlending",value:function(){const e=this.context;e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.enable(e.BLEND)}}])}()}),require.register("home/View.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.View=void 0;var n=t("curvature/base/View"),o=t("curvature/input/Keyboard"),s=(t("Config"),t("../ui/Controller")),a=t("../sprite/Camera"),l=t("../session/Session");function u(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,c(i.key),i)}}function c(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}function h(e,t,r){return t=f(t),function(e,t){if(t&&("object"==i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,r||[],f(e).constructor):t.apply(e,r))}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}const p={};p.onScreenJoyPad=new s.Controller,p.keyboard=o.Keyboard.get();e.View=function(e){function r(e){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),window.smProfiling=!0,(i=h(this,r,[e])).template=t("./view.tmp"),i.routes=[],i.keyboard=p.keyboard,i.speed=24,i.maxSpeed=i.speed,i.args.controller=p.onScreenJoyPad,i.args.fps=0,i.args.sps=0,i.args.camX=0,i.args.camY=0,i.args.showEditor=!1,i.keyboard.listening=!0,i.keyboard.keys.bindTo("Home",(e,t,r,n)=>{!i.session||e<0||e%5==0&&(i.session.frameLock++,i.args.frameLock=i.session.frameLock)}),i.keyboard.keys.bindTo("End",(e,t,r,n)=>{!i.session||e<0||e%5==0&&(i.session.frameLock--,i.session.frameLock<0&&(i.session.frameLock=0),i.args.frameLock=i.session.frameLock)}),i.keyboard.keys.bindTo("PageUp",(e,t,r,n)=>{!i.session||e<0||(e%5==0&&i.session.simulationLock++,i.args.simulationLock=i.session.simulationLock)}),i.keyboard.keys.bindTo("PageDown",(e,t,r,n)=>{!i.session||e<0||(e%5==0&&(i.session.simulationLock--,i.session.simulationLock<0&&(i.session.simulationLock=0)),i.args.simulationLock=i.session.simulationLock)}),i.keyboard.keys.bindTo("=",(e,t,r,n)=>{e>0&&i.zoom(1)}),i.keyboard.keys.bindTo("+",(e,t,r,n)=>{e>0&&i.zoom(1)}),i.keyboard.keys.bindTo("-",(e,t,r,n)=>{e>0&&i.zoom(-1)}),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&d(e,t)}(r,n.View),i=r,(o=[{key:"onRendered",value:function(){this.session=new l.Session({onScreenJoyPad:this.args.controller,keyboard:this.keyboard,element:this.tags.canvas.element,world:"world.json"}),this.args.frameLock=this.session.frameLock,this.args.simulationLock=this.session.simulationLock,window.addEventListener("resize",()=>this.resize());let e=0,t=0;const r=e=>{document.hidden||this.session.simulate(e)&&(this.args.sps=(1e3/(e-t)).toFixed(3),t=e)},i=t=>{document.hidden?window.requestAnimationFrame(i):(window.requestAnimationFrame(i),this.session.draw(t)&&(this.args.fps=(1e3/(t-e)).toFixed(3),this.args.camX=Number(a.Camera.x).toFixed(3),this.args.camY=Number(a.Camera.y).toFixed(3),e=t,this.session.spriteBoard.following&&(this.args.posX=Number(this.session.spriteBoard.following.sprite.x).toFixed(3),this.args.posY=Number(this.session.spriteBoard.following.sprite.y).toFixed(3))))};this.session.spriteBoard.gl2d.zoomLevel=document.body.clientHeight/1280*4,this.resize(),setInterval(()=>r(performance.now()),0),i(performance.now())}},{key:"resize",value:function(e,t){this.args.width=this.tags.canvas.element.width=e||document.body.clientWidth,this.args.height=this.tags.canvas.element.height=t||document.body.clientHeight,this.args.rwidth=Math.trunc((e||document.body.clientWidth)/this.session.spriteBoard.gl2d.zoomLevel),this.args.rheight=Math.trunc((t||document.body.clientHeight)/this.session.spriteBoard.gl2d.zoomLevel);const r=this.session.spriteBoard.gl2d.screenScale;this.session.spriteBoard.gl2d.screenScale=document.body.clientHeight/1280,this.session.spriteBoard.gl2d.zoomLevel*=this.session.spriteBoard.gl2d.screenScale/r,this.session.spriteBoard.resize()}},{key:"scroll",value:function(e){let t=e.deltaY>0?-1:e.deltaY<0?1:0;this.zoom(t)}},{key:"zoom",value:function(e){if(!this.session)return;const t=32*this.session.spriteBoard.gl2d.screenScale,r=.2*this.session.spriteBoard.gl2d.screenScale;let i=(e*(.05*this.session.spriteBoard.gl2d.zoomLevel)+this.session.spriteBoard.gl2d.zoomLevel).toFixed(2);i<r?i=r:i>t&&(i=t),Math.abs(i-1)<.05&&(i=1),this.session.spriteBoard.gl2d.zoomLevel!==i&&(this.session.spriteBoard.gl2d.zoomLevel=i,this.resize())}}])&&u(i.prototype,o),s&&u(i,s),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,s}()}),require.register("home/view.tmp.html",function(e,t,r){r.exports='<canvas\n\tcv-ref = "canvas:curvature/base/Tag"\n\tcv-on  = "wheel:scroll(event);"\n></canvas>\n\n<div class = "hud fps">[[sps]] simulations/s / [[simulationLock]]\n[[fps]] frames/s      / [[frameLock]]\n\nRes [[rwidth]] x [[rheight]]\n    [[width]] x [[height]]\n\nCam [[camX]] x [[camY]]\nPos [[posX]] x [[posY]]\n\n Sim:   Pg Up / Dn\n Frame: Home / End\n Scale: + / -\n</div>\n<div class = "reticle"></div>\n\n[[controller]]\n'}),require.register("initialize.js",function(e,t,r){"use strict";var i=t("curvature/base/Router"),n=t("home/View");void 0!==Proxy&&document.addEventListener("DOMContentLoaded",()=>{const e=new n.View;i.Router.listen(e),e.render(document.body)})}),require.register("inject/Container.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.Container=void 0;var n=t("./Injectable");function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,s(i.key),i)}}function s(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}function a(e,t,r){return t=l(t),function(e,t){if(t&&("object"==i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,r||[],l(e).constructor):t.apply(e,r))}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}e.Container=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a(this,t,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(t,n.Injectable),r=t,(i=[{key:"inject",value:function(e){return new this.constructor(Object.assign({},this,e))}}])&&o(r.prototype,i),s&&o(r,s),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,i,s}()}),require.register("inject/Injectable.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t,r){return t=o(t),function(e,t){if(t&&("object"==i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,r||[],o(e).constructor):t.apply(e,r))}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,c(i.key),i)}}function u(e,t,r){return t&&l(e.prototype,t),r&&l(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function c(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Injectable=void 0;let h={},f={};e.Injectable=function(){function e(){a(this,e);let t=this.constructor.injections(),r=this.constructor.context();h[r]||(h[r]={}),f[r]||(f[r]={});for(let e in t){let i=t[e];!h[r][e]&&i.prototype&&(/[A-Z]/.test(String(e)[0])&&(h[r][e]=i))}for(let e in t){let i=void 0,n=h[r][e]||t[e];/[A-Z]/.test(String(e)[0])?(n.prototype?f[r][e]||(f[r][e]=new n):f[r][e]=n,i=f[r][e]):i=n.prototype?new n:n,Object.defineProperty(this,e,{enumerable:!1,writable:!1,value:i})}}return u(e,null,[{key:"injections",value:function(){return{}}},{key:"context",value:function(){return"."}},{key:"inject",value:function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".";if(!(this.prototype instanceof e||this===e))throw new Error("Cannot access injectable subclass!\n\nAre you trying to instantiate like this?\n\n\tnew X.inject({...});\n\nIf so please try:\n\n\tnew (X.inject({...}));\n\nPlease note the parenthesis.\n");let i=this.injections();return function(e){function o(){return a(this,o),n(this,o,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&s(e,t)}(o,e),u(o,null,[{key:"injections",value:function(){return Object.assign({},i,t)}},{key:"context",value:function(){return r}}])}(this)}}])}()}),require.register("inject/Single.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,o(i.key),i)}}function o(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.single=e.Single=void 0;let s=e.Single=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name="sss."+Math.random()});e.single=new s}),require.register("math/Geometry.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,o(i.key),i)}}function o(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Geometry=void 0;e.Geometry=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},r=[{key:"lineIntersectsLine",value:function(e,t,r,i,n,o,s,a){const l=r-e,u=i-t,c=s-n,h=a-o,f=l*h-u*c;if(0===f)return!1;const d=n-e,p=o-t,y=(d*u-p*l)/f;if(y<0||y>1)return!1;const v=(d*h-p*c)/f;return!(v<0||v>1)&&[e+v*l,t+v*u]}}],(t=null)&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}()}),require.register("math/Matrix.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,o(i.key),i)}}function o(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Matrix=void 0;e.Matrix=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},r=[{key:"identity",value:function(){return[[1,0,0],[0,1,0],[0,0,1]]}},{key:"translate",value:function(e,t){return[[1,0,e],[0,1,t],[0,0,1]]}},{key:"scale",value:function(e,t){return[[e,0,0],[0,t,0],[0,0,1]]}},{key:"rotate",value:function(e){const t=Math.sin(e),r=Math.cos(e);return[[r,-t,0],[t,r,0],[0,0,1]]}},{key:"shearX",value:function(e){return[[1,e,0],[0,1,0],[0,0,1]]}},{key:"shearY",value:function(e){return[[1,0,0],[e,1,0],[0,0,1]]}},{key:"multiply",value:function(e,t){if(e.length!==t.length)throw new Error("Invalid matrices");if(e[0].length!==t.length)throw new Error("Incompatible matrices");const r=Array(e.length).fill().map(()=>Array(t[0].length).fill(0));for(let i=0;i<e.length;i++)for(let n=0;n<t[0].length;n++)for(let o=0;o<e[0].length;o++)r[i][n]+=e[i][o]*t[o][n];return r}},{key:"composite",value:function(){let e=this.identity();for(let t=0;t<arguments.length;t++)e=this.multiply(e,t<0||arguments.length<=t?void 0:arguments[t]);return e}},{key:"transform",value:function(e,t){const r=[];for(let i=0;i<e.length;i+=2){const n=[e[i],e[i+1],1];for(const e of t)r.push(n[0]*e[0]+n[1]*e[1]+n[2]*e[2])}return new Float32Array(r.filter((e,t)=>(1+t)%3))}}],(t=null)&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}()}),require.register("math/Quadtree.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.Quadtree=void 0;var n=t("curvature/base/Bindable"),o=t("./Rectangle");function s(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,a(i.key),i)}}function a(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}function l(e,t,r){return t=u(t),function(e,t){if(t&&("object"==i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,r||[],u(e).constructor):t.apply(e,r))}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}e.Quadtree=function(e){function t(e,r,i,o){var s;let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(s=l(this,t,[e,r,i,o]))[n.Bindable.Prevent]=!0,s.items=new Set,s.split=!1,s.minSize=a||10,s.backMap=u?u.backMap:new Map,s.parent=u,s.ulCell=null,s.urCell=null,s.blCell=null,s.brCell=null,s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}(t,o.Rectangle),r=t,(i=[{key:"add",value:function(e){if(!this.contains(e.x,e.y))return!1;const r=this.x2-this.x1,i=this.y2-this.y1;if(this.split)return this.ulCell.add(e)||this.urCell.add(e)||this.blCell.add(e)||this.brCell.add(e);if(this.items.size&&r>this.minSize&&i>this.minSize){this.split=!0;const n=.5*r,o=.5*i;this.ulCell=new t(this.x1,this.y1,this.x1+n,this.y1+o,this.minSize,this),this.blCell=new t(this.x1,this.y1+o,this.x1+n,this.y2,this.minSize,this),this.urCell=new t(this.x1+n,this.y1,this.x2,this.y1+o,this.minSize,this),this.brCell=new t(this.x1+n,this.y1+o,this.x2,this.y2,this.minSize,this);for(const e of this.items)this.items.delete(e),this.ulCell.add(e)||this.urCell.add(e)||this.blCell.add(e)||this.brCell.add(e);return this.ulCell.add(e)||this.urCell.add(e)||this.blCell.add(e)||this.brCell.add(e)}return this.backMap.set(e,this),this.items.add(e),!0}},{key:"move",value:function(e){if(!this.backMap.has(e))return void this.add(e);const t=this.backMap.get(e);let r=t;for(;r&&!r.contains(e.x,e.y);)r=r.parent;r?r!==t&&(t.delete(e),r.add(e)):t.delete(e)}},{key:"delete",value:function(e){if(!this.backMap.has(e))return console.warn("Entity not in Quadtree."),!1;const t=this.backMap.get(e);return t.items.delete(e),t.parent&&t.parent.prune(),this.backMap.delete(e),!0}},{key:"isPrunable",value:function(){return this.split?this.ulCell.isPrunable()&&this.urCell.isPrunable()&&this.blCell.isPrunable()&&this.brCell.isPrunable():0===this.items.size}},{key:"prune",value:function(){this.isPrunable()&&(this.split=!1,this.ulCell=null,this.urCell=null,this.blCell=null,this.brCell=null)}},{key:"findLeaf",value:function(e,t){var r,i,n;return this.contains(e,t)?this.split?null!==(r=null!==(i=null!==(n=this.ulCell.findLeaf(e,t))&&void 0!==n?n:this.urCell.findLeaf(e,t))&&void 0!==i?i:this.blCell.findLeaf(e,t))&&void 0!==r?r:this.brCell.findLeaf(e,t):this:null}},{key:"has",value:function(e){return this.split?this.ulCell.has(e)||this.urCell.has(e)||this.blCell.has(e)||this.brCell.has(e):this.items.has(e)}},{key:"select",value:function(e,t,r,i){const n=t+i;return e+r<this.x1||e>this.x2?new Set:n<this.y1||t>this.y2?new Set:this.split?new Set([...this.ulCell.select(e,t,r,i),...this.urCell.select(e,t,r,i),...this.blCell.select(e,t,r,i),...this.brCell.select(e,t,r,i)]):this.items}},{key:"dump",value:function(){return this.split?new Set([...this.ulCell.dump(),...this.urCell.dump(),...this.blCell.dump(),...this.brCell.dump()]):this.items}}])&&s(r.prototype,i),a&&s(r,a),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,i,a}()}),require.register("math/QuickTree.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.QuickTree=void 0;var n=t("./Quadtree"),o=t("./Rectangle");function s(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,a(i.key),i)}}function a(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}function l(e,t,r){return t=h(t),function(e,t){if(t&&("object"==i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,r||[],h(e).constructor):t.apply(e,r))}function u(e,t,r,i){var n=c(h(1&i?e.prototype:e),t,r);return 2&i&&"function"==typeof n?function(e){return n.apply(r,e)}:n}function c(){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var i=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(arguments.length<3?e:r):n.value}}).apply(null,arguments)}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}const d=new WeakMap;e.QuickTree=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),l(this,t,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&f(e,t)}(t,n.Quadtree),r=t,a=[{key:"deleteFromAllTrees",value:function(e){d.has(e)&&d.get(e).forEach(t=>t.delete(e))}}],(i=[{key:"add",value:function(e){u(t,"add",this,3)([e])&&(d.has(e)||d.set(e,new Set),d.get(e).add(this))}},{key:"delete",value:function(e){u(t,"delete",this,3)([e])&&d.has(e)&&d.get(e).delete(this)}},{key:"select",value:function(e,r,i,n){const s=new o.Rectangle(e,r,e+i,r+n),a=u(t,"select",this,3)([e,r,i,n]);for(const e of a)s.contains(e.x,e.y)||a.delete(e);return a}}])&&s(r.prototype,i),a&&s(r,a),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,i,a}()}),require.register("math/Ray.js",function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Ray=void 0;var i=t("./Geometry");function n(e){"@babel/helpers - typeof";return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,a(i.key),i)}}function s(e,t,r){return(t=a(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}let l=e.Ray=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},r=[{key:"cast",value:function(e,t,r,i,n){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:320,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:this.DEFAULT_FLAGS;Math.cos(n),Math.sin(n);return{terrain:this.castTerrain(e,t,r,i,n,o,s),entities:null}}},{key:"castEntity",value:function(e,t,r,n,o){arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.DEFAULT_FLAGS;const s=.5*(t+n),a=.5*(r+o),l=Math.max(320,Math.abs(t-n)),u=Math.max(320,Math.abs(r-o)),c=e.getEntitiesForRect(s,a,l,u),h=new Map;for(const e of c){const s=e.rect.toLines();for(let a=0;a<s.length;a+=4){const l=s[a+0],u=s[a+1],c=s[a+2],f=s[a+3],d=i.Geometry.lineIntersectsLine(l,u,c,f,t,r,n,o);if(d)if(h.has(e)){const i=h.get(e);Math.hypot(t-d[0],r-d[1])<Math.hypot(t-i[0],r-i[1])&&h.set(e,d)}else h.set(e,d)}}return h}},{key:"castTerrain",value:function(e,t,r,i,n){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:320,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:this.DEFAULT_FLAGS;o=Math.ceil(o);const a=Math.cos(n),l=Math.sin(n),u=t+(Math.abs(a)>Number.EPSILON?a:0)*o,c=r+(Math.abs(l)>Number.EPSILON?l:0)*o,h=u-t,f=c-r,d=Math.sign(h),p=Math.sign(f),y=h?Math.hypot(1,f/h):0,v=f?Math.hypot(1,h/f):0;let m=0;if(e.getSolid(t,r,i))return[t,r];const b=null===e.getCollisionTile(t,r,i)?0:1;let g=b,w=b,T=!1,x=!1,S=1;let _=b?0:d>0?32-t%32:t%32+1,E=b?0:p>0?32-r%32:r%32+1,P=_*y*d,j=E*v*p;const O=new Set,C=new Set;window.logPoints&&console.time("rayCast");for(;Math.abs(m)<o&&!O.size&&!C.size;){if(d&&(!p||Math.abs(P)<Math.abs(j))){const n=Math.abs(P);let o=t+n*a,s=r+n*l;if(d>=0&&o%1>.99999&&(o=Math.round(o)),p>=0&&s%1>.99999&&(s=Math.round(s)),d<=0&&o%1<1e-5&&(o=Math.round(o)),p<=0&&s%1<1e-5&&(s=Math.round(s)),T=g,S=(g=e.getCollisionTile(o,s,i))?1:32,!g&&T&&(S=d<0?(t+-_+1)%32:32-(t+_)%32),e.getSolid(o,s,i)){O.add([o,s]);break}m=Math.abs(P),P=(_+=S)*y*d}else{const n=Math.abs(j);let o=t+n*a,s=r+n*l;if(d>=0&&o%1>.99999&&(o=Math.round(o)),p>=0&&s%1>.99999&&(s=Math.round(s)),d<=0&&o%1<1e-5&&(o=Math.round(o)),p<=0&&s%1<1e-5&&(s=Math.round(s)),x=w,S=(w=e.getCollisionTile(o,s,i))?1:32,!w&&x&&(S=p<0?(r+-E+1)%32:32-(r+E)%32),e.getSolid(o,s,i)){C.add([o,s]);break}m=Math.abs(j),j=(E+=S)*v*p}0}const R=[...O,...C];if(s&this.ALL_POINTS)return new O.union(C);const k=R.map(e=>Math.pow(e[0]-t,2)+Math.pow(e[1]-r,2)),M=Math.min(...k),B=R[k.indexOf(M)];return B&&(d>0&&B[0]%1>.99999&&(B[0]=Math.round(B[0])),d<0&&B[0]%1<1e-5&&(B[0]=Math.round(B[0])),p>0&&B[1]%1>.99999&&(B[1]=Math.round(B[1])),p<0&&B[1]%1<1e-5&&(B[1]=Math.round(B[1]))),Math.sqrt(M)>o?void 0:s&this.T_LAST_EMPTY?[B[0]+-a*Math.sign(P),B[1]+-l*Math.sign(j)]:B}}],(t=null)&&o(e.prototype,t),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}();s(l,"T_LAST_EMPTY",1),s(l,"T_ALL_POINTS",2),s(l,"E_ALL_ENTITIES",256),s(l,"DEFAULT_FLAGS",0)}),require.register("math/Rectangle.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,o(i.key),i)}}function o(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Rectangle=void 0;e.Rectangle=function(){return e=function e(t,r,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x1=t,this.y1=r,this.x2=i,this.y2=n},(t=[{key:"contains",value:function(e,t){return!(e<this.x1||e>this.x2)&&!(t<this.y1||t>this.y2)}},{key:"isOverlapping",value:function(e){return!(this.x1>=e.x2||this.x2<=e.x1)&&!(this.y1>=e.y2||this.y2<=e.y1)}},{key:"isFlushWith",value:function(e){return!(this.x1>e.x2||e.x1>this.x2)&&(!(this.y1>e.y2||e.y1>this.y2)&&(this.x1===e.x2||e.x1===this.x2||(this.y1===e.y2||e.y1===this.y2||void 0)))}},{key:"intersection",value:function(e){if(this.isOverlapping(e))return new this.constructor(Math.max(this.x1,e.x1),Math.max(this.y1,e.y1),Math.min(this.x2,e.x2),Math.min(this.y2,e.y2))}},{key:"isInside",value:function(e){return this.x1>=e.x1&&this.y1>=e.y1&&this.x2<=e.x2&&this.y2<=e.y2}},{key:"isOutside",value:function(e){return e.isInside(this)}},{key:"toLines",value:function(){return[this.x1,this.y1,this.x2,this.y1,this.x2,this.y1,this.x2,this.y2,this.x1,this.y2,this.x2,this.y2,this.x1,this.y1,this.x1,this.y2]}},{key:"toTriangles",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;return 2===e?[this.x1,this.y1,this.x2,this.y1,this.x1,this.y2,this.x1,this.y2,this.x2,this.y1,this.x2,this.y2]:3===e?[this.x1,this.y1,1,this.x2,this.y1,1,this.x1,this.y2,1,this.x1,this.y2,1,this.x2,this.y1,1,this.x2,this.y2,1]:4===e?[this.x1,this.y1,0,1,this.x2,this.y1,0,1,this.x1,this.y2,0,1,this.x1,this.y2,0,1,this.x2,this.y1,0,1,this.x2,this.y2,0,1]:[this.x1,this.y1,...e>2?Array(-2+e).fill(0):[],this.x2,this.y1,...e>2?Array(-2+e).fill(0):[],this.x1,this.y2,...e>2?Array(-2+e).fill(0):[],this.x1,this.y2,...e>2?Array(-2+e).fill(0):[],this.x2,this.y1,...e>2?Array(-2+e).fill(0):[],this.x2,this.y2,...e>2?Array(-2+e).fill(0):[]]}}])&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}()}),require.register("math/SMTree.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t,r){return(t=l(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,l(i.key),i)}}function a(e,t,r){return t&&s(e.prototype,t),r&&s(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function l(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.SMTree=void 0;const u=Symbol("depth");let c=function(){function e(t,r,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;o(this,e),this.start=t,this.end=r,this.depth=a,this.dimension=s,this.size=0,this.rectangles=new Set,this.subTree=a<1?new f(n({dimension:s},u,1+a)):null,this.prev=i}return a(e,[{key:"split",value:function(t){if(t<this.start||t>this.end)throw new RangeError("Splitting segment out of bounds!");if(t===this.start)return[this];if(t===this.end)return[this];const r=new e(this.start,t,this.prev,this.dimension,this.depth),i=new e(t,this.end,r,this.dimension,this.depth);for(const e of this.rectangles){const n=0===this.depth?e.x1:e.y1;(0===this.depth?e.x2:e.y2)<t?r.add(e):n>t?i.add(e):(r.add(e),i.add(e))}return[r,i]}},{key:"add",value:function(e){Object.freeze(e),this.subTree&&this.subTree.add(e),this.rectangles.add(e),this.size=this.rectangles.size}},{key:"delete",value:function(e){return this.subTree&&this.subTree.delete(e),this.rectangles.delete(e),this.size=this.rectangles.size,!this.rectangles.size&&this.start>-1/0}}])}();const h=e=>"x1"in e&&"y1"in e&&"x2"in e&&"y2"in e&&e.x1<e.x2&&e.y1<e.y2;let f=e.SMTree=function(){return a(function e(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n({dimension:2},u,0);o(this,e),this.depth=t[u],this.dimension=t.dimension,this.segments=[new c(-1/0,1/0,null,this.dimension,this.depth)]},[{key:"add",value:function(e){if(!h(e))throw new Error("Object supplied is not a Rectangle. Must have properties: x1, y1, x2, y2.");const t=0===this.depth?e.x1:e.y1,r=0===this.depth?e.x2:e.y2,i=this.findSegment(t);this.splitSegment(i,t);const n=this.findSegment(r);if(this.splitSegment(n,r),i!==n)for(let t=1+i;t<=n;t++)this.segments[t].add(e);else this.segments[i].add(e)}},{key:"delete",value:function(e){if(!h(e))throw new Error("Object supplied is not a Rectangle. Must have properties: x1, y1, x2, y2.");const t=0===this.depth?e.x1:e.y1,r=0===this.depth?e.x2:e.y2,i=this.findSegment(t),n=this.findSegment(r),o=[];for(let t=i;t<=n;t++)t>0&&this.segments[t].delete(e)&&o.push(t);for(let e=-1+o.length;e>=0;e--){const t=o[e];if(!this.segments[-1+t])throw new Error("Cannot delete segment without predecessor.");this.segments[-1+t].end=this.segments[t].end,this.segments[1+t].prev=this.segments[-1+t],this.segments.splice(t,1)}2===this.segments.length&&0==this.segments[0].size&&0===this.segments[1].size&&(this.segments[0].end=this.segments[1].end,this.segments.length=1)}},{key:"query",value:function(e,t,r,i){const n=new Set,o=this.findSegment(e),s=this.findSegment(r);for(let e=o;e<=s;e++){const r=this.segments[e];if(!r.subTree)continue;const o=r.subTree.findSegment(t),s=r.subTree.findSegment(i);for(let e=o;e<=s;e++)for(const t of r.subTree.segments[e].rectangles)n.add(t)}return n}},{key:"splitSegment",value:function(e,t){if(t<=this.segments[e].start||t>=this.segments[e].end)return;const r=this.segments[e].split(t);this.segments.splice(e,1,...r)}},{key:"findSegment",value:function(e){let t=0,r=-1+this.segments.length;do{const i=Math.floor(.5*(t+r)),n=this.segments[i];if(n.start<e&&n.end>=e)return i;n.start<e&&(t=1+i),n.end>e&&(r=-1+i)}while(t<=r);return-1}}])}()}),require.register("math/Split.js",function(e,t,r){"use strict";var i;function n(e){"@babel/helpers - typeof";return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,a(i.key),i)}}function s(e,t,r){return(t=a(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Split=void 0;let l=e.Split=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},r=[{key:"intToBytes",value:function(e){return this.value[0]=e,[...this.bytes]}},{key:"bytesToInt",value:function(e){return this.bytes[0]=e[0],this.bytes[1]=e[1],this.bytes[2]=e[2],this.bytes[3]=e[3],this.value[0]}},{key:"bytesToInt3",value:function(e){return this.bytes[0]=e[0],this.bytes[1]=e[1],this.bytes[2]=e[2],this.bytes[3]=0,this.value[0]}}],(t=null)&&o(e.prototype,t),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}();i=l,s(l,"bytes",new Uint8ClampedArray(4)),s(l,"words",new Uint16Array(i.bytes.buffer)),s(l,"value",new Uint32Array(i.bytes.buffer))}),require.register("model/Controller.js",function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Controller=void 0;var i=t("curvature/base/Bindable");function n(e){"@babel/helpers - typeof";return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,a(i.key),i)}}function s(e,t,r){return(t=a(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}e.Controller=function(){return e=function e(t){let r=t.keyboard,n=t.onScreenJoyPad;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s(this,"triggers",i.Bindable.makeBindable({})),s(this,"axis",i.Bindable.makeBindable({})),r.keys.bindTo((e,t,r,i)=>{e>0?this.keyPress(t,e,r[t]):-1!==e||this.keyRelease(t,e,r[t])}),n.args.bindTo("x",e=>{this.axis[0]=e/50}),n.args.bindTo("y",e=>{this.axis[1]=e/50})},(t=[{key:"keyPress",value:function(e,t,r){if(/^[0-9]$/.test(e))this.triggers[e]=!0;else switch(e){case"ArrowRight":this.axis[0]=1;break;case"ArrowDown":this.axis[1]=1;break;case"ArrowLeft":this.axis[0]=-1;break;case"ArrowUp":this.axis[1]=-1;break;case" ":this.triggers[0]=!0}}},{key:"keyRelease",value:function(e,t,r){if(/^[0-9]$/.test(e))this.triggers[e]=!1;else switch(e){case"ArrowRight":this.axis[0]>0&&(this.axis[0]=0),this.axis[0]=0;case"ArrowLeft":this.axis[0]<0&&(this.axis[0]=0);break;case"ArrowDown":this.axis[1]>0&&(this.axis[1]=0);case"ArrowUp":this.axis[1]<0&&(this.axis[1]=0);break;case" ":this.triggers[0]=!1}}}])&&o(e.prototype,t),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}()}),require.register("model/Entity.js",function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Entity=void 0;var i=t("curvature/base/Bindable"),n=t("../math/Rectangle");function o(e){"@babel/helpers - typeof";return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,a(i.key),i)}}function a(e){var t=function(e,t){if("object"!=o(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=o(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==o(t)?t:t+""}e.Entity=function(){return e=function e(t){let r=t.session,o=t.controller,s=t.sprite,a=t.x,l=void 0===a?0:a,u=t.y,c=void 0===u?0:u,h=t.width,f=void 0===h?32:h,d=t.height,p=void 0===d?32:d;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this[i.Bindable.Prevent]=!0,this.controller=o,this.sprite=s,this.session=r,this.x=l,this.y=c,this.xSpriteOffset=0,this.ySpriteOffset=0,this.width=f,this.height=p,this.rect=new n.Rectangle(l-.5*f,c-p,l+.5*f,c)},(t=[{key:"create",value:function(){}},{key:"simulate",value:function(){this.rect.x1=this.x-.5*this.width,this.rect.x2=this.x+.5*this.width,this.rect.y1=this.y-this.height,this.rect.y2=this.y,this.sprite.x=this.x+this.xSpriteOffset,this.sprite.y=this.y+this.ySpriteOffset}},{key:"destroy",value:function(){}},{key:"fixFPE",value:function(){this.x%1>.99999&&(this.x=Math.round(this.x)),this.y%1>.99999&&(this.y=Math.round(this.y)),this.x%1<1e-5&&(this.x=Math.round(this.x)),this.y%1<1e-5&&(this.y=Math.round(this.y))}}])&&s(e.prototype,t),r&&s(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}()}),require.register("model/Player.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.Player=void 0;var n=t("../math/Ray"),o=t("./Entity");function s(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,a(i.key),i)}}function a(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}function l(e,t,r){return t=c(t),function(e,t){if(t&&("object"==i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,r||[],c(e).constructor):t.apply(e,r))}function u(){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var i=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=c(e)););return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(arguments.length<3?e:r):n.value}}).apply(null,arguments)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}e.Player=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=l(this,t,[e])).direction="south",r.state="standing",r.xSpeed=0,r.ySpeed=0,r.grounded=!0,r.xDirection=0,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(t,o.Entity),r=t,(i=[{key:"simulate",value:function(){var e,r,i,o,s;(e=t,r="simulate",i=this,s=u(c(1&(o=3)?e.prototype:e),r,i),2&o&&"function"==typeof s?function(e){return s.apply(i,e)}:s)([]),"jumping"===this.state?this.height=24:this.height=48;const a=Math.min(1,Math.max(this.controller.axis[0]||0,-1))||0,l=Math.min(1,Math.max(this.controller.axis[1]||0,-1))||0,h=this.session.world;for(h.getSolid(this.x,this.y+1)?(this.ySpeed=Math.min(0,this.ySpeed),this.grounded=!0):(this.ySpeed=Math.min(8,this.ySpeed+.5),this.grounded=!1),a?(this.xDirection=Math.sign(a),h.getSolid(this.x+Math.sign(a)*this.width*.5+Math.sign(a),this.y)||(this.xSpeed+=a*(this.grounded?.2:.4)),Math.abs(this.xSpeed)>8&&(this.xSpeed=8*Math.sign(this.xSpeed)),this.grounded&&a&&Math.sign(a)!==Math.sign(this.xSpeed)&&(this.xSpeed*=.75)):this.grounded?this.xSpeed*=.9:this.xSpeed*=.999,h.getSolid(this.x,this.y)&&!h.getSolid(this.x,this.y+-this.height)&&(this.ySpeed=0,this.y--);h.getSolid(this.x,this.y+-this.height)&&!h.getSolid(this.x,this.y);)this.ySpeed=0,this.y++;for(;h.getSolid(this.x+.5*-this.width,this.y+-8)&&!h.getSolid(this.x+.5*this.width,this.y+-8);)this.xSpeed=0,this.x++;for(;h.getSolid(this.x+.5*this.width,this.y+-8)&&!h.getSolid(this.x-.5*this.width,this.y+-8);)this.xSpeed=0,this.x--;if(this.xSpeed||this.ySpeed){const e=Math.atan2(this.ySpeed,this.xSpeed),t=Math.hypot(this.ySpeed,this.xSpeed),r=n.Ray.cast(h,this.x,this.y,0,e,t,n.Ray.T_LAST_EMPTY);let i=this.xSpeed,o=this.ySpeed;if(r.terrain){const t=Math.hypot(this.x-r.terrain[0],this.y-r.terrain[1]);i=Math.cos(e)*t,o=Math.sin(e)*t}this.x+=i,this.y+=o,this.fixFPE()}let f=!1;Math.abs(a)>Math.abs(l)&&(f=!0),f?(this.direction="west",a>0&&(this.direction="east"),this.grounded&&(this.state="walking")):this.grounded&&(this.state="standing"),this.sprite.changeAnimation(`${this.state}-${this.direction}`);for(let e in this.controller.triggers)if(this.controller.triggers[e]){if(this.sprite.spriteBoard.renderMode=e,"0"===e&&this.grounded&&(this.state="jumping",this.ySpeed=-10),"8"===e&&console.log(n.Ray.castEntity(h,this.x,this.y+-16,this.x+200*this.xDirection,this.y+-16,0)),"9"===e){this.sprite.spriteBoard.world.getMapsForPoint(this.sprite.x,this.sprite.y).forEach(e=>console.log(e.src))}"jumping"===this.state&&"south"===this.direction&&(this.direction="east")}}}])&&s(r.prototype,i),a&&s(r,a),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,i,a}()}),require.register("model/Pushable.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.Pushable=void 0;var n=t("../math/Ray"),o=t("./Entity");function s(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,a(i.key),i)}}function a(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}function l(e,t,r){return t=c(t),function(e,t){if(t&&("object"==i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,r||[],c(e).constructor):t.apply(e,r))}function u(){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var i=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=c(e)););return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(arguments.length<3?e:r):n.value}}).apply(null,arguments)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}e.Pushable=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=l(this,t,[e])).xSpeed=0,r.ySpeed=0,r.height=48,r.width=32,r.grounded=!0,r.ySpriteOffset=6,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(t,o.Entity),r=t,(i=[{key:"simulate",value:function(){var e,r,i,o,s;(e=t,r="simulate",i=this,s=u(c(1&(o=3)?e.prototype:e),r,i),2&o&&"function"==typeof s?function(e){return s.apply(i,e)}:s)([]);const a=this.session.world;for(a.getSolid(this.x,this.y+1)?(this.ySpeed=Math.min(0,this.ySpeed),this.grounded=!0):(this.ySpeed=Math.min(8,this.ySpeed+.5),this.grounded=!1),a.getSolid(this.x,this.y)&&!a.getSolid(this.x,this.y-1)&&(this.ySpeed=0,this.y--);a.getSolid(this.x,this.y+-this.height)&&!a.getSolid(this.x,this.y);)this.ySpeed=0,this.y++;for(;a.getSolid(this.x+.5*-this.width,this.y+-8)&&!a.getSolid(this.x+.5*this.width,this.y+-8);)this.xSpeed=0,this.x++;for(;a.getSolid(this.x+.5*this.width,this.y+-8)&&!a.getSolid(this.x-.5*this.width,this.y+-8);)this.xSpeed=0,this.x--;if(this.xSpeed||this.ySpeed){const e=Math.atan2(this.ySpeed,this.xSpeed),t=Math.hypot(this.ySpeed,this.xSpeed),r=n.Ray.cast(a,this.x,this.y,0,e,t,n.Ray.T_LAST_EMPTY);let i=this.xSpeed,o=this.ySpeed;if(r.terrain){const t=Math.hypot(this.x-r.terrain[0],this.y-r.terrain[1]);i=Math.cos(e)*t,o=Math.sin(e)*t}this.x+=i,this.y+=o,this.fixFPE()}}}])&&s(r.prototype,i),a&&s(r,a),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,i,a}()}),require.register("model/Spawner.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.Spawner=void 0;var n=t("./Entity"),o=t("../sprite/Sprite");function s(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,a(i.key),i)}}function a(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}function l(e,t,r){return t=c(t),function(e,t){if(t&&("object"==i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,r||[],c(e).constructor):t.apply(e,r))}function u(){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var i=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=c(e)););return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(arguments.length<3?e:r):n.value}}).apply(null,arguments)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}e.Spawner=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e.sprite=new o.Sprite({session:e.session,src:"./thing.png",width:32,height:32}),(r=l(this,t,[e])).spawnFunction=e.spawnFunction,r.session=e.session,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(t,n.Entity),r=t,(i=[{key:"simulate",value:function(){const e=this.spawnFunction(this.session);var r,i,n,o,s;e.x=this.x,e.y=this.y,this.session.addEntity(e),this.session.removeEntity(this),(r=t,i="simulate",n=this,s=u(c(1&(o=3)?r.prototype:r),i,n),2&o&&"function"==typeof s?function(e){return s.apply(n,e)}:s)([])}}])&&s(r.prototype,i),a&&s(r,a),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,i,a}()}),require.register("overlay/overlay.frag",function(e,t,r){r.exports="precision mediump float;\n\nuniform vec4 u_color;\nvarying vec2 v_texCoord;\n\nvoid main() {\n  // gl_FragColor = texture2D(u_image, v_texCoord);\n  gl_FragColor = vec4(1.0, 1.0, 0.0, 0.25);\n}\n"}),require.register("overlay/overlay.vert",function(e,t,r){r.exports="attribute vec2 a_position;\nattribute vec2 a_texCoord;\n\nuniform vec2 u_resolution;\nvarying vec2 v_texCoord;\n\nvoid main()\n{\n  vec2 zeroToOne = a_position / u_resolution;\n  vec2 zeroToTwo = zeroToOne * 2.0;\n  vec2 clipSpace = zeroToTwo - 1.0;\n\n  gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n  v_texCoord  = a_texCoord;\n}\n"}),require.register("session/Session.js",function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Session=void 0;t("curvature/base/Bag");var i=t("../sprite/Camera"),n=t("../model/Controller"),o=t("../sprite/SpriteSheet"),s=t("../sprite/Sprite"),a=t("../sprite/SpriteBoard"),l=t("../model/Player"),u=t("../world/World"),c=t("../math/QuickTree");function h(e){"@babel/helpers - typeof";return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,d(i.key),i)}}function d(e){var t=function(e,t){if("object"!=h(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=h(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==h(t)?t:t+""}e.Session=function(){return e=function e(t){let r=t.element,c=t.world,h=t.keyboard,f=t.onScreenJoyPad;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.world=new u.World({src:c,session:this}),this.spriteBoard=new a.SpriteBoard({element:r,world:this.world,session:this}),this.fThen=0,this.sThen=0,this.frameLock=60,this.simulationLock=60,this.entities=new Set,this.removed=new WeakSet,this.keyboard=h,this.loaded=!1,this.world.ready.then(()=>{this.loaded=!0;const e=this.player=new l.Player({x:128,y:64,session:this,sprite:new s.Sprite({session:this,spriteSheet:new o.SpriteSheet({source:"./player.tsj"}),width:32,height:48}),controller:new n.Controller({keyboard:h,onScreenJoyPad:f}),camera:i.Camera});this.spriteBoard.following=e,this.addEntity(e)})},(t=[{key:"addEntity",value:function(e){this.entities.add(e),this.spriteBoard.sprites.add(e.sprite),this.world.getMapsForPoint(e.x,e.y).forEach(t=>t.quadTree.add(e))}},{key:"removeEntity",value:function(e){this.entities.delete(e),this.spriteBoard.sprites.delete(e.sprite),c.QuickTree.deleteFromAllTrees(e),this.removed.add(e)}},{key:"simulate",value:function(e){if(!this.loaded)return!1;const t=e-this.sThen;if(0==this.simulationLock||.2+t<1e3/this.simulationLock)return!1;if(this.sThen=e,this.keyboard.update(),!this.player)return!1;this.entities.forEach(e=>e.sprite.visible=!1);const r=this.player,i=this.world.getEntitiesForRect(r.x,r.y,100,100);return i.add(r),i.forEach(e=>{e.simulate(t),this.world.getMapsForRect(e.x,e.y,100,100).forEach(t=>this.removed.has(e)||t.quadTree.move(e)),e.sprite.visible=!0}),!0}},{key:"draw",value:function(e){if(!this.loaded)return;const t=e-this.fThen;return!(0==this.frameLock||.2+t<1e3/this.frameLock)&&(this.spriteBoard.draw(t),this.fThen=e,!0)}}])&&f(e.prototype,t),r&&f(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}()}),require.register("sprite/Camera.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,s(i.key),i)}}function o(e,t,r){return(t=s(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Camera=void 0;let a=e.Camera=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)});o(a,"x",0),o(a,"y",0),o(a,"width",0),o(a,"height",0)}),require.register("sprite/MapRenderer.js",function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MapRenderer=void 0;var i=t("curvature/base/Bindable");function n(e){"@babel/helpers - typeof";return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,s(i.key),i)}}function s(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}e.MapRenderer=function(){return e=function e(t){let r=t.spriteBoard,n=t.map;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this[i.Bindable.Prevent]=!0,this.spriteBoard=r,this.loaded=!1,this.map=n,this.width=0,this.height=0,this.tileWidth=0,this.tileHeight=0,this.xOffset=0,this.yOffset=0;const o=this.spriteBoard.gl2d.context;this.tileMapping=this.spriteBoard.gl2d.createTexture(1,1),this.tileTexture=this.spriteBoard.gl2d.createTexture(1,1);const s=()=>parseInt(255*Math.random());new Uint8Array([s(),s(),s(),255]);n.ready.then(()=>{this.loaded=!0,this.tileWidth=n.tileWidth,this.tileHeight=n.tileHeight,o.bindTexture(o.TEXTURE_2D,this.tileTexture),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,n.tileSetWidth,n.tileSetHeight,0,o.RGBA,o.UNSIGNED_BYTE,n.pixels),o.bindTexture(o.TEXTURE_2D,null)})},(t=[{key:"negSafeMod",value:function(e,t){return e>=0?e%t:(t+e%t)%t}},{key:"draw",value:function(){if(!this.loaded)return;const e=this.spriteBoard.gl2d.context,t=this.spriteBoard.following.sprite.x,r=this.spriteBoard.following.sprite.y,i=this.spriteBoard.gl2d.zoomLevel,n=.5*this.tileWidth,o=.5*this.tileHeight,s=Math.floor(this.width/this.tileWidth),a=Math.floor(this.height/this.tileHeight),l=64*Math.floor(Math.floor(.5*this.width/64)+0),u=64*Math.floor(Math.floor(.5*this.height/64)+0),c=(t+n)/this.tileWidth+-this.negSafeMod(t+n,64)/this.tileWidth+-this.map.xWorld/this.tileWidth+-l/this.tileWidth,h=(r+o)/this.tileHeight+-this.negSafeMod(r+o,64)/this.tileHeight+-this.map.yWorld/this.tileHeight+-u/this.tileHeight;if(c+s<0||h+a<0)return;const f=i*(.5*(this.width+this.xOffset)-this.negSafeMod(t+n,64)-l),d=i*(.5*(this.height+this.yOffset)-this.negSafeMod(r+o,64)-u);this.spriteBoard.drawProgram.uniformF("u_size",this.width,this.height),this.spriteBoard.drawProgram.uniformF("u_tileSize",this.tileWidth,this.tileHeight),this.spriteBoard.drawProgram.uniformF("u_mapTextureSize",this.map.tileSetWidth,this.map.tileSetHeight),this.spriteBoard.drawProgram.uniformI("u_renderTiles",1),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,this.tileTexture),this.spriteBoard.drawProgram.uniformI("u_tiles",2),e.activeTexture(e.TEXTURE3),e.bindTexture(e.TEXTURE_2D,this.tileMapping),this.spriteBoard.drawProgram.uniformI("u_tileMapping",3);const p=this.map.getSlice(c,h,s,a,performance.now()/1e3);for(const t of p)e.texImage2D(e.TEXTURE_2D,0,e.RGBA,s,a,0,e.RGBA,e.UNSIGNED_BYTE,t),this.setRectangle(f+.5*this.tileWidth*i,d+this.tileHeight*i,this.width*i,this.height*i),e.bindFramebuffer(e.FRAMEBUFFER,this.spriteBoard.drawBuffer),e.drawArrays(e.TRIANGLES,0,6);this.spriteBoard.drawProgram.uniformI("u_renderTiles",0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE3),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,null)}},{key:"resize",value:function(e,t){this.width=e+0,this.height=t+0,this.width=128*Math.ceil(e/128)+128,this.height=128*Math.ceil(t/128)+128,this.xOffset=e-this.width,this.yOffset=t-this.height}},{key:"simulate",value:function(){}},{key:"setRectangle",value:function(e,t,r,i){const n=this.spriteBoard.gl2d.context;n.bindBuffer(n.ARRAY_BUFFER,this.spriteBoard.drawProgram.buffers.a_texCoord),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),n.STATIC_DRAW);const o=e,s=e+r,a=t,l=t+i;n.bindBuffer(n.ARRAY_BUFFER,this.spriteBoard.drawProgram.buffers.a_position),n.bufferData(n.ARRAY_BUFFER,new Float32Array([o,l,s,l,o,a,o,a,s,l,s,a]),n.STATIC_DRAW)}}])&&o(e.prototype,t),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}()}),require.register("sprite/Parallax.js",function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Parallax=void 0;var i=t("curvature/base/Bindable");t("./Camera");function n(e){"@babel/helpers - typeof";return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,u(i.key),i)}}function s(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t,r){return(t=u(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}let c=s(function e(){a(this,e),l(this,"texture",null),l(this,"width",0),l(this,"height",0),l(this,"offset",0),l(this,"parallax",0)});e.Parallax=function(){return s(function e(t){let r=t.spriteBoard,n=t.map;a(this,e),this[i.Bindable.Prevent]=!0,this.spriteBoard=r;this.spriteBoard.gl2d.context;this.map=n,this.texture=null,this.height=0,this.slices=["parallax/mountains-0.png","parallax/sky-0-recolor.png","parallax/sky-1-recolor.png","parallax/sky-1b-recolor.png","parallax/sky-2-recolor.png"],this.parallaxLayers=[],this.textures=[],this.ready=n.ready.then(()=>this.assemble(n)).then(()=>{this.loaded=!0}),this.loaded=!1,this.x=0,this.y=0},[{key:"assemble",value:function(){const e=this.spriteBoard.gl2d.context,t=this.map.imageLayers.map((t,r)=>this.constructor.loadImage(t.image).then(i=>{var n,o;const s=this.textures[r]=e.createTexture(),a=this.parallaxLayers[r]=new c,l=i.height+t.offsety;this.height<l&&(this.height=l),a.texture=s,a.width=i.width,a.height=i.height,a.offset=null!==(n=t.offsety)&&void 0!==n?n:0,a.parallax=null!==(o=t.parallaxx)&&void 0!==o?o:1,e.bindTexture(e.TEXTURE_2D,s),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST)}));return Promise.all(t)}},{key:"draw",value:function(){if(!this.loaded)return;const e=this.spriteBoard.gl2d.context,t=this.spriteBoard.gl2d.zoomLevel;this.x=this.spriteBoard.following.sprite.x+-this.spriteBoard.width/t*.5,this.y=this.spriteBoard.following.sprite.y,this.spriteBoard.drawProgram.uniformI("u_renderParallax",1),this.spriteBoard.drawProgram.uniformF("u_scroll",this.x,this.y),e.activeTexture(e.TEXTURE0);for(const r of this.parallaxLayers)e.bindTexture(e.TEXTURE_2D,r.texture),this.spriteBoard.drawProgram.uniformF("u_size",r.width,r.width),this.spriteBoard.drawProgram.uniformF("u_parallax",r.parallax,0),this.setRectangle(0,this.spriteBoard.height+(-this.height+r.offset)*t,r.width*t,r.height*t,r.width),e.bindFramebuffer(e.FRAMEBUFFER,this.spriteBoard.drawBuffer),e.drawArrays(e.TRIANGLES,0,6);this.spriteBoard.drawProgram.uniformI("u_renderParallax",0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindTexture(e.TEXTURE_2D,null)}},{key:"setRectangle",value:function(e,t,r,i){const n=this.spriteBoard.gl2d.context,o=this.spriteBoard.width/r;n.bindBuffer(n.ARRAY_BUFFER,this.spriteBoard.drawProgram.buffers.a_texCoord),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,0,o,0,0,1,0,1,o,0,o,1]),n.STATIC_DRAW);const s=e-0,a=e+this.spriteBoard.width,l=t,u=t+i;n.bindBuffer(n.ARRAY_BUFFER,this.spriteBoard.drawProgram.buffers.a_position),n.bufferData(n.ARRAY_BUFFER,new Float32Array([s,u,a,u,s,l,s,l,a,u,a,l]),n.STATIC_DRAW)}}],[{key:"loadImage",value:function(e){return this.imagePromises||(this.imagePromises={}),this.imagePromises[e]?this.imagePromises[e]:(this.imagePromises[e]=new Promise((t,r)=>{const i=new Image;i.src=e,i.addEventListener("load",e=>{t(i)})}),this.imagePromises[e])}}])}()}),require.register("sprite/Sprite.js",function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Sprite=void 0;var i=t("curvature/base/Bindable"),n=t("./Camera"),o=t("../math/Matrix"),s=t("./SpriteSheet");function a(e){"@babel/helpers - typeof";return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,u(i.key),i)}}function u(e){var t=function(e,t){if("object"!=a(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=a(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==a(t)?t:t+""}e.Sprite=function(){return e=function e(t){let r=t.src,n=t.session,o=t.spriteSheet,a=(t.width,t.height,t.x),l=t.y,u=t.z;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this[i.Bindable.Prevent]=!0,this.x=a||0,this.y=l||0,this.z=u||0,this.currentAnimation=null,this.width=32,this.height=32,this.scale=1,this.visible=!1,this.moving=!1,this.textures=[],this.frames=[],this.currentDelay=0,this.currentFrame=0,this.currentFrames="",this.speed=0,this.maxSpeed=4,this.RIGHT=0,this.DOWN=1,this.LEFT=2,this.UP=3,this.EAST=this.RIGHT,this.SOUTH=this.DOWN,this.WEST=this.LEFT,this.NORTH=this.UP,this.region=[0,0,0,1],this.spriteBoard=n.spriteBoard;const c=this.spriteBoard.gl2d.context;this.texture=c.createTexture(),c.bindTexture(c.TEXTURE_2D,this.texture);const h=()=>parseInt(255*Math.random()),f=new Uint8Array([h(),h(),h(),255]);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,1,1,0,c.RGBA,c.UNSIGNED_BYTE,f),r&&!o&&(o=new s.SpriteSheet({image:r})),this.spriteSheet=o,o&&o.ready.then(()=>{this.width=o.tileWidth,this.height=o.tileHeight,this.texture=this.createTexture(o.getFrame(0));for(let e=0;e<o.tileCount;e++)this.textures[e]=this.createTexture(o.getFrame(e));this.changeAnimation("default")})},(t=[{key:"draw",value:function(e){if(this.currentDelay>0)this.currentDelay-=e;else if(this.currentFrame++,this.spriteSheet&&this.spriteSheet.animations[this.currentAnimation]){const e=this.spriteSheet.animations[this.currentAnimation];this.currentFrame>=e.length&&(this.currentFrame=this.currentFrame%e.length);const t=e[this.currentFrame].tileid,r=this.textures[t];r&&(this.currentDelay=e[this.currentFrame].duration,this.texture=r)}const t=this.spriteBoard.gl2d.context;t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.texture),this.spriteBoard.drawProgram.uniformF("u_region",0,0,0,0);const r=this.spriteBoard.gl2d.zoomLevel;this.setRectangle(this.x*r-n.Camera.x+this.spriteBoard.width/2,this.y*r-n.Camera.y+this.spriteBoard.height/2+-this.height*r,this.width*r,this.height*r),t.bindFramebuffer(t.FRAMEBUFFER,this.spriteBoard.drawBuffer),t.drawArrays(t.TRIANGLES,0,6),this.spriteBoard.drawProgram.uniformF("u_region",...Object.assign(this.region||[0,0,0],{3:1})),t.bindFramebuffer(t.FRAMEBUFFER,this.spriteBoard.effectBuffer),t.drawArrays(t.TRIANGLES,0,6),this.spriteBoard.drawProgram.uniformF("u_region",0,0,0,0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,null)}},{key:"changeAnimation",value:function(e){this.spriteSheet&&this.spriteSheet.animations[e]?this.currentAnimation!==e&&(this.currentAnimation=e,this.currentDelay=0):console.warn(`Animation ${e} not found.`)}},{key:"createTexture",value:function(e){const t=this.spriteBoard.gl2d.context,r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,e),t.bindTexture(t.TEXTURE_2D,null),r}},{key:"setRectangle",value:function(e,t,r,i){arguments.length>4&&void 0!==arguments[4]&&arguments[4];const n=this.spriteBoard.gl2d.context,s=this.spriteBoard.gl2d.zoomLevel;n.bindBuffer(n.ARRAY_BUFFER,this.spriteBoard.drawProgram.buffers.a_texCoord),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),n.STATIC_DRAW);const a=t+32*s,l=e+r,u=t+i+32*s,c=new Float32Array([e,a,l,a,e,u,e,u,l,a,l,u]),h=e+.5*r,f=t+.5*i,d=o.Matrix.transform(c,o.Matrix.composite(o.Matrix.translate(h,f),o.Matrix.translate(-h,-f)));n.bindBuffer(n.ARRAY_BUFFER,this.spriteBoard.drawProgram.buffers.a_position),n.bufferData(n.ARRAY_BUFFER,d,n.STATIC_DRAW)}}])&&l(e.prototype,t),r&&l(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}()}),require.register("sprite/SpriteBoard.js",function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SpriteBoard=void 0;t("curvature/base/Bag");var i=t("curvature/base/Bindable"),n=t("../gl2d/Gl2d"),o=t("./Camera"),s=t("./MapRenderer"),a=t("./Parallax");function l(e){"@babel/helpers - typeof";return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,c(i.key),i)}}function c(e){var t=function(e,t){if("object"!=l(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=l(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==l(t)?t:t+""}e.SpriteBoard=function(){return e=function e(t){let r=t.element,s=t.world;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this[i.Bindable.Prevent]=!0,this.maps=[],this.world=s,this.sprites=new Set,this.currentMap=null,this.mouse={x:null,y:null,clickX:null,clickY:null},this.parallax=null,this.width=r.width,this.height=r.height,o.Camera.width=r.width,o.Camera.height=r.height,this.gl2d=new n.Gl2d(r),this.gl2d.enableBlending();this.renderMode=0,this.drawProgram=this.gl2d.createProgram({vertexShader:this.gl2d.createShader("sprite/texture.vert"),fragmentShader:this.gl2d.createShader("sprite/texture.frag"),attributes:["a_position","a_texCoord"],uniforms:["u_image","u_effect","u_tiles","u_tileMapping","u_size","u_scale","u_scroll","u_stretch","u_tileSize","u_resolution","u_mapTextureSize","u_region","u_parallax","u_time","u_renderTiles","u_renderParallax","u_renderMode"]}),this.drawProgram.use(),this.colorLocation=this.drawProgram.uniforms.u_color,this.tilePosLocation=this.drawProgram.uniforms.u_tileNo,this.regionLocation=this.drawProgram.uniforms.u_region,this.drawLayer=this.gl2d.createTexture(1e3,1e3),this.effectLayer=this.gl2d.createTexture(1e3,1e3),this.drawBuffer=this.gl2d.createFramebuffer(this.drawLayer),this.effectBuffer=this.gl2d.createFramebuffer(this.effectLayer),document.addEventListener("mousemove",e=>{this.mouse.x=e.clientX,this.mouse.y=e.clientY}),this.mapRenderers=new Map,this.following=null},(t=[{key:"draw",value:function(e){if(this.following){o.Camera.x=(16+this.following.sprite.x)*this.gl2d.zoomLevel||0,o.Camera.y=(16+this.following.sprite.y)*this.gl2d.zoomLevel||0;const e=[...this.world.getMapsForPoint(this.following.x,this.following.y)];if(e[0]&&this.currentMap!==e[0]){const t=this.nextParallax=new a.Parallax({spriteBoard:this,map:e[0]});this.nextParallax.ready.then(()=>{this.nextParallax===t&&(this.parallax=t)}),this.currentMap=e[0]}}const t=this.world.getMapsForRect(this.following.sprite.x,this.following.sprite.y,64,64),r=new Set;t.forEach(e=>{if(this.mapRenderers.has(e))return void r.add(this.mapRenderers.get(e));const t=new s.MapRenderer({spriteBoard:this,map:e});r.add(t),t.resize(o.Camera.width,o.Camera.height),this.mapRenderers.set(e,t)}),new Set(this.mapRenderers.keys()).difference(t).forEach(e=>this.mapRenderers.delete(e));const i=this.gl2d.context;if(this.drawProgram.uniformF("u_size",o.Camera.width,o.Camera.height),this.drawProgram.uniformF("u_resolution",i.canvas.width,i.canvas.height),this.drawProgram.uniformI("u_renderMode",this.renderMode),this.drawProgram.uniformF("u_time",performance.now()),this.drawProgram.uniformF("u_region",0,0,0,0),i.viewport(0,0,i.canvas.width,i.canvas.height),i.clearColor(0,0,0,1),i.bindFramebuffer(i.FRAMEBUFFER,this.effectBuffer),i.clear(i.COLOR_BUFFER_BIT),i.bindFramebuffer(i.FRAMEBUFFER,this.drawBuffer),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),i.bindFramebuffer(i.FRAMEBUFFER,null),this.currentMap&&this.currentMap.backgroundColor){const e=this.currentMap.backgroundColor.substr(1),t=parseInt(e.substr(-6,2),16)/255,r=parseInt(e.substr(-4,2),16)/255,n=parseInt(e.substr(-2,2),16)/255,o=8===e.length?parseInt(e.substr(-8,2),16)/255:1;i.clearColor(t,n,r,o)}else i.clearColor(0,0,0,1);i.clear(i.COLOR_BUFFER_BIT),window.smProfiling&&console.time("draw-parallax"),this.parallax&&this.parallax.draw(),window.smProfiling&&console.timeEnd("draw-parallax"),this.drawProgram.uniformF("u_size",o.Camera.width,o.Camera.height),window.smProfiling&&console.time("draw-tiles"),this.mapRenderers.values().forEach(e=>e.draw()),window.smProfiling&&console.timeEnd("draw-tiles"),window.smProfiling&&console.time("draw-sprites");let n=[...this.sprites];n.sort((e,t)=>void 0===e.y?-1:void 0===t.y?1:e.y-t.y),n.forEach(t=>t.visible&&t.draw(e)),window.smProfiling&&console.timeEnd("draw-sprites"),window.smProfiling&&(window.smProfiling=!1),this.setRectangle(0,this.gl2d.element.height,this.gl2d.element.width,-this.gl2d.element.height),i.bindFramebuffer(i.FRAMEBUFFER,null),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this.drawLayer),this.drawProgram.uniformI("u_image",0),i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,this.effectLayer),this.drawProgram.uniformI("u_effect",1),i.drawArrays(i.TRIANGLES,0,6),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,null),i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,null),i.activeTexture(i.TEXTURE4),i.bindTexture(i.TEXTURE_2D,null)}},{key:"resize",value:function(e,t){const r=this.gl2d.context;e=e||this.gl2d.element.width,t=t||this.gl2d.element.height,this.width=e,this.height=t,o.Camera.x*=this.gl2d.zoomLevel,o.Camera.y*=this.gl2d.zoomLevel,o.Camera.width=e/this.gl2d.zoomLevel,o.Camera.height=t/this.gl2d.zoomLevel,this.mapRenderers.values().forEach(e=>e.resize(o.Camera.width,o.Camera.height)),r.bindTexture(r.TEXTURE_2D,this.drawLayer),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,this.width,this.height,0,r.RGBA,r.UNSIGNED_BYTE,null),r.bindTexture(r.TEXTURE_2D,this.effectLayer),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,this.width,this.height,0,r.RGBA,r.UNSIGNED_BYTE,null),r.bindTexture(r.TEXTURE_2D,null)}},{key:"setRectangle",value:function(e,t,r,i){const n=this.gl2d.context;n.bindBuffer(n.ARRAY_BUFFER,this.drawProgram.buffers.a_position);const o=e,s=e+r,a=t,l=t+i;n.bufferData(n.ARRAY_BUFFER,new Float32Array([o,a,s,a,o,l,o,l,s,a,s,l]),n.STREAM_DRAW)}}])&&u(e.prototype,t),r&&u(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}()}),require.register("sprite/SpriteSheet.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.SpriteSheet=void 0;var n=t("./Tileset");function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,s(i.key),i)}}function s(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}function a(e,t,r){return t=l(t),function(e,t){if(t&&("object"==i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,r||[],l(e).constructor):t.apply(e,r))}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}e.SpriteSheet=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=a(this,t,[e])).frames=[],r.animations={default:[{tileid:0,duration:1/0}]},r.canvas=document.createElement("canvas"),r.context=r.canvas.getContext("2d",{willReadFrequently:!0}),r.ready=r.ready.then(()=>{r.processImage();for(const e of r.tiles)e.animation?r.animations[e.type]=e.animation:e.type&&(r.animations[e.type]=[{duration:1/0,tileid:e.id}])}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(t,n.Tileset),r=t,(i=[{key:"processImage",value:function(){this.canvas.width=this.image.width,this.canvas.height=this.image.height,this.context.drawImage(this.image,0,0);for(let e=0;e<this.tileCount;e++)this.frames[e]=this.getFrame(e)}},{key:"getFrame",value:function(e){const t=(e%=this.tileCount)%this.columns,r=Math.floor(e/this.columns);return this.context.getImageData(t*this.tileWidth,r*this.tileHeight,this.tileWidth,this.tileHeight).data}}])&&o(r.prototype,i),s&&o(r,s),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,i,s}()}),require.register("sprite/TextureBank.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,o(i.key),i)}}function o(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.TextureBank=void 0;e.TextureBank=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)})}),require.register("sprite/Tileset.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,o(i.key),i)}}function o(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}Object.defineProperty(e,"__esModule",{value:!0}),e.Tileset=void 0;e.Tileset=function(){return e=function e(t){let r=t.source,i=t.firstgid,n=t.columns,o=t.image,s=t.imageheight,a=t.imagewidth,l=t.margin,u=t.name,c=t.spacing,h=t.tilecount,f=t.tileheight,d=t.tilewidth,p=t.tiles;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.firstGid=null!==i&&void 0!==i?i:0,this.tileCount=null!==h&&void 0!==h?h:0,this.tileHeight=null!==f&&void 0!==f?f:0,this.tileWidth=null!==d&&void 0!==d?d:0,this.ready=this.getReady({source:r,columns:n,image:o,imageheight:s,imagewidth:a,margin:l,name:u,spacing:c,tilecount:h,tileheight:f,tilewidth:d,tiles:p})},(t=[{key:"getReady",value:async function(e){let t=e.source,r=e.columns,i=e.image,n=e.imageheight,o=e.imagewidth,s=e.margin,a=e.name,l=e.spacing,u=e.tilecount,c=e.tileheight,h=e.tilewidth,f=e.tiles;if(t){var d=await(await fetch(t)).json();r=d.columns,i=d.image,n=d.imageheight,o=d.imagewidth,s=d.margin,a=d.name,l=d.spacing,u=d.tilecount,c=d.tileheight,h=d.tilewidth,f=d.tiles;for(const e of f)e.id+=this.firstGid}this.columns=null!==r&&void 0!==r?r:1,this.margin=null!==s&&void 0!==s?s:0,this.name=null!==a&&void 0!==a?a:i,this.spacing=null!==l&&void 0!==l?l:0,this.tiles=null!==f&&void 0!==f?f:[],this.tileCount=null!==u&&void 0!==u?u:1,this.image=new Image,this.image.src=i,await new Promise(e=>this.image.onload=(()=>e())),this.imageWidth=null!==o&&void 0!==o?o:this.image.width,this.imageHeight=null!==n&&void 0!==n?n:this.image.height,this.tileWidth=null!==h&&void 0!==h?h:this.imageWidth,this.tileHeight=null!==c&&void 0!==c?c:this.imageHeight,this.rows=Math.ceil(n/c)||1}}])&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}()}),require.register("sprite/texture.frag",function(e,t,r){r.exports="// texture.frag\n#define M_PI 3.1415926535897932384626433832795\n#define M_TAU M_PI / 2.0\nprecision mediump float;\n\nvarying vec2 v_texCoord;\nvarying vec2 v_position;\n\nuniform sampler2D u_image;\nuniform sampler2D u_effect;\nuniform sampler2D u_tiles;\nuniform sampler2D u_tileMapping;\n\nuniform vec2 u_size;\nuniform vec2 u_tileSize;\nuniform vec2 u_resolution;\nuniform vec2 u_mapTextureSize;\n\nuniform vec4 u_color;\nuniform vec4 u_region;\nuniform vec2 u_parallax;\nuniform vec2 u_scroll;\nuniform vec2 u_stretch;\n\nuniform float u_time;\nuniform float u_scale;\n\nuniform int u_renderTiles;\nuniform int u_renderParallax;\nuniform int u_renderMode;\n\nfloat masked = 0.0;\nfloat sorted = 1.0;\nfloat displace = 1.0;\nfloat blur = 1.0;\n\nvec2 rippleX(vec2 texCoord, float a, float b, float c) {\n  vec2 rippled = vec2(\n    v_texCoord.x + sin(v_texCoord.y * (a * u_size.y) + b) * c / u_size.x,\n    v_texCoord.y\n  );\n\n  if (rippled.x < 0.0) {\n    rippled.x = abs(rippled.x);\n  }\n  else if (rippled.x > u_size.x) {\n    rippled.x = u_size.x - (rippled.x - u_size.x);\n  }\n\n  return rippled;\n}\n\nvec2 rippleY(vec2 texCoord, float a, float b, float c) {\n  vec2 rippled = vec2(v_texCoord.x, v_texCoord.y + sin(v_texCoord.x * (a * u_size.x) + b) * c / u_size.y);\n\n  if (rippled.y < 0.0) {\n    rippled.x = abs(rippled.x);\n  }\n  else if (rippled.y > u_size.y) {\n    rippled.y = u_size.y - (rippled.y - u_size.y);\n  }\n\n  return rippled;\n}\n\nvec4 motionBlur(sampler2D image, float angle, float magnitude, vec2 textCoord) {\n  vec4 originalColor = texture2D(image, textCoord);\n  vec4 dispColor = originalColor;\n\n  const float max = 10.0;\n  float weight = 0.85;\n\n  for (float i = 0.0; i < max; i += 1.0) {\n    if(i > abs(magnitude) || originalColor.a < 1.0) {\n      break;\n    }\n    vec4 dispColorDown = texture2D(image, textCoord + vec2(\n      cos(angle) * i * sign(magnitude) / u_size.x,\n      sin(angle) * i * sign(magnitude) / u_size.y\n    ));\n    dispColor = dispColor * (1.0 - weight) + dispColorDown * weight;\n    weight *= 0.8;\n  }\n\n  return dispColor;\n}\n\nvec4 linearBlur(sampler2D image, float angle, float magnitude, vec2 textCoord) {\n  vec4 originalColor = texture2D(image, textCoord);\n  vec4 dispColor = texture2D(image, textCoord);\n\n  const float max = 10.0;\n  float weight = 0.65;\n\n  for (float i = 0.0; i < max; i += 0.25) {\n    if(i > abs(magnitude)) {\n      break;\n    }\n    vec4 dispColorUp = texture2D(image, textCoord + vec2(\n      cos(angle) * -i * sign(magnitude) / u_size.x,\n      sin(angle) * -i * sign(magnitude) / u_size.y\n    ));\n    vec4 dispColorDown = texture2D(image, textCoord + vec2(\n      cos(angle) * i * sign(magnitude) / u_size.x,\n      sin(angle) * i * sign(magnitude) / u_size.y\n    ));\n    dispColor = dispColor * (1.0 - weight) + dispColorDown * weight * 0.5 + dispColorUp * weight * 0.5;\n    weight *= 0.70;\n  }\n\n  return dispColor;\n}\n\nvoid main() {\n  vec4 originalColor = texture2D(u_image, v_texCoord);\n  vec4 effectColor = texture2D(u_effect,  v_texCoord);\n\n  // This only applies when drawing the parallax background\n  if (u_renderParallax == 1) {\n\n    float texelSize = 1.0 / u_size.x;\n\n    vec2 parallaxCoord = v_texCoord * vec2(1.0, -1.0) + vec2(0.0, 1.0)\n      + vec2(u_scroll.x * texelSize * u_parallax.x, 0.0);\n      // + vec2(u_time / 10000.0, 0.0);\n      // + vec2(, 0.0);\n      ;\n\n    gl_FragColor = texture2D(u_image,  parallaxCoord);\n\n    return;\n  }\n\n  // This only applies when drawing tiles.\n  if (u_renderTiles == 1) {\n    float xTiles = floor(u_size.x / u_tileSize.x);\n    float yTiles = floor(u_size.y / u_tileSize.y);\n\n    float xT = (v_texCoord.x * u_size.x) / u_tileSize.x;\n    float yT = (v_texCoord.y * u_size.y) / u_tileSize.y;\n\n    float inv_xTiles = 1.0 / xTiles;\n    float inv_yTiles = 1.0 / yTiles;\n\n    float xTile = floor(xT) * inv_xTiles;\n    float yTile = floor(yT) * inv_yTiles;\n\n    float xOff = (xT * inv_xTiles - xTile) * xTiles;\n    float yOff = (yT * inv_yTiles - yTile) * yTiles * -1.0 + 1.0;\n\n    float xWrap = u_mapTextureSize.x / u_tileSize.x;\n    float yWrap = u_mapTextureSize.y / u_tileSize.y;\n\n    // Mode 1 draws tiles' x/y values as red & green\n    if (u_renderMode == 1) {\n      gl_FragColor = vec4(xTile, yTile, 0, 1.0);\n      return;\n    }\n\n    // Mode 2 is the same as mode 1 but adds combines\n    // internal tile x/y to the blue channel\n    if (u_renderMode == 2) {\n      gl_FragColor = vec4(xTile, yTile, (xOff + yOff) * 0.5, 1.0);\n      return;\n    }\n\n    vec4 tile = texture2D(u_tileMapping, v_texCoord * vec2(1.0, -1.0) + vec2(0.0, 1.0));\n\n    float lo = tile.r * 256.0;\n    float hi = tile.g * 256.0 * 256.0;\n\n    float tileNumber = lo + hi;\n\n    if (tileNumber == 0.0) {\n      gl_FragColor.a = 0.0;\n      return;\n    }\n\n    // Mode 3 uses the tile number for the red/green channels\n    if (u_renderMode == 3) {\n      gl_FragColor = tile;\n      gl_FragColor.b = 0.5;\n      gl_FragColor.a = 1.0;\n      return;\n    }\n\n    // Mode 4 normalizes the tile number to all channels\n    if (u_renderMode == 4) {\n      gl_FragColor = vec4(\n        mod(tileNumber, 256.0) / 256.0\n        , mod(tileNumber, 256.0) / 256.0\n        , mod(tileNumber, 256.0) / 256.0\n        , 1.0\n      );\n      return;\n    }\n\n    float tileSetX = floor(mod((-1.0 + tileNumber), xWrap));\n    float tileSetY = floor((-1.0 + tileNumber) / xWrap);\n\n    vec4 tileColor = texture2D(u_tiles, vec2(\n      xOff / xWrap + tileSetX * (u_tileSize.y / u_mapTextureSize.y)\n      , yOff / yWrap + tileSetY * (u_tileSize.y / u_mapTextureSize.y)\n    ));\n\n    gl_FragColor = tileColor;\n\n    return;\n  }\n\n  // This if/else block only applies\n  // when we're drawing the effectBuffer\n  if (u_region.r > 0.0 || u_region.g > 0.0 || u_region.b > 0.0) {\n    if (masked < 1.0 || originalColor.a > 0.0) {\n      gl_FragColor = u_region;\n    }\n    return;\n  }\n  else if (u_region.a > 0.0) {\n    if (sorted > 0.0) {\n      gl_FragColor = vec4(0, 0, 0, originalColor.a > 0.0 ? 1.0 : 0.0);\n    }\n    else {\n      gl_FragColor = vec4(0, 0, 0, 0.0);\n    }\n    return;\n  };\n\n  // Mode 5 draws the effect buffer to the screen\n  if (u_renderMode == 5) {\n    gl_FragColor = effectColor;\n    return;\n  }\n\n  vec3 ripple = vec3(M_PI/8.0, u_time / 200.0, 1.0);\n\n  // This if/else block only applies\n  // when we're drawing the drawBuffer\n  if (effectColor == vec4(0, 1, 1, 1)) { // Water region\n    vec2 texCoord = v_texCoord;\n    vec4 v_blurredColor = originalColor;\n    if (displace > 0.0) {\n      texCoord = rippleX(v_texCoord, ripple.x, ripple.y, ripple.z);\n      v_blurredColor = texture2D(u_image, texCoord);\n    }\n    if (blur > 0.0) {\n      v_blurredColor = linearBlur(u_image, 0.0, 1.0, texCoord);\n    }\n    gl_FragColor = v_blurredColor * 0.65 + effectColor * 0.35;\n  }\n  else if (effectColor == vec4(1, 0, 0, 1)) { // Fire region\n    vec2 v_displacement = rippleY(v_texCoord, ripple.x * 3.0, ripple.y * 1.5, ripple.z * 0.333);\n    vec4 v_blurredColor = originalColor;\n    if (displace > 0.0) {\n      v_blurredColor = texture2D(u_image, v_displacement);\n    }\n    if (blur > 0.0) {\n      v_blurredColor = motionBlur(u_image, -M_TAU, 1.0, v_displacement);\n    }\n    gl_FragColor = v_blurredColor * 0.75 + effectColor * 0.25;\n  }\n  else { // Null region\n    gl_FragColor = originalColor;\n  }\n}\n"}),require.register("sprite/texture.vert",function(e,t,r){r.exports="// texture.vert\nprecision mediump float;\n\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\n\nuniform vec2 u_resolution;\n\nvarying vec2 v_texCoord;\nvarying vec2 v_position;\n\nvoid main()\n{\n  vec2 zeroToOne = a_position / u_resolution;\n  vec2 zeroToTwo = zeroToOne * 2.0;\n  vec2 clipSpace = zeroToTwo - 1.0;\n\n  gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n  v_texCoord  = a_texCoord;\n  v_position  = a_position;\n}\n"}),require.register("ui/Controller.js",function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.Controller=void 0;var n=t("curvature/base/View");function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,s(i.key),i)}}function s(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}function a(e,t,r){return t=l(t),function(e,t){if(t&&("object"==i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,r||[],l(e).constructor):t.apply(e,r))}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}e.Controller=function(e){function r(e){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(i=a(this,r,[e])).template=t("./controller.tmp"),i.dragStart=!1,i.args.dragging=!1,i.args.x=0,i.args.y=0,window.addEventListener("mousemove",e=>{i.moveStick(e)}),window.addEventListener("mouseup",e=>{i.dropStick(e)}),window.addEventListener("touchmove",e=>{i.moveStick(e)}),window.addEventListener("touchend",e=>{i.dropStick(e)}),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(r,n.View),i=r,(s=[{key:"dragStick",value:function(e){let t=e;e.preventDefault(),e.touches&&e.touches[0]&&(t=e.touches[0]),this.args.dragging=!0,this.dragStart={x:t.clientX,y:t.clientY}}},{key:"moveStick",value:function(e){if(this.args.dragging){let t=e;e.touches&&e.touches[0]&&(t=e.touches[0]),this.args.xx=t.clientX-this.dragStart.x,this.args.yy=t.clientY-this.dragStart.y;const r=50;this.args.xx<-r?this.args.x=-r:this.args.xx>r?this.args.x=r:this.args.x=this.args.xx,this.args.yy<-r?this.args.y=-r:this.args.yy>r?this.args.y=r:this.args.y=this.args.yy}}},{key:"dropStick",value:function(e){this.args.dragging=!1,this.args.x=0,this.args.y=0}}])&&o(i.prototype,s),l&&o(i,l),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,s,l}()}),require.register("ui/controller.tmp.html",function(e,t,r){r.exports='<div class = "controller">\n\t<div class = "joystick" cv-on = "\n\t\ttouchstart:dragStick(event);\n\t\tmousedown:dragStick(event);\n\t">\n\t\t<div class = "pad" style = "position: relative; transform:translate([[x]]px,[[y]]px);"></div>\n\t</div>\n\n\t<div class = "button">A</div>\n\t<div class = "button">B</div>\n\t<div class = "button">C</div>\n</div>'}),require.register("world/TileMap.js",function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TileMap=void 0;var i=t("curvature/base/Bindable"),n=t("../sprite/Tileset"),o=t("../math/QuickTree"),s=(t("../model/Player"),t("../model/Pushable")),a=t("../model/Spawner"),l=t("../sprite/Sprite");function u(e){"@babel/helpers - typeof";return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach(function(t){f(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function f(e,t,r){return(t=p(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function d(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,p(i.key),i)}}function p(e){var t=function(e,t){if("object"!=u(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=u(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==u(t)?t:t+""}const y={"@barrel":e=>new s.Pushable({sprite:new l.Sprite({src:"./barrel.png",session:e}),session:e})};e.TileMap=function(){return e=function e(t){let r=t.fileName,n=t.session,s=t.x,a=t.y,l=t.width,u=t.height;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this[i.Bindable.Prevent]=!0,this.image=document.createElement("img"),this.src=r,this.pixels=[],this.tileCount=0,this.backgroundColor=null,this.session=n,this.properties={},this.emptyTiles=new Set,this.tilesIndexes=new Map,this.canvases=new Map,this.contexts=new Map,this.tiles=null,this.tileLayers=[],this.imageLayers=[],this.objectLayers=[],this.xWorld=s,this.yWorld=a,this.width=l,this.height=u,this.tileWidth=0,this.tileHeight=0,this.tileSetWidth=0,this.tileSetHeight=0,this.ready=this.getReady(r),this.animations=new Map,this.quadTree=new o.QuickTree(s,s,s+this.width,a+this.height)},(t=[{key:"getReady",value:async function(e){const t=await(await fetch(e)).json();if(this.collisionLayers=t.layers.filter(e=>"tilelayer"===e.type&&"collision"===e.class),this.tileLayers=t.layers.filter(e=>"tilelayer"===e.type&&"collision"!==e.class),this.imageLayers=t.layers.filter(e=>"imagelayer"===e.type),this.objectLayers=t.layers.filter(e=>"objectgroup"===e.type),this.backgroundColor=t.backgroundcolor,t.properties)for(const e of t.properties)this.properties[e.name]=e.value;this.properties.backgroundColor&&(this.backgroundColor=this.properties.backgroundColor);const r=t.tilesets.map(e=>new n.Tileset(e));return this.width=t.width,this.height=t.height,this.tileWidth=t.tilewidth,this.tileHeight=t.tileheight,await Promise.all(r.map(e=>e.ready)),this.assemble(r),this.spawn(),this}},{key:"assemble",value:function(e){e.sort((e,t)=>e.firstGid-t.firstGid);const t=this.tileCount=e.reduce((e,t)=>e.tileCount+t.tileCount,{tileCount:0}),r=Math.ceil(Math.sqrt(t)),i=document.createElement("canvas");this.tileSetWidth=i.width=r*this.tileWidth,this.tileSetHeight=i.height=Math.ceil(t/r)*this.tileHeight;const n=i.getContext("2d",{willReadFrequently:!0});for(const t of e){const e=t.image,r=document.createElement("canvas");r.width=e.width,r.height=e.height;const o=r.getContext("2d",{willReadFrequently:!0});o.drawImage(e,0,0);for(let e=0;e<t.tileCount;e++){const r=e*this.tileWidth%t.imageWidth,s=Math.floor(e*this.tileWidth/t.imageWidth)*this.tileHeight,a=e*this.tileWidth%i.width,l=Math.floor(e*this.tileWidth/i.width)*this.tileHeight,u=o.getImageData(r,s,this.tileWidth,this.tileHeight);n.putImageData(u,a,l);const c=new Uint32Array(u.data.buffer);let h=!0;for(const e of c)e>0&&(h=!1);h&&this.emptyTiles.add(e)}for(const e of t.tiles)e.animation&&this.animations.set(e.id,e.animation)}this.pixels=n.getImageData(0,0,i.width,i.height).data,this.tiles=n;for(const e of[...this.tileLayers,...this.collisionLayers]){const t=document.createElement("canvas"),r=t.getContext("2d",{willReadFrequently:!0});this.canvases.set(e,t),this.contexts.set(e,r);const i=new Uint32Array(e.data.map(e=>0+e)),n=new Uint8ClampedArray(i.buffer);for(const e in i){const t=i[e];this.animations.has(t)&&console.log({i:e,tile:t},this.animations.get(t))}for(let e=3;e<n.length;e+=4)n[e]=255;this.tilesIndexes.set(e,i),t.width=this.width,t.height=this.height,r.putImageData(new ImageData(n,this.width,this.height),0,0)}}},{key:"spawn",value:function(){for(const e of this.objectLayers){const t=e.objects;for(const e of t)if(y[e.type]){const t=new a.Spawner(h(h({spawnFunction:y[e.type]},e),{},{spriteBoard:this.session.spriteBoard,session:this.session,world:this.session.world}));t.x+=this.xWorld,t.y+=this.yWorld,this.session.addEntity(t)}}}},{key:"getCollisionTile",value:function(e,t,r){return!(!this.collisionLayers||!this.collisionLayers[r])&&this.getTileFromLayer(this.collisionLayers[r],e,t)}},{key:"getColor",value:function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.getPixel(this.tileLayers[r],e,t,r)}},{key:"getSolid",value:function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this.collisionLayers||!this.collisionLayers[r])return!1;const i=this.getPixel(this.collisionLayers[r],e,t,r);return 0===i||i}},{key:"getPixel",value:function(e,t,r){const i=this.getTileFromLayer(e,t,r);if(!1===i||-1===i)return!1;const n=Math.trunc(t%this.tileWidth),o=Math.trunc(r%this.tileHeight),s=i*this.tileWidth%this.tileSetWidth,a=Math.floor(i*this.tileWidth/this.tileSetWidth);return this.pixels[s+n+(a+o)*this.tileSetWidth]}},{key:"getTileFromLayer",value:function(e,t,r){const i=-this.xWorld+t,n=-this.yWorld+r;if(i<0||i>=this.width*this.tileWidth||n<0||n>=this.height*this.tileWidth)return!1;const o=Math.floor(i/this.tileWidth),s=Math.floor(n/this.tileHeight);return-1+e.data[o+s*this.width]}},{key:"getSlice",value:function(e,t,r,i){arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.tileLayers.map(e=>this.contexts.get(e)).map(n=>n.getImageData(e,t,r,i).data)}}])&&d(e.prototype,t),r&&d(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}()}),require.register("world/World.js",function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.World=void 0;var i=t("curvature/base/Bindable"),n=t("../math/Rectangle"),o=t("./TileMap"),s=t("../math/SMTree");function a(e){"@babel/helpers - typeof";return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach(function(t){c(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function c(e,t,r){return(t=f(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function h(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,f(i.key),i)}}function f(e){var t=function(e,t){if("object"!=a(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=a(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==a(t)?t:t+""}e.World=function(){return e=function e(t){let r=t.src,n=t.session;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this[i.Bindable.Prevent]=!0,this.ready=this.getReady(r),this.maps=[],this.mTree=new s.SMTree,this.rectMap=new Map,this.session=n},(t=[{key:"getReady",value:async function(e){const t=await(await fetch(e)).json();return await Promise.all(t.maps.map((e,t)=>{const r=new o.TileMap(u(u({},e),{},{session:this.session}));r.xWorld=e.x,r.yWorld=e.y,this.maps[t]=r;const i=new n.Rectangle(e.x,e.y,e.x+e.width,e.y+e.height);return this.rectMap.set(i,r),this.mTree.add(i),r.ready}))}},{key:"getMapsForPoint",value:function(e,t){const r=this.mTree.query(e,t,e,t),i=new Set;for(const e of r){const t=this.rectMap.get(e);i.add(t)}return i}},{key:"getMapsForRect",value:function(e,t,r,i){const n=new Set,o=this.mTree.query(e+.5*-r,t+.5*-i,e+.5*r,t+.5*i);window.smProfiling&&console.time("query mapTree");for(const e of o)n.add(this.rectMap.get(e));return window.smProfiling&&console.timeEnd("query mapTree"),n}},{key:"getSolid",value:function(e,t,r){const i=this.getMapsForPoint(e,t);for(const n of i){const i=n.getSolid(e,t,r);if(i)return i}return null}},{key:"getCollisionTile",value:function(e,t,r){const i=this.getMapsForPoint(e,t);for(const n of i){const i=n.getCollisionTile(e,t,r);if(i>0)return i}return null}},{key:"getEntitiesForRect",value:function(e,t,r,i){const n=this.getMapsForRect(e,t,r,i);let o=new Set;window.smProfiling&&console.time("query quadTree");for(const s of n)o=o.union(s.quadTree.select(e+.5*-r,t+.5*-i,r,i));return window.smProfiling&&console.timeEnd("query quadTree"),o}}])&&h(e.prototype,t),r&&h(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}()}),require.register("___globals___",function(e,t,r){})}(),require("___globals___");
